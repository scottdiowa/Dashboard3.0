import{t as ys,c as ps,f as L,p as Ne,r as _,j as e,V as jt,R as Et,a as st,A as St,C as Tt,X as Rt,T as Ct,D as kt,P as _s,b as bs,S as Ns,u as ws,B as vs,d as se,F as at,e as re,U as Dt,M as js,g as Es,W as Ss,h as Le,L as He,i as ue,k as Lt,l as Ts,m as At,n as Rs,o as It,I as Mt,q as Ot,s as Ft,v as Ut,w as Vt,x as qt,y as Pt,z as zt,E as Cs,G as ks,H as Ds,J as Wt,K as Ls,N as xe,O,Q as V,Y as Ve,Z as Ht,_ as As,$ as $t,a0 as Gt,a1 as Me,a2 as Oe,a3 as Qt,a4 as Is,a5 as Ms,a6 as Kt,a7 as Os,a8 as Fs,a9 as Us,aa as Vs,ab as qs,ac as Yt,ad as Ps,ae as zs,af as xt,ag as rt,ah as Qe,ai as le,aj as Ce,ak as Y,al as Z,am as pe,an as ye,ao as Ie,ap as we,aq as ve,ar as je,as as Ee,at as Se,au as Ws,av as de,aw as Bt,ax as Hs,ay as Jt,az as Pe,aA as be,aB as nt,aC as $e,aD as fe,aE as $s,aF as qe,aG as ht,aH as Te,aI as Re,aJ as Gs,aK as Qs,aL as Ks,aM as Ys,aN as De,aO as Bs,aP as Js,aQ as Xs,aR as gt,aS as Zs,aT as ea,aU as Xt,aV as ta,aW as Zt,aX as es,aY as sa,aZ as ts,a_ as aa,a$ as ss,b0 as as,b1 as ra,b2 as na,b3 as rs,b4 as ia,b5 as oa,b6 as la,b7 as da,b8 as ca,b9 as ma,ba as ua,bb as xa,bc as ha,bd as ga}from"./vendor-CQwfuuxl.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const y of o)if(y.type==="childList")for(const c of y.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const y={};return o.integrity&&(y.integrity=o.integrity),o.referrerPolicy&&(y.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?y.credentials="include":o.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function d(o){if(o.ep)return;o.ep=!0;const y=n(o);fetch(o.href,y)}})();function S(...s){return ys(ps(s))}function ae(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function X(s,i=1){return`${s.toFixed(i)}%`}function ce(s){const i=typeof s=="string"?new Date(Number(s.slice(0,4)),Number(s.slice(5,7))-1,Number(s.slice(8,10))):s;return L(i,"MMM dd, yyyy")}function fa(s){return L(Ne(`2000-01-01T${s}`),"h:mm a")}function ns(s){switch(s.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const ya=_s,is=_.forwardRef(({className:s,...i},n)=>e.jsx(jt,{ref:n,className:S("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...i}));is.displayName=jt.displayName;const pa=st("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),os=_.forwardRef(({className:s,variant:i,...n},d)=>e.jsx(Et,{ref:d,className:S(pa({variant:i}),s),...n}));os.displayName=Et.displayName;const _a=_.forwardRef(({className:s,...i},n)=>e.jsx(St,{ref:n,className:S("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...i}));_a.displayName=St.displayName;const ls=_.forwardRef(({className:s,...i},n)=>e.jsx(Tt,{ref:n,className:S("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...i,children:e.jsx(Rt,{className:"h-4 w-4"})}));ls.displayName=Tt.displayName;const ds=_.forwardRef(({className:s,...i},n)=>e.jsx(Ct,{ref:n,className:S("text-sm font-semibold",s),...i}));ds.displayName=Ct.displayName;const cs=_.forwardRef(({className:s,...i},n)=>e.jsx(kt,{ref:n,className:S("text-sm opacity-90",s),...i}));cs.displayName=kt.displayName;const ba=1,Na=1e6;let Be=0;function wa(){return Be=(Be+1)%Number.MAX_SAFE_INTEGER,Be.toString()}const Je=new Map,ft=s=>{if(Je.has(s))return;const i=setTimeout(()=>{Je.delete(s),Ae({type:"REMOVE_TOAST",toastId:s})},Na);Je.set(s,i)},va=(s,i)=>{switch(i.type){case"ADD_TOAST":return{...s,toasts:[i.toast,...s.toasts].slice(0,ba)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(n=>n.id===i.toast.id?{...n,...i.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=i;return n?ft(n):s.toasts.forEach(d=>{ft(d.id)}),{...s,toasts:s.toasts.map(d=>d.id===n||n===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return i.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(n=>n.id!==i.toastId)}}},ze=[];let We={toasts:[]};function Ae(s){We=va(We,s),ze.forEach(i=>{i(We)})}function ja({...s}){const i=wa(),n=o=>Ae({type:"UPDATE_TOAST",toast:{...o,id:i}}),d=()=>Ae({type:"DISMISS_TOAST",toastId:i});return Ae({type:"ADD_TOAST",toast:{...s,id:i,open:!0,onOpenChange:o=>{o||d()}}}),{id:i,dismiss:d,update:n}}function ne(){const[s,i]=_.useState(We);return _.useEffect(()=>(ze.push(i),()=>{const n=ze.indexOf(i);n>-1&&ze.splice(n,1)}),[s]),{...s,toast:ja,dismiss:n=>Ae({type:"DISMISS_TOAST",toastId:n})}}function Ea(){const{toasts:s}=ne();return e.jsxs(ya,{children:[s.map(function({id:i,title:n,description:d,action:o,...y}){return e.jsxs(os,{...y,children:[e.jsxs("div",{className:"grid gap-1",children:[n&&e.jsx(ds,{children:n}),d&&e.jsx(cs,{children:d})]}),o,e.jsx(ls,{})]},i)}),e.jsx(is,{})]})}const Sa="https://qewndmyixpzmtgjjihoj.supabase.co",Ta="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",j=bs(Sa,Ta,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),C=_.forwardRef(({className:s,type:i,...n},d)=>e.jsx("input",{type:i,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:d,...n}));C.displayName="Input";const Xe=st("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),R=_.forwardRef(({className:s,variant:i,size:n,asChild:d=!1,...o},y)=>{const c=d?Ns:"button";return e.jsx(c,{className:S(Xe({variant:i,size:n,className:s})),ref:y,...o})});R.displayName="Button";const yt=[{name:"Overview",href:"/overview",icon:vs,description:"Key metrics and trends",category:"main",priority:"high"},{name:"Omega Daily",href:"/omega-daily",icon:se,description:"Daily business metrics",category:"main",priority:"high"},{name:"Weekending Sheet",href:"/weekending-sheet",icon:at,description:"Weekly operational data",category:"main",priority:"high"},{name:"Calendar",href:"/calendar",icon:re,description:"Events and reminders",category:"main",priority:"medium"},{name:"Interviews & Hires",href:"/interviews",icon:Dt,description:"Manage candidates and hiring",category:"main",priority:"medium"},{name:"OSAT",href:"/smg",icon:js,description:"Customer feedback metrics",category:"main",priority:"medium"},{name:"Goal Setting",href:"/goals",icon:Es,description:"Set goals & track progress",category:"main",priority:"medium"},{name:"Setup",href:"/setup",icon:Ss,description:"Copy SQL & configure",category:"main",priority:"low"}],ms=_.forwardRef(({open:s,isMobile:i,onClose:n},d)=>{const o=ws(),[y,c]=_.useState(""),[h,f]=_.useState(null),v=_.useMemo(()=>{if(!y.trim())return yt;const r=y.toLowerCase();return yt.filter(m=>m.name.toLowerCase().includes(r)||m.description.toLowerCase().includes(r))},[y]),u=()=>{i&&n()};return i?e.jsx("div",{ref:d,className:S("fixed top-0 left-0 w-80 h-full bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",s?"translate-x-0":"-translate-x-full"),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("h2",{className:"font-semibold text-wendys-charcoal",children:"Navigation"})]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:n,className:"tap","aria-label":"Close navigation",children:"×"})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{placeholder:"Search navigation...",value:y,onChange:r=>c(r.target.value),className:"pl-10 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-2",children:v.map(r=>{const m=o.pathname===r.href,T=r.icon;return e.jsxs(He,{to:r.href,onClick:u,className:S("flex items-center space-x-3 p-4 rounded-lg transition-all duration-200 tap",m?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg":"text-gray-700 hover:bg-gray-50"),children:[e.jsx("div",{className:S("flex-shrink-0 p-2 rounded-lg",m?"bg-white/20":"bg-gray-100"),children:e.jsx(T,{className:S("h-5 w-5",m?"text-white":"text-gray-600")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:S("font-semibold text-sm",m?"text-white":"text-gray-800"),children:r.name}),r.priority==="high"&&e.jsx(ue,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:S("text-xs mt-1",m?"text-red-100":"text-gray-500"),children:r.description})]})]},r.href)})}),y.trim()&&v.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-xs mt-1",children:"Try a different search term"})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})}):e.jsx("div",{className:S("bg-gradient-to-b from-white to-gray-50 shadow-2xl border-r border-gray-200 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",s?"w-64":"w-16"),children:e.jsxs("div",{className:"flex flex-col h-full relative",children:[s&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{placeholder:"Search navigation...",value:y,onChange:r=>c(r.target.value),className:"pl-10 h-9 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:S("overflow-y-auto flex-1",s?"p-4":"p-2"),children:[e.jsx("div",{className:"space-y-1",children:v.map(r=>{const m=o.pathname===r.href,T=r.icon;return e.jsxs("div",{className:"relative",children:[e.jsxs(He,{to:r.href,className:S("flex items-center transition-all duration-200 group relative",s?"space-x-3 p-3 rounded-lg mx-0":"justify-center p-3 rounded-lg mx-1",m?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg ring-1 ring-red-200":"text-gray-700 hover:bg-white hover:shadow-sm hover:ring-1 hover:ring-gray-200"),onMouseEnter:()=>!s&&f(r.href),onMouseLeave:()=>!s&&f(null),children:[e.jsx("div",{className:S("flex-shrink-0 p-2 rounded-lg transition-all duration-200",m?"bg-white/20":"bg-gray-100 group-hover:bg-wendys-red/10 group-hover:scale-110"),children:e.jsx(T,{className:S("h-5 w-5 transition-colors duration-200",m?"text-white":"text-gray-600 group-hover:text-wendys-red")})}),s&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:S("font-semibold text-sm",m?"text-white":"text-gray-800"),children:r.name}),r.priority==="high"&&e.jsx(ue,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:S("text-xs mt-1",m?"text-red-100":"text-gray-500"),children:r.description})]})]}),!s&&h===r.href&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 transform -translate-y-1/2 z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-sm px-3 py-2 rounded-lg shadow-lg whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsx("div",{className:"text-gray-300 text-xs mt-1",children:r.description}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-900 rotate-45"})]})})]},r.href)})}),y.trim()&&v.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Try a different search term"})]})]}),s&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})})});ms.displayName="RightNavDrawer";const Ra=Cs,Ca=ks,ka=_.forwardRef(({className:s,inset:i,children:n,...d},o)=>e.jsxs(Lt,{ref:o,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",i&&"pl-8",s),...d,children:[n,e.jsx(Ts,{className:"ml-auto h-4 w-4"})]}));ka.displayName=Lt.displayName;const Da=_.forwardRef(({className:s,...i},n)=>e.jsx(At,{ref:n,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i}));Da.displayName=At.displayName;const us=_.forwardRef(({className:s,sideOffset:i=4,...n},d)=>e.jsx(Rs,{children:e.jsx(It,{ref:d,sideOffset:i,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));us.displayName=It.displayName;const xs=_.forwardRef(({className:s,inset:i,...n},d)=>e.jsx(Mt,{ref:d,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i&&"pl-8",s),...n}));xs.displayName=Mt.displayName;const La=_.forwardRef(({className:s,children:i,checked:n,...d},o)=>e.jsxs(Ot,{ref:o,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:n,...d,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(Ut,{className:"h-4 w-4"})})}),i]}));La.displayName=Ot.displayName;const Aa=_.forwardRef(({className:s,children:i,...n},d)=>e.jsxs(Vt,{ref:d,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(qt,{className:"h-2 w-2 fill-current"})})}),i]}));Aa.displayName=Vt.displayName;const Ia=_.forwardRef(({className:s,inset:i,...n},d)=>e.jsx(Pt,{ref:d,className:S("px-2 py-1.5 text-sm font-semibold",i&&"pl-8",s),...n}));Ia.displayName=Pt.displayName;const Ma=_.forwardRef(({className:s,...i},n)=>e.jsx(zt,{ref:n,className:S("-mx-1 my-1 h-px bg-muted",s),...i}));Ma.displayName=zt.displayName;function Oa({user:s,onNavToggle:i,navOpen:n}){const{toast:d}=ne(),o=async()=>{try{await j.auth.signOut(),d({title:"Signed out",description:"You have been successfully signed out."})}catch(y){console.error("Error signing out:",y),d({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:i,className:"tap p-2 hover:bg-gray-100","aria-label":n?"Close navigation":"Open navigation",children:e.jsx(Ds,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm sm:text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-bold text-wendys-charcoal",children:[e.jsx("span",{className:"hidden sm:inline",children:"SE 14th GM Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Dashboard"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 hide-on-mobile",children:L(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:e.jsxs(Ra,{children:[e.jsx(Ca,{asChild:!0,children:e.jsxs(R,{variant:"ghost",className:"flex items-center space-x-1 sm:space-x-2 tap",children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:s.email})]})}),e.jsx(us,{align:"end",children:e.jsxs(xs,{onClick:o,children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const Fa=xe({business_date:V().min(1,"Business date is required"),net_sales:O.number().min(0,"Net sales must be positive"),last_year_sales:O.number().min(0,"Last year sales must be positive"),labor_hours:O.number().min(0,"Labor hours must be positive"),ideal_labor_hours:O.number().min(0,"Ideal labor hours must be positive"),labor_percentage:O.number().min(0,"Labor percentage must be positive"),food_variance_cost:O.number(),waste_amount:O.number().min(0,"Waste amount must be positive"),breakfast_sales:O.number().min(0,"Breakfast sales must be positive"),night_sales:O.number().min(0,"Night sales must be positive")}),Ua=xe({date:V().min(1,"Date is required"),accuracy_decimal:Ve().min(0,"Accuracy must be 0 or greater"),zod_per_10k:Ve().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:Ve().min(0,"CC Complaints must be 0 or greater"),osat_decimal:Ve().min(0,"OSAT Score must be 0 or greater"),notes:V().optional()});xe({candidate_name:V().min(1,"Candidate name is required"),phone:V().optional(),email:V().email("Invalid email format").optional().or(As("")),position:V().optional(),interview_date:V().min(1,"Interview date is required"),interview_time:V().min(1,"Interview time is required"),status:Ht(["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"]),notes:V().optional()});xe({entry_date:V().min(1,"Entry date is required"),accuracy_of_order:O.number().min(0).max(5).optional(),zone_of_defection:O.number().min(0).max(5).optional(),customer_computers:O.number().min(0).max(5).optional(),taste_of_food:O.number().min(0).max(5).optional(),osat:O.number().min(0).max(5).optional()});xe({documents_received:$t().default(!1),documents_folder:V().optional(),onboarding_sent_date:V().optional(),onboarding_completed_date:V().optional(),manager_reviewed_date:V().optional(),entered_in_system_date:V().optional(),fingerprint_scheduled_date:V().optional(),first_day:V().optional(),notes:V().optional()});const Va=xe({email:V().email("Invalid email format"),password:V().min(6,"Password must be at least 6 characters")}),qa=xe({week_ending_date:V().min(1,"Week ending date is required"),manager_name:Ht(["Scott","Sophear","Letoya","Carissa"],{required_error:"Please select a manager"}),breakfast_sales:O.number().min(0,"Breakfast sales must be positive"),late_night_sales:O.number().min(0,"Late night sales must be positive"),net_sales:O.number().min(0,"Net sales must be positive"),discounts:O.number().default(0),cash:O.number().default(0),food_total:O.number().default(0),food_cost:O.number().default(0),variance_dollars:O.number().default(0),food_variance_percentage:O.number().default(0),labor:O.number().min(0,"Labor must be positive"),credit_hours:O.number().min(0,"Credit hours must be positive"),reason:V().optional(),onboarding:$t().default(!1),crew_food_safety_quiz:O.number().min(0).max(100,"Score must be between 0-100"),mgr_food_safety_quiz:O.number().min(0).max(100,"Score must be between 0-100"),new_hire_name:V().optional(),terminations:V().optional(),term_date:V().optional()}),Pa=st("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),E=_.forwardRef(({className:s,...i},n)=>e.jsx(Gt,{ref:n,className:S(Pa(),s),...i}));E.displayName=Gt.displayName;function za(){const[s,i]=_.useState(!1),[n,d]=_.useState(!1),{toast:o}=ne(),{register:y,handleSubmit:c,formState:{errors:h}}=Me({resolver:Oe(Va)}),f=async v=>{i(!0);try{const{error:u}=await j.auth.signInWithPassword({email:v.email,password:v.password});if(u)throw u;o({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(u){console.error("Login error:",u),o({title:"Login failed",description:u.message||"Please check your credentials and try again.",variant:"destructive"})}finally{i(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:c(f),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...y("email")})]}),h.email&&e.jsx("p",{className:"text-red-600 text-sm",children:h.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{id:"password",type:n?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...y("password")}),e.jsx("button",{type:"button",onClick:()=>d(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n?e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(Kt,{className:"h-4 w-4"})})]}),h.password&&e.jsx("p",{className:"text-red-600 text-sm",children:h.password.message})]}),e.jsx(R,{type:"submit",className:"w-full wendys-button",disabled:s,children:s?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const ie=Os({component:Wa});function Wa(){const[s,i]=_.useState(null),[n,d]=_.useState(!0),[o,y]=_.useState(()=>{const r=localStorage.getItem("navOpen"),m=typeof window<"u"?window.innerWidth>=768:!0;return r?JSON.parse(r):m}),[c,h]=_.useState(typeof window<"u"?window.innerWidth<768:!1),f=_.useRef(null),{toast:v}=ne(),u=Fs();return _.useEffect(()=>{const r=()=>{const m=window.innerWidth<768;h(m),m&&o&&y(!1)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[o]),_.useEffect(()=>{const r=T=>{T.key==="Escape"&&o&&c&&y(!1)},m=T=>{c&&o&&f.current&&!f.current.contains(T.target)&&y(!1)};return o&&c?(document.addEventListener("keydown",r),document.addEventListener("mousedown",m),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",r),document.removeEventListener("mousedown",m),document.body.style.overflow="unset"}},[o,c]),_.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){i({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),d(!1);return}const{data:{session:m}}=await j.auth.getSession();m!=null&&m.user&&i(m.user)}catch(m){console.error("Error checking session:",m),i({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{d(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:m}}=j.auth.onAuthStateChange(async(T,w)=>{T==="SIGNED_IN"&&(w!=null&&w.user)?(i(w.user),v({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):T==="SIGNED_OUT"&&(i(null),u({to:"/"}),v({title:"Signed out",description:"You have been successfully signed out."}))});return()=>m.unsubscribe()}},[u,v]),_.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(o))},[o]),n?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(Oa,{user:s,onNavToggle:()=>y(!o),navOpen:o}),e.jsxs("div",{className:"flex relative",children:[c&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm",onClick:()=>y(!1)}),e.jsx(ms,{open:o,isMobile:c,onClose:()=>y(!1),ref:f}),e.jsx("main",{id:"main-content",className:S("flex-1 transition-all duration-300 ease-in-out mobile-container","ml-0"),children:e.jsx(Us,{})})]})]}):e.jsx(za,{})}function ke({className:s,classNames:i,showOutsideDays:n=!0,...d}){return e.jsx(Vs,{showOutsideDays:n,className:S("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:S(Xe({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:S(Xe({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...i},...d})}ke.displayName="Calendar";const Ke=Ps,Ye=zs,Fe=_.forwardRef(({className:s,align:i="center",sideOffset:n=4,...d},o)=>e.jsx(qs,{children:e.jsx(Yt,{ref:o,align:i,sideOffset:n,className:S("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...d})}));Fe.displayName=Yt.displayName;function Ha({columns:s,data:i,className:n,emptyMessage:d="No data available",loading:o=!1}){const[y,c]=_.useState(null),[h,f]=_.useState(null),v=_.useMemo(()=>!y||!h?i:[...i].sort((m,T)=>{const w=m[y],D=T[y];if(w==null&&D==null)return 0;if(w==null)return h==="asc"?-1:1;if(D==null)return h==="asc"?1:-1;if(typeof w=="number"&&typeof D=="number")return h==="asc"?w-D:D-w;if(typeof w=="string"&&typeof D=="string")return h==="asc"?w.localeCompare(D):D.localeCompare(w);if(w instanceof Date&&D instanceof Date)return h==="asc"?w.getTime()-D.getTime():D.getTime()-w.getTime();const b=String(w),x=String(D);return h==="asc"?b.localeCompare(x):x.localeCompare(b)}),[i,y,h]),u=m=>{y===m?h==="asc"?f("desc"):h==="desc"&&(f(null),c(null)):(c(m),f("asc"))},r=m=>y!==m?e.jsx(xt,{className:"h-3 w-3 text-gray-400"}):h==="asc"?e.jsx(rt,{className:"h-3 w-3 text-gray-600"}):h==="desc"?e.jsx(Qe,{className:"h-3 w-3 text-gray-600"}):e.jsx(xt,{className:"h-3 w-3 text-gray-400"});return o?e.jsx($a,{columns:s}):e.jsx("div",{className:S("overflow-x-auto",n),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(m=>e.jsx("th",{className:S("py-3 px-4 font-medium text-gray-700 text-sm",m.align==="center"&&"text-center",m.align==="right"&&"text-right",m.sortable&&"cursor-pointer hover:bg-gray-100 select-none",m.className),onClick:()=>m.sortable&&u(m.key),children:e.jsxs("div",{className:S("flex items-center gap-1",m.align==="center"&&"justify-center",m.align==="right"&&"justify-end"),children:[m.label,m.sortable&&r(m.key)]})},m.key))})}),e.jsx("tbody",{children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:d})}):v.map((m,T)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:s.map(w=>e.jsx("td",{className:S("py-3 px-4 text-sm",w.align==="center"&&"text-center",w.align==="right"&&"text-right",w.className),children:w.render?w.render(m[w.key],m):m[w.key]},w.key))},m.id||T))})]})})}function $a({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(i=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},i.key))})}),e.jsx("tbody",{children:[...Array(5)].map((i,n)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(d=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},d.key))},n))})]})})})}function me({title:s,subtitle:i,className:n,children:d,loading:o=!1,error:y,onRefresh:c}){return e.jsxs("div",{className:S("wendys-card",n),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),i&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i})]}),c&&e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),y?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:y}),c&&e.jsx("button",{onClick:c,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):o?e.jsx(Ga,{}):d]})}function Ga(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((s,i)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},i))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((s,i)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},i))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((s,i)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},i))})]})})}const $={currency:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),currencyDetailed:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),percent:(s,i=1)=>`${(s??0).toFixed(i)}%`,hours:(s,i=1)=>`${(s??0).toFixed(i)}h`,dateShort:s=>{const i=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return L(i,"MMM d")},dateFull:s=>{const i=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return L(i,"MMM dd, yyyy")},currencyCompact:s=>{const i=Math.abs(s);return i>=1e6?`$${(s/1e6).toFixed(1)}M`:i>=1e3?`$${(s/1e3).toFixed(1)}k`:$.currency(s)}},F={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},P={cartesianGrid:{strokeDasharray:"3 3",stroke:F.gridStroke},xAxis:{stroke:F.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:F.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${F.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:F.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:F.textSecondary}}},Ze=(s,i=new Date)=>{const n=new Date(i);switch(s){case"today":return{start:L(n,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Today"};case"wtd":const d=new Date(n);return d.setDate(n.getDate()-n.getDay()),{start:L(d,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const o=new Date(n.getFullYear(),n.getMonth(),1);return{start:L(o,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const y=new Date(n);return y.setDate(n.getDate()-6),{start:L(y,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const c=new Date(n);return c.setDate(n.getDate()-29),{start:L(c,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},Qa=le("/smg")({component:Ka});function Ka(){const[s,i]=_.useState(null),[n,d]=_.useState(),{toast:o}=ne(),y=Ce(),c=Me({resolver:Oe(Ua),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});_.useEffect(()=>{let x=!0;return(async()=>{var W;const{data:N}=await j.auth.getUser(),U=(W=N.user)==null?void 0:W.id;if(!U)return;const{data:M,error:z}=await j.from("users").select("store_id").eq("id",U).maybeSingle();x&&(z||i((M==null?void 0:M.store_id)??null))})(),()=>{x=!1}},[]);const{data:h=[],isLoading:f,error:v}=Y({queryKey:["smg_daily",s],queryFn:async()=>{if(!s)return[];const{data:x,error:N}=await j.from("smg_daily").select("*").eq("store_id",s).order("date",{ascending:!1});if(N)throw N;return x||[]},enabled:!!s}),{data:u=[]}=Y({queryKey:["smg_entries_import",s],queryFn:async()=>{if(!s)return[];const{data:x,error:N}=await j.from("smg_entries").select("*").eq("store_id",s).order("entry_date",{ascending:!1});if(N)throw N;return x||[]},enabled:!!s}),r=_.useMemo(()=>h.length>0?h:u.length?u.map(x=>({id:x.id,date:x.entry_date,accuracy_decimal:Number(x.accuracy_of_order)||0,zod_per_10k:Number(x.zone_of_defection)||0,cc_complaints:Number(x.customer_computers)||0,osat_decimal:Number(x.osat)||0,notes:"",created_at:x.created_at})):[],[h,u]),m=Z({mutationFn:async x=>{if(!s)throw new Error("Store not connected");const{error:N}=await j.from("smg_daily").insert({store_id:s,date:x.date,accuracy_decimal:x.accuracy_decimal,zod_per_10k:x.zod_per_10k,cc_complaints:x.cc_complaints,osat_decimal:x.osat_decimal,notes:x.notes||null});if(N)throw N},onSuccess:()=>{y.invalidateQueries({queryKey:["smg_daily",s]}),c.reset(),d(void 0),o({title:"Success",description:"SMG entry saved successfully."})},onError:x=>{o({title:"Error",description:x.message||"Failed to save SMG entry.",variant:"destructive"})}}),T=x=>{m.mutate(x)},w=x=>{const N=Number(x.slice(0,4)),U=Number(x.slice(5,7)),M=Number(x.slice(8,10));return new Date(N,(U||1)-1,M||1)},D=[{key:"date",label:"Date",sortable:!0,render:x=>L(w(x),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:x=>x.toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:x=>x.toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:x=>x.toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:x=>x.toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:x=>e.jsx("div",{className:"max-w-32 truncate",title:x,children:x||"-"})}],b=_.useMemo(()=>r.length?r.slice().reverse().map(x=>({date:$.dateShort(x.date),osat:x.osat_decimal})):[],[r]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),v&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",v.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:c.handleSubmit(T),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"date",children:"Date *"}),e.jsxs(Ke,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(R,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),n?L(n,"MMM dd, yyyy"):"Select date"]})}),e.jsx(Fe,{className:"w-auto p-0",align:"start",children:e.jsx(ke,{mode:"single",selected:n,onSelect:x=>{d(x),x&&c.setValue("date",L(x,"yyyy-MM-dd"))},initialFocus:!0})})]}),c.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(C,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("accuracy_decimal",{valueAsNumber:!0})}),c.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(C,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("zod_per_10k",{valueAsNumber:!0})}),c.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(C,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("cc_complaints",{valueAsNumber:!0})}),c.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(C,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("osat_decimal",{valueAsNumber:!0})}),c.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(E,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...c.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(R,{type:"submit",disabled:m.isPending||!s,className:"bg-wendys-red hover:bg-wendys-red/90",children:m.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(me,{title:"OSAT Score Trend",subtitle:`${r.length} entries`,loading:f,error:v==null?void 0:v.message,children:b.length>0?e.jsx(ye,{width:"100%",height:300,children:e.jsxs(Ie,{data:b,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:x=>x.toFixed(1)}),e.jsx(Ee,{...P.tooltip,formatter:x=>[x.toFixed(2),"OSAT Score"]}),e.jsx(Se,{type:"monotone",dataKey:"osat",stroke:F.sales,strokeWidth:3,dot:{fill:F.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:f?"Loading...":`${r.length} entries`})]}),s?e.jsx(Ha,{columns:D,data:r,loading:f,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const pt=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
`,_t=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'COMPLETED', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,Ya=le("/setup")({component:Ba});function bt(s){navigator.clipboard.writeText(s)}function Ba(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase → Auth → Providers → Email: enable. Then Auth → Users → Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase → SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(R,{onClick:()=>bt(pt),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:pt})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(R,{onClick:()=>bt(_t),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:_t})]})]})}function K({title:s,value:i,format:n,delta:d,deltaLabel:o,icon:y,trend:c,suffix:h,sparklineData:f,className:v}){const u=T=>{switch(n){case"currency":return ae(T);case"percentage":return X(T);case"number":return T.toLocaleString();default:return T.toString()}},r=()=>{switch(c){case"up":return e.jsx(se,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(de,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(Ws,{className:"h-4 w-4 text-gray-400"})}},m=()=>{switch(c){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:S("wendys-card",v),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(y,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[u(i),h&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:h})]}),f&&f.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsx(Ie,{data:f,children:e.jsx(Se,{type:"monotone",dataKey:"value",stroke:c==="up"?F.positive:c==="down"?F.waste:F.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),d!==void 0&&o&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[r(),e.jsxs("span",{className:S("text-sm font-medium",m()),children:[d>0?"+":"",Math.abs(d)<1&&n!=="percentage"?X(Math.abs(d)*100):u(Math.abs(d)),h&&n!=="percentage"&&e.jsx("span",{className:"ml-1",children:h})]}),e.jsx("span",{className:"text-xs text-gray-500",children:o})]})]})})})}function Ja({data:s=[]}){const i=_.useMemo(()=>{if(!s.length){const n=[];for(let d=13;d>=0;d--){const o=new Date;o.setDate(o.getDate()-d),n.push({date:$.dateShort(o.toISOString().slice(0,10)),sales:0})}return n}return s.sort((n,d)=>new Date(n.business_date).getTime()-new Date(d.business_date).getTime()).slice(-30).map(n=>({date:$.dateShort(n.business_date),sales:n.net_sales||0}))},[s]);return e.jsx(ye,{width:"100%",height:300,children:e.jsxs(Ie,{data:i,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:n=>$.currencyCompact(n)}),e.jsx(Ee,{...P.tooltip,formatter:n=>[$.currencyDetailed(n),"Net Sales"]}),e.jsx(Se,{type:"monotone",dataKey:"sales",stroke:F.sales,strokeWidth:3,dot:{fill:F.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.salesSecondary,strokeWidth:2}})]})})}function Xa({data:s=[]}){console.log("🔍 LaborVsIdealChart received data:",s.slice(0,3));const i=_.useMemo(()=>{if(!s.length){const d=[];for(let o=6;o>=0;o--){const y=new Date;y.setDate(y.getDate()-o),d.push({date:$.dateShort(y.toISOString().slice(0,10)),ideal:0,actual:0})}return d}const n=s.sort((d,o)=>new Date(d.business_date).getTime()-new Date(o.business_date).getTime()).slice(-30).map(d=>{const o=Number(d.ideal_labor_hours)||0,y=Number(d.labor_hours)||0;return console.log("🔍 Processing entry:",d.business_date,"ideal:",d.ideal_labor_hours,"=>",o,"actual:",d.labor_hours,"=>",y),{date:$.dateShort(d.business_date),ideal:o,actual:y}});return console.log("🔍 Processed chart data:",n.slice(0,3)),n},[s]);return console.log("🔍 Final chartData being rendered:",i.slice(0,3)),e.jsx(ye,{width:"100%",height:300,children:e.jsxs(Bt,{data:i,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:n=>$.hours(n)}),e.jsx(Ee,{...P.tooltip,formatter:(n,d)=>[$.hours(n),d==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(Hs,{...P.legend}),e.jsx(Jt,{dataKey:"ideal",fill:F.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(Se,{type:"monotone",dataKey:"actual",stroke:F.labor,strokeWidth:3,dot:{fill:F.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function Za(){const[s,i]=_.useState(null);_.useEffect(()=>{let u=!0;return(async()=>{var m;const{data:r}=await j.from("users").select("store_id").eq("id",(m=(await j.auth.getUser()).data.user)==null?void 0:m.id).single();u&&i((r==null?void 0:r.store_id)??null)})(),()=>{u=!1}},[]);const{data:n=[],isLoading:d}=Y({queryKey:["smg_snapshot",s],queryFn:async()=>{if(!s)return[];const u=new Date;u.setDate(u.getDate()-30);const{data:r,error:m}=await j.from("smg_daily").select("*").eq("store_id",s).gte("date",u.toISOString().split("T")[0]).order("date",{ascending:!1});if(m)throw m;return r||[]},enabled:!!s}),o=n.length>0?{accuracy:n.reduce((u,r)=>u+r.accuracy_decimal,0)/n.length,zod:n.reduce((u,r)=>u+r.zod_per_10k,0)/n.length,complaints:n.reduce((u,r)=>u+r.cc_complaints,0)/n.length,osat:n.reduce((u,r)=>u+r.osat_decimal,0)/n.length}:{accuracy:0,zod:0,complaints:0,osat:0},y=u=>{if(u.length<4)return"neutral";const r=Math.floor(u.length/2),m=u.slice(0,r).reduce((D,b)=>D+b,0)/r,w=u.slice(r).reduce((D,b)=>D+b,0)/(u.length-r)-m;return Math.abs(w)<.1?"neutral":w>0?"up":"down"},c={accuracy:y(n.map(u=>u.accuracy_decimal).reverse()),zod:y(n.map(u=>u.zod_per_10k).reverse()),complaints:y(n.map(u=>u.cc_complaints).reverse()),osat:y(n.map(u=>u.osat_decimal).reverse())},h=(u,r=!1)=>r?u<=1?"text-green-600":u<=3?"text-yellow-600":"text-red-600":u>=90?"text-green-600":u>=80?"text-yellow-600":"text-red-600",f=(u,r=!1)=>r?u<=1?e.jsx(Pe,{className:"h-4 w-4 text-green-600"}):u<=3?e.jsx(be,{className:"h-4 w-4 text-yellow-600"}):e.jsx(be,{className:"h-4 w-4 text-red-600"}):u>=90?e.jsx(Pe,{className:"h-4 w-4 text-green-600"}):u>=80?e.jsx(be,{className:"h-4 w-4 text-yellow-600"}):e.jsx(be,{className:"h-4 w-4 text-red-600"}),v=u=>{switch(u){case"up":return e.jsx(se,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(de,{className:"h-3 w-3 text-red-600"});default:return null}};return d?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((u,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},r))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(ue,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[n.length," entries"]})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(c.osat),f(o.osat),e.jsx("span",{className:S("text-xl font-bold",h(o.osat)),children:o.osat.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pe,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(c.accuracy),f(o.accuracy),e.jsx("span",{className:S("text-xl font-bold",h(o.accuracy)),children:o.accuracy.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(be,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(c.zod==="up"?"down":c.zod==="down"?"up":"neutral"),f(o.zod,!0),e.jsx("span",{className:S("text-xl font-bold",h(o.zod,!0)),children:o.zod.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(be,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(c.complaints==="up"?"down":c.complaints==="down"?"up":"neutral"),f(o.complaints,!0),e.jsx("span",{className:S("text-xl font-bold",h(o.complaints,!0)),children:o.complaints.toFixed(1)})]})]})]})]})}function er(){const[s,i]=_.useState(null),n=L(new Date,"EEEE, MMMM d"),d=L(new Date,"yyyy-MM-dd");_.useEffect(()=>{let h=!0;return(async()=>{var T;console.log("🔐 [InterviewsToday] Checking user authentication...");const{data:f,error:v}=await j.auth.getUser();console.log("👤 [InterviewsToday] Auth data:",f,"Auth error:",v);const u=(T=f.user)==null?void 0:T.id;if(!u){console.log("❌ [InterviewsToday] No user ID found - user not authenticated");return}console.log("🔍 [InterviewsToday] Looking up store for user:",u);const{data:r,error:m}=await j.from("users").select("store_id").eq("id",u).maybeSingle();if(console.log("🏪 [InterviewsToday] Store lookup result - data:",r,"error:",m),!!h){if(m){console.error("❌ [InterviewsToday] Store lookup error:",m);return}i((r==null?void 0:r.store_id)??null),console.log("✅ [InterviewsToday] Store ID set to:",(r==null?void 0:r.store_id)??null)}})(),()=>{h=!1}},[]);const{data:o=[],isLoading:y}=Y({queryKey:["interviews-today",s,d],queryFn:async()=>{if(!s)return[];const{data:h,error:f}=await j.from("interviews").select("*").eq("store_id",s).eq("interview_date",d).order("interview_time",{ascending:!0});if(f)throw f;return h||[]},enabled:!!s}),c=h=>L(new Date(`2000-01-01T${h}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:n})]})]}),y?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Wt,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:o.map(h=>e.jsx(He,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:h.candidate_name}),e.jsx("span",{className:tr("px-2 py-1 text-xs font-medium rounded-full",ns(h.status)),children:h.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(nt,{className:"h-3 w-3"}),e.jsx("span",{children:h.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($e,{className:"h-3 w-3"}),e.jsx("span",{children:c(h.interview_time)})]})]}),h.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',h.notes,'"']})]})})},h.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(He,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"→"})]})})]})}function tr(...s){return s.filter(Boolean).join(" ")}const Nt=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function it({selectedRange:s="last30",selectedDate:i,onRangeChange:n,onDateChange:d,onClearFilters:o,className:y,compact:c=!1}){const h=s!=="last30"||i,f=u=>{n==null||n(u),u!=="custom"&&(d==null||d(void 0))},v=()=>{if(s==="custom"&&i)return L(i,"MMM dd, yyyy");const u=Nt.find(r=>r.key===s);return(u==null?void 0:u.label)||"Last 30"};return e.jsxs("div",{className:S("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",c&&"p-3",y),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($s,{className:"h-4 w-4"}),e.jsx("span",{className:S("text-sm font-medium",c&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Nt.map(u=>e.jsx(R,{variant:s===u.key?"default":"ghost",size:"sm",onClick:()=>f(u.key),className:S("text-xs h-7 px-2",s===u.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",c&&"text-[11px] h-6 px-1.5"),title:u.description,children:u.label},u.key))}),s==="custom"&&e.jsxs(Ke,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"sm",className:S("justify-start text-left font-normal h-7",!i&&"text-muted-foreground",c&&"h-6 text-xs"),children:[e.jsx(re,{className:"mr-1 h-3 w-3"}),i?L(i,"MMM dd"):"Pick date"]})}),e.jsx(Fe,{className:"w-auto p-0",align:"start",children:e.jsx(ke,{mode:"single",selected:i,onSelect:d,initialFocus:!0})})]}),!c&&h&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:v()})]}),h&&o&&e.jsxs(R,{variant:"ghost",size:"sm",onClick:o,className:S("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",c&&"h-6 px-1.5"),children:[e.jsx(Rt,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function ot(s,i="last30"){const[n,d]=fe.useState(()=>typeof window<"u"&&localStorage.getItem(`${s}_range`)||i),[o,y]=fe.useState(()=>{if(typeof window<"u"){const u=localStorage.getItem(`${s}_date`);if(u){const[r,m,T]=u.split("-").map(Number);return new Date(r,(m||1)-1,T||1)}return}}),c=fe.useCallback(u=>{d(u),typeof window<"u"&&localStorage.setItem(`${s}_range`,u)},[s]),h=fe.useCallback(u=>{if(y(u),typeof window<"u")if(u){const r=L(u,"yyyy-MM-dd");localStorage.setItem(`${s}_date`,r)}else localStorage.removeItem(`${s}_date`)},[s]),f=fe.useCallback(()=>{d(i),y(void 0),typeof window<"u"&&(localStorage.removeItem(`${s}_range`),localStorage.removeItem(`${s}_date`))},[s,i]),v=fe.useCallback(()=>{if(n==="custom"&&o){const u=L(o,"yyyy-MM-dd");return{start:u,end:u}}if(n&&n!=="custom"){const u=Ze(n);return u.start?{start:u.start,end:u.end}:null}return null},[n,o]);return{selectedRange:n,selectedDate:o,handleRangeChange:c,handleDateChange:h,clearFilters:f,getDateRangeFilter:v,getSelectedLabel:()=>n==="custom"&&o?L(o,"MMM dd, yyyy"):Ze(n).label}}const sr=le("/overview")({component:ar});function ar(){const[s,i]=_.useState(null),n=ot("overview","today");_.useEffect(()=>{let m=!0;return(async()=>{var x;const{data:T}=await j.auth.getUser(),w=(x=T.user)==null?void 0:x.id;if(!w)return;const{data:D,error:b}=await j.from("users").select("store_id").eq("id",w).maybeSingle();if(m){if(b){console.error("Error fetching store ID:",b);return}i((D==null?void 0:D.store_id)??null)}})(),()=>{m=!1}},[]);const d=n.getDateRangeFilter(),{data:o=[]}=Y({queryKey:["overview-charts",s],queryFn:async()=>{if(!s)return[];const m=new Date;m.setDate(m.getDate()-30);const T=m.toISOString().slice(0,10),{data:w,error:D}=await j.from("omega_daily").select("*").eq("store_id",s).gte("business_date",T).order("business_date",{ascending:!0});if(D)throw D;return w||[]},enabled:!!s}),{data:y=[],isLoading:c,error:h}=Y({queryKey:["overview-omega",s,d==null?void 0:d.start,d==null?void 0:d.end],queryFn:async()=>{if(!s)return[];let m=j.from("omega_daily").select("*").eq("store_id",s);d&&(m=m.gte("business_date",d.start).lte("business_date",d.end));const{data:T,error:w}=await m.order("business_date",{ascending:!0});if(w)throw w;return T||[]},enabled:!!s}),{data:f=[]}=Y({queryKey:["overview-weekending",s,d==null?void 0:d.start,d==null?void 0:d.end],queryFn:async()=>{if(!s)return[];let m=j.from("weekending_sheet").select("*").eq("store_id",s);d&&(m=m.gte("week_ending_date",d.start).lte("week_ending_date",d.end));const{data:T,error:w}=await m.order("week_ending_date",{ascending:!0});if(w)throw w;return T||[]},enabled:!!s}),{data:v=[]}=Y({queryKey:["overview-weekending-charts",s],queryFn:async()=>{if(!s)return[];const m=new Date;m.setDate(m.getDate()-84);const T=m.toISOString().slice(0,10),{data:w,error:D}=await j.from("weekending_sheet").select("*").eq("store_id",s).gte("week_ending_date",T).order("week_ending_date",{ascending:!0});if(D)throw D;return w||[]},enabled:!!s}),u=_.useMemo(()=>{if(y.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const m=y.reduce((b,x)=>({netSales:b.netSales+(x.net_sales||0),compNetSales:b.compNetSales+((x.net_sales||0)-(x.last_year_sales||0)),laborHours:b.laborHours+(x.labor_hours||0),idealLaborHours:b.idealLaborHours+(x.ideal_labor_hours||0),foodVarianceCost:b.foodVarianceCost+(x.food_variance_cost||0),wasteAmount:b.wasteAmount+(x.waste_amount||0),breakfastSales:b.breakfastSales+(x.breakfast_sales||0),nightSales:b.nightSales+(x.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),T=m.netSales>0?m.laborHours/m.netSales*100:0,w=m.netSales>0?m.foodVarianceCost/m.netSales*100:0,D=m.netSales>0?m.wasteAmount/m.netSales*100:0;return{...m,laborPercentage:T,foodVariancePercentage:w,wastePercentage:D}},[y]),r=_.useMemo(()=>{if(f.length===0)return{weeklyNetSales:0,weeklyLabor:0,weeklyFoodVariance:0,weeklyBreakfastSales:0,weeklyLateNightSales:0,weeklyOnboarding:0,weeklyCrewQuiz:0,weeklyMgrQuiz:0,weeklyNewHires:0,weeklyTerminations:0};const m=f.reduce((b,x)=>({weeklyNetSales:b.weeklyNetSales+(x.net_sales||0),weeklyLabor:b.weeklyLabor+(x.labor||0),weeklyFoodVariance:b.weeklyFoodVariance+(x.food_variance_percentage||0),weeklyBreakfastSales:b.weeklyBreakfastSales+(x.breakfast_sales||0),weeklyLateNightSales:b.weeklyLateNightSales+(x.late_night_sales||0),weeklyOnboarding:b.weeklyOnboarding+(x.onboarding?1:0),weeklyCrewQuiz:b.weeklyCrewQuiz+(x.crew_food_safety_quiz||0),weeklyMgrQuiz:b.weeklyMgrQuiz+(x.mgr_food_safety_quiz||0),weeklyNewHires:b.weeklyNewHires+(x.new_hire_name?1:0),weeklyTerminations:b.weeklyTerminations+(x.terminations?1:0)}),{weeklyNetSales:0,weeklyLabor:0,weeklyFoodVariance:0,weeklyBreakfastSales:0,weeklyLateNightSales:0,weeklyOnboarding:0,weeklyCrewQuiz:0,weeklyMgrQuiz:0,weeklyNewHires:0,weeklyTerminations:0}),T=f.length>0?m.weeklyCrewQuiz/f.length:0,w=f.length>0?m.weeklyMgrQuiz/f.length:0,D=f.length>0?m.weeklyFoodVariance/f.length:0;return{...m,avgCrewQuiz:T,avgMgrQuiz:w,avgFoodVariance:D}},[f]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",n.getSelectedLabel(),c&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),h&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",h.message]})]}),e.jsx(it,{selectedRange:n.selectedRange,selectedDate:n.selectedDate,onRangeChange:n.handleRangeChange,onDateChange:n.handleDateChange,onClearFilters:n.clearFilters,compact:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(K,{title:"Net Sales",value:u.netSales,format:"currency",delta:u.compNetSales,deltaLabel:"vs Last Year",icon:qe,trend:u.compNetSales>=0?"up":"down"}),e.jsx(K,{title:"Labor Hours",value:u.laborHours,format:"number",delta:u.laborHours-u.idealLaborHours,deltaLabel:"vs Ideal",icon:$e,trend:u.laborHours>u.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(K,{title:"Labor %",value:u.laborPercentage,format:"percentage",icon:se,trend:"neutral"}),e.jsx(K,{title:"Food Variance",value:u.foodVarianceCost,format:"currency",delta:u.foodVariancePercentage,deltaLabel:"% of Sales",icon:de,trend:u.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(K,{title:"Waste Amount",value:u.wasteAmount,format:"currency",delta:u.wastePercentage,deltaLabel:"% of Sales",icon:de,trend:u.wasteAmount>=0?"down":"up"}),e.jsx(K,{title:"Breakfast Sales",value:u.breakfastSales,format:"currency",icon:qe,trend:"neutral"}),e.jsx(K,{title:"Night Sales",value:u.nightSales,format:"currency",icon:qe,trend:"neutral"}),e.jsx(K,{title:"Comp Net Sales",value:u.compNetSales,format:"currency",icon:se,trend:u.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(K,{title:"Weekly Net Sales",value:r.weeklyNetSales,format:"currency",icon:qe,trend:"neutral"}),e.jsx(K,{title:"Weekly Labor",value:r.weeklyLabor,format:"currency",icon:$e,trend:"neutral"}),e.jsx(K,{title:"Avg Food Variance %",value:r.avgFoodVariance,format:"percentage",icon:de,trend:r.avgFoodVariance>=0?"down":"up"}),e.jsx(K,{title:"Weekly Onboarding",value:r.weeklyOnboarding,format:"number",icon:se,trend:"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(K,{title:"Avg Crew Quiz Score",value:r.avgCrewQuiz,format:"number",icon:se,trend:"neutral",suffix:"/100"}),e.jsx(K,{title:"Avg MGR Quiz Score",value:r.avgMgrQuiz,format:"number",icon:se,trend:"neutral",suffix:"/100"}),e.jsx(K,{title:"Weekly New Hires",value:r.weeklyNewHires,format:"number",icon:se,trend:"neutral"}),e.jsx(K,{title:"Weekly Terminations",value:r.weeklyTerminations,format:"number",icon:de,trend:"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(me,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!o.length&&!h,error:h==null?void 0:h.message,children:o.length>0?e.jsx(Ja,{data:o}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(me,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!o.length&&!h,error:h==null?void 0:h.message,children:o.length>0?e.jsx(Xa,{data:o}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(me,{title:"Weekly Net Sales Trend",subtitle:"Last 12 weeks",loading:!v.length&&!h,error:h==null?void 0:h.message,children:v.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:ae(r.weeklyNetSales)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weekly Sales"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[v.length," weeks of data"]})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No weekly data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Weekending Sheet to see trends"})]})})}),e.jsx(me,{title:"Weekly Training Metrics",subtitle:"Last 12 weeks",loading:!v.length&&!h,error:h==null?void 0:h.message,children:v.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-medium text-wendys-charcoal",children:[r.avgCrewQuiz.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Crew Quiz"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-medium text-wendys-charcoal",children:[r.avgMgrQuiz.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Avg MGR Quiz"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:r.weeklyOnboarding}),e.jsx("p",{className:"text-sm text-gray-600",children:"Onboarding"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:r.weeklyNewHires}),e.jsx("p",{className:"text-sm text-gray-600",children:"New Hires"})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No training data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Weekending Sheet to see metrics"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Data Integration Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Daily Entries"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:y.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"OMEGA Daily records"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weekly Entries"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:f.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Weekending records"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:ae(u.netSales+r.weeklyNetSales)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Combined daily + weekly"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Coverage"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:y.length>0||f.length>0?"Active":"No Data"}),e.jsx("p",{className:"text-xs text-gray-500",children:"System status"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Za,{}),e.jsx(er,{})]})]})}function rr({columns:s,data:i,mobileCardRender:n,className:d,emptyMessage:o="No data available",loading:y=!1}){if(y)return e.jsx(nr,{columns:s});const c=h=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:s.map(f=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[f.label,":"]}),e.jsx("span",{className:"text-sm",children:f.render?f.render(h[f.key],h):h[f.key]})]},f.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:S("hidden md:block",d),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(h=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:h.label},h.key))})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:o})}):i.map((h,f)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:s.map(v=>e.jsx("td",{className:S("py-3 px-4 text-sm",v.className),children:v.render?v.render(h[v.key],h):h[v.key]},v.key))},h.id||f))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:o}):i.map((h,f)=>e.jsx("div",{children:n?n(h):c(h)},h.id||f))})})]})}function nr({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(i=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},i.key))})}),e.jsx("tbody",{children:[...Array(3)].map((i,n)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(d=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},d.key))},n))})]})})})}const ir=le("/omega-daily")({component:or});function or(){const[s,i]=_.useState(!1),[n,d]=_.useState(null),{toast:o}=ne(),y=Ce(),[c,h]=_.useState(null),f=ot("omega-daily","last30"),v=async()=>{if(!c){o({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const t=[],l=new Date;for(let p=9;p>=0;p--){const k=new Date(l);k.setDate(k.getDate()-p),t.push({store_id:c,business_date:L(k,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:a}=await j.from("omega_daily").insert(t);if(a)throw a;o({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),y.invalidateQueries({queryKey:["omega_daily","last30",c]})}catch(t){o({title:"Error adding sample data",description:t.message,variant:"destructive"})}},u=()=>{y.invalidateQueries({queryKey:["omega_daily",c]}),o({title:"Refreshing data...",description:"Reloading your OMEGA entries."})},r=Me({resolver:Oe(Fa),defaultValues:{business_date:L(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),m=Z({onMutate:async t=>{if(!c)throw new Error("No store is linked to your account. See Setup to link one.");await y.cancelQueries({queryKey:["omega_daily"]});const l=`temp-${Date.now()}`,a={id:l,store_id:c,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales},p=[],k=y.getQueriesData({queryKey:["omega_daily"]});for(const[q,ee]of k){const J=q;if(!J.includes(c))continue;let Q=!0;const lt=typeof J[2]=="string"?String(J[2]):void 0,dt=typeof J[3]=="string"?String(J[3]):void 0;if(lt&&dt&&(Q=t.business_date>=lt&&t.business_date<=dt),!Q)continue;const ct=[a,...ee||[]];ct.sort((mt,ut)=>mt.business_date>ut.business_date?-1:mt.business_date<ut.business_date?1:0),p.push({queryKey:q,previousData:ee}),y.setQueryData(q,ct)}return{optimisticId:l,touchedCaches:p}},mutationFn:async t=>{if(console.log("🔄 Starting insertMutation with payload:",t),console.log("🏪 Store ID:",c),!c)throw console.error("❌ No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const l={store_id:c,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales};console.log("📤 Inserting data:",l);const{data:a,error:p}=await j.from("omega_daily").insert(l).select();if(console.log("📥 Supabase response - data:",a,"error:",p),p)throw console.error("❌ Supabase error:",p),p;return console.log("✅ Insert successful:",a),a},onError:(t,l,a)=>{if(a!=null&&a.touchedCaches)for(const{queryKey:p,previousData:k}of a.touchedCaches)y.setQueryData(p,k||[]);console.error("💥 Insert mutation failed (rolled back):",t),o({title:"Save failed",description:(t==null?void 0:t.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(t,l,a)=>{console.log("🎉 Insert mutation succeeded with data:",t),o({title:"Success!",description:"Daily metrics saved successfully."});const p=Array.isArray(t)&&t[0]?t[0]:void 0;if(p&&(a!=null&&a.touchedCaches)&&a.optimisticId)for(const{queryKey:k}of a.touchedCaches){const ee=(y.getQueryData(k)??[]).map(J=>J.id===a.optimisticId?p:J);y.setQueryData(k,ee)}i(!1),d(null),r.reset()}}),T=Z({mutationFn:async({id:t,payload:l})=>{if(!c)throw new Error("No store is linked to your account. See Setup to link one.");const{error:a}=await j.from("omega_daily").update({business_date:l.business_date,net_sales:l.net_sales,last_year_sales:l.last_year_sales,labor_hours:l.labor_hours,ideal_labor_hours:l.ideal_labor_hours,labor_percentage:l.labor_percentage,food_variance_cost:l.food_variance_cost,waste_amount:l.waste_amount,breakfast_sales:l.breakfast_sales,night_sales:l.night_sales}).eq("id",t);if(a)throw a},onSuccess:()=>{o({title:"Updated!",description:"Daily metrics updated successfully."}),i(!1),d(null),r.reset(),y.invalidateQueries({queryKey:["omega_daily","last30",c]})},onError:t=>{o({title:"Update failed",description:t.message,variant:"destructive"})}}),w=t=>{console.log("🚀 onSubmit called with data:",t),console.log("📋 Form errors:",r.formState.errors),console.log("🏪 Store ID:",c),console.log("✏️ Editing entry:",n),console.log("🔄 Insert mutation pending:",m.isPending),console.log("🔄 Update mutation pending:",T.isPending),n?(console.log("📝 Calling updateMutation..."),T.mutate({id:n.id,payload:t})):(console.log("➕ Calling insertMutation..."),m.mutate(t))},D=t=>{console.error("❌ Form validation failed with errors:",t),o({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},b=Z({mutationFn:async t=>{const{error:l}=await j.from("omega_daily").delete().eq("id",t);if(l)throw l},onSuccess:()=>{o({title:"Deleted",description:"Daily metrics entry removed."}),y.invalidateQueries({queryKey:["omega_daily","last30",c]})},onError:t=>{o({title:"Delete failed",description:t.message,variant:"destructive"})}});_.useEffect(()=>{let t=!0;return(async()=>{var ee;console.log("🔐 Checking user authentication...");const{data:l,error:a}=await j.auth.getUser();console.log("👤 Auth data:",l,"Auth error:",a);const p=(ee=l.user)==null?void 0:ee.id;if(!p){console.log("❌ No user ID found - user not authenticated");return}console.log("🔍 Looking up store for user:",p);const{data:k,error:q}=await j.from("users").select("store_id").eq("id",p).maybeSingle();if(console.log("🏪 Store lookup result - data:",k,"error:",q),!!t){if(q){console.error("❌ Store lookup error:",q),o({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}h((k==null?void 0:k.store_id)??null),console.log("✅ Store ID set to:",(k==null?void 0:k.store_id)??null),k!=null&&k.store_id||(console.log("⚠️ No store linked to user account"),o({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{t=!1}},[]);const x=f.getDateRangeFilter(),{data:N=[],isLoading:U,error:M}=Y({queryKey:["omega_daily",c,x==null?void 0:x.start,x==null?void 0:x.end],queryFn:async()=>{if(!c)return[];let t=j.from("omega_daily").select("*").eq("store_id",c);x&&(t=t.gte("business_date",x.start).lte("business_date",x.end));const{data:l,error:a}=await t.order("business_date",{ascending:!1}).limit(100);if(a)throw a;return l},enabled:!!c}),{data:z=[]}=Y({queryKey:["omega_daily_charts",c],queryFn:async()=>{if(!c)return[];const t=new Date;t.setDate(t.getDate()-30);const l=L(t,"yyyy-MM-dd"),{data:a,error:p}=await j.from("omega_daily").select("*").eq("store_id",c).gte("business_date",l).order("business_date",{ascending:!0});if(p)throw p;return a},enabled:!!c}),{data:W=[]}=Y({queryKey:["omega_daily_mtd",c],queryFn:async()=>{if(!c)return[];const{start:t,end:l}=Ze("mtd"),{data:a,error:p}=await j.from("omega_daily").select("*").eq("store_id",c).gte("business_date",t).lte("business_date",l).order("business_date",{ascending:!0});if(p)throw p;return a},enabled:!!c}),g=t=>{if(!t)return;f.handleRangeChange("custom");const l=Number(t.slice(0,4)),a=Number(t.slice(5,7)),p=Number(t.slice(8,10));f.handleDateChange(new Date(l,(a||1)-1,p||1))},A=_.useMemo(()=>z.length?z.map(t=>({date:$.dateShort(t.business_date),dateFull:$.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),comp_net_sales_percentage:t.last_year_sales?(t.net_sales-t.last_year_sales)/t.last_year_sales*100:0})):[],[z]),H=_.useMemo(()=>z.length?z.map(t=>({date:$.dateShort(t.business_date),dateFull:$.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),waste_percentage:t.net_sales?t.waste_amount/t.net_sales*100:0,food_variance_percentage:t.net_sales?-(t.food_variance_cost/t.net_sales)*100:0})):[],[z]),G=t=>{d(t);const l={business_date:t.business_date||L(new Date,"yyyy-MM-dd"),net_sales:t.net_sales!=null?Number(t.net_sales):0,last_year_sales:t.last_year_sales!=null?Number(t.last_year_sales):0,labor_hours:t.labor_hours!=null?Number(t.labor_hours):0,ideal_labor_hours:t.ideal_labor_hours!=null?Number(t.ideal_labor_hours):0,labor_percentage:t.labor_percentage!=null?Number(t.labor_percentage):0,food_variance_cost:t.food_variance_cost!=null?Number(t.food_variance_cost):0,waste_amount:t.waste_amount!=null?Number(t.waste_amount):0,breakfast_sales:t.breakfast_sales!=null?Number(t.breakfast_sales):0,night_sales:t.night_sales!=null?Number(t.night_sales):0};r.reset(l),i(!0)},B=t=>{b.mutate(t)},I=r.watch(),_e=I.last_year_sales>0?(I.net_sales-I.last_year_sales)/I.last_year_sales*100:0,he=I.labor_hours-I.ideal_labor_hours,Ue=I.net_sales>0?I.food_variance_cost/I.net_sales*100:0,ge=I.net_sales>0?I.waste_amount/I.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(R,{onClick:()=>{d(null),r.reset({business_date:L(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),i(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),c&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(R,{onClick:v,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(R,{onClick:u,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const t=W.reduce((k,q)=>k+(Number(q.net_sales)||0),0),l=W.length>0?W.reduce((k,q)=>k+(Number(q.labor_percentage)||0),0)/W.length:0,a=W.reduce((k,q)=>k+(Number(q.waste_amount)||0),0),p=t>0?a/t*100:0;return e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:ae(t)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:X(l)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:X(p)})]})]})})()}),e.jsx(it,{selectedRange:f.selectedRange,selectedDate:f.selectedDate,onRangeChange:f.handleRangeChange,onDateChange:f.handleDateChange,onClearFilters:f.clearFilters}),M&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",M.message]}),e.jsxs("div",{className:"grid-auto",children:[e.jsx(me,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!z.length&&!M,error:M==null?void 0:M.message,children:A.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:A,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(Ee,{...P.tooltip,formatter:t=>[$.percent(t,1),"Comp Sales %"],labelFormatter:(t,l)=>{var a;return l&&l[0]&&((a=l[0].payload)==null?void 0:a.dateFull)||t}}),e.jsx(Se,{type:"monotone",dataKey:"comp_net_sales_percentage",stroke:F.sales,strokeWidth:2,dot:{fill:F.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:F.salesSecondary,strokeWidth:2},onClick:t=>{var l;return g((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(me,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!z.length&&!M,error:M==null?void 0:M.message,children:H.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:H,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(Ee,{...P.tooltip,formatter:t=>[$.percent(t,2),"Waste %"],labelFormatter:(t,l)=>{var a;return l&&l[0]&&((a=l[0].payload)==null?void 0:a.dateFull)||t}}),e.jsx(ht,{y:.5,stroke:F.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:F.textSecondary,fontSize:12}}),e.jsx(Jt,{dataKey:"waste_percentage",fill:F.waste,opacity:.7,onClick:t=>{var l;return g((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(me,{title:"Food Variance",subtitle:"Last 30 days",loading:!z.length&&!M,error:M==null?void 0:M.message,children:H.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:H,children:[e.jsx(we,{...P.cartesianGrid}),e.jsx(ve,{dataKey:"date",...P.xAxis}),e.jsx(je,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(Ee,{...P.tooltip,formatter:(t,l,a)=>{var k;const p=((k=a==null?void 0:a.payload)==null?void 0:k.food_variance_percentage)!==void 0?-a.payload.food_variance_percentage:0;return[$.percent(p,2),"Food Variance %"]},labelFormatter:(t,l)=>{var a;return l&&l[0]&&((a=l[0].payload)==null?void 0:a.dateFull)||t}}),e.jsx(ht,{y:0,stroke:F.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:F.textSecondary,fontSize:12}}),e.jsx(Se,{type:"monotone",dataKey:"food_variance_percentage",stroke:F.foodVariance,strokeWidth:2,dot:{fill:F.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:F.warning,strokeWidth:2},onClick:t=>{var l;return g((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:f.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[U?"Loading...":`${N.length} entries`,f.selectedRange!=="last30"&&` for ${f.getSelectedLabel()}`,(f.selectedRange!=="last30"||f.selectedDate)&&e.jsx(R,{variant:"ghost",size:"sm",onClick:f.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(N==null?void 0:N.length)===0&&!U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:c?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:f.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),c&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(R,{onClick:()=>i(!0),className:"wendys-button",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(R,{onClick:v,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx(rr,{columns:[{key:"business_date",label:"Date",render:t=>ce(t)},{key:"net_sales",label:"Net Sales",render:t=>ae(t)},{key:"comp_sales",label:"Comp Sales",render:(t,l)=>{const a=(l.net_sales??0)-(l.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${a>=0?"text-green-600":"text-red-600"}`,children:[a>=0?e.jsx(se,{className:"h-3 w-3 mr-1"}):e.jsx(de,{className:"h-3 w-3 mr-1"}),ae(Math.abs(a))]})}},{key:"labor_hours",label:"Labor Hours",render:t=>`${t}h`},{key:"labor_percentage",label:"Labor %",render:t=>X(t)},{key:"food_variance",label:"Food Variance",render:(t,l)=>{const a=l.net_sales?l.food_variance_cost/l.net_sales*100:0;return X(a)}},{key:"waste",label:"Waste",render:(t,l)=>{const a=l.net_sales?l.waste_amount/l.net_sales*100:0;return X(a)}},{key:"actions",label:"Actions",render:(t,l)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>G(l),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>{g(l.business_date),o({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Kt,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>B(l.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})}],data:N,mobileCardRender:t=>{const l=(t.net_sales??0)-(t.last_year_sales??0),a=t.net_sales?t.food_variance_cost/t.net_sales*100:0,p=t.net_sales?t.waste_amount/t.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:ce(t.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>G(t),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>B(t.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:ae(t.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${l>=0?"text-green-600":"text-red-600"}`,children:[l>=0?e.jsx(se,{className:"h-3 w-3 mr-1"}):e.jsx(de,{className:"h-3 w-3 mr-1"}),ae(Math.abs(l))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[t.labor_hours,"h (",X(t.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:X(a)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:X(p)})]})]})]})},emptyMessage:"No entries found",loading:U})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:n?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(R,{variant:"ghost",onClick:()=>{i(!1),d(null),r.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:r.handleSubmit(w,D),className:"space-y-4",children:[Object.keys(r.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(r.formState.errors).map(([t,l])=>e.jsxs("li",{children:["• ",l==null?void 0:l.message]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(E,{children:"Business Date"}),e.jsxs(Ke,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),r.watch("business_date")?ce(r.watch("business_date")):"Pick a date"]})}),e.jsx(Fe,{className:"w-auto p-0",children:e.jsx(ke,{mode:"single",selected:(()=>{const t=r.watch("business_date");if(!t)return;const l=Number(t.slice(0,4)),a=Number(t.slice(5,7)),p=Number(t.slice(8,10));return new Date(l,(a||1)-1,p||1)})(),onSelect:t=>{const l=t?L(t,"yyyy-MM-dd"):"";if(r.setValue("business_date",l),l){const a=N.find(p=>p.business_date===l);a?(d(a),r.reset({business_date:a.business_date,net_sales:a.net_sales!=null?Number(a.net_sales):0,last_year_sales:a.last_year_sales!=null?Number(a.last_year_sales):0,labor_hours:a.labor_hours!=null?Number(a.labor_hours):0,ideal_labor_hours:a.ideal_labor_hours!=null?Number(a.ideal_labor_hours):0,labor_percentage:a.labor_percentage!=null?Number(a.labor_percentage):0,food_variance_cost:a.food_variance_cost!=null?Number(a.food_variance_cost):0,waste_amount:a.waste_amount!=null?Number(a.waste_amount):0,breakfast_sales:a.breakfast_sales!=null?Number(a.breakfast_sales):0,night_sales:a.night_sales!=null?Number(a.night_sales):0}),o({title:"Loaded existing entry",description:`Loaded data for ${ce(a.business_date)} to edit.`})):(d(null),r.reset({business_date:l,net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}))}},initialFocus:!0})})]}),r.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(C,{id:"net_sales",type:"number",step:"0.01",...r.register("net_sales")}),r.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(C,{id:"last_year_sales",type:"number",step:"0.01",...r.register("last_year_sales")}),r.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(C,{id:"comp_net_sales",value:X(_e),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(C,{id:"labor_hours",type:"number",step:"0.1",...r.register("labor_hours")}),r.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(C,{id:"ideal_labor_hours",type:"number",step:"0.1",...r.register("ideal_labor_hours")}),r.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(C,{id:"labor_hours_diff",value:`${he>=0?"+":""}${he.toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(C,{id:"labor_percentage",type:"number",step:"0.1",...r.register("labor_percentage")}),r.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(C,{id:"food_variance_cost",type:"number",step:"0.01",...r.register("food_variance_cost")}),r.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(C,{id:"food_variance_percentage",value:X(Ue),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(C,{id:"waste_amount",type:"number",step:"0.01",...r.register("waste_amount")}),r.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(C,{id:"waste_percentage",value:X(ge),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(C,{id:"breakfast_sales",type:"number",step:"0.01",...r.register("breakfast_sales")}),r.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(C,{id:"night_sales",type:"number",step:"0.01",...r.register("night_sales")}),r.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.night_sales.message})]})]}),!c&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn’t linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{i(!1),d(null),r.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:m.isPending||T.isPending||!c,children:n?"Update Entry":"Save Entry"})]})]})]})})]})}const lr=le("/weekending-sheet")({component:dr});function dr(){const[s,i]=_.useState(!1),[n,d]=_.useState(null),[o,y]=_.useState(!1),{toast:c}=ne(),h=Ce(),[f,v]=_.useState(null),u=()=>{const A=Ks(new Date,{weekStartsOn:6});return L(Ys(A,{weekStartsOn:6}),"yyyy-MM-dd")},r=Me({resolver:Oe(qa),defaultValues:{week_ending_date:u(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}}),m=Z({mutationFn:async g=>{if(!f)throw new Error("No store is linked to your account. See Setup to link one.");const A={store_id:f,...g},{data:H,error:G}=await j.from("weekending_sheet").insert(A).select();if(G)throw G;return H},onSuccess:()=>{c({title:"Success!",description:"Weekending sheet saved successfully."}),i(!1),d(null),r.reset({week_ending_date:u(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}),h.invalidateQueries({queryKey:["weekending_sheet",f]})},onError:g=>{c({title:"Save failed",description:(g==null?void 0:g.message)||"Unable to save entry.",variant:"destructive"})}}),T=Z({mutationFn:async({id:g,payload:A})=>{if(!f)throw new Error("No store is linked to your account. See Setup to link one.");const{error:H}=await j.from("weekending_sheet").update({...A}).eq("id",g);if(H)throw H},onSuccess:()=>{c({title:"Updated!",description:"Weekending sheet updated successfully."}),i(!1),d(null),r.reset(),h.invalidateQueries({queryKey:["weekending_sheet",f]})},onError:g=>{c({title:"Update failed",description:g.message,variant:"destructive"})}}),w=Z({mutationFn:async g=>{const{error:A}=await j.from("weekending_sheet").delete().eq("id",g);if(A)throw A},onSuccess:()=>{c({title:"Deleted",description:"Weekending sheet entry removed."}),h.invalidateQueries({queryKey:["weekending_sheet",f]})},onError:g=>{c({title:"Delete failed",description:g.message,variant:"destructive"})}}),D=g=>{const A={...g,breakfast_sales:Number(g.breakfast_sales)||0,late_night_sales:Number(g.late_night_sales)||0,net_sales:Number(g.net_sales)||0,discounts:Number(g.discounts)||0,cash:Number(g.cash)||0,food_total:Number(g.food_total)||0,food_cost:Number(g.food_cost)||0,variance_dollars:Number(g.variance_dollars)||0,food_variance_percentage:Number(g.food_variance_percentage)||0,labor:Number(g.labor)||0,credit_hours:Number(g.credit_hours)||0,crew_food_safety_quiz:Number(g.crew_food_safety_quiz)||0,mgr_food_safety_quiz:Number(g.mgr_food_safety_quiz)||0};n?T.mutate({id:n.id,payload:A}):m.mutate(A)},b=g=>{console.error("Form validation failed:",g),g.discounts&&console.error("Discounts error:",g.discounts),g.cash&&console.error("Cash error:",g.cash),g.food_cost&&console.error("Food cost error:",g.food_cost),c({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})};_.useEffect(()=>{let g=!0;return(async()=>{var B;const{data:A}=await j.auth.getUser(),H=(B=A.user)==null?void 0:B.id;if(!H)return;const{data:G}=await j.from("users").select("store_id").eq("id",H).maybeSingle();g&&v((G==null?void 0:G.store_id)??null)})(),()=>{g=!1}},[]);const{data:x=[],isLoading:N,error:U}=Y({queryKey:["weekending_sheet",f],queryFn:async()=>{if(!f)return[];const{data:g,error:A}=await j.from("weekending_sheet").select("*").eq("store_id",f).order("week_ending_date",{ascending:!1}).limit(100);if(A)throw A;return g},enabled:!!f}),M=g=>{d(g),r.reset({week_ending_date:g.week_ending_date,manager_name:g.manager_name,breakfast_sales:g.breakfast_sales||0,late_night_sales:g.late_night_sales||0,net_sales:g.net_sales||0,discounts:g.discounts||0,cash:g.cash||0,food_total:g.food_total||0,food_cost:g.food_cost||0,variance_dollars:g.variance_dollars||0,food_variance_percentage:g.food_variance_percentage||0,labor:g.labor||0,credit_hours:g.credit_hours||0,reason:g.reason||"",onboarding:g.onboarding||!1,crew_food_safety_quiz:g.crew_food_safety_quiz||0,mgr_food_safety_quiz:g.mgr_food_safety_quiz||0,new_hire_name:g.new_hire_name||"",terminations:g.terminations||"",term_date:g.term_date||""}),i(!0)},z=g=>{confirm("Are you sure you want to delete this entry?")&&w.mutate(g)},W=()=>{if(x.length===0){c({title:"No data",description:"No entries to export.",variant:"destructive"});return}const A=[["Week Ending Date","Manager","Breakfast Sales","Late Night Sales","Net Sales","Discounts","Cash","Food Total","Food Cost","Variance Dollars","Food Variance %","Labor","Credit Hours","Reason","Onboarding","Crew Food Safety Quiz","MGR Food Safety Quiz","New Hire Name","Terminations","Term Date"].join(","),...x.map(I=>[I.week_ending_date,I.manager_name,I.breakfast_sales,I.late_night_sales,I.net_sales,I.discounts,I.cash,I.food_total,I.food_cost,I.variance_dollars,I.food_variance_percentage,I.labor,I.credit_hours,I.reason||"",I.onboarding?"Yes":"No",I.crew_food_safety_quiz,I.mgr_food_safety_quiz,I.new_hire_name||"",I.terminations||"",I.term_date||""].join(","))].join(`
`),H=new Blob([A],{type:"text/csv"}),G=window.URL.createObjectURL(H),B=document.createElement("a");B.href=G,B.download=`weekending-sheet-${L(new Date,"yyyy-MM-dd")}.csv`,B.click(),window.URL.revokeObjectURL(G),c({title:"Exported!",description:"CSV file downloaded successfully."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Weekending Sheet"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Weekly operational data and metrics tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(R,{onClick:()=>{d(null),r.reset({week_ending_date:u(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}),i(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Add Weekending Entry"]}),x.length>0&&e.jsxs(R,{onClick:W,variant:"outline",size:"sm",className:"w-full md:w-auto border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Total Entries"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:x.length})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Latest Week"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:x.length>0?ce(x[0].week_ending_date):"N/A"})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Avg Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:x.length>0?ae(x.reduce((g,A)=>g+(A.net_sales||0),0)/x.length):"$0"})]})]})}),U&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",U.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Weekending Entries"}),e.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:N?"Loading...":`${x.length} entries`})]}),(x==null?void 0:x.length)===0&&!N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:f?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:"You haven't added any weekending entries yet."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),f&&e.jsxs(R,{onClick:()=>i(!0),className:"wendys-button",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Week Ending"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Manager"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Sales"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Food Variance"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Labor"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(g=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:ce(g.week_ending_date)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:g.manager_name}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:ae(g.net_sales)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:X(g.food_variance_percentage)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:ae(g.labor)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>M(g),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>z(g.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})})]},g.id))})]})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:n?"Edit Weekending Entry":"Add Weekending Entry"}),e.jsx(R,{variant:"ghost",onClick:()=>{i(!1),d(null),r.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:r.handleSubmit(D,b),className:"space-y-6",children:[Object.keys(r.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(r.formState.errors).map(([g,A])=>e.jsxs("li",{children:["• ",A==null?void 0:A.message]},g))})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"form-section-title",children:[e.jsx(at,{className:"mr-2"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(E,{children:"Week Ending Date"}),e.jsxs(Ke,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),r.watch("week_ending_date")?ce(r.watch("week_ending_date")):"Pick a date"]})}),e.jsx(Fe,{className:"w-auto p-0",children:e.jsx(ke,{mode:"single",selected:(()=>{const g=r.watch("week_ending_date");if(!g)return;const A=Number(g.slice(0,4)),H=Number(g.slice(5,7)),G=Number(g.slice(8,10));return new Date(A,(H||1)-1,G||1)})(),onSelect:g=>{const A=g?L(g,"yyyy-MM-dd"):"";r.setValue("week_ending_date",A)},initialFocus:!0})})]}),r.formState.errors.week_ending_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.week_ending_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"manager_name",children:"Manager Name"}),e.jsxs("select",{id:"manager_name",...r.register("manager_name"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",children:[e.jsx("option",{value:"Scott",children:"Scott"}),e.jsx("option",{value:"Sophear",children:"Sophear"}),e.jsx("option",{value:"Letoya",children:"Letoya"}),e.jsx("option",{value:"Carissa",children:"Carissa"})]}),r.formState.errors.manager_name&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.manager_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"reason",children:"Reason"}),e.jsx(C,{id:"reason",placeholder:"Optional notes or reason",...r.register("reason")}),r.formState.errors.reason&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.reason.message})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"form-section-title",children:[e.jsx(Qs,{className:"mr-2"}),"Sales & Financial Data"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"breakfast_sales",children:"Breakfast Sales (DP1) ($)"}),e.jsx(C,{id:"breakfast_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("breakfast_sales")}),r.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"late_night_sales",children:"Late Night Sales (DP6) ($)"}),e.jsx(C,{id:"late_night_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("late_night_sales")}),r.formState.errors.late_night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.late_night_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(C,{id:"net_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("net_sales")}),r.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"discounts",children:"Discounts ($) - Can be negative"}),e.jsx(C,{id:"discounts",type:"number",step:"0.01",placeholder:"0.00",...r.register("discounts")}),r.formState.errors.discounts&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.discounts.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"cash",children:"Cash ($) - Can be negative"}),e.jsx(C,{id:"cash",type:"number",step:"0.01",placeholder:"0.00",...r.register("cash")}),r.formState.errors.cash&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.cash.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_total",children:"Food Total ($) - Can be negative"}),e.jsx(C,{id:"food_total",type:"number",step:"0.01",placeholder:"0.00",...r.register("food_total")}),r.formState.errors.food_total&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_total.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_cost",children:"Food Cost ($) - Can be negative"}),e.jsx(C,{id:"food_cost",type:"number",step:"0.01",placeholder:"0.00",...r.register("food_cost")}),r.formState.errors.food_cost&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"variance_dollars",children:"Variance Dollars ($) - Can be negative"}),e.jsx(C,{id:"variance_dollars",type:"number",step:"0.01",placeholder:"0.00",...r.register("variance_dollars")}),r.formState.errors.variance_dollars&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.variance_dollars.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_percentage",children:"Food Variance % - Can be negative"}),e.jsx(C,{id:"food_variance_percentage",type:"number",step:"0.1",placeholder:"0.0",...r.register("food_variance_percentage")}),r.formState.errors.food_variance_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_variance_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor",children:"Labor ($)"}),e.jsx(C,{id:"labor",type:"number",step:"0.01",placeholder:"0.00",...r.register("labor")}),r.formState.errors.labor&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"credit_hours",children:"Credit Hours"}),e.jsx(C,{id:"credit_hours",type:"number",step:"0.1",placeholder:"0.0",...r.register("credit_hours")}),r.formState.errors.credit_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.credit_hours.message})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("button",{type:"button",onClick:()=>y(!o),className:"form-section-title w-full text-left flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Dt,{className:"mr-2"}),"WeLearn & Training"]}),o?e.jsx(rt,{className:"h-5 w-5"}):e.jsx(Qe,{className:"h-5 w-5"})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"md:col-span-2 space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"onboarding",type:"checkbox",...r.register("onboarding"),className:"h-4 w-4 text-wendys-red focus:ring-wendys-red border-gray-300 rounded"}),e.jsx(E,{htmlFor:"onboarding",children:"Onboarding Completed"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"crew_food_safety_quiz",children:"Crew Food Safety Quiz Score"}),e.jsx(C,{id:"crew_food_safety_quiz",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0-100",...r.register("crew_food_safety_quiz")}),r.formState.errors.crew_food_safety_quiz&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.crew_food_safety_quiz.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"mgr_food_safety_quiz",children:"MGR Food Safety Quiz Score"}),e.jsx(C,{id:"mgr_food_safety_quiz",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0-100",...r.register("mgr_food_safety_quiz")}),r.formState.errors.mgr_food_safety_quiz&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.mgr_food_safety_quiz.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"new_hire_name",children:"New Hire Name"}),e.jsx(C,{id:"new_hire_name",placeholder:"Optional",...r.register("new_hire_name")}),r.formState.errors.new_hire_name&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.new_hire_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"terminations",children:"Terminations"}),e.jsx(C,{id:"terminations",placeholder:"Optional",...r.register("terminations")}),r.formState.errors.terminations&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.terminations.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"term_date",children:"Termination Date"}),e.jsx(C,{id:"term_date",type:"date",...r.register("term_date")}),r.formState.errors.term_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.term_date.message})]})]})]}),!f&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn't linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{i(!1),d(null),r.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:m.isPending||T.isPending||!f,children:n?"Update Entry":"Save Entry"})]})]})]})})]})}const Ge=_.forwardRef(({className:s,...i},n)=>e.jsx("textarea",{className:S("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...i}));Ge.displayName="Textarea";const cr=le("/calendar")({component:mr});function mr(){var ge,t,l;const[s,i]=_.useState(!1),[n,d]=_.useState(!1),[o,y]=_.useState(null),[c,h]=_.useState(null),[f,v]=_.useState(new Date),[u,r]=_.useState("month"),{toast:m}=ne(),T=Ce(),[w,D]=_.useState(null);_.useEffect(()=>{(async()=>{const{data:{user:p}}=await j.auth.getUser();D((p==null?void 0:p.id)||null)})()},[]);const{data:b=[]}=Y({queryKey:["calendar-events",w],queryFn:async()=>{if(!w)return[];const{data:a,error:p}=await j.from("calendar_events").select("*").eq("created_by",w).order("start_date",{ascending:!0});if(p)throw p;return a||[]},enabled:!!w}),{data:x=[]}=Y({queryKey:["calendar-reminders",w],queryFn:async()=>{if(!w)return[];const{data:a,error:p}=await j.from("calendar_reminders").select("*").eq("created_by",w).order("due_date",{ascending:!0});if(p)throw p;return a||[]},enabled:!!w}),N=Z({mutationFn:async a=>{if(!w)throw new Error("User not authenticated");if(o){const{error:p}=await j.from("calendar_events").update({...a,updated_at:new Date().toISOString()}).eq("id",o.id);if(p)throw p}else{const{error:p}=await j.from("calendar_events").insert({...a,created_by:w,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(p)throw p}},onSuccess:()=>{m({title:o?"Event updated!":"Event created!",description:o?"Your event has been updated successfully.":"Your event has been created successfully."}),i(!1),y(null),T.invalidateQueries({queryKey:["calendar-events",w]})},onError:a=>{m({title:"Error",description:a.message||"Failed to save event",variant:"destructive"})}}),U=Z({mutationFn:async a=>{if(!w)throw new Error("User not authenticated");if(c){const{error:p}=await j.from("calendar_reminders").update({...a,updated_at:new Date().toISOString()}).eq("id",c.id);if(p)throw p}else{const{error:p}=await j.from("calendar_reminders").insert({...a,created_by:w,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(p)throw p}},onSuccess:()=>{m({title:c?"Reminder updated!":"Reminder created!",description:c?"Your reminder has been updated successfully.":"Your reminder has been created successfully."}),d(!1),h(null),T.invalidateQueries({queryKey:["calendar-reminders",w]})},onError:a=>{m({title:"Error",description:a.message||"Failed to save reminder",variant:"destructive"})}}),M=Z({mutationFn:async a=>{const{error:p}=await j.from("calendar_events").delete().eq("id",a);if(p)throw p},onSuccess:()=>{m({title:"Event deleted",description:"Event has been removed successfully."}),T.invalidateQueries({queryKey:["calendar-events",w]})},onError:a=>{m({title:"Delete failed",description:a.message,variant:"destructive"})}}),z=Z({mutationFn:async a=>{const{error:p}=await j.from("calendar_reminders").delete().eq("id",a);if(p)throw p},onSuccess:()=>{m({title:"Reminder deleted",description:"Reminder has been removed successfully."}),T.invalidateQueries({queryKey:["calendar-reminders",w]})},onError:a=>{m({title:"Delete failed",description:a.message,variant:"destructive"})}}),W=Z({mutationFn:async({id:a,completed:p})=>{const{error:k}=await j.from("calendar_reminders").update({completed:p,updated_at:new Date().toISOString()}).eq("id",a);if(k)throw k},onSuccess:()=>{T.invalidateQueries({queryKey:["calendar-reminders",w]})},onError:a=>{m({title:"Error",description:a.message,variant:"destructive"})}}),g=b.filter(a=>De(Ne(a.start_date),f)),A=x.filter(a=>De(Ne(a.due_date),f)),H=Bs({start:Js(f),end:Xs(f)}),G=a=>b.filter(p=>De(Ne(p.start_date),a)),B=a=>x.filter(p=>De(Ne(p.due_date),a)),I=a=>{a&&v(a)},_e=a=>{y(a||null),i(!0)},he=a=>{h(a||null),d(!0)},Ue=a=>{switch(a){case"high":return e.jsx(ue,{className:"h-3 w-3 fill-red-500 text-red-500"});case"medium":return e.jsx(ue,{className:"h-3 w-3 fill-yellow-500 text-yellow-500"});case"low":return e.jsx(ue,{className:"h-3 w-3 fill-green-500 text-green-500"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-wendys-red via-red-600 to-wendys-dark-red opacity-10"}),e.jsx("div",{className:"relative px-6 py-8 sm:px-8 lg:px-12",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold bg-gradient-to-r from-wendys-charcoal to-gray-700 bg-clip-text text-transparent",children:"Calendar"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl",children:"Organize your schedule with beautiful events and smart reminders"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(R,{onClick:()=>_e(),className:"wendys-button shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Add Event"]}),e.jsxs(R,{onClick:()=>he(),variant:"outline",className:"border-2 border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(gt,{className:"h-5 w-5 mr-2"}),"Add Reminder"]})]})]})})})]}),e.jsx("div",{className:"px-6 sm:px-8 lg:px-12 pb-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex bg-white rounded-xl p-1 shadow-lg border border-gray-200",children:["month","week","day"].map(a=>e.jsx(R,{variant:u===a?"default":"ghost",onClick:()=>r(a),size:"sm",className:`rounded-lg px-6 py-2 font-medium transition-all duration-200 ${u===a?"wendys-button shadow-md":"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100"}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:e.jsx(ke,{mode:"single",selected:f,onSelect:I,className:"rounded-xl border-0",classNames:{day_selected:"bg-wendys-red text-white hover:bg-wendys-dark-red focus:bg-wendys-dark-red",day_today:"bg-wendys-red/10 text-wendys-red font-bold",day:"h-12 w-12 text-center text-sm p-0 font-normal aria-selected:opacity-100 hover:bg-gray-100 rounded-lg transition-colors duration-200",head_cell:"text-gray-500 font-semibold text-sm uppercase tracking-wide pb-4",nav_button:"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100 rounded-lg transition-colors duration-200",nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",caption:"relative px-8 py-4 text-center text-xl font-semibold text-wendys-charcoal",caption_label:"text-xl font-semibold text-wendys-charcoal",table:"w-full border-collapse space-y-1",head_row:"flex",row:"flex w-full mt-2",cell:"h-12 w-12 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20"}})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-wendys-red to-wendys-dark-red rounded-full mb-4",children:e.jsx(re,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal",children:L(f,"EEEE")}),e.jsx("p",{className:"text-lg text-gray-600",children:L(f,"MMMM d, yyyy")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),"Events (",g.length,")"]}),g.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No events scheduled"})]}):e.jsx("div",{className:"space-y-3",children:g.map(a=>e.jsx("div",{className:"group bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-blue-900 text-lg",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-blue-700 mt-2 leading-relaxed",children:a.description}),e.jsxs("div",{className:"flex items-center text-xs text-blue-600 mt-3 space-x-4",children:[e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),L(Ne(a.start_date),"h:mm a")]}),a.location&&e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx(nt,{className:"h-3 w-3 mr-1"}),a.location]})]})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>_e(a),className:"h-8 w-8 p-0 hover:bg-blue-200",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>M.mutate(a.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},a.id))})]}),e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-3"}),"Reminders (",A.length,")"]}),A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(gt,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No reminders due"})]}):e.jsx("div",{className:"space-y-3",children:A.map(a=>e.jsx("div",{className:`group border rounded-xl p-4 transition-all duration-200 hover:shadow-md ${a.completed?"bg-gray-50 border-gray-200":a.priority==="high"?"bg-gradient-to-r from-red-50 to-red-100 border-red-200":a.priority==="medium"?"bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-200":"bg-gradient-to-r from-green-50 to-green-100 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>W.mutate({id:a.id,completed:!a.completed}),className:"flex-shrink-0",children:a.completed?e.jsx(Pe,{className:"h-5 w-5 text-green-600"}):e.jsx(qt,{className:"h-5 w-5 text-gray-400 hover:text-gray-600 transition-colors duration-200"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Ue(a.priority),e.jsx("h5",{className:`font-semibold text-lg ${a.completed?"text-gray-500 line-through":"text-gray-900"}`,children:a.title})]})]}),a.description&&e.jsx("p",{className:`text-sm mt-2 leading-relaxed ${a.completed?"text-gray-500":"text-gray-700"}`,children:a.description}),e.jsx("div",{className:"flex items-center mt-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.priority==="high"?"bg-red-100 text-red-800":a.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[a.priority.charAt(0).toUpperCase()+a.priority.slice(1)," Priority"]})})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>he(a),className:"h-8 w-8 p-0 hover:bg-gray-200",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>z.mutate(a.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},a.id))})]})]})})]}),u==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal mb-6 text-center",children:L(f,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-500 py-3 px-2",children:a},a)),H.map((a,p)=>{const k=G(a),q=B(a),ee=Zs(a),J=De(a,f),oe=ea(a,f);return e.jsxs("div",{className:`min-h-[100px] p-2 border border-gray-200 cursor-pointer transition-all duration-200 rounded-lg ${oe?"bg-white hover:bg-gray-50":"bg-gray-50 text-gray-400"} ${ee?"bg-gradient-to-br from-wendys-red/20 to-wendys-dark-red/20 border-wendys-red/30 shadow-md":""} ${J?"bg-blue-50 border-blue-300 shadow-md":""}`,onClick:()=>v(a),children:[e.jsx("div",{className:`text-sm font-semibold mb-2 ${ee?"text-wendys-red":oe?"text-gray-900":"text-gray-400"}`,children:L(a,"d")}),k.slice(0,2).map(Q=>e.jsx("div",{className:"text-xs bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded-full mb-1 truncate shadow-sm",title:Q.title,children:Q.title},Q.id)),q.slice(0,2).map(Q=>e.jsx("div",{className:`text-xs px-2 py-1 rounded-full mb-1 truncate shadow-sm ${Q.completed?"bg-gray-400 text-white":Q.priority==="high"?"bg-gradient-to-r from-red-500 to-red-600 text-white":Q.priority==="medium"?"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white":"bg-gradient-to-r from-green-500 to-green-600 text-white"}`,title:Q.title,children:Q.title},Q.id)),k.length+q.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 text-center bg-gray-100 rounded-full py-1 mt-1",children:["+",k.length+q.length-4," more"]})]},p)})]})]})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:o?"Edit Event":"Add Event"}),e.jsx(R,{variant:"ghost",onClick:()=>{i(!1),y(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const p=new FormData(a.currentTarget),k={title:p.get("title"),description:p.get("description"),start_date:p.get("start_date"),end_date:p.get("end_date")||void 0,all_day:p.get("all_day")==="on",location:p.get("location"),reminder_type:p.get("reminder_type")};N.mutate(k)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"title",className:"text-sm font-semibold text-gray-700",children:"Event Title *"}),e.jsx(C,{id:"title",name:"title",defaultValue:o==null?void 0:o.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event title"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(Ge,{id:"description",name:"description",defaultValue:o==null?void 0:o.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"start_date",className:"text-sm font-semibold text-gray-700",children:"Start Date *"}),e.jsx(C,{id:"start_date",name:"start_date",type:"datetime-local",defaultValue:(ge=o==null?void 0:o.start_date)==null?void 0:ge.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"end_date",className:"text-sm font-semibold text-gray-700",children:"End Date"}),e.jsx(C,{id:"end_date",name:"end_date",type:"datetime-local",defaultValue:(t=o==null?void 0:o.end_date)==null?void 0:t.slice(0,16),className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{id:"all_day",name:"all_day",type:"checkbox",defaultChecked:o==null?void 0:o.all_day,className:"rounded border-gray-300 text-wendys-red focus:ring-wendys-red/20 h-4 w-4"}),e.jsx(E,{htmlFor:"all_day",className:"text-sm font-medium text-gray-700",children:"All day event"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"location",className:"text-sm font-semibold text-gray-700",children:"Location"}),e.jsx(C,{id:"location",name:"location",defaultValue:o==null?void 0:o.location,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter location"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_type",className:"text-sm font-semibold text-gray-700",children:"Reminder"}),e.jsxs("select",{id:"reminder_type",name:"reminder_type",defaultValue:(o==null?void 0:o.reminder_type)||"none",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"none",children:"No reminder"}),e.jsx("option",{value:"15min",children:"15 minutes before"}),e.jsx("option",{value:"1hour",children:"1 hour before"}),e.jsx("option",{value:"1day",children:"1 day before"}),e.jsx("option",{value:"1week",children:"1 week before"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{i(!1),y(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:o?"Update Event":"Create Event"})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:c?"Edit Reminder":"Add Reminder"}),e.jsx(R,{variant:"ghost",onClick:()=>{d(!1),h(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:a=>{a.preventDefault();const p=new FormData(a.currentTarget),k={title:p.get("title"),description:p.get("description"),due_date:p.get("due_date"),priority:p.get("priority"),completed:!1};U.mutate(k)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_title",className:"text-sm font-semibold text-gray-700",children:"Reminder Title *"}),e.jsx(C,{id:"reminder_title",name:"title",defaultValue:c==null?void 0:c.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder title"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(Ge,{id:"reminder_description",name:"description",defaultValue:c==null?void 0:c.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder description"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_due_date",className:"text-sm font-semibold text-gray-700",children:"Due Date *"}),e.jsx(C,{id:"reminder_due_date",name:"due_date",type:"datetime-local",defaultValue:(l=c==null?void 0:c.due_date)==null?void 0:l.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_priority",className:"text-sm font-semibold text-gray-700",children:"Priority"}),e.jsxs("select",{id:"reminder_priority",name:"priority",defaultValue:(c==null?void 0:c.priority)||"medium",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{d(!1),h(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:c?"Update Reminder":"Create Reminder"})]})]})]})})]})}const wt=ia,vt=oa,et=_.forwardRef(({className:s,children:i,...n},d)=>e.jsxs(Xt,{ref:d,className:S("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[i,e.jsx(ta,{asChild:!0,children:e.jsx(Qe,{className:"h-4 w-4 opacity-50"})})]}));et.displayName=Xt.displayName;const hs=_.forwardRef(({className:s,...i},n)=>e.jsx(Zt,{ref:n,className:S("flex cursor-default items-center justify-center py-1",s),...i,children:e.jsx(rt,{className:"h-4 w-4"})}));hs.displayName=Zt.displayName;const gs=_.forwardRef(({className:s,...i},n)=>e.jsx(es,{ref:n,className:S("flex cursor-default items-center justify-center py-1",s),...i,children:e.jsx(Qe,{className:"h-4 w-4"})}));gs.displayName=es.displayName;const tt=_.forwardRef(({className:s,children:i,position:n="popper",...d},o)=>e.jsx(sa,{children:e.jsxs(ts,{ref:o,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...d,children:[e.jsx(hs,{}),e.jsx(aa,{className:S("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(gs,{})]})}));tt.displayName=ts.displayName;const ur=_.forwardRef(({className:s,...i},n)=>e.jsx(ss,{ref:n,className:S("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...i}));ur.displayName=ss.displayName;const te=_.forwardRef(({className:s,children:i,...n},d)=>e.jsxs(as,{ref:d,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ra,{children:e.jsx(Ut,{className:"h-4 w-4"})})}),e.jsx(na,{children:i})]}));te.displayName=as.displayName;const xr=_.forwardRef(({className:s,...i},n)=>e.jsx(rs,{ref:n,className:S("-mx-1 my-1 h-px bg-muted",s),...i}));xr.displayName=rs.displayName;const hr=le("/interviews")({component:gr});function gr(){const[s,i]=_.useState(null),[n,d]=_.useState(null),[o,y]=_.useState([]),[c,h]=_.useState(!1),[f,v]=_.useState(null),[u,r]=_.useState(""),[m,T]=_.useState("ALL"),[w,D]=_.useState(!1),{toast:b}=ne(),x=Ce(),[N,U]=_.useState({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""});_.useEffect(()=>{(async()=>{try{const{data:{user:l}}=await j.auth.getUser();if(!l)return;d(l.id);const{data:a}=await j.from("users").select("store_id").eq("id",l.id).single();a!=null&&a.store_id&&(i(a.store_id),W(a.store_id),z(a.store_id))}catch(l){console.error("Error getting store ID:",l)}})()},[]);const M=async()=>{try{console.log("🔧 Starting database enum migration..."),console.log("Step 1: Updating DONE to COMPLETED...");const{error:t}=await j.from("interviews").update({status:"COMPLETED"}).eq("status","DONE");t?console.log("Update error (may be expected if no DONE values exist):",t.message):console.log("✅ Updated existing DONE values to COMPLETED"),console.log("Step 2: Attempting enum recreation via RPC..."),console.log("⚠️  Manual migration required!"),console.log("Please run this SQL in your Supabase SQL Editor:"),console.log(`
-- Migration SQL to run in Supabase Dashboard:
DROP TYPE IF EXISTS interview_status CASCADE;
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Then recreate the interviews table if it was dropped:
-- (Copy the CREATE TABLE statement from schema.sql)
      `),b({title:"Migration Instructions",description:"Check console for SQL commands to run in Supabase Dashboard",variant:"default"})}catch(t){console.error("Migration error:",t),b({title:"Migration Error",description:"See console for details",variant:"destructive"})}},z=async t=>{try{console.log("🔍 Checking database enum values...");const{data:l,error:a}=await j.rpc("get_enum_values",{enum_name:"interview_status"});if(a){console.log("Could not get enum values via RPC, trying direct query...");const p=["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"];for(const k of p)try{console.log(`Testing status: "${k}"`);const{error:q}=await j.from("interviews").insert([{store_id:t,candidate_name:`TEST_${k}`,interview_date:new Date().toISOString().split("T")[0],interview_time:"12:00:00",status:k,position:"Test Position"}]).select();q?console.log(`❌ Status "${k}" rejected:`,q.message):(console.log(`✅ Status "${k}" accepted`),await j.from("interviews").delete().eq("candidate_name",`TEST_${k}`))}catch(q){console.log(`❌ Status "${k}" failed:`,q)}}else console.log("✅ Database enum values:",l)}catch(l){console.error("Error checking database enum values:",l)}},W=async t=>{try{D(!0);const{data:l,error:a}=await j.from("interviews").select("*").eq("store_id",t).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(a)throw a;y(l||[])}catch(l){console.error("Error fetching interviews:",l),b({title:"Error",description:"Failed to fetch interviews",variant:"destructive"})}finally{D(!1)}},g=(t,l)=>{U(a=>({...a,[t]:l}))},A=()=>{U({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""}),v(null)},H=async t=>{if(!n)return null;try{const{data:l,error:a}=await j.from("calendar_events").select("id").eq("created_by",n).ilike("title","Interview: %").ilike("description",`%interviewId: ${t}%`).single();return a&&a.code!=="PGRST116"?(console.error("Error finding calendar event:",a),null):l}catch(l){return console.error("Error in findCalendarEvent:",l),null}},G=async t=>{if(!n){console.warn("No user ID available for calendar event deletion");return}try{const l=await H(t);if(l){const{error:a}=await j.from("calendar_events").delete().eq("id",l.id);if(a)throw console.error("Error deleting calendar event:",a),a;console.log("Calendar event deleted successfully for interview:",t),x.invalidateQueries({queryKey:["calendar-events",n]}),x.refetchQueries({queryKey:["calendar-events",n]})}else console.log("No calendar event found to delete for interview:",t)}catch(l){throw console.error("Error in deleteCalendarEvent:",l),l}},B=async(t,l=!1)=>{if(!n){console.warn("No user ID available for calendar event creation");return}try{if(t.status!=="SCHEDULED"){console.log("Interview status is not SCHEDULED, removing calendar event if it exists"),await G(t.id);return}if(!t.interview_date||!t.interview_time){console.warn("Invalid date or time for calendar event:",{date:t.interview_date,time:t.interview_time});return}const a=t.interview_time.includes(":")&&t.interview_time.split(":").length===2?`${t.interview_time}:00`:t.interview_time,p=`${t.interview_date}T${a}`,k=new Date(p);if(isNaN(k.getTime()))throw console.error("Invalid start date created:",p,"from:",{date:t.interview_date,time:t.interview_time,formattedTime:a}),new Error("Invalid interview date/time format");const q=new Date(k.getTime()+60*60*1e3);if(isNaN(q.getTime()))throw console.error("Invalid end date calculated from start date:",k),new Error("Invalid end date calculation");const ee=q.toISOString(),J={title:`Interview: ${t.candidate_name}`,description:`Interview for ${t.position||"position"}
${t.notes||""}
Phone: ${t.phone||"N/A"}
Email: ${t.email||"N/A"}
interviewId: ${t.id}`,start_date:p,end_date:ee,all_day:!1,location:"Store Interview Room",reminder_type:"15min",updated_at:new Date().toISOString()};if(l){const oe=await H(t.id);if(oe){const{error:Q}=await j.from("calendar_events").update(J).eq("id",oe.id);Q?console.error("Error updating calendar event:",Q):(console.log("Calendar event updated successfully for interview:",t.id),x.invalidateQueries({queryKey:["calendar-events",n]}),x.refetchQueries({queryKey:["calendar-events",n]}))}else{const{error:Q}=await j.from("calendar_events").insert([{...J,created_by:n}]);Q?console.error("Error creating calendar event:",Q):(console.log("Calendar event created successfully for interview:",t.id),x.invalidateQueries({queryKey:["calendar-events",n]}),x.refetchQueries({queryKey:["calendar-events",n]}))}}else{const{error:oe}=await j.from("calendar_events").insert([{...J,created_by:n}]);oe?(console.error("Error creating calendar event:",oe),b({title:"Warning",description:"Interview scheduled but calendar event creation failed.",variant:"destructive"})):(console.log("Calendar event created successfully for interview:",t.id),x.invalidateQueries({queryKey:["calendar-events",n]}),x.refetchQueries({queryKey:["calendar-events",n]}))}}catch(a){throw console.error("Error in createOrUpdateCalendarEvent:",a),a}},I=async()=>{if(!n){b({title:"Error",description:"User not authenticated",variant:"destructive"});return}if(!s){b({title:"Error",description:"No store selected",variant:"destructive"});return}if(!N.candidate_name.trim()){b({title:"Error",description:"Candidate name is required",variant:"destructive"});return}if(!N.position.trim()){b({title:"Error",description:"Position is required",variant:"destructive"});return}if(!N.interview_date){b({title:"Error",description:"Interview date is required",variant:"destructive"});return}if(!N.interview_time){b({title:"Error",description:"Interview time is required",variant:"destructive"});return}console.log("Saving interview with data:",N),console.log("Interview date format:",typeof N.interview_date,N.interview_date),console.log("Interview time format:",typeof N.interview_time,N.interview_time);const t=N.interview_time.includes(":")&&N.interview_time.split(":").length===2?`${N.interview_time}:00`:N.interview_time;console.log("Formatted time for database:",t);try{if(f){const{data:l,error:a}=await j.from("interviews").update({candidate_name:N.candidate_name,phone:N.phone||null,email:N.email||null,position:N.position,interview_date:N.interview_date,interview_time:t,status:N.status,notes:N.notes||null}).eq("id",f.id).select().single();if(a)throw a;if(l)try{await B(l,!0)}catch(p){console.warn("Calendar event update failed, but interview was saved:",p)}b({title:"Success!",description:N.status==="SCHEDULED"?"Interview updated and calendar synced!":"Interview updated and removed from calendar!"})}else{const{data:l,error:a}=await j.from("interviews").insert([{store_id:s,candidate_name:N.candidate_name,phone:N.phone||null,email:N.email||null,position:N.position,interview_date:N.interview_date,interview_time:t,status:N.status,notes:N.notes||null}]).select().single();if(a)throw a;if(l)try{await B(l,!1)}catch(p){console.warn("Calendar event creation failed, but interview was saved:",p)}b({title:"Success!",description:N.status==="SCHEDULED"?"Interview scheduled and added to calendar!":"Interview saved successfully!"})}W(s),h(!1),A()}catch(l){console.error("Error saving interview:",l),console.error("Full error object:",JSON.stringify(l,null,2)),console.error("Error message:",l.message),console.error("Error details:",l.details),console.error("Error hint:",l.hint),console.error("Error code:",l.code);let a="Failed to save interview";l.message?a=l.message:l.details?a=`Database error: ${l.details}`:l.hint?a=`Hint: ${l.hint}`:l.code&&(a=`Error code: ${l.code}`),b({title:"Error",description:a,variant:"destructive"})}},_e=t=>{v(t),U({candidate_name:t.candidate_name,phone:t.phone||"",email:t.email||"",position:t.position||"",interview_date:t.interview_date,interview_time:t.interview_time,status:t.status,notes:t.notes||""}),h(!0)},he=async t=>{if(confirm("Are you sure you want to delete this interview?"))try{try{await G(t)}catch(a){console.warn("Calendar event deletion failed, but continuing with interview deletion:",a)}const{error:l}=await j.from("interviews").delete().eq("id",t);if(l)throw l;b({title:"Deleted!",description:"Interview and calendar event removed successfully."}),W(s)}catch(l){console.error("Error deleting interview:",l),b({title:"Error",description:l.message||"Failed to delete interview",variant:"destructive"})}},ge=o.filter(t=>{const l=t.candidate_name.toLowerCase().includes(u.toLowerCase())||(t.position||"").toLowerCase().includes(u.toLowerCase()),a=m==="ALL"||t.status===m;return l&&a}).reduce((t,l)=>{const a=l.interview_date;return t[a]||(t[a]=[]),t[a].push(l),t},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(R,{onClick:()=>h(!0),className:"wendys-button",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(C,{placeholder:"Search by name or position...",value:u,onChange:t=>r(t.target.value),className:"pl-10"})]})}),e.jsxs(wt,{value:m,onValueChange:T,children:[e.jsx(et,{className:"w-full sm:w-48",children:e.jsx(vt,{placeholder:"Filter by status"})}),e.jsxs(tt,{children:[e.jsx(te,{value:"ALL",children:"All Statuses"}),e.jsx(te,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(te,{value:"COMPLETED",children:"Completed"}),e.jsx(te,{value:"NO_SHOW",children:"No Show"}),e.jsx(te,{value:"HIRED",children:"Hired"}),e.jsx(te,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[w&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!w&&Object.keys(ge).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(ge).map(([t,l])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),ce(t)]}),e.jsx("div",{className:"space-y-3",children:l.map(a=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:a.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ns(a.status)}`,children:a.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx("span",{children:a.position||"No position specified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:fa(a.interview_time)})]}),a.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(la,{className:"h-4 w-4"}),e.jsx("span",{children:a.phone})]}),a.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qt,{className:"h-4 w-4"}),e.jsx("span",{children:a.email})]})]}),a.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx(at,{className:"h-4 w-4 inline mr-1"}),a.notes]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>_e(a),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>he(a.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},a.id))})]},t))]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:f?"Edit Interview":"Schedule New Interview"}),e.jsx(R,{variant:"ghost",onClick:()=>{h(!1),A()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),I()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(C,{id:"candidate_name",value:N.candidate_name,onChange:t=>g("candidate_name",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"position",children:"Position"}),e.jsx(C,{id:"position",value:N.position,onChange:t=>g("position",t.target.value),placeholder:"e.g., Crew Member, Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"phone",children:"Phone"}),e.jsx(C,{id:"phone",type:"tel",value:N.phone,onChange:t=>g("phone",t.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"email",children:"Email"}),e.jsx(C,{id:"email",type:"email",value:N.email,onChange:t=>g("email",t.target.value),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(C,{id:"interview_date",type:"date",value:N.interview_date,onChange:t=>g("interview_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(C,{id:"interview_time",type:"time",value:N.interview_time,onChange:t=>g("interview_time",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"status",children:"Status *"}),e.jsxs(wt,{value:N.status,onValueChange:t=>g("status",t),children:[e.jsx(et,{id:"status",children:e.jsx(vt,{})}),e.jsxs(tt,{children:[e.jsx(te,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(te,{value:"COMPLETED",children:"Completed"}),e.jsx(te,{value:"NO_SHOW",children:"No Show"}),e.jsx(te,{value:"HIRED",children:"Hired"}),e.jsx(te,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"notes",children:"Notes"}),e.jsx(Ge,{id:"notes",value:N.notes,onChange:t=>g("notes",t.target.value),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>z(s),className:"text-xs",children:"Test Enum"}),e.jsx(R,{type:"button",variant:"outline",onClick:M,className:"text-xs",children:"Migrate DB"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{h(!1),A()},children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button",children:f?"Update Interview":"Schedule Interview"})]})]})]})]})})]})}const fr=xe({sales_target:O.number().min(0),labor_target_pct:O.number().min(0),waste_target_pct:O.number().min(0),food_variance_target_pct:O.number().min(0),team_notes:V().optional()});function yr(){const{toast:s}=ne(),i=Ce(),[n,d]=_.useState(null),o=ot("goals","wtd"),y=o.getDateRangeFilter(),c=(y==null?void 0:y.start)||L(new Date,"yyyy-MM-dd"),h=(y==null?void 0:y.end)||L(new Date,"yyyy-MM-dd"),f=o.selectedRange==="mtd"?"month":o.selectedRange==="wtd"?"week":"custom",v=Me({resolver:Oe(fr),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});_.useEffect(()=>{let b=!0;return(async()=>{var z;const{data:x}=await j.auth.getUser(),N=(z=x.user)==null?void 0:z.id;if(!N)return;const{data:U,error:M}=await j.from("users").select("store_id").eq("id",N).maybeSingle();b&&(M||d((U==null?void 0:U.store_id)??null))})(),()=>{b=!1}},[]);const{data:u}=Y({queryKey:["goals_settings",n,c,h],queryFn:async()=>{if(!n)return null;try{const{data:b,error:x}=await j.from("goals").select("*").eq("store_id",n).eq("period_start",c).eq("period_end",h).maybeSingle();if(x&&x.code!=="PGRST116"){const N=String(x.code||""),U=String(x.message||"");if(N.startsWith("42")||U.toLowerCase().includes("relation")||U.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw x}return b||null}catch(b){const x=String((b==null?void 0:b.code)||""),N=String((b==null?void 0:b.message)||"");if(x.startsWith("42")||N.toLowerCase().includes("relation")||N.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw b}},enabled:!!n});_.useEffect(()=>{u&&v.reset({sales_target:u.sales_target,labor_target_pct:u.labor_target_pct,waste_target_pct:u.waste_target_pct,food_variance_target_pct:u.food_variance_target_pct,team_notes:u.team_notes||""})},[u]);const{data:r=[]}=Y({queryKey:["omega_daily_for_goals",n,c,h],queryFn:async()=>{if(!n)return[];const{data:b,error:x}=await j.from("omega_daily").select("*").eq("store_id",n).gte("business_date",c).lte("business_date",h).order("business_date",{ascending:!0});if(x)throw x;return b},enabled:!!n}),m=_.useMemo(()=>{const b=r.reduce((W,g)=>W+(Number(g.net_sales)||0),0),x=r.length>0?r.reduce((W,g)=>W+(Number(g.labor_percentage)||0),0)/r.length:0,N=r.reduce((W,g)=>W+(Number(g.waste_amount)||0),0),U=r.reduce((W,g)=>W+(Number(g.food_variance_cost)||0),0),M=b>0?N/b*100:0,z=b>0?U/b*100:0;return{totalSales:b,avgLaborPct:x,wastePct:M,foodVarPct:z}},[r]),T=Z({mutationFn:async b=>{if(!n)throw new Error("No store is linked to your account. See Setup to link one.");const x={store_id:n,scope:f,period_start:c,period_end:h,sales_target:b.sales_target,labor_target_pct:b.labor_target_pct,waste_target_pct:b.waste_target_pct,food_variance_target_pct:b.food_variance_target_pct,team_notes:b.team_notes||null},{error:N}=await j.from("goals").upsert(x,{onConflict:"store_id,period_start,period_end"});if(N){const U=String(N.code||""),M=String(N.message||"");throw U.startsWith("42")||M.toLowerCase().includes("relation")||M.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):N}},onSuccess:()=>{s({title:"Saved",description:"Goals saved for selected period."}),i.invalidateQueries({queryKey:["goals_settings",n,c,h]})},onError:b=>{s({title:"Save failed",description:b.message,variant:"destructive"})}}),w=()=>{v.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""})},D=(b,x)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:x});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Goal Setting"}),e.jsx("p",{className:"text-gray-600",children:"Set targets and track progress against Omega Daily actuals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",onClick:w,children:"Reset Goals"}),e.jsx(R,{className:"wendys-button",onClick:v.handleSubmit(b=>T.mutate(b)),disabled:!n||T.isPending,children:"Save Goals"})]})]}),e.jsx(it,{selectedRange:o.selectedRange,selectedDate:o.selectedDate,onRangeChange:o.handleRangeChange,onDateChange:o.handleDateChange,onClearFilters:o.clearFilters}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Sales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target"}),e.jsx(C,{type:"number",step:"0.01",...v.register("sales_target")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual"}),e.jsxs("p",{className:"text-xl font-semibold",children:["$",m.totalSales.toLocaleString()]})]})]}),e.jsx("div",{children:D(m.totalSales>=(v.watch("sales_target")||0),m.totalSales>=(v.watch("sales_target")||0)?"On Track":"Behind")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Labor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target %"}),e.jsx(C,{type:"number",step:"0.1",...v.register("labor_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[m.avgLaborPct.toFixed(1),"%"]})]})]}),e.jsx("div",{children:D(m.avgLaborPct<=(v.watch("labor_target_pct")||0),m.avgLaborPct<=(v.watch("labor_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Waste & Food"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Target %"}),e.jsx(C,{type:"number",step:"0.1",...v.register("waste_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[m.wastePct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:D(m.wastePct<=(v.watch("waste_target_pct")||0),m.wastePct<=(v.watch("waste_target_pct")||0)?"On Track":"High")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Target %"}),e.jsx(C,{type:"number",step:"0.1",...v.register("food_variance_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[m.foodVarPct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:D(m.foodVarPct<=(v.watch("food_variance_target_pct")||0),m.foodVarPct<=(v.watch("food_variance_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card md:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Team & Personal"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"team_notes",children:"Notes"}),e.jsx(C,{id:"team_notes",...v.register("team_notes"),placeholder:"Notes, personal goals, shout-outs..."})]})})]})]})]})}const pr=le("/goals")({component:yr}),_r=le("/")({beforeLoad:()=>{throw da({to:"/overview"})}}),br=Qa.update({id:"/smg",path:"/smg",getParentRoute:()=>ie}),Nr=Ya.update({id:"/setup",path:"/setup",getParentRoute:()=>ie}),wr=sr.update({id:"/overview",path:"/overview",getParentRoute:()=>ie}),vr=ir.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>ie}),jr=lr.update({id:"/weekending-sheet",path:"/weekending-sheet",getParentRoute:()=>ie}),Er=cr.update({id:"/calendar",path:"/calendar",getParentRoute:()=>ie}),Sr=hr.update({id:"/interviews",path:"/interviews",getParentRoute:()=>ie}),Tr=pr.update({id:"/goals",path:"/goals",getParentRoute:()=>ie}),Rr=_r.update({id:"/",path:"/",getParentRoute:()=>ie}),Cr={IndexRoute:Rr,CalendarRoute:Er,GoalsRoute:Tr,InterviewsRoute:Sr,OmegaDailyRoute:vr,WeekendingSheetRoute:jr,OverviewRoute:wr,SetupRoute:Nr,SmgRoute:br},kr=ie._addFileChildren(Cr)._addFileTypes(),fs=new ca({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),Dr=ma({routeTree:kr,context:{queryClient:fs},defaultPreload:"intent"});ua.createRoot(document.getElementById("root")).render(e.jsx(fe.StrictMode,{children:e.jsxs(xa,{client:fs,children:[e.jsx(ha,{router:Dr}),e.jsx(Ea,{}),e.jsx(ga,{initialIsOpen:!1})]})}));
