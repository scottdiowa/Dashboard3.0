import{t as nt,c as it,f as C,p as ot,r as f,j as e,V as cs,R as ms,a as We,A as us,C as xs,X as hs,T as gs,D as ps,P as lt,b as dt,u as ct,B as mt,d as ae,U as ut,e as re,g as xt,W as ht,L as ke,S as gt,h as ys,i as pt,k as fs,l as yt,m as _s,I as Ns,n as bs,o as js,q as vs,s as ws,v as ft,w as Es,x as Ss,y as _t,z as Nt,M as bt,E as Ts,F as jt,G as ne,H as q,J as V,K as be,N as vt,O as wt,Q as Et,Y as Rs,Z as Ee,_ as Se,$ as As,a0 as St,a1 as Tt,a2 as Cs,a3 as Rt,a4 as At,a5 as Ct,a6 as Lt,a7 as Dt,a8 as Ls,a9 as It,aa as kt,ab as ss,ac as Ds,ad as He,ae as ie,af as qe,ag as K,ah as fe,ai as we,aj as te,ak as Ne,al as de,am as ce,an as me,ao as ue,ap as he,aq as Ot,ar as ge,as as Is,at as Mt,au as ks,av as Ae,aw as Ce,ax as oe,ay as Os,az as Ms,aA as se,aB as Ut,aC as Le,aD as ts,aE as Oe,aF as Me,aG as Us,aH as Ft,aI as Fs,aJ as Vs,aK as Vt,aL as Ps,aM as Pt,aN as Ws,aO as Hs,aP as Wt,aQ as Ht,aR as qs,aS as qt,aT as zt,aU as Gt,aV as $t,aW as Yt,aX as Bt,aY as Kt,aZ as Qt,a_ as Jt,a$ as Xt,b0 as Zt,b1 as ea}from"./vendor-DB4-i2vp.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const x of i)if(x.type==="childList")for(const d of x.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(i){const x={};return i.integrity&&(x.integrity=i.integrity),i.referrerPolicy&&(x.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?x.credentials="include":i.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function n(i){if(i.ep)return;i.ep=!0;const x=t(i);fetch(i.href,x)}})();function N(...s){return nt(it(s))}function le(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function $(s,r=1){return`${s.toFixed(r)}%`}function ye(s){const r=typeof s=="string"?new Date(Number(s.slice(0,4)),Number(s.slice(5,7))-1,Number(s.slice(8,10))):s;return C(r,"MMM dd, yyyy")}function sa(s){return C(ot(`2000-01-01T${s}`),"h:mm a")}function zs(s){switch(s.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const ta=lt,Gs=f.forwardRef(({className:s,...r},t)=>e.jsx(cs,{ref:t,className:N("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r}));Gs.displayName=cs.displayName;const aa=We("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$s=f.forwardRef(({className:s,variant:r,...t},n)=>e.jsx(ms,{ref:n,className:N(aa({variant:r}),s),...t}));$s.displayName=ms.displayName;const ra=f.forwardRef(({className:s,...r},t)=>e.jsx(us,{ref:t,className:N("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...r}));ra.displayName=us.displayName;const Ys=f.forwardRef(({className:s,...r},t)=>e.jsx(xs,{ref:t,className:N("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...r,children:e.jsx(hs,{className:"h-4 w-4"})}));Ys.displayName=xs.displayName;const Bs=f.forwardRef(({className:s,...r},t)=>e.jsx(gs,{ref:t,className:N("text-sm font-semibold",s),...r}));Bs.displayName=gs.displayName;const Ks=f.forwardRef(({className:s,...r},t)=>e.jsx(ps,{ref:t,className:N("text-sm opacity-90",s),...r}));Ks.displayName=ps.displayName;const na=1,ia=1e6;let De=0;function oa(){return De=(De+1)%Number.MAX_SAFE_INTEGER,De.toString()}const Ie=new Map,as=s=>{if(Ie.has(s))return;const r=setTimeout(()=>{Ie.delete(s),_e({type:"REMOVE_TOAST",toastId:s})},ia);Ie.set(s,r)},la=(s,r)=>{switch(r.type){case"ADD_TOAST":return{...s,toasts:[r.toast,...s.toasts].slice(0,na)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===r.toast.id?{...t,...r.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=r;return t?as(t):s.toasts.forEach(n=>{as(n.id)}),{...s,toasts:s.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return r.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==r.toastId)}}},je=[];let ve={toasts:[]};function _e(s){ve=la(ve,s),je.forEach(r=>{r(ve)})}function da({...s}){const r=oa(),t=i=>_e({type:"UPDATE_TOAST",toast:{...i,id:r}}),n=()=>_e({type:"DISMISS_TOAST",toastId:r});return _e({type:"ADD_TOAST",toast:{...s,id:r,open:!0,onOpenChange:i=>{i||n()}}}),{id:r,dismiss:n,update:t}}function X(){const[s,r]=f.useState(ve);return f.useEffect(()=>(je.push(r),()=>{const t=je.indexOf(r);t>-1&&je.splice(t,1)}),[s]),{...s,toast:da,dismiss:t=>_e({type:"DISMISS_TOAST",toastId:t})}}function ca(){const{toasts:s}=X();return e.jsxs(ta,{children:[s.map(function({id:r,title:t,description:n,action:i,...x}){return e.jsxs($s,{...x,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(Bs,{children:t}),n&&e.jsx(Ks,{children:n})]}),i,e.jsx(Ys,{})]},r)}),e.jsx(Gs,{})]})}const ma="https://qewndmyixpzmtgjjihoj.supabase.co",ua="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",E=dt(ma,ua,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),xa=[{name:"Overview",href:"/overview",icon:mt,description:"Key metrics and trends"},{name:"Omega Daily",href:"/omega-daily",icon:ae,description:"Daily business metrics"},{name:"Interviews & Hires",href:"/interviews",icon:ut,description:"Manage candidates and hiring"},{name:"OSAT",href:"/smg",icon:re,description:"Customer feedback metrics"},{name:"Goal Setting",href:"/goals",icon:xt,description:"Set goals & track progress"},{name:"Setup",href:"/setup",icon:ht,description:"Copy SQL & configure"}];function ha({open:s}){const r=ct();return e.jsx(e.Fragment,{children:e.jsx("div",{className:N("bg-white shadow-2xl border-r border-gray-100 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",s?"w-48":"w-0"),children:e.jsx("div",{className:"flex flex-col h-full relative",children:e.jsx("nav",{className:N("overflow-y-auto",s?"p-3":"p-2.5"),children:e.jsx("div",{className:"space-y-2",children:xa.map(t=>{const n=r.pathname===t.href,i=t.icon;return e.jsxs(ke,{to:t.href,className:N("flex items-center transition-colors duration-200",s?"space-x-2 p-2 rounded-md mx-2":"justify-center p-2 rounded-md mx-1",n?"bg-wendys-red text-white ring-1 ring-red-200":"text-gray-700 hover:bg-gray-50 hover:ring-1 hover:ring-gray-200"),children:[e.jsx("div",{className:N("flex-shrink-0 p-2 rounded-md",n?"bg-white/20":"bg-gray-100"),children:e.jsx(i,{className:N("h-4.5 w-4.5",n?"text-white":"text-gray-600")})}),s&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:N("font-medium text-sm",n?"text-white":"text-gray-800"),children:t.name}),e.jsx("div",{className:N("text-xs mt-0.5",n?"text-red-100":"text-gray-500"),children:t.description})]})]},t.href)})})})})})})}const Ue=We("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),A=f.forwardRef(({className:s,variant:r,size:t,asChild:n=!1,...i},x)=>{const d=n?gt:"button";return e.jsx(d,{className:N(Ue({variant:r,size:t,className:s})),ref:x,...i})});A.displayName="Button";const ga=_t,pa=Nt,ya=f.forwardRef(({className:s,inset:r,children:t,...n},i)=>e.jsxs(ys,{ref:i,className:N("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",s),...n,children:[t,e.jsx(pt,{className:"ml-auto h-4 w-4"})]}));ya.displayName=ys.displayName;const fa=f.forwardRef(({className:s,...r},t)=>e.jsx(fs,{ref:t,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r}));fa.displayName=fs.displayName;const Qs=f.forwardRef(({className:s,sideOffset:r=4,...t},n)=>e.jsx(yt,{children:e.jsx(_s,{ref:n,sideOffset:r,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));Qs.displayName=_s.displayName;const Js=f.forwardRef(({className:s,inset:r,...t},n)=>e.jsx(Ns,{ref:n,className:N("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",s),...t}));Js.displayName=Ns.displayName;const _a=f.forwardRef(({className:s,children:r,checked:t,...n},i)=>e.jsxs(bs,{ref:i,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(js,{children:e.jsx(vs,{className:"h-4 w-4"})})}),r]}));_a.displayName=bs.displayName;const Na=f.forwardRef(({className:s,children:r,...t},n)=>e.jsxs(ws,{ref:n,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(js,{children:e.jsx(ft,{className:"h-2 w-2 fill-current"})})}),r]}));Na.displayName=ws.displayName;const ba=f.forwardRef(({className:s,inset:r,...t},n)=>e.jsx(Es,{ref:n,className:N("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...t}));ba.displayName=Es.displayName;const ja=f.forwardRef(({className:s,...r},t)=>e.jsx(Ss,{ref:t,className:N("-mx-1 my-1 h-px bg-muted",s),...r}));ja.displayName=Ss.displayName;function va({user:s,onNavToggle:r,navOpen:t}){const{toast:n}=X(),i=async()=>{try{await E.auth.signOut(),n({title:"Signed out",description:"You have been successfully signed out."})}catch(x){console.error("Error signing out:",x),n({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:r,className:"p-2 hover:bg-gray-100","aria-label":t?"Close navigation":"Open navigation",children:e.jsx(bt,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-wendys-charcoal",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500",children:C(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(ga,{children:[e.jsx(pa,{asChild:!0,children:e.jsxs(A,{variant:"ghost",className:"flex items-center space-x-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.email})]})}),e.jsx(Qs,{align:"end",children:e.jsxs(Js,{onClick:i,children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const wa=ne({business_date:V().min(1,"Business date is required"),net_sales:q.number().min(0,"Net sales must be positive"),last_year_sales:q.number().min(0,"Last year sales must be positive"),labor_hours:q.number().min(0,"Labor hours must be positive"),ideal_labor_hours:q.number().min(0,"Ideal labor hours must be positive"),labor_percentage:q.number().min(0,"Labor percentage must be positive"),food_variance_cost:q.number(),waste_amount:q.number().min(0,"Waste amount must be positive"),breakfast_sales:q.number().min(0,"Breakfast sales must be positive"),night_sales:q.number().min(0,"Night sales must be positive")}),Ea=ne({date:V().min(1,"Date is required"),accuracy_decimal:be().min(0,"Accuracy must be 0 or greater"),zod_per_10k:be().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:be().min(0,"CC Complaints must be 0 or greater"),osat_decimal:be().min(0,"OSAT Score must be 0 or greater"),notes:V().optional()});ne({candidate_name:V().min(1,"Candidate name is required"),phone:V().optional(),email:V().email("Invalid email format").optional().or(wt("")),position:V().optional(),interview_date:V().min(1,"Interview date is required"),interview_time:V().min(1,"Interview time is required"),status:vt(["SCHEDULED","DONE","NO_SHOW","HIRED","REJECTED"]),notes:V().optional()});ne({entry_date:V().min(1,"Entry date is required"),accuracy_of_order:q.number().min(0).max(5).optional(),zone_of_defection:q.number().min(0).max(5).optional(),customer_computers:q.number().min(0).max(5).optional(),taste_of_food:q.number().min(0).max(5).optional(),osat:q.number().min(0).max(5).optional()});ne({documents_received:Et().default(!1),documents_folder:V().optional(),onboarding_sent_date:V().optional(),onboarding_completed_date:V().optional(),manager_reviewed_date:V().optional(),entered_in_system_date:V().optional(),fingerprint_scheduled_date:V().optional(),first_day:V().optional(),notes:V().optional()});const Sa=ne({email:V().email("Invalid email format"),password:V().min(6,"Password must be at least 6 characters")}),D=f.forwardRef(({className:s,type:r,...t},n)=>e.jsx("input",{type:r,className:N("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...t}));D.displayName="Input";const Ta=We("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),L=f.forwardRef(({className:s,...r},t)=>e.jsx(Rs,{ref:t,className:N(Ta(),s),...r}));L.displayName=Rs.displayName;function Ra(){const[s,r]=f.useState(!1),[t,n]=f.useState(!1),{toast:i}=X(),{register:x,handleSubmit:d,formState:{errors:c}}=Ee({resolver:Se(Sa)}),h=async g=>{r(!0);try{const{error:l}=await E.auth.signInWithPassword({email:g.email,password:g.password});if(l)throw l;i({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(l){console.error("Login error:",l),i({title:"Login failed",description:l.message||"Please check your credentials and try again.",variant:"destructive"})}finally{r(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:d(h),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...x("email")})]}),c.email&&e.jsx("p",{className:"text-red-600 text-sm",children:c.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(D,{id:"password",type:t?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...x("password")}),e.jsx("button",{type:"button",onClick:()=>n(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t?e.jsx(Tt,{className:"h-4 w-4"}):e.jsx(Cs,{className:"h-4 w-4"})})]}),c.password&&e.jsx("p",{className:"text-red-600 text-sm",children:c.password.message})]}),e.jsx(A,{type:"submit",className:"w-full wendys-button",disabled:s,children:s?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const Z=Rt({component:Aa});function Aa(){const[s,r]=f.useState(null),[t,n]=f.useState(!0),[i,x]=f.useState(()=>{const h=localStorage.getItem("navOpen");return h?JSON.parse(h):!0}),{toast:d}=X(),c=At();return f.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){r({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),n(!1);return}const{data:{session:g}}=await E.auth.getSession();g!=null&&g.user&&r(g.user)}catch(g){console.error("Error checking session:",g),r({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{n(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:g}}=E.auth.onAuthStateChange(async(l,o)=>{l==="SIGNED_IN"&&(o!=null&&o.user)?(r(o.user),d({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):l==="SIGNED_OUT"&&(r(null),c({to:"/"}),d({title:"Signed out",description:"You have been successfully signed out."}))});return()=>g.unsubscribe()}},[c,d]),f.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(i))},[i]),t?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx(va,{user:s,onNavToggle:()=>x(!i),navOpen:i}),e.jsxs("div",{className:"flex",children:[e.jsx(ha,{open:i}),e.jsx("main",{className:N("flex-1 p-6 transition-all duration-300"),children:e.jsx(Ct,{})})]})]}):e.jsx(Ra,{})}function Te({className:s,classNames:r,showOutsideDays:t=!0,...n}){return e.jsx(Lt,{showOutsideDays:t,className:N("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:N(Ue({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:N(Ue({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...r},...n})}Te.displayName="Calendar";const ze=It,Ge=kt,Re=f.forwardRef(({className:s,align:r="center",sideOffset:t=4,...n},i)=>e.jsx(Dt,{children:e.jsx(Ls,{ref:i,align:r,sideOffset:t,className:N("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}));Re.displayName=Ls.displayName;function Ca({columns:s,data:r,className:t,emptyMessage:n="No data available",loading:i=!1}){const[x,d]=f.useState(null),[c,h]=f.useState(null),g=f.useMemo(()=>!x||!c?r:[...r].sort((y,S)=>{const b=y[x],j=S[x];if(b==null&&j==null)return 0;if(b==null)return c==="asc"?-1:1;if(j==null)return c==="asc"?1:-1;if(typeof b=="number"&&typeof j=="number")return c==="asc"?b-j:j-b;if(typeof b=="string"&&typeof j=="string")return c==="asc"?b.localeCompare(j):j.localeCompare(b);if(b instanceof Date&&j instanceof Date)return c==="asc"?b.getTime()-j.getTime():j.getTime()-b.getTime();const v=String(b),m=String(j);return c==="asc"?v.localeCompare(m):m.localeCompare(v)}),[r,x,c]),l=y=>{x===y?c==="asc"?h("desc"):c==="desc"&&(h(null),d(null)):(d(y),h("asc"))},o=y=>x!==y?e.jsx(ss,{className:"h-3 w-3 text-gray-400"}):c==="asc"?e.jsx(Ds,{className:"h-3 w-3 text-gray-600"}):c==="desc"?e.jsx(He,{className:"h-3 w-3 text-gray-600"}):e.jsx(ss,{className:"h-3 w-3 text-gray-400"});return i?e.jsx(La,{columns:s}):e.jsx("div",{className:N("overflow-x-auto",t),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(y=>e.jsx("th",{className:N("py-3 px-4 font-medium text-gray-700 text-sm",y.align==="center"&&"text-center",y.align==="right"&&"text-right",y.sortable&&"cursor-pointer hover:bg-gray-100 select-none",y.className),onClick:()=>y.sortable&&l(y.key),children:e.jsxs("div",{className:N("flex items-center gap-1",y.align==="center"&&"justify-center",y.align==="right"&&"justify-end"),children:[y.label,y.sortable&&o(y.key)]})},y.key))})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:n})}):g.map((y,S)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:s.map(b=>e.jsx("td",{className:N("py-3 px-4 text-sm",b.align==="center"&&"text-center",b.align==="right"&&"text-right",b.className),children:b.render?b.render(y[b.key],y):y[b.key]},b.key))},y.id||S))})]})})}function La({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(r=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},r.key))})}),e.jsx("tbody",{children:[...Array(5)].map((r,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(n=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},n.key))},t))})]})})})}function xe({title:s,subtitle:r,className:t,children:n,loading:i=!1,error:x,onRefresh:d}){return e.jsxs("div",{className:N("wendys-card",t),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),r&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]}),d&&e.jsx("button",{onClick:d,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),x?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:x}),d&&e.jsx("button",{onClick:d,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):i?e.jsx(Da,{}):n]})}function Da(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((s,r)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},r))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((s,r)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},r))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((s,r)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},r))})]})})}const P={currency:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),currencyDetailed:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),percent:(s,r=1)=>`${(s??0).toFixed(r)}%`,hours:(s,r=1)=>`${(s??0).toFixed(r)}h`,dateShort:s=>{const r=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return C(r,"MMM d")},dateFull:s=>{const r=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return C(r,"MMM dd, yyyy")},currencyCompact:s=>{const r=Math.abs(s);return r>=1e6?`$${(s/1e6).toFixed(1)}M`:r>=1e3?`$${(s/1e3).toFixed(1)}k`:P.currency(s)}},k={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},U={cartesianGrid:{strokeDasharray:"3 3",stroke:k.gridStroke},xAxis:{stroke:k.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:k.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${k.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:k.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:k.textSecondary}}},Fe=(s,r=new Date)=>{const t=new Date(r);switch(s){case"today":return{start:C(t,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Today"};case"wtd":const n=new Date(t);return n.setDate(t.getDate()-t.getDay()),{start:C(n,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const i=new Date(t.getFullYear(),t.getMonth(),1);return{start:C(i,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const x=new Date(t);return x.setDate(t.getDate()-6),{start:C(x,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const d=new Date(t);return d.setDate(t.getDate()-29),{start:C(d,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},Ia=ie("/smg")({component:ka});function ka(){const[s,r]=f.useState(null),[t,n]=f.useState(),{toast:i}=X(),x=qe(),d=Ee({resolver:Se(Ea),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});f.useEffect(()=>{let m=!0;return(async()=>{var H;const{data:w}=await E.auth.getUser(),F=(H=w.user)==null?void 0:H.id;if(!F)return;const{data:I,error:W}=await E.from("users").select("store_id").eq("id",F).maybeSingle();m&&(W||r((I==null?void 0:I.store_id)??null))})(),()=>{m=!1}},[]);const{data:c=[],isLoading:h,error:g}=K({queryKey:["smg_daily",s],queryFn:async()=>{if(!s)return[];const{data:m,error:w}=await E.from("smg_daily").select("*").eq("store_id",s).order("date",{ascending:!1});if(w)throw w;return m||[]},enabled:!!s}),{data:l=[]}=K({queryKey:["smg_entries_import",s],queryFn:async()=>{if(!s)return[];const{data:m,error:w}=await E.from("smg_entries").select("*").eq("store_id",s).order("entry_date",{ascending:!1});if(w)throw w;return m||[]},enabled:!!s}),o=f.useMemo(()=>c.length>0?c:l.length?l.map(m=>({id:m.id,date:m.entry_date,accuracy_decimal:Number(m.accuracy_of_order)||0,zod_per_10k:Number(m.zone_of_defection)||0,cc_complaints:Number(m.customer_computers)||0,osat_decimal:Number(m.osat)||0,notes:"",created_at:m.created_at})):[],[c,l]),y=fe({mutationFn:async m=>{if(!s)throw new Error("Store not connected");const{error:w}=await E.from("smg_daily").insert({store_id:s,date:m.date,accuracy_decimal:m.accuracy_decimal,zod_per_10k:m.zod_per_10k,cc_complaints:m.cc_complaints,osat_decimal:m.osat_decimal,notes:m.notes||null});if(w)throw w},onSuccess:()=>{x.invalidateQueries({queryKey:["smg_daily",s]}),d.reset(),n(void 0),i({title:"Success",description:"SMG entry saved successfully."})},onError:m=>{i({title:"Error",description:m.message||"Failed to save SMG entry.",variant:"destructive"})}}),S=m=>{y.mutate(m)},b=m=>{const w=Number(m.slice(0,4)),F=Number(m.slice(5,7)),I=Number(m.slice(8,10));return new Date(w,(F||1)-1,I||1)},j=[{key:"date",label:"Date",sortable:!0,render:m=>C(b(m),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:m=>m.toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:m=>m.toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:m=>m.toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:m=>m.toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:m=>e.jsx("div",{className:"max-w-32 truncate",title:m,children:m||"-"})}],v=f.useMemo(()=>o.length?o.slice().reverse().map(m=>({date:P.dateShort(m.date),osat:m.osat_decimal})):[],[o]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),g&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",g.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(we,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:d.handleSubmit(S),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"date",children:"Date *"}),e.jsxs(ze,{children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(A,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),t?C(t,"MMM dd, yyyy"):"Select date"]})}),e.jsx(Re,{className:"w-auto p-0",align:"start",children:e.jsx(Te,{mode:"single",selected:t,onSelect:m=>{n(m),m&&d.setValue("date",C(m,"yyyy-MM-dd"))},initialFocus:!0})})]}),d.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(D,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("accuracy_decimal",{valueAsNumber:!0})}),d.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(D,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("zod_per_10k",{valueAsNumber:!0})}),d.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(D,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("cc_complaints",{valueAsNumber:!0})}),d.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(D,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("osat_decimal",{valueAsNumber:!0})}),d.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(L,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...d.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(A,{type:"submit",disabled:y.isPending||!s,className:"bg-wendys-red hover:bg-wendys-red/90",children:y.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(xe,{title:"OSAT Score Trend",subtitle:`${o.length} entries`,loading:h,error:g==null?void 0:g.message,children:v.length>0?e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ne,{data:v,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:m=>m.toFixed(1)}),e.jsx(ue,{...U.tooltip,formatter:m=>[m.toFixed(2),"OSAT Score"]}),e.jsx(he,{type:"monotone",dataKey:"osat",stroke:k.sales,strokeWidth:3,dot:{fill:k.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:h?"Loading...":`${o.length} entries`})]}),s?e.jsx(Ca,{columns:j,data:o,loading:h,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const rs=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
`,ns=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'DONE', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,Oa=ie("/setup")({component:Ma});function is(s){navigator.clipboard.writeText(s)}function Ma(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase → Auth → Providers → Email: enable. Then Auth → Users → Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase → SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(A,{onClick:()=>is(rs),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:rs})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(A,{onClick:()=>is(ns),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:ns})]})]})}function J({title:s,value:r,format:t,delta:n,deltaLabel:i,icon:x,trend:d,suffix:c,sparklineData:h,className:g}){const l=S=>{switch(t){case"currency":return le(S);case"percentage":return $(S);case"number":return S.toLocaleString();default:return S.toString()}},o=()=>{switch(d){case"up":return e.jsx(ae,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(ge,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(Ot,{className:"h-4 w-4 text-gray-400"})}},y=()=>{switch(d){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:N("wendys-card",g),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(x,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[l(r),c&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:c})]}),h&&h.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsx(Ne,{data:h,children:e.jsx(he,{type:"monotone",dataKey:"value",stroke:d==="up"?k.positive:d==="down"?k.waste:k.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),n!==void 0&&i&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[o(),e.jsxs("span",{className:N("text-sm font-medium",y()),children:[n>0?"+":"",Math.abs(n)<1&&t!=="percentage"?$(Math.abs(n)*100):l(Math.abs(n)),c&&t!=="percentage"&&e.jsx("span",{className:"ml-1",children:c})]}),e.jsx("span",{className:"text-xs text-gray-500",children:i})]})]})})})}function Ua({data:s=[]}){const r=f.useMemo(()=>{if(!s.length){const t=[];for(let n=13;n>=0;n--){const i=new Date;i.setDate(i.getDate()-n),t.push({date:P.dateShort(i.toISOString().slice(0,10)),sales:0})}return t}return s.sort((t,n)=>new Date(t.business_date).getTime()-new Date(n.business_date).getTime()).slice(-30).map(t=>({date:P.dateShort(t.business_date),sales:t.net_sales||0}))},[s]);return e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ne,{data:r,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:t=>P.currencyCompact(t)}),e.jsx(ue,{...U.tooltip,formatter:t=>[P.currencyDetailed(t),"Net Sales"]}),e.jsx(he,{type:"monotone",dataKey:"sales",stroke:k.sales,strokeWidth:3,dot:{fill:k.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.salesSecondary,strokeWidth:2}})]})})}function Fa({data:s=[]}){console.log("🔍 LaborVsIdealChart received data:",s.slice(0,3));const r=f.useMemo(()=>{if(!s.length){const n=[];for(let i=6;i>=0;i--){const x=new Date;x.setDate(x.getDate()-i),n.push({date:P.dateShort(x.toISOString().slice(0,10)),ideal:0,actual:0})}return n}const t=s.sort((n,i)=>new Date(n.business_date).getTime()-new Date(i.business_date).getTime()).slice(-30).map(n=>{const i=Number(n.ideal_labor_hours)||0,x=Number(n.labor_hours)||0;return console.log("🔍 Processing entry:",n.business_date,"ideal:",n.ideal_labor_hours,"=>",i,"actual:",n.labor_hours,"=>",x),{date:P.dateShort(n.business_date),ideal:i,actual:x}});return console.log("🔍 Processed chart data:",t.slice(0,3)),t},[s]);return console.log("🔍 Final chartData being rendered:",r.slice(0,3)),e.jsx(te,{width:"100%",height:300,children:e.jsxs(Is,{data:r,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:t=>P.hours(t)}),e.jsx(ue,{...U.tooltip,formatter:(t,n)=>[P.hours(t),n==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(Mt,{...U.legend}),e.jsx(ks,{dataKey:"ideal",fill:k.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(he,{type:"monotone",dataKey:"actual",stroke:k.labor,strokeWidth:3,dot:{fill:k.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function Va(){const[s,r]=f.useState(null);f.useEffect(()=>{let l=!0;return(async()=>{var y;const{data:o}=await E.from("users").select("store_id").eq("id",(y=(await E.auth.getUser()).data.user)==null?void 0:y.id).single();l&&r((o==null?void 0:o.store_id)??null)})(),()=>{l=!1}},[]);const{data:t=[],isLoading:n}=K({queryKey:["smg_snapshot",s],queryFn:async()=>{if(!s)return[];const l=new Date;l.setDate(l.getDate()-30);const{data:o,error:y}=await E.from("smg_daily").select("*").eq("store_id",s).gte("date",l.toISOString().split("T")[0]).order("date",{ascending:!1});if(y)throw y;return o||[]},enabled:!!s}),i=t.length>0?{accuracy:t.reduce((l,o)=>l+o.accuracy_decimal,0)/t.length,zod:t.reduce((l,o)=>l+o.zod_per_10k,0)/t.length,complaints:t.reduce((l,o)=>l+o.cc_complaints,0)/t.length,osat:t.reduce((l,o)=>l+o.osat_decimal,0)/t.length}:{accuracy:0,zod:0,complaints:0,osat:0},x=l=>{if(l.length<4)return"neutral";const o=Math.floor(l.length/2),y=l.slice(0,o).reduce((j,v)=>j+v,0)/o,b=l.slice(o).reduce((j,v)=>j+v,0)/(l.length-o)-y;return Math.abs(b)<.1?"neutral":b>0?"up":"down"},d={accuracy:x(t.map(l=>l.accuracy_decimal).reverse()),zod:x(t.map(l=>l.zod_per_10k).reverse()),complaints:x(t.map(l=>l.cc_complaints).reverse()),osat:x(t.map(l=>l.osat_decimal).reverse())},c=(l,o=!1)=>o?l<=1?"text-green-600":l<=3?"text-yellow-600":"text-red-600":l>=90?"text-green-600":l>=80?"text-yellow-600":"text-red-600",h=(l,o=!1)=>o?l<=1?e.jsx(Ce,{className:"h-4 w-4 text-green-600"}):l<=3?e.jsx(oe,{className:"h-4 w-4 text-yellow-600"}):e.jsx(oe,{className:"h-4 w-4 text-red-600"}):l>=90?e.jsx(Ce,{className:"h-4 w-4 text-green-600"}):l>=80?e.jsx(oe,{className:"h-4 w-4 text-yellow-600"}):e.jsx(oe,{className:"h-4 w-4 text-red-600"}),g=l=>{switch(l){case"up":return e.jsx(ae,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(ge,{className:"h-3 w-3 text-red-600"});default:return null}};return n?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((l,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},o))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(Ae,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[t.length," entries"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(d.osat),h(i.osat),e.jsx("span",{className:N("text-xl font-bold",c(i.osat)),children:i.osat.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(d.accuracy),h(i.accuracy),e.jsx("span",{className:N("text-xl font-bold",c(i.accuracy)),children:i.accuracy.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(oe,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(d.zod==="up"?"down":d.zod==="down"?"up":"neutral"),h(i.zod,!0),e.jsx("span",{className:N("text-xl font-bold",c(i.zod,!0)),children:i.zod.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(oe,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(d.complaints==="up"?"down":d.complaints==="down"?"up":"neutral"),h(i.complaints,!0),e.jsx("span",{className:N("text-xl font-bold",c(i.complaints,!0)),children:i.complaints.toFixed(1)})]})]})]})]})}function Pa(){const[s,r]=f.useState(null),t=C(new Date,"EEEE, MMMM d"),n=C(new Date,"yyyy-MM-dd");f.useEffect(()=>{let c=!0;return(async()=>{var S;console.log("🔐 [InterviewsToday] Checking user authentication...");const{data:h,error:g}=await E.auth.getUser();console.log("👤 [InterviewsToday] Auth data:",h,"Auth error:",g);const l=(S=h.user)==null?void 0:S.id;if(!l){console.log("❌ [InterviewsToday] No user ID found - user not authenticated");return}console.log("🔍 [InterviewsToday] Looking up store for user:",l);const{data:o,error:y}=await E.from("users").select("store_id").eq("id",l).maybeSingle();if(console.log("🏪 [InterviewsToday] Store lookup result - data:",o,"error:",y),!!c){if(y){console.error("❌ [InterviewsToday] Store lookup error:",y);return}r((o==null?void 0:o.store_id)??null),console.log("✅ [InterviewsToday] Store ID set to:",(o==null?void 0:o.store_id)??null)}})(),()=>{c=!1}},[]);const{data:i=[],isLoading:x}=K({queryKey:["interviews-today",s,n],queryFn:async()=>{if(!s)return[];const{data:c,error:h}=await E.from("interviews").select("*").eq("store_id",s).eq("interview_date",n).order("interview_time",{ascending:!0});if(h)throw h;return c||[]},enabled:!!s}),d=c=>C(new Date(`2000-01-01T${c}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:t})]})]}),x?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ts,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:i.map(c=>e.jsx(ke,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:c.candidate_name}),e.jsx("span",{className:Wa("px-2 py-1 text-xs font-medium rounded-full",zs(c.status)),children:c.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Os,{className:"h-3 w-3"}),e.jsx("span",{children:c.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ms,{className:"h-3 w-3"}),e.jsx("span",{children:d(c.interview_time)})]})]}),c.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',c.notes,'"']})]})})},c.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(ke,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"→"})]})})]})}function Wa(...s){return s.filter(Boolean).join(" ")}const os=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function $e({selectedRange:s="last30",selectedDate:r,onRangeChange:t,onDateChange:n,onClearFilters:i,className:x,compact:d=!1}){const c=s!=="last30"||r,h=l=>{t==null||t(l),l!=="custom"&&(n==null||n(void 0))},g=()=>{if(s==="custom"&&r)return C(r,"MMM dd, yyyy");const l=os.find(o=>o.key===s);return(l==null?void 0:l.label)||"Last 30"};return e.jsxs("div",{className:N("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",d&&"p-3",x),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ut,{className:"h-4 w-4"}),e.jsx("span",{className:N("text-sm font-medium",d&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:os.map(l=>e.jsx(A,{variant:s===l.key?"default":"ghost",size:"sm",onClick:()=>h(l.key),className:N("text-xs h-7 px-2",s===l.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",d&&"text-[11px] h-6 px-1.5"),title:l.description,children:l.label},l.key))}),s==="custom"&&e.jsxs(ze,{children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:N("justify-start text-left font-normal h-7",!r&&"text-muted-foreground",d&&"h-6 text-xs"),children:[e.jsx(re,{className:"mr-1 h-3 w-3"}),r?C(r,"MMM dd"):"Pick date"]})}),e.jsx(Re,{className:"w-auto p-0",align:"start",children:e.jsx(Te,{mode:"single",selected:r,onSelect:n,initialFocus:!0})})]}),!d&&c&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:g()})]}),c&&i&&e.jsxs(A,{variant:"ghost",size:"sm",onClick:i,className:N("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",d&&"h-6 px-1.5"),children:[e.jsx(hs,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function Ye(s,r="last30"){const[t,n]=se.useState(()=>typeof window<"u"&&localStorage.getItem(`${s}_range`)||r),[i,x]=se.useState(()=>{if(typeof window<"u"){const l=localStorage.getItem(`${s}_date`);if(l){const[o,y,S]=l.split("-").map(Number);return new Date(o,(y||1)-1,S||1)}return}}),d=se.useCallback(l=>{n(l),typeof window<"u"&&localStorage.setItem(`${s}_range`,l)},[s]),c=se.useCallback(l=>{if(x(l),typeof window<"u")if(l){const o=C(l,"yyyy-MM-dd");localStorage.setItem(`${s}_date`,o)}else localStorage.removeItem(`${s}_date`)},[s]),h=se.useCallback(()=>{n(r),x(void 0),typeof window<"u"&&(localStorage.removeItem(`${s}_range`),localStorage.removeItem(`${s}_date`))},[s,r]),g=se.useCallback(()=>{if(t==="custom"&&i){const l=C(i,"yyyy-MM-dd");return{start:l,end:l}}if(t&&t!=="custom"){const l=Fe(t);return l.start?{start:l.start,end:l.end}:null}return null},[t,i]);return{selectedRange:t,selectedDate:i,handleRangeChange:d,handleDateChange:c,clearFilters:h,getDateRangeFilter:g,getSelectedLabel:()=>t==="custom"&&i?C(i,"MMM dd, yyyy"):Fe(t).label}}const Ha=ie("/overview")({component:qa});function qa(){const[s,r]=f.useState(null),t=Ye("overview","today");f.useEffect(()=>{let g=!0;return(async()=>{var b;const{data:l}=await E.auth.getUser(),o=(b=l.user)==null?void 0:b.id;if(!o)return;const{data:y,error:S}=await E.from("users").select("store_id").eq("id",o).maybeSingle();if(g){if(S){console.error("Error fetching store ID:",S);return}r((y==null?void 0:y.store_id)??null)}})(),()=>{g=!1}},[]);const n=t.getDateRangeFilter(),{data:i=[]}=K({queryKey:["overview-charts",s],queryFn:async()=>{if(!s)return[];const g=new Date;g.setDate(g.getDate()-30);const l=g.toISOString().slice(0,10),{data:o,error:y}=await E.from("omega_daily").select("*").eq("store_id",s).gte("business_date",l).order("business_date",{ascending:!0});if(y)throw y;return o||[]},enabled:!!s}),{data:x=[],isLoading:d,error:c}=K({queryKey:["overview-omega",s,n==null?void 0:n.start,n==null?void 0:n.end],queryFn:async()=>{if(!s)return[];let g=E.from("omega_daily").select("*").eq("store_id",s);n&&(g=g.gte("business_date",n.start).lte("business_date",n.end));const{data:l,error:o}=await g.order("business_date",{ascending:!0});if(o)throw o;return l||[]},enabled:!!s}),h=f.useMemo(()=>{if(x.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const g=x.reduce((S,b)=>({netSales:S.netSales+(b.net_sales||0),compNetSales:S.compNetSales+((b.net_sales||0)-(b.last_year_sales||0)),laborHours:S.laborHours+(b.labor_hours||0),idealLaborHours:S.idealLaborHours+(b.ideal_labor_hours||0),foodVarianceCost:S.foodVarianceCost+(b.food_variance_cost||0),wasteAmount:S.wasteAmount+(b.waste_amount||0),breakfastSales:S.breakfastSales+(b.breakfast_sales||0),nightSales:S.nightSales+(b.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),l=g.netSales>0?g.laborHours/g.netSales*100:0,o=g.netSales>0?g.foodVarianceCost/g.netSales*100:0,y=g.netSales>0?g.wasteAmount/g.netSales*100:0;return{...g,laborPercentage:l,foodVariancePercentage:o,wastePercentage:y}},[x]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",t.getSelectedLabel(),d&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),c&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",c.message]})]}),e.jsx($e,{selectedRange:t.selectedRange,selectedDate:t.selectedDate,onRangeChange:t.handleRangeChange,onDateChange:t.handleDateChange,onClearFilters:t.clearFilters,compact:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Net Sales",value:h.netSales,format:"currency",delta:h.compNetSales,deltaLabel:"vs Last Year",icon:Le,trend:h.compNetSales>=0?"up":"down"}),e.jsx(J,{title:"Labor Hours",value:h.laborHours,format:"number",delta:h.laborHours-h.idealLaborHours,deltaLabel:"vs Ideal",icon:Ms,trend:h.laborHours>h.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(J,{title:"Labor %",value:h.laborPercentage,format:"percentage",icon:ae,trend:"neutral"}),e.jsx(J,{title:"Food Variance",value:h.foodVarianceCost,format:"currency",delta:h.foodVariancePercentage,deltaLabel:"% of Sales",icon:ge,trend:h.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Waste Amount",value:h.wasteAmount,format:"currency",delta:h.wastePercentage,deltaLabel:"% of Sales",icon:ge,trend:h.wasteAmount>=0?"down":"up"}),e.jsx(J,{title:"Breakfast Sales",value:h.breakfastSales,format:"currency",icon:Le,trend:"neutral"}),e.jsx(J,{title:"Night Sales",value:h.nightSales,format:"currency",icon:Le,trend:"neutral"}),e.jsx(J,{title:"Comp Net Sales",value:h.compNetSales,format:"currency",icon:ae,trend:h.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(xe,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!i.length&&!c,error:c==null?void 0:c.message,children:i.length>0?e.jsx(Ua,{data:i}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(xe,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!i.length&&!c,error:c==null?void 0:c.message,children:i.length>0?e.jsx(Fa,{data:i}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Va,{}),e.jsx(Pa,{})]})]})}function za({columns:s,data:r,mobileCardRender:t,className:n,emptyMessage:i="No data available",loading:x=!1}){if(x)return e.jsx(Ga,{columns:s});const d=c=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:s.map(h=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[h.label,":"]}),e.jsx("span",{className:"text-sm",children:h.render?h.render(c[h.key],c):c[h.key]})]},h.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:N("hidden md:block",n),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(c=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:c.label},c.key))})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:i})}):r.map((c,h)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:s.map(g=>e.jsx("td",{className:N("py-3 px-4 text-sm",g.className),children:g.render?g.render(c[g.key],c):c[g.key]},g.key))},c.id||h))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:i}):r.map((c,h)=>e.jsx("div",{children:t?t(c):d(c)},c.id||h))})})]})}function Ga({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(r=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},r.key))})}),e.jsx("tbody",{children:[...Array(3)].map((r,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(n=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},n.key))},t))})]})})})}const $a=ie("/omega-daily")({component:Ya});function Ya(){const[s,r]=f.useState(!1),[t,n]=f.useState(null),{toast:i}=X(),x=qe(),[d,c]=f.useState(null),h=Ye("omega-daily","last30"),g=async()=>{if(!d){i({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const a=[],u=new Date;for(let T=9;T>=0;T--){const O=new Date(u);O.setDate(O.getDate()-T),a.push({store_id:d,business_date:C(O,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:p}=await E.from("omega_daily").insert(a);if(p)throw p;i({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),x.invalidateQueries({queryKey:["omega_daily","last30",d]})}catch(a){i({title:"Error adding sample data",description:a.message,variant:"destructive"})}},l=()=>{x.invalidateQueries({queryKey:["omega_daily",d]}),i({title:"Refreshing data...",description:"Reloading your OMEGA entries."})},o=Ee({resolver:Se(wa),defaultValues:{business_date:C(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),y=fe({onMutate:async a=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");await x.cancelQueries({queryKey:["omega_daily"]});const u=`temp-${Date.now()}`,p={id:u,store_id:d,business_date:a.business_date,net_sales:a.net_sales,last_year_sales:a.last_year_sales,labor_hours:a.labor_hours,ideal_labor_hours:a.ideal_labor_hours,labor_percentage:a.labor_percentage,food_variance_cost:a.food_variance_cost,waste_amount:a.waste_amount,breakfast_sales:a.breakfast_sales,night_sales:a.night_sales},T=[],O=x.getQueriesData({queryKey:["omega_daily"]});for(const[z,ee]of O){const Q=z;if(!Q.includes(d))continue;let Ke=!0;const Qe=typeof Q[2]=="string"?String(Q[2]):void 0,Je=typeof Q[3]=="string"?String(Q[3]):void 0;if(Qe&&Je&&(Ke=a.business_date>=Qe&&a.business_date<=Je),!Ke)continue;const Xe=[p,...ee||[]];Xe.sort((Ze,es)=>Ze.business_date>es.business_date?-1:Ze.business_date<es.business_date?1:0),T.push({queryKey:z,previousData:ee}),x.setQueryData(z,Xe)}return{optimisticId:u,touchedCaches:T}},mutationFn:async a=>{if(console.log("🔄 Starting insertMutation with payload:",a),console.log("🏪 Store ID:",d),!d)throw console.error("❌ No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const u={store_id:d,business_date:a.business_date,net_sales:a.net_sales,last_year_sales:a.last_year_sales,labor_hours:a.labor_hours,ideal_labor_hours:a.ideal_labor_hours,labor_percentage:a.labor_percentage,food_variance_cost:a.food_variance_cost,waste_amount:a.waste_amount,breakfast_sales:a.breakfast_sales,night_sales:a.night_sales};console.log("📤 Inserting data:",u);const{data:p,error:T}=await E.from("omega_daily").insert(u).select();if(console.log("📥 Supabase response - data:",p,"error:",T),T)throw console.error("❌ Supabase error:",T),T;return console.log("✅ Insert successful:",p),p},onError:(a,u,p)=>{if(p!=null&&p.touchedCaches)for(const{queryKey:T,previousData:O}of p.touchedCaches)x.setQueryData(T,O||[]);console.error("💥 Insert mutation failed (rolled back):",a),i({title:"Save failed",description:(a==null?void 0:a.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(a,u,p)=>{console.log("🎉 Insert mutation succeeded with data:",a),i({title:"Success!",description:"Daily metrics saved successfully."});const T=Array.isArray(a)&&a[0]?a[0]:void 0;if(T&&(p!=null&&p.touchedCaches)&&p.optimisticId)for(const{queryKey:O}of p.touchedCaches){const ee=(x.getQueryData(O)??[]).map(Q=>Q.id===p.optimisticId?T:Q);x.setQueryData(O,ee)}r(!1),n(null),o.reset()}}),S=fe({mutationFn:async({id:a,payload:u})=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const{error:p}=await E.from("omega_daily").update({business_date:u.business_date,net_sales:u.net_sales,last_year_sales:u.last_year_sales,labor_hours:u.labor_hours,ideal_labor_hours:u.ideal_labor_hours,labor_percentage:u.labor_percentage,food_variance_cost:u.food_variance_cost,waste_amount:u.waste_amount,breakfast_sales:u.breakfast_sales,night_sales:u.night_sales}).eq("id",a);if(p)throw p},onSuccess:()=>{i({title:"Updated!",description:"Daily metrics updated successfully."}),r(!1),n(null),o.reset(),x.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:a=>{i({title:"Update failed",description:a.message,variant:"destructive"})}}),b=a=>{console.log("🚀 onSubmit called with data:",a),console.log("📋 Form errors:",o.formState.errors),console.log("🏪 Store ID:",d),console.log("✏️ Editing entry:",t),console.log("🔄 Insert mutation pending:",y.isPending),console.log("🔄 Update mutation pending:",S.isPending),t?(console.log("📝 Calling updateMutation..."),S.mutate({id:t.id,payload:a})):(console.log("➕ Calling insertMutation..."),y.mutate(a))},j=a=>{console.error("❌ Form validation failed with errors:",a),i({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},v=fe({mutationFn:async a=>{const{error:u}=await E.from("omega_daily").delete().eq("id",a);if(u)throw u},onSuccess:()=>{i({title:"Deleted",description:"Daily metrics entry removed."}),x.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:a=>{i({title:"Delete failed",description:a.message,variant:"destructive"})}});f.useEffect(()=>{let a=!0;return(async()=>{var ee;console.log("🔐 Checking user authentication...");const{data:u,error:p}=await E.auth.getUser();console.log("👤 Auth data:",u,"Auth error:",p);const T=(ee=u.user)==null?void 0:ee.id;if(!T){console.log("❌ No user ID found - user not authenticated");return}console.log("🔍 Looking up store for user:",T);const{data:O,error:z}=await E.from("users").select("store_id").eq("id",T).maybeSingle();if(console.log("🏪 Store lookup result - data:",O,"error:",z),!!a){if(z){console.error("❌ Store lookup error:",z),i({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}c((O==null?void 0:O.store_id)??null),console.log("✅ Store ID set to:",(O==null?void 0:O.store_id)??null),O!=null&&O.store_id||(console.log("⚠️ No store linked to user account"),i({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{a=!1}},[]);const m=h.getDateRangeFilter(),{data:w=[],isLoading:F,error:I}=K({queryKey:["omega_daily",d,m==null?void 0:m.start,m==null?void 0:m.end],queryFn:async()=>{if(!d)return[];let a=E.from("omega_daily").select("*").eq("store_id",d);m&&(a=a.gte("business_date",m.start).lte("business_date",m.end));const{data:u,error:p}=await a.order("business_date",{ascending:!1}).limit(100);if(p)throw p;return u},enabled:!!d}),{data:W=[]}=K({queryKey:["omega_daily_charts",d],queryFn:async()=>{if(!d)return[];const a=new Date;a.setDate(a.getDate()-30);const u=C(a,"yyyy-MM-dd"),{data:p,error:T}=await E.from("omega_daily").select("*").eq("store_id",d).gte("business_date",u).order("business_date",{ascending:!0});if(T)throw T;return p},enabled:!!d}),{data:H=[]}=K({queryKey:["omega_daily_mtd",d],queryFn:async()=>{if(!d)return[];const{start:a,end:u}=Fe("mtd"),{data:p,error:T}=await E.from("omega_daily").select("*").eq("store_id",d).gte("business_date",a).lte("business_date",u).order("business_date",{ascending:!0});if(T)throw T;return p},enabled:!!d}),G=a=>{if(!a)return;h.handleRangeChange("custom");const u=Number(a.slice(0,4)),p=Number(a.slice(5,7)),T=Number(a.slice(8,10));h.handleDateChange(new Date(u,(p||1)-1,T||1))},pe=f.useMemo(()=>W.length?W.map(a=>({date:P.dateShort(a.business_date),dateFull:P.dateFull(a.business_date),isoDate:(typeof a.business_date=="string",a.business_date),comp_net_sales:(a.net_sales??0)-(a.last_year_sales??0)})):[],[W]),_=f.useMemo(()=>W.length?W.map(a=>({date:P.dateShort(a.business_date),dateFull:P.dateFull(a.business_date),isoDate:(typeof a.business_date=="string",a.business_date),waste_percentage:a.net_sales?a.waste_amount/a.net_sales*100:0,food_variance_percentage:a.net_sales?a.food_variance_cost/a.net_sales*100:0})):[],[W]),M=a=>{n(a);const u={business_date:a.business_date||C(new Date,"yyyy-MM-dd"),net_sales:a.net_sales!=null?Number(a.net_sales):0,last_year_sales:a.last_year_sales!=null?Number(a.last_year_sales):0,labor_hours:a.labor_hours!=null?Number(a.labor_hours):0,ideal_labor_hours:a.ideal_labor_hours!=null?Number(a.ideal_labor_hours):0,labor_percentage:a.labor_percentage!=null?Number(a.labor_percentage):0,food_variance_cost:a.food_variance_cost!=null?Number(a.food_variance_cost):0,waste_amount:a.waste_amount!=null?Number(a.waste_amount):0,breakfast_sales:a.breakfast_sales!=null?Number(a.breakfast_sales):0,night_sales:a.night_sales!=null?Number(a.night_sales):0};o.reset(u),r(!0)},R=a=>{v.mutate(a)},Y=o.watch(),tt=Y.last_year_sales>0?(Y.net_sales-Y.last_year_sales)/Y.last_year_sales*100:0,Be=Y.labor_hours-Y.ideal_labor_hours,at=Y.net_sales>0?Y.food_variance_cost/Y.net_sales*100:0,rt=Y.net_sales>0?Y.waste_amount/Y.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(A,{onClick:()=>{n(null),o.reset({business_date:C(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),r(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),d&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(A,{onClick:g,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(A,{onClick:l,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const a=H.reduce((O,z)=>O+(Number(z.net_sales)||0),0),u=H.length>0?H.reduce((O,z)=>O+(Number(z.labor_percentage)||0),0)/H.length:0,p=H.reduce((O,z)=>O+(Number(z.waste_amount)||0),0),T=a>0?p/a*100:0;return e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:le(a)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:$(u)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:$(T)})]})]})})()}),e.jsx($e,{selectedRange:h.selectedRange,selectedDate:h.selectedDate,onRangeChange:h.handleRangeChange,onDateChange:h.handleDateChange,onClearFilters:h.clearFilters}),I&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",I.message]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(xe,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!W.length&&!I,error:I==null?void 0:I.message,children:pe.length>0?e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ne,{data:pe,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:a=>P.currencyCompact(a)}),e.jsx(ue,{...U.tooltip,formatter:a=>[P.currencyDetailed(a),"Comp Sales"],labelFormatter:(a,u)=>{var p;return u&&u[0]&&((p=u[0].payload)==null?void 0:p.dateFull)||a}}),e.jsx(he,{type:"monotone",dataKey:"comp_net_sales",stroke:k.sales,strokeWidth:2,dot:{fill:k.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:k.salesSecondary,strokeWidth:2},onClick:a=>{var u;return G((u=a==null?void 0:a.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(xe,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!W.length&&!I,error:I==null?void 0:I.message,children:_.length>0?e.jsx(te,{width:"100%",height:300,children:e.jsxs(Is,{data:_,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:a=>P.percent(a)}),e.jsx(ue,{...U.tooltip,formatter:a=>[P.percent(a,2),"Waste %"],labelFormatter:(a,u)=>{var p;return u&&u[0]&&((p=u[0].payload)==null?void 0:p.dateFull)||a}}),e.jsx(ts,{y:.5,stroke:k.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:k.textSecondary,fontSize:12}}),e.jsx(ks,{dataKey:"waste_percentage",fill:k.waste,opacity:.7,onClick:a=>{var u;return G((u=a==null?void 0:a.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(xe,{title:"Food Variance",subtitle:"Last 30 days",loading:!W.length&&!I,error:I==null?void 0:I.message,children:_.length>0?e.jsx(te,{width:"100%",height:300,children:e.jsxs(Ne,{data:_,children:[e.jsx(de,{...U.cartesianGrid}),e.jsx(ce,{dataKey:"date",...U.xAxis}),e.jsx(me,{...U.yAxis,tickFormatter:a=>P.percent(a)}),e.jsx(ue,{...U.tooltip,formatter:a=>[P.percent(a,2),"Food Variance %"],labelFormatter:(a,u)=>{var p;return u&&u[0]&&((p=u[0].payload)==null?void 0:p.dateFull)||a}}),e.jsx(ts,{y:0,stroke:k.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:k.textSecondary,fontSize:12}}),e.jsx(he,{type:"monotone",dataKey:"food_variance_percentage",stroke:k.foodVariance,strokeWidth:2,dot:{fill:k.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:k.warning,strokeWidth:2},onClick:a=>{var u;return G((u=a==null?void 0:a.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:h.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[F?"Loading...":`${w.length} entries`,h.selectedRange!=="last30"&&` for ${h.getSelectedLabel()}`,(h.selectedRange!=="last30"||h.selectedDate)&&e.jsx(A,{variant:"ghost",size:"sm",onClick:h.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(w==null?void 0:w.length)===0&&!F?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:d?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:h.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),d&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(A,{onClick:()=>r(!0),className:"wendys-button",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(A,{onClick:g,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx(za,{columns:[{key:"business_date",label:"Date",render:a=>ye(a)},{key:"net_sales",label:"Net Sales",render:a=>le(a)},{key:"comp_sales",label:"Comp Sales",render:(a,u)=>{const p=(u.net_sales??0)-(u.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${p>=0?"text-green-600":"text-red-600"}`,children:[p>=0?e.jsx(ae,{className:"h-3 w-3 mr-1"}):e.jsx(ge,{className:"h-3 w-3 mr-1"}),le(Math.abs(p))]})}},{key:"labor_hours",label:"Labor Hours",render:a=>`${a}h`},{key:"labor_percentage",label:"Labor %",render:a=>$(a)},{key:"food_variance",label:"Food Variance",render:(a,u)=>{const p=u.net_sales?u.food_variance_cost/u.net_sales*100:0;return $(p)}},{key:"waste",label:"Waste",render:(a,u)=>{const p=u.net_sales?u.waste_amount/u.net_sales*100:0;return $(p)}},{key:"actions",label:"Actions",render:(a,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>M(u),className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{G(u.business_date),i({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>R(u.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Me,{className:"h-4 w-4"})})]})}],data:w,mobileCardRender:a=>{const u=(a.net_sales??0)-(a.last_year_sales??0),p=a.net_sales?a.food_variance_cost/a.net_sales*100:0,T=a.net_sales?a.waste_amount/a.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:ye(a.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>M(a),className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>R(a.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Me,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:le(a.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${u>=0?"text-green-600":"text-red-600"}`,children:[u>=0?e.jsx(ae,{className:"h-3 w-3 mr-1"}):e.jsx(ge,{className:"h-3 w-3 mr-1"}),le(Math.abs(u))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[a.labor_hours,"h (",$(a.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:$(p)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:$(T)})]})]})]})},emptyMessage:"No entries found",loading:F})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:t?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(A,{variant:"ghost",onClick:()=>{r(!1),n(null),o.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:o.handleSubmit(b,j),className:"space-y-4",children:[Object.keys(o.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(o.formState.errors).map(([a,u])=>e.jsxs("li",{children:["• ",u==null?void 0:u.message]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(L,{children:"Business Date"}),e.jsxs(ze,{children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),o.watch("business_date")?ye(o.watch("business_date")):"Pick a date"]})}),e.jsx(Re,{className:"w-auto p-0",children:e.jsx(Te,{mode:"single",selected:(()=>{const a=o.watch("business_date");if(!a)return;const u=Number(a.slice(0,4)),p=Number(a.slice(5,7)),T=Number(a.slice(8,10));return new Date(u,(p||1)-1,T||1)})(),onSelect:a=>{const u=a?C(a,"yyyy-MM-dd"):"";if(o.setValue("business_date",u),u){const p=w.find(T=>T.business_date===u);p?(n(p),o.reset({business_date:p.business_date,net_sales:p.net_sales!=null?Number(p.net_sales):0,last_year_sales:p.last_year_sales!=null?Number(p.last_year_sales):0,labor_hours:p.labor_hours!=null?Number(p.labor_hours):0,ideal_labor_hours:p.ideal_labor_hours!=null?Number(p.ideal_labor_hours):0,labor_percentage:p.labor_percentage!=null?Number(p.labor_percentage):0,food_variance_cost:p.food_variance_cost!=null?Number(p.food_variance_cost):0,waste_amount:p.waste_amount!=null?Number(p.waste_amount):0,breakfast_sales:p.breakfast_sales!=null?Number(p.breakfast_sales):0,night_sales:p.night_sales!=null?Number(p.night_sales):0}),i({title:"Loaded existing entry",description:`Loaded data for ${ye(p.business_date)} to edit.`})):(n(null),o.reset({business_date:u,net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}))}},initialFocus:!0})})]}),o.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(D,{id:"net_sales",type:"number",step:"0.01",...o.register("net_sales")}),o.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(D,{id:"last_year_sales",type:"number",step:"0.01",...o.register("last_year_sales")}),o.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(D,{id:"comp_net_sales",value:$(tt),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(D,{id:"labor_hours",type:"number",step:"0.1",...o.register("labor_hours")}),o.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(D,{id:"ideal_labor_hours",type:"number",step:"0.1",...o.register("ideal_labor_hours")}),o.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(D,{id:"labor_hours_diff",value:`${Be>=0?"+":""}${Be.toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(D,{id:"labor_percentage",type:"number",step:"0.1",...o.register("labor_percentage")}),o.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(D,{id:"food_variance_cost",type:"number",step:"0.01",...o.register("food_variance_cost")}),o.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(D,{id:"food_variance_percentage",value:$(at),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(D,{id:"waste_amount",type:"number",step:"0.01",...o.register("waste_amount")}),o.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(D,{id:"waste_percentage",value:$(rt),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(D,{id:"breakfast_sales",type:"number",step:"0.01",...o.register("breakfast_sales")}),o.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(D,{id:"night_sales",type:"number",step:"0.01",...o.register("night_sales")}),o.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.night_sales.message})]})]}),!d&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn’t linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>{r(!1),n(null),o.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(A,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:y.isPending||S.isPending||!d,children:t?"Update Entry":"Save Entry"})]})]})]})})]})}const ls=qt,ds=zt,Ve=f.forwardRef(({className:s,children:r,...t},n)=>e.jsxs(Us,{ref:n,className:N("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[r,e.jsx(Ft,{asChild:!0,children:e.jsx(He,{className:"h-4 w-4 opacity-50"})})]}));Ve.displayName=Us.displayName;const Xs=f.forwardRef(({className:s,...r},t)=>e.jsx(Fs,{ref:t,className:N("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Ds,{className:"h-4 w-4"})}));Xs.displayName=Fs.displayName;const Zs=f.forwardRef(({className:s,...r},t)=>e.jsx(Vs,{ref:t,className:N("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(He,{className:"h-4 w-4"})}));Zs.displayName=Vs.displayName;const Pe=f.forwardRef(({className:s,children:r,position:t="popper",...n},i)=>e.jsx(Vt,{children:e.jsxs(Ps,{ref:i,className:N("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...n,children:[e.jsx(Xs,{}),e.jsx(Pt,{className:N("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(Zs,{})]})}));Pe.displayName=Ps.displayName;const Ba=f.forwardRef(({className:s,...r},t)=>e.jsx(Ws,{ref:t,className:N("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r}));Ba.displayName=Ws.displayName;const B=f.forwardRef(({className:s,children:r,...t},n)=>e.jsxs(Hs,{ref:n,className:N("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Wt,{children:e.jsx(vs,{className:"h-4 w-4"})})}),e.jsx(Ht,{children:r})]}));B.displayName=Hs.displayName;const Ka=f.forwardRef(({className:s,...r},t)=>e.jsx(qs,{ref:t,className:N("-mx-1 my-1 h-px bg-muted",s),...r}));Ka.displayName=qs.displayName;const et=f.forwardRef(({className:s,...r},t)=>e.jsx("textarea",{className:N("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r}));et.displayName="Textarea";const Qa=ie("/interviews")({component:Ja});function Ja(){const[s,r]=f.useState(null),[t,n]=f.useState([]),[i,x]=f.useState(!1),[d,c]=f.useState(null),[h,g]=f.useState(""),[l,o]=f.useState("ALL"),[y,S]=f.useState(!1),{toast:b}=X(),[j,v]=f.useState({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""});f.useEffect(()=>{(async()=>{try{const{data:{user:M}}=await E.auth.getUser();if(!M)return;const{data:R}=await E.from("users").select("store_id").eq("id",M.id).single();R!=null&&R.store_id&&(r(R.store_id),m(R.store_id))}catch(M){console.error("Error getting store ID:",M)}})()},[]);const m=async _=>{try{S(!0);const{data:M,error:R}=await E.from("interviews").select("*").eq("store_id",_).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(R)throw R;n(M||[])}catch(M){console.error("Error fetching interviews:",M),b({title:"Error",description:"Failed to fetch interviews",variant:"destructive"})}finally{S(!1)}},w=(_,M)=>{v(R=>({...R,[_]:M}))},F=()=>{v({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""}),c(null)},I=async()=>{if(!s){b({title:"Error",description:"No store selected",variant:"destructive"});return}try{if(d){const{error:_}=await E.from("interviews").update({candidate_name:j.candidate_name,phone:j.phone||null,email:j.email||null,position:j.position||null,interview_date:j.interview_date,interview_time:j.interview_time,status:j.status,notes:j.notes||null}).eq("id",d.id);if(_)throw _;b({title:"Success!",description:"Interview updated successfully."})}else{const{error:_}=await E.from("interviews").insert([{store_id:s,candidate_name:j.candidate_name,phone:j.phone||null,email:j.email||null,position:j.position||null,interview_date:j.interview_date,interview_time:j.interview_time,status:j.status,notes:j.notes||null}]);if(_)throw _;b({title:"Success!",description:"Interview scheduled successfully."})}m(s),x(!1),F()}catch(_){console.error("Error saving interview:",_),b({title:"Error",description:_.message||"Failed to save interview",variant:"destructive"})}},W=_=>{c(_),v({candidate_name:_.candidate_name,phone:_.phone||"",email:_.email||"",position:_.position||"",interview_date:_.interview_date,interview_time:_.interview_time,status:_.status,notes:_.notes||""}),x(!0)},H=async _=>{if(confirm("Are you sure you want to delete this interview?"))try{const{error:M}=await E.from("interviews").delete().eq("id",_);if(M)throw M;b({title:"Deleted!",description:"Interview removed successfully."}),m(s)}catch(M){console.error("Error deleting interview:",M),b({title:"Error",description:M.message||"Failed to delete interview",variant:"destructive"})}},pe=t.filter(_=>{const M=_.candidate_name.toLowerCase().includes(h.toLowerCase())||(_.position||"").toLowerCase().includes(h.toLowerCase()),R=l==="ALL"||_.status===l;return M&&R}).reduce((_,M)=>{const R=M.interview_date;return _[R]||(_[R]=[]),_[R].push(M),_},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(A,{onClick:()=>x(!0),className:"wendys-button",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(D,{placeholder:"Search by name or position...",value:h,onChange:_=>g(_.target.value),className:"pl-10"})]})}),e.jsxs(ls,{value:l,onValueChange:o,children:[e.jsx(Ve,{className:"w-full sm:w-48",children:e.jsx(ds,{placeholder:"Filter by status"})}),e.jsxs(Pe,{children:[e.jsx(B,{value:"ALL",children:"All Statuses"}),e.jsx(B,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(B,{value:"COMPLETED",children:"Completed"}),e.jsx(B,{value:"NO_SHOW",children:"No Show"}),e.jsx(B,{value:"HIRED",children:"Hired"}),e.jsx(B,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[y&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!y&&Object.keys(pe).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(pe).map(([_,M])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),ye(_)]}),e.jsx("div",{className:"space-y-3",children:M.map(R=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:R.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${zs(R.status)}`,children:R.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Os,{className:"h-4 w-4"}),e.jsx("span",{children:R.position||"No position specified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:sa(R.interview_time)})]}),R.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx("span",{children:R.phone})]}),R.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:R.email})]})]}),R.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx(Yt,{className:"h-4 w-4 inline mr-1"}),R.notes]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(A,{variant:"outline",size:"sm",onClick:()=>W(R),children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>H(R.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Me,{className:"h-4 w-4"})})]})]})},R.id))})]},_))]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:d?"Edit Interview":"Schedule New Interview"}),e.jsx(A,{variant:"ghost",onClick:()=>{x(!1),F()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:_=>{_.preventDefault(),I()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(D,{id:"candidate_name",value:j.candidate_name,onChange:_=>w("candidate_name",_.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"position",children:"Position"}),e.jsx(D,{id:"position",value:j.position,onChange:_=>w("position",_.target.value),placeholder:"e.g., Crew Member, Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"phone",children:"Phone"}),e.jsx(D,{id:"phone",type:"tel",value:j.phone,onChange:_=>w("phone",_.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email"}),e.jsx(D,{id:"email",type:"email",value:j.email,onChange:_=>w("email",_.target.value),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(D,{id:"interview_date",type:"date",value:j.interview_date,onChange:_=>w("interview_date",_.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(D,{id:"interview_time",type:"time",value:j.interview_time,onChange:_=>w("interview_time",_.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"status",children:"Status *"}),e.jsxs(ls,{value:j.status,onValueChange:_=>w("status",_),children:[e.jsx(Ve,{id:"status",children:e.jsx(ds,{})}),e.jsxs(Pe,{children:[e.jsx(B,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(B,{value:"DONE",children:"Completed"}),e.jsx(B,{value:"NO_SHOW",children:"No Show"}),e.jsx(B,{value:"HIRED",children:"Hired"}),e.jsx(B,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"notes",children:"Notes"}),e.jsx(et,{id:"notes",value:j.notes,onChange:_=>w("notes",_.target.value),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>{x(!1),F()},children:"Cancel"}),e.jsx(A,{type:"submit",className:"wendys-button",children:d?"Update Interview":"Schedule Interview"})]})]})]})})]})}const Xa=ne({sales_target:q.number().min(0),labor_target_pct:q.number().min(0),waste_target_pct:q.number().min(0),food_variance_target_pct:q.number().min(0),team_notes:V().optional()});function Za(){const{toast:s}=X(),r=qe(),[t,n]=f.useState(null),i=Ye("goals","wtd"),x=i.getDateRangeFilter(),d=(x==null?void 0:x.start)||C(new Date,"yyyy-MM-dd"),c=(x==null?void 0:x.end)||C(new Date,"yyyy-MM-dd"),h=i.selectedRange==="mtd"?"month":i.selectedRange==="wtd"?"week":"custom",g=Ee({resolver:Se(Xa),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});f.useEffect(()=>{let v=!0;return(async()=>{var W;const{data:m}=await E.auth.getUser(),w=(W=m.user)==null?void 0:W.id;if(!w)return;const{data:F,error:I}=await E.from("users").select("store_id").eq("id",w).maybeSingle();v&&(I||n((F==null?void 0:F.store_id)??null))})(),()=>{v=!1}},[]);const{data:l}=K({queryKey:["goals_settings",t,d,c],queryFn:async()=>{if(!t)return null;try{const{data:v,error:m}=await E.from("goals").select("*").eq("store_id",t).eq("period_start",d).eq("period_end",c).maybeSingle();if(m&&m.code!=="PGRST116"){const w=String(m.code||""),F=String(m.message||"");if(w.startsWith("42")||F.toLowerCase().includes("relation")||F.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw m}return v||null}catch(v){const m=String((v==null?void 0:v.code)||""),w=String((v==null?void 0:v.message)||"");if(m.startsWith("42")||w.toLowerCase().includes("relation")||w.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw v}},enabled:!!t});f.useEffect(()=>{l&&g.reset({sales_target:l.sales_target,labor_target_pct:l.labor_target_pct,waste_target_pct:l.waste_target_pct,food_variance_target_pct:l.food_variance_target_pct,team_notes:l.team_notes||""})},[l]);const{data:o=[]}=K({queryKey:["omega_daily_for_goals",t,d,c],queryFn:async()=>{if(!t)return[];const{data:v,error:m}=await E.from("omega_daily").select("*").eq("store_id",t).gte("business_date",d).lte("business_date",c).order("business_date",{ascending:!0});if(m)throw m;return v},enabled:!!t}),y=f.useMemo(()=>{const v=o.reduce((H,G)=>H+(Number(G.net_sales)||0),0),m=o.length>0?o.reduce((H,G)=>H+(Number(G.labor_percentage)||0),0)/o.length:0,w=o.reduce((H,G)=>H+(Number(G.waste_amount)||0),0),F=o.reduce((H,G)=>H+(Number(G.food_variance_cost)||0),0),I=v>0?w/v*100:0,W=v>0?F/v*100:0;return{totalSales:v,avgLaborPct:m,wastePct:I,foodVarPct:W}},[o]),S=fe({mutationFn:async v=>{if(!t)throw new Error("No store is linked to your account. See Setup to link one.");const m={store_id:t,scope:h,period_start:d,period_end:c,sales_target:v.sales_target,labor_target_pct:v.labor_target_pct,waste_target_pct:v.waste_target_pct,food_variance_target_pct:v.food_variance_target_pct,team_notes:v.team_notes||null},{error:w}=await E.from("goals").upsert(m,{onConflict:"store_id,period_start,period_end"});if(w){const F=String(w.code||""),I=String(w.message||"");throw F.startsWith("42")||I.toLowerCase().includes("relation")||I.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):w}},onSuccess:()=>{s({title:"Saved",description:"Goals saved for selected period."}),r.invalidateQueries({queryKey:["goals_settings",t,d,c]})},onError:v=>{s({title:"Save failed",description:v.message,variant:"destructive"})}}),b=()=>{g.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""})},j=(v,m)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${v?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:m});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Goal Setting"}),e.jsx("p",{className:"text-gray-600",children:"Set targets and track progress against Omega Daily actuals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",onClick:b,children:"Reset Goals"}),e.jsx(A,{className:"wendys-button",onClick:g.handleSubmit(v=>S.mutate(v)),disabled:!t||S.isPending,children:"Save Goals"})]})]}),e.jsx($e,{selectedRange:i.selectedRange,selectedDate:i.selectedDate,onRangeChange:i.handleRangeChange,onDateChange:i.handleDateChange,onClearFilters:i.clearFilters}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Sales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target"}),e.jsx(D,{type:"number",step:"0.01",...g.register("sales_target")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual"}),e.jsxs("p",{className:"text-xl font-semibold",children:["$",y.totalSales.toLocaleString()]})]})]}),e.jsx("div",{children:j(y.totalSales>=(g.watch("sales_target")||0),y.totalSales>=(g.watch("sales_target")||0)?"On Track":"Behind")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Labor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target %"}),e.jsx(D,{type:"number",step:"0.1",...g.register("labor_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.avgLaborPct.toFixed(1),"%"]})]})]}),e.jsx("div",{children:j(y.avgLaborPct<=(g.watch("labor_target_pct")||0),y.avgLaborPct<=(g.watch("labor_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Waste & Food"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Target %"}),e.jsx(D,{type:"number",step:"0.1",...g.register("waste_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.wastePct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:j(y.wastePct<=(g.watch("waste_target_pct")||0),y.wastePct<=(g.watch("waste_target_pct")||0)?"On Track":"High")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Target %"}),e.jsx(D,{type:"number",step:"0.1",...g.register("food_variance_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.foodVarPct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:j(y.foodVarPct<=(g.watch("food_variance_target_pct")||0),y.foodVarPct<=(g.watch("food_variance_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card md:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Team & Personal"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"team_notes",children:"Notes"}),e.jsx(D,{id:"team_notes",...g.register("team_notes"),placeholder:"Notes, personal goals, shout-outs..."})]})})]})]})]})}const er=ie("/goals")({component:Za}),sr=ie("/")({beforeLoad:()=>{throw Bt({to:"/overview"})}}),tr=Ia.update({id:"/smg",path:"/smg",getParentRoute:()=>Z}),ar=Oa.update({id:"/setup",path:"/setup",getParentRoute:()=>Z}),rr=Ha.update({id:"/overview",path:"/overview",getParentRoute:()=>Z}),nr=$a.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>Z}),ir=Qa.update({id:"/interviews",path:"/interviews",getParentRoute:()=>Z}),or=er.update({id:"/goals",path:"/goals",getParentRoute:()=>Z}),lr=sr.update({id:"/",path:"/",getParentRoute:()=>Z}),dr={IndexRoute:lr,GoalsRoute:or,InterviewsRoute:ir,OmegaDailyRoute:nr,OverviewRoute:rr,SetupRoute:ar,SmgRoute:tr},cr=Z._addFileChildren(dr)._addFileTypes(),st=new Kt({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),mr=Qt({routeTree:cr,context:{queryClient:st},defaultPreload:"intent"});Jt.createRoot(document.getElementById("root")).render(e.jsx(se.StrictMode,{children:e.jsxs(Xt,{client:st,children:[e.jsx(Zt,{router:mr}),e.jsx(ca,{}),e.jsx(ea,{initialIsOpen:!1})]})}));
