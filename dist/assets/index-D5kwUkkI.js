import{t as ps,c as ys,f as L,p as _e,r as _,j as e,V as wt,R as Et,a as tt,A as St,C as Tt,X as Rt,T as Ct,D as Dt,P as _s,b as bs,S as Ns,u as vs,B as js,d as ge,F as st,e as te,U as Lt,M as ws,g as Es,W as Ss,h as Ae,L as We,i as de,k as At,l as Ts,m as kt,n as Rs,o as It,I as Mt,q as Ot,s as Ft,v as Ut,w as Vt,x as qt,y as Pt,z as zt,E as Cs,G as Ds,H as Ls,J as Wt,K as As,N as ce,O,Q as V,Y as Ve,Z as Ht,_ as ks,$ as $t,a0 as Gt,a1 as Me,a2 as Oe,a3 as Kt,a4 as Is,a5 as Ms,a6 as Yt,a7 as Os,a8 as Fs,a9 as Us,aa as Vs,ab as qs,ac as Bt,ad as Ps,ae as zs,af as xt,ag as at,ah as $e,ai as ie,aj as Ce,ak as J,al as X,am as fe,an as he,ao as Ie,ap as be,aq as Ne,ar as ve,as as je,at as Ee,au as Ws,av as Se,aw as Qt,ax as Hs,ay as Jt,az as qe,aA as ye,aB as rt,aC as nt,aD as xe,aE as $s,aF as Ye,aG as ht,aH as Te,aI as Re,aJ as Gs,aK as Ks,aL as Ys,aM as Bs,aN as Le,aO as Qs,aP as Js,aQ as Xs,aR as gt,aS as Zs,aT as ea,aU as Xt,aV as ta,aW as Zt,aX as es,aY as sa,aZ as ts,a_ as aa,a$ as ss,b0 as as,b1 as ra,b2 as na,b3 as rs,b4 as ia,b5 as oa,b6 as la,b7 as da,b8 as ca,b9 as ma,ba as ua,bb as xa,bc as ha,bd as ga}from"./vendor-CQwfuuxl.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const d of f.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(o){if(o.ep)return;o.ep=!0;const f=n(o);fetch(o.href,f)}})();function S(...a){return ps(ys(a))}function ne(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)}function Q(a,i=1){return`${a.toFixed(i)}%`}function le(a){const i=typeof a=="string"?new Date(Number(a.slice(0,4)),Number(a.slice(5,7))-1,Number(a.slice(8,10))):a;return L(i,"MMM dd, yyyy")}function fa(a){return L(_e(`2000-01-01T${a}`),"h:mm a")}function ns(a){switch(a.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const pa=_s,is=_.forwardRef(({className:a,...i},n)=>e.jsx(wt,{ref:n,className:S("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...i}));is.displayName=wt.displayName;const ya=tt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),os=_.forwardRef(({className:a,variant:i,...n},c)=>e.jsx(Et,{ref:c,className:S(ya({variant:i}),a),...n}));os.displayName=Et.displayName;const _a=_.forwardRef(({className:a,...i},n)=>e.jsx(St,{ref:n,className:S("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...i}));_a.displayName=St.displayName;const ls=_.forwardRef(({className:a,...i},n)=>e.jsx(Tt,{ref:n,className:S("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...i,children:e.jsx(Rt,{className:"h-4 w-4"})}));ls.displayName=Tt.displayName;const ds=_.forwardRef(({className:a,...i},n)=>e.jsx(Ct,{ref:n,className:S("text-sm font-semibold",a),...i}));ds.displayName=Ct.displayName;const cs=_.forwardRef(({className:a,...i},n)=>e.jsx(Dt,{ref:n,className:S("text-sm opacity-90",a),...i}));cs.displayName=Dt.displayName;const ba=1,Na=1e6;let Be=0;function va(){return Be=(Be+1)%Number.MAX_SAFE_INTEGER,Be.toString()}const Qe=new Map,ft=a=>{if(Qe.has(a))return;const i=setTimeout(()=>{Qe.delete(a),ke({type:"REMOVE_TOAST",toastId:a})},Na);Qe.set(a,i)},ja=(a,i)=>{switch(i.type){case"ADD_TOAST":return{...a,toasts:[i.toast,...a.toasts].slice(0,ba)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(n=>n.id===i.toast.id?{...n,...i.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=i;return n?ft(n):a.toasts.forEach(c=>{ft(c.id)}),{...a,toasts:a.toasts.map(c=>c.id===n||n===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return i.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(n=>n.id!==i.toastId)}}},Pe=[];let ze={toasts:[]};function ke(a){ze=ja(ze,a),Pe.forEach(i=>{i(ze)})}function wa({...a}){const i=va(),n=o=>ke({type:"UPDATE_TOAST",toast:{...o,id:i}}),c=()=>ke({type:"DISMISS_TOAST",toastId:i});return ke({type:"ADD_TOAST",toast:{...a,id:i,open:!0,onOpenChange:o=>{o||c()}}}),{id:i,dismiss:c,update:n}}function se(){const[a,i]=_.useState(ze);return _.useEffect(()=>(Pe.push(i),()=>{const n=Pe.indexOf(i);n>-1&&Pe.splice(n,1)}),[a]),{...a,toast:wa,dismiss:n=>ke({type:"DISMISS_TOAST",toastId:n})}}function Ea(){const{toasts:a}=se();return e.jsxs(pa,{children:[a.map(function({id:i,title:n,description:c,action:o,...f}){return e.jsxs(os,{...f,children:[e.jsxs("div",{className:"grid gap-1",children:[n&&e.jsx(ds,{children:n}),c&&e.jsx(cs,{children:c})]}),o,e.jsx(ls,{})]},i)}),e.jsx(is,{})]})}const Sa="https://qewndmyixpzmtgjjihoj.supabase.co",Ta="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",w=bs(Sa,Ta,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),C=_.forwardRef(({className:a,type:i,...n},c)=>e.jsx("input",{type:i,className:S("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:c,...n}));C.displayName="Input";const Je=tt("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),T=_.forwardRef(({className:a,variant:i,size:n,asChild:c=!1,...o},f)=>{const d=c?Ns:"button";return e.jsx(d,{className:S(Je({variant:i,size:n,className:a})),ref:f,...o})});T.displayName="Button";const pt=[{name:"Overview",href:"/overview",icon:js,description:"Key metrics and trends",category:"main",priority:"high"},{name:"Omega Daily",href:"/omega-daily",icon:ge,description:"Daily business metrics",category:"main",priority:"high"},{name:"Weekending Sheet",href:"/weekending-sheet",icon:st,description:"Weekly operational data",category:"main",priority:"high"},{name:"Calendar",href:"/calendar",icon:te,description:"Events and reminders",category:"main",priority:"medium"},{name:"Interviews & Hires",href:"/interviews",icon:Lt,description:"Manage candidates and hiring",category:"main",priority:"medium"},{name:"OSAT",href:"/smg",icon:ws,description:"Customer feedback metrics",category:"main",priority:"medium"},{name:"Goal Setting",href:"/goals",icon:Es,description:"Set goals & track progress",category:"main",priority:"medium"},{name:"Setup",href:"/setup",icon:Ss,description:"Copy SQL & configure",category:"main",priority:"low"}],ms=_.forwardRef(({open:a,isMobile:i,onClose:n},c)=>{const o=vs(),[f,d]=_.useState(""),[g,x]=_.useState(null),b=_.useMemo(()=>{if(!f.trim())return pt;const r=f.toLowerCase();return pt.filter(u=>u.name.toLowerCase().includes(r)||u.description.toLowerCase().includes(r))},[f]),m=()=>{i&&n()};return i?e.jsx("div",{ref:c,className:S("fixed top-0 left-0 w-80 h-full bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",a?"translate-x-0":"-translate-x-full"),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("h2",{className:"font-semibold text-wendys-charcoal",children:"Navigation"})]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:n,className:"tap","aria-label":"Close navigation",children:"×"})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{placeholder:"Search navigation...",value:f,onChange:r=>d(r.target.value),className:"pl-10 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-2",children:b.map(r=>{const u=o.pathname===r.href,R=r.icon;return e.jsxs(We,{to:r.href,onClick:m,className:S("flex items-center space-x-3 p-4 rounded-lg transition-all duration-200 tap",u?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg":"text-gray-700 hover:bg-gray-50"),children:[e.jsx("div",{className:S("flex-shrink-0 p-2 rounded-lg",u?"bg-white/20":"bg-gray-100"),children:e.jsx(R,{className:S("h-5 w-5",u?"text-white":"text-gray-600")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:S("font-semibold text-sm",u?"text-white":"text-gray-800"),children:r.name}),r.priority==="high"&&e.jsx(de,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:S("text-xs mt-1",u?"text-red-100":"text-gray-500"),children:r.description})]})]},r.href)})}),f.trim()&&b.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-xs mt-1",children:"Try a different search term"})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})}):e.jsx("div",{className:S("bg-gradient-to-b from-white to-gray-50 shadow-2xl border-r border-gray-200 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",a?"w-64":"w-16"),children:e.jsxs("div",{className:"flex flex-col h-full relative",children:[a&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{placeholder:"Search navigation...",value:f,onChange:r=>d(r.target.value),className:"pl-10 h-9 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:S("overflow-y-auto flex-1",a?"p-4":"p-2"),children:[e.jsx("div",{className:"space-y-1",children:b.map(r=>{const u=o.pathname===r.href,R=r.icon;return e.jsxs("div",{className:"relative",children:[e.jsxs(We,{to:r.href,className:S("flex items-center transition-all duration-200 group relative",a?"space-x-3 p-3 rounded-lg mx-0":"justify-center p-3 rounded-lg mx-1",u?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg ring-1 ring-red-200":"text-gray-700 hover:bg-white hover:shadow-sm hover:ring-1 hover:ring-gray-200"),onMouseEnter:()=>!a&&x(r.href),onMouseLeave:()=>!a&&x(null),children:[e.jsx("div",{className:S("flex-shrink-0 p-2 rounded-lg transition-all duration-200",u?"bg-white/20":"bg-gray-100 group-hover:bg-wendys-red/10 group-hover:scale-110"),children:e.jsx(R,{className:S("h-5 w-5 transition-colors duration-200",u?"text-white":"text-gray-600 group-hover:text-wendys-red")})}),a&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:S("font-semibold text-sm",u?"text-white":"text-gray-800"),children:r.name}),r.priority==="high"&&e.jsx(de,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:S("text-xs mt-1",u?"text-red-100":"text-gray-500"),children:r.description})]})]}),!a&&g===r.href&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 transform -translate-y-1/2 z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-sm px-3 py-2 rounded-lg shadow-lg whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:r.name}),e.jsx("div",{className:"text-gray-300 text-xs mt-1",children:r.description}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-900 rotate-45"})]})})]},r.href)})}),f.trim()&&b.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ae,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Try a different search term"})]})]}),a&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})})});ms.displayName="RightNavDrawer";const Ra=Cs,Ca=Ds,Da=_.forwardRef(({className:a,inset:i,children:n,...c},o)=>e.jsxs(At,{ref:o,className:S("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",i&&"pl-8",a),...c,children:[n,e.jsx(Ts,{className:"ml-auto h-4 w-4"})]}));Da.displayName=At.displayName;const La=_.forwardRef(({className:a,...i},n)=>e.jsx(kt,{ref:n,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i}));La.displayName=kt.displayName;const us=_.forwardRef(({className:a,sideOffset:i=4,...n},c)=>e.jsx(Rs,{children:e.jsx(It,{ref:c,sideOffset:i,className:S("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}));us.displayName=It.displayName;const xs=_.forwardRef(({className:a,inset:i,...n},c)=>e.jsx(Mt,{ref:c,className:S("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i&&"pl-8",a),...n}));xs.displayName=Mt.displayName;const Aa=_.forwardRef(({className:a,children:i,checked:n,...c},o)=>e.jsxs(Ot,{ref:o,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...c,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(Ut,{className:"h-4 w-4"})})}),i]}));Aa.displayName=Ot.displayName;const ka=_.forwardRef(({className:a,children:i,...n},c)=>e.jsxs(Vt,{ref:c,className:S("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ft,{children:e.jsx(qt,{className:"h-2 w-2 fill-current"})})}),i]}));ka.displayName=Vt.displayName;const Ia=_.forwardRef(({className:a,inset:i,...n},c)=>e.jsx(Pt,{ref:c,className:S("px-2 py-1.5 text-sm font-semibold",i&&"pl-8",a),...n}));Ia.displayName=Pt.displayName;const Ma=_.forwardRef(({className:a,...i},n)=>e.jsx(zt,{ref:n,className:S("-mx-1 my-1 h-px bg-muted",a),...i}));Ma.displayName=zt.displayName;function Oa({user:a,onNavToggle:i,navOpen:n}){const{toast:c}=se(),o=async()=>{try{await w.auth.signOut(),c({title:"Signed out",description:"You have been successfully signed out."})}catch(f){console.error("Error signing out:",f),c({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:i,className:"tap p-2 hover:bg-gray-100","aria-label":n?"Close navigation":"Open navigation",children:e.jsx(Ls,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm sm:text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-bold text-wendys-charcoal",children:[e.jsx("span",{className:"hidden sm:inline",children:"SE 14th GM Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Dashboard"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 hide-on-mobile",children:L(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:e.jsxs(Ra,{children:[e.jsx(Ca,{asChild:!0,children:e.jsxs(T,{variant:"ghost",className:"flex items-center space-x-1 sm:space-x-2 tap",children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:a.email})]})}),e.jsx(us,{align:"end",children:e.jsxs(xs,{onClick:o,children:[e.jsx(As,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const Fa=ce({business_date:V().min(1,"Business date is required"),net_sales:O.number().min(0,"Net sales must be positive"),last_year_sales:O.number().min(0,"Last year sales must be positive"),labor_hours:O.number().min(0,"Labor hours must be positive"),ideal_labor_hours:O.number().min(0,"Ideal labor hours must be positive"),labor_percentage:O.number().min(0,"Labor percentage must be positive"),food_variance_cost:O.number(),waste_amount:O.number().min(0,"Waste amount must be positive"),breakfast_sales:O.number().min(0,"Breakfast sales must be positive"),night_sales:O.number().min(0,"Night sales must be positive")}),Ua=ce({date:V().min(1,"Date is required"),accuracy_decimal:Ve().min(0,"Accuracy must be 0 or greater"),zod_per_10k:Ve().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:Ve().min(0,"CC Complaints must be 0 or greater"),osat_decimal:Ve().min(0,"OSAT Score must be 0 or greater"),notes:V().optional()});ce({candidate_name:V().min(1,"Candidate name is required"),phone:V().optional(),email:V().email("Invalid email format").optional().or(ks("")),position:V().optional(),interview_date:V().min(1,"Interview date is required"),interview_time:V().min(1,"Interview time is required"),status:Ht(["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"]),notes:V().optional()});ce({entry_date:V().min(1,"Entry date is required"),accuracy_of_order:O.number().min(0).max(5).optional(),zone_of_defection:O.number().min(0).max(5).optional(),customer_computers:O.number().min(0).max(5).optional(),taste_of_food:O.number().min(0).max(5).optional(),osat:O.number().min(0).max(5).optional()});ce({documents_received:$t().default(!1),documents_folder:V().optional(),onboarding_sent_date:V().optional(),onboarding_completed_date:V().optional(),manager_reviewed_date:V().optional(),entered_in_system_date:V().optional(),fingerprint_scheduled_date:V().optional(),first_day:V().optional(),notes:V().optional()});const Va=ce({email:V().email("Invalid email format"),password:V().min(6,"Password must be at least 6 characters")}),qa=ce({week_ending_date:V().min(1,"Week ending date is required"),manager_name:Ht(["Scott","Sophear","Letoya","Carissa"],{required_error:"Please select a manager"}),breakfast_sales:O.number().min(0,"Breakfast sales must be positive"),late_night_sales:O.number().min(0,"Late night sales must be positive"),net_sales:O.number().min(0,"Net sales must be positive"),discounts:O.number().min(0,"Discounts must be positive"),cash:O.number().min(0,"Cash must be positive"),food_total:O.number().min(0,"Food total must be positive"),food_cost:O.number().min(0,"Food cost must be positive"),variance_dollars:O.number(),food_variance_percentage:O.number(),labor:O.number().min(0,"Labor must be positive"),credit_hours:O.number().min(0,"Credit hours must be positive"),reason:V().optional(),onboarding:$t().default(!1),crew_food_safety_quiz:O.number().min(0).max(100,"Score must be between 0-100"),mgr_food_safety_quiz:O.number().min(0).max(100,"Score must be between 0-100"),new_hire_name:V().optional(),terminations:V().optional(),term_date:V().optional()}),Pa=tt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),E=_.forwardRef(({className:a,...i},n)=>e.jsx(Gt,{ref:n,className:S(Pa(),a),...i}));E.displayName=Gt.displayName;function za(){const[a,i]=_.useState(!1),[n,c]=_.useState(!1),{toast:o}=se(),{register:f,handleSubmit:d,formState:{errors:g}}=Me({resolver:Oe(Va)}),x=async b=>{i(!0);try{const{error:m}=await w.auth.signInWithPassword({email:b.email,password:b.password});if(m)throw m;o({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(m){console.error("Login error:",m),o({title:"Login failed",description:m.message||"Please check your credentials and try again.",variant:"destructive"})}finally{i(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:d(x),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...f("email")})]}),g.email&&e.jsx("p",{className:"text-red-600 text-sm",children:g.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(C,{id:"password",type:n?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...f("password")}),e.jsx("button",{type:"button",onClick:()=>c(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n?e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(Yt,{className:"h-4 w-4"})})]}),g.password&&e.jsx("p",{className:"text-red-600 text-sm",children:g.password.message})]}),e.jsx(T,{type:"submit",className:"w-full wendys-button",disabled:a,children:a?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const ae=Os({component:Wa});function Wa(){const[a,i]=_.useState(null),[n,c]=_.useState(!0),[o,f]=_.useState(()=>{const r=localStorage.getItem("navOpen"),u=typeof window<"u"?window.innerWidth>=768:!0;return r?JSON.parse(r):u}),[d,g]=_.useState(typeof window<"u"?window.innerWidth<768:!1),x=_.useRef(null),{toast:b}=se(),m=Fs();return _.useEffect(()=>{const r=()=>{const u=window.innerWidth<768;g(u),u&&o&&f(!1)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[o]),_.useEffect(()=>{const r=R=>{R.key==="Escape"&&o&&d&&f(!1)},u=R=>{d&&o&&x.current&&!x.current.contains(R.target)&&f(!1)};return o&&d?(document.addEventListener("keydown",r),document.addEventListener("mousedown",u),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",r),document.removeEventListener("mousedown",u),document.body.style.overflow="unset"}},[o,d]),_.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){i({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),c(!1);return}const{data:{session:u}}=await w.auth.getSession();u!=null&&u.user&&i(u.user)}catch(u){console.error("Error checking session:",u),i({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{c(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:u}}=w.auth.onAuthStateChange(async(R,v)=>{R==="SIGNED_IN"&&(v!=null&&v.user)?(i(v.user),b({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):R==="SIGNED_OUT"&&(i(null),m({to:"/"}),b({title:"Signed out",description:"You have been successfully signed out."}))});return()=>u.unsubscribe()}},[m,b]),_.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(o))},[o]),n?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):a?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(Oa,{user:a,onNavToggle:()=>f(!o),navOpen:o}),e.jsxs("div",{className:"flex relative",children:[d&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm",onClick:()=>f(!1)}),e.jsx(ms,{open:o,isMobile:d,onClose:()=>f(!1),ref:x}),e.jsx("main",{id:"main-content",className:S("flex-1 transition-all duration-300 ease-in-out mobile-container","ml-0"),children:e.jsx(Us,{})})]})]}):e.jsx(za,{})}function De({className:a,classNames:i,showOutsideDays:n=!0,...c}){return e.jsx(Vs,{showOutsideDays:n,className:S("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:S(Je({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:S(Je({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...i},...c})}De.displayName="Calendar";const Ge=Ps,Ke=zs,Fe=_.forwardRef(({className:a,align:i="center",sideOffset:n=4,...c},o)=>e.jsx(qs,{children:e.jsx(Bt,{ref:o,align:i,sideOffset:n,className:S("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c})}));Fe.displayName=Bt.displayName;function Ha({columns:a,data:i,className:n,emptyMessage:c="No data available",loading:o=!1}){const[f,d]=_.useState(null),[g,x]=_.useState(null),b=_.useMemo(()=>!f||!g?i:[...i].sort((u,R)=>{const v=u[f],M=R[f];if(v==null&&M==null)return 0;if(v==null)return g==="asc"?-1:1;if(M==null)return g==="asc"?1:-1;if(typeof v=="number"&&typeof M=="number")return g==="asc"?v-M:M-v;if(typeof v=="string"&&typeof M=="string")return g==="asc"?v.localeCompare(M):M.localeCompare(v);if(v instanceof Date&&M instanceof Date)return g==="asc"?v.getTime()-M.getTime():M.getTime()-v.getTime();const j=String(v),h=String(M);return g==="asc"?j.localeCompare(h):h.localeCompare(j)}),[i,f,g]),m=u=>{f===u?g==="asc"?x("desc"):g==="desc"&&(x(null),d(null)):(d(u),x("asc"))},r=u=>f!==u?e.jsx(xt,{className:"h-3 w-3 text-gray-400"}):g==="asc"?e.jsx(at,{className:"h-3 w-3 text-gray-600"}):g==="desc"?e.jsx($e,{className:"h-3 w-3 text-gray-600"}):e.jsx(xt,{className:"h-3 w-3 text-gray-400"});return o?e.jsx($a,{columns:a}):e.jsx("div",{className:S("overflow-x-auto",n),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:a.map(u=>e.jsx("th",{className:S("py-3 px-4 font-medium text-gray-700 text-sm",u.align==="center"&&"text-center",u.align==="right"&&"text-right",u.sortable&&"cursor-pointer hover:bg-gray-100 select-none",u.className),onClick:()=>u.sortable&&m(u.key),children:e.jsxs("div",{className:S("flex items-center gap-1",u.align==="center"&&"justify-center",u.align==="right"&&"justify-end"),children:[u.label,u.sortable&&r(u.key)]})},u.key))})}),e.jsx("tbody",{children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"py-8 px-4 text-center text-gray-500",children:c})}):b.map((u,R)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:a.map(v=>e.jsx("td",{className:S("py-3 px-4 text-sm",v.align==="center"&&"text-center",v.align==="right"&&"text-right",v.className),children:v.render?v.render(u[v.key],u):u[v.key]},v.key))},u.id||R))})]})})}function $a({columns:a}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:a.map(i=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},i.key))})}),e.jsx("tbody",{children:[...Array(5)].map((i,n)=>e.jsx("tr",{className:"border-b border-gray-100",children:a.map(c=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},c.key))},n))})]})})})}function we({title:a,subtitle:i,className:n,children:c,loading:o=!1,error:f,onRefresh:d}){return e.jsxs("div",{className:S("wendys-card",n),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:a}),i&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i})]}),d&&e.jsx("button",{onClick:d,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),f?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:f}),d&&e.jsx("button",{onClick:d,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):o?e.jsx(Ga,{}):c]})}function Ga(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((a,i)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},i))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((a,i)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},i))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((a,i)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},i))})]})})}const $={currency:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a),currencyDetailed:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a),percent:(a,i=1)=>`${(a??0).toFixed(i)}%`,hours:(a,i=1)=>`${(a??0).toFixed(i)}h`,dateShort:a=>{const i=typeof a=="string"?new Date(Number(String(a).slice(0,4)),Number(String(a).slice(5,7))-1,Number(String(a).slice(8,10))):a;return L(i,"MMM d")},dateFull:a=>{const i=typeof a=="string"?new Date(Number(String(a).slice(0,4)),Number(String(a).slice(5,7))-1,Number(String(a).slice(8,10))):a;return L(i,"MMM dd, yyyy")},currencyCompact:a=>{const i=Math.abs(a);return i>=1e6?`$${(a/1e6).toFixed(1)}M`:i>=1e3?`$${(a/1e3).toFixed(1)}k`:$.currency(a)}},F={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},P={cartesianGrid:{strokeDasharray:"3 3",stroke:F.gridStroke},xAxis:{stroke:F.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:F.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${F.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:F.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:F.textSecondary}}},Xe=(a,i=new Date)=>{const n=new Date(i);switch(a){case"today":return{start:L(n,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Today"};case"wtd":const c=new Date(n);return c.setDate(n.getDate()-n.getDay()),{start:L(c,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const o=new Date(n.getFullYear(),n.getMonth(),1);return{start:L(o,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const f=new Date(n);return f.setDate(n.getDate()-6),{start:L(f,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const d=new Date(n);return d.setDate(n.getDate()-29),{start:L(d,"yyyy-MM-dd"),end:L(n,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},Ka=ie("/smg")({component:Ya});function Ya(){const[a,i]=_.useState(null),[n,c]=_.useState(),{toast:o}=se(),f=Ce(),d=Me({resolver:Oe(Ua),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});_.useEffect(()=>{let h=!0;return(async()=>{var W;const{data:N}=await w.auth.getUser(),U=(W=N.user)==null?void 0:W.id;if(!U)return;const{data:I,error:z}=await w.from("users").select("store_id").eq("id",U).maybeSingle();h&&(z||i((I==null?void 0:I.store_id)??null))})(),()=>{h=!1}},[]);const{data:g=[],isLoading:x,error:b}=J({queryKey:["smg_daily",a],queryFn:async()=>{if(!a)return[];const{data:h,error:N}=await w.from("smg_daily").select("*").eq("store_id",a).order("date",{ascending:!1});if(N)throw N;return h||[]},enabled:!!a}),{data:m=[]}=J({queryKey:["smg_entries_import",a],queryFn:async()=>{if(!a)return[];const{data:h,error:N}=await w.from("smg_entries").select("*").eq("store_id",a).order("entry_date",{ascending:!1});if(N)throw N;return h||[]},enabled:!!a}),r=_.useMemo(()=>g.length>0?g:m.length?m.map(h=>({id:h.id,date:h.entry_date,accuracy_decimal:Number(h.accuracy_of_order)||0,zod_per_10k:Number(h.zone_of_defection)||0,cc_complaints:Number(h.customer_computers)||0,osat_decimal:Number(h.osat)||0,notes:"",created_at:h.created_at})):[],[g,m]),u=X({mutationFn:async h=>{if(!a)throw new Error("Store not connected");const{error:N}=await w.from("smg_daily").insert({store_id:a,date:h.date,accuracy_decimal:h.accuracy_decimal,zod_per_10k:h.zod_per_10k,cc_complaints:h.cc_complaints,osat_decimal:h.osat_decimal,notes:h.notes||null});if(N)throw N},onSuccess:()=>{f.invalidateQueries({queryKey:["smg_daily",a]}),d.reset(),c(void 0),o({title:"Success",description:"SMG entry saved successfully."})},onError:h=>{o({title:"Error",description:h.message||"Failed to save SMG entry.",variant:"destructive"})}}),R=h=>{u.mutate(h)},v=h=>{const N=Number(h.slice(0,4)),U=Number(h.slice(5,7)),I=Number(h.slice(8,10));return new Date(N,(U||1)-1,I||1)},M=[{key:"date",label:"Date",sortable:!0,render:h=>L(v(h),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:h=>e.jsx("div",{className:"max-w-32 truncate",title:h,children:h||"-"})}],j=_.useMemo(()=>r.length?r.slice().reverse().map(h=>({date:$.dateShort(h.date),osat:h.osat_decimal})):[],[r]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),b&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",b.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:d.handleSubmit(R),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"date",children:"Date *"}),e.jsxs(Ge,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(T,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),n?L(n,"MMM dd, yyyy"):"Select date"]})}),e.jsx(Fe,{className:"w-auto p-0",align:"start",children:e.jsx(De,{mode:"single",selected:n,onSelect:h=>{c(h),h&&d.setValue("date",L(h,"yyyy-MM-dd"))},initialFocus:!0})})]}),d.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(C,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("accuracy_decimal",{valueAsNumber:!0})}),d.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(C,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("zod_per_10k",{valueAsNumber:!0})}),d.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(C,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("cc_complaints",{valueAsNumber:!0})}),d.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(C,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("osat_decimal",{valueAsNumber:!0})}),d.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(E,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...d.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(T,{type:"submit",disabled:u.isPending||!a,className:"bg-wendys-red hover:bg-wendys-red/90",children:u.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(we,{title:"OSAT Score Trend",subtitle:`${r.length} entries`,loading:x,error:b==null?void 0:b.message,children:j.length>0?e.jsx(he,{width:"100%",height:300,children:e.jsxs(Ie,{data:j,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:h=>h.toFixed(1)}),e.jsx(je,{...P.tooltip,formatter:h=>[h.toFixed(2),"OSAT Score"]}),e.jsx(Ee,{type:"monotone",dataKey:"osat",stroke:F.sales,strokeWidth:3,dot:{fill:F.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:x?"Loading...":`${r.length} entries`})]}),a?e.jsx(Ha,{columns:M,data:r,loading:x,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const yt=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
`,_t=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'COMPLETED', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,Ba=ie("/setup")({component:Qa});function bt(a){navigator.clipboard.writeText(a)}function Qa(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase → Auth → Providers → Email: enable. Then Auth → Users → Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase → SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(T,{onClick:()=>bt(yt),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:yt})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(T,{onClick:()=>bt(_t),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:_t})]})]})}function oe({title:a,value:i,format:n,delta:c,deltaLabel:o,icon:f,trend:d,suffix:g,sparklineData:x,className:b}){const m=R=>{switch(n){case"currency":return ne(R);case"percentage":return Q(R);case"number":return R.toLocaleString();default:return R.toString()}},r=()=>{switch(d){case"up":return e.jsx(ge,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(Se,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(Ws,{className:"h-4 w-4 text-gray-400"})}},u=()=>{switch(d){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:S("wendys-card",b),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:a}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(f,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[m(i),g&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:g})]}),x&&x.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsx(Ie,{data:x,children:e.jsx(Ee,{type:"monotone",dataKey:"value",stroke:d==="up"?F.positive:d==="down"?F.waste:F.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),c!==void 0&&o&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[r(),e.jsxs("span",{className:S("text-sm font-medium",u()),children:[c>0?"+":"",Math.abs(c)<1&&n!=="percentage"?Q(Math.abs(c)*100):m(Math.abs(c)),g&&n!=="percentage"&&e.jsx("span",{className:"ml-1",children:g})]}),e.jsx("span",{className:"text-xs text-gray-500",children:o})]})]})})})}function Ja({data:a=[]}){const i=_.useMemo(()=>{if(!a.length){const n=[];for(let c=13;c>=0;c--){const o=new Date;o.setDate(o.getDate()-c),n.push({date:$.dateShort(o.toISOString().slice(0,10)),sales:0})}return n}return a.sort((n,c)=>new Date(n.business_date).getTime()-new Date(c.business_date).getTime()).slice(-30).map(n=>({date:$.dateShort(n.business_date),sales:n.net_sales||0}))},[a]);return e.jsx(he,{width:"100%",height:300,children:e.jsxs(Ie,{data:i,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:n=>$.currencyCompact(n)}),e.jsx(je,{...P.tooltip,formatter:n=>[$.currencyDetailed(n),"Net Sales"]}),e.jsx(Ee,{type:"monotone",dataKey:"sales",stroke:F.sales,strokeWidth:3,dot:{fill:F.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.salesSecondary,strokeWidth:2}})]})})}function Xa({data:a=[]}){console.log("🔍 LaborVsIdealChart received data:",a.slice(0,3));const i=_.useMemo(()=>{if(!a.length){const c=[];for(let o=6;o>=0;o--){const f=new Date;f.setDate(f.getDate()-o),c.push({date:$.dateShort(f.toISOString().slice(0,10)),ideal:0,actual:0})}return c}const n=a.sort((c,o)=>new Date(c.business_date).getTime()-new Date(o.business_date).getTime()).slice(-30).map(c=>{const o=Number(c.ideal_labor_hours)||0,f=Number(c.labor_hours)||0;return console.log("🔍 Processing entry:",c.business_date,"ideal:",c.ideal_labor_hours,"=>",o,"actual:",c.labor_hours,"=>",f),{date:$.dateShort(c.business_date),ideal:o,actual:f}});return console.log("🔍 Processed chart data:",n.slice(0,3)),n},[a]);return console.log("🔍 Final chartData being rendered:",i.slice(0,3)),e.jsx(he,{width:"100%",height:300,children:e.jsxs(Qt,{data:i,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:n=>$.hours(n)}),e.jsx(je,{...P.tooltip,formatter:(n,c)=>[$.hours(n),c==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(Hs,{...P.legend}),e.jsx(Jt,{dataKey:"ideal",fill:F.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(Ee,{type:"monotone",dataKey:"actual",stroke:F.labor,strokeWidth:3,dot:{fill:F.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:F.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function Za(){const[a,i]=_.useState(null);_.useEffect(()=>{let m=!0;return(async()=>{var u;const{data:r}=await w.from("users").select("store_id").eq("id",(u=(await w.auth.getUser()).data.user)==null?void 0:u.id).single();m&&i((r==null?void 0:r.store_id)??null)})(),()=>{m=!1}},[]);const{data:n=[],isLoading:c}=J({queryKey:["smg_snapshot",a],queryFn:async()=>{if(!a)return[];const m=new Date;m.setDate(m.getDate()-30);const{data:r,error:u}=await w.from("smg_daily").select("*").eq("store_id",a).gte("date",m.toISOString().split("T")[0]).order("date",{ascending:!1});if(u)throw u;return r||[]},enabled:!!a}),o=n.length>0?{accuracy:n.reduce((m,r)=>m+r.accuracy_decimal,0)/n.length,zod:n.reduce((m,r)=>m+r.zod_per_10k,0)/n.length,complaints:n.reduce((m,r)=>m+r.cc_complaints,0)/n.length,osat:n.reduce((m,r)=>m+r.osat_decimal,0)/n.length}:{accuracy:0,zod:0,complaints:0,osat:0},f=m=>{if(m.length<4)return"neutral";const r=Math.floor(m.length/2),u=m.slice(0,r).reduce((M,j)=>M+j,0)/r,v=m.slice(r).reduce((M,j)=>M+j,0)/(m.length-r)-u;return Math.abs(v)<.1?"neutral":v>0?"up":"down"},d={accuracy:f(n.map(m=>m.accuracy_decimal).reverse()),zod:f(n.map(m=>m.zod_per_10k).reverse()),complaints:f(n.map(m=>m.cc_complaints).reverse()),osat:f(n.map(m=>m.osat_decimal).reverse())},g=(m,r=!1)=>r?m<=1?"text-green-600":m<=3?"text-yellow-600":"text-red-600":m>=90?"text-green-600":m>=80?"text-yellow-600":"text-red-600",x=(m,r=!1)=>r?m<=1?e.jsx(qe,{className:"h-4 w-4 text-green-600"}):m<=3?e.jsx(ye,{className:"h-4 w-4 text-yellow-600"}):e.jsx(ye,{className:"h-4 w-4 text-red-600"}):m>=90?e.jsx(qe,{className:"h-4 w-4 text-green-600"}):m>=80?e.jsx(ye,{className:"h-4 w-4 text-yellow-600"}):e.jsx(ye,{className:"h-4 w-4 text-red-600"}),b=m=>{switch(m){case"up":return e.jsx(ge,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(Se,{className:"h-3 w-3 text-red-600"});default:return null}};return c?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((m,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},r))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(de,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[n.length," entries"]})]})]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(de,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b(d.osat),x(o.osat),e.jsx("span",{className:S("text-xl font-bold",g(o.osat)),children:o.osat.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qe,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b(d.accuracy),x(o.accuracy),e.jsx("span",{className:S("text-xl font-bold",g(o.accuracy)),children:o.accuracy.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b(d.zod==="up"?"down":d.zod==="down"?"up":"neutral"),x(o.zod,!0),e.jsx("span",{className:S("text-xl font-bold",g(o.zod,!0)),children:o.zod.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b(d.complaints==="up"?"down":d.complaints==="down"?"up":"neutral"),x(o.complaints,!0),e.jsx("span",{className:S("text-xl font-bold",g(o.complaints,!0)),children:o.complaints.toFixed(1)})]})]})]})]})}function er(){const[a,i]=_.useState(null),n=L(new Date,"EEEE, MMMM d"),c=L(new Date,"yyyy-MM-dd");_.useEffect(()=>{let g=!0;return(async()=>{var R;console.log("🔐 [InterviewsToday] Checking user authentication...");const{data:x,error:b}=await w.auth.getUser();console.log("👤 [InterviewsToday] Auth data:",x,"Auth error:",b);const m=(R=x.user)==null?void 0:R.id;if(!m){console.log("❌ [InterviewsToday] No user ID found - user not authenticated");return}console.log("🔍 [InterviewsToday] Looking up store for user:",m);const{data:r,error:u}=await w.from("users").select("store_id").eq("id",m).maybeSingle();if(console.log("🏪 [InterviewsToday] Store lookup result - data:",r,"error:",u),!!g){if(u){console.error("❌ [InterviewsToday] Store lookup error:",u);return}i((r==null?void 0:r.store_id)??null),console.log("✅ [InterviewsToday] Store ID set to:",(r==null?void 0:r.store_id)??null)}})(),()=>{g=!1}},[]);const{data:o=[],isLoading:f}=J({queryKey:["interviews-today",a,c],queryFn:async()=>{if(!a)return[];const{data:g,error:x}=await w.from("interviews").select("*").eq("store_id",a).eq("interview_date",c).order("interview_time",{ascending:!0});if(x)throw x;return g||[]},enabled:!!a}),d=g=>L(new Date(`2000-01-01T${g}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:n})]})]}),f?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Wt,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:o.map(g=>e.jsx(We,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:g.candidate_name}),e.jsx("span",{className:tr("px-2 py-1 text-xs font-medium rounded-full",ns(g.status)),children:g.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(rt,{className:"h-3 w-3"}),e.jsx("span",{children:g.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(nt,{className:"h-3 w-3"}),e.jsx("span",{children:d(g.interview_time)})]})]}),g.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',g.notes,'"']})]})})},g.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(We,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"→"})]})})]})}function tr(...a){return a.filter(Boolean).join(" ")}const Nt=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function it({selectedRange:a="last30",selectedDate:i,onRangeChange:n,onDateChange:c,onClearFilters:o,className:f,compact:d=!1}){const g=a!=="last30"||i,x=m=>{n==null||n(m),m!=="custom"&&(c==null||c(void 0))},b=()=>{if(a==="custom"&&i)return L(i,"MMM dd, yyyy");const m=Nt.find(r=>r.key===a);return(m==null?void 0:m.label)||"Last 30"};return e.jsxs("div",{className:S("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",d&&"p-3",f),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx($s,{className:"h-4 w-4"}),e.jsx("span",{className:S("text-sm font-medium",d&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Nt.map(m=>e.jsx(T,{variant:a===m.key?"default":"ghost",size:"sm",onClick:()=>x(m.key),className:S("text-xs h-7 px-2",a===m.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",d&&"text-[11px] h-6 px-1.5"),title:m.description,children:m.label},m.key))}),a==="custom"&&e.jsxs(Ge,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:S("justify-start text-left font-normal h-7",!i&&"text-muted-foreground",d&&"h-6 text-xs"),children:[e.jsx(te,{className:"mr-1 h-3 w-3"}),i?L(i,"MMM dd"):"Pick date"]})}),e.jsx(Fe,{className:"w-auto p-0",align:"start",children:e.jsx(De,{mode:"single",selected:i,onSelect:c,initialFocus:!0})})]}),!d&&g&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:b()})]}),g&&o&&e.jsxs(T,{variant:"ghost",size:"sm",onClick:o,className:S("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",d&&"h-6 px-1.5"),children:[e.jsx(Rt,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function ot(a,i="last30"){const[n,c]=xe.useState(()=>typeof window<"u"&&localStorage.getItem(`${a}_range`)||i),[o,f]=xe.useState(()=>{if(typeof window<"u"){const m=localStorage.getItem(`${a}_date`);if(m){const[r,u,R]=m.split("-").map(Number);return new Date(r,(u||1)-1,R||1)}return}}),d=xe.useCallback(m=>{c(m),typeof window<"u"&&localStorage.setItem(`${a}_range`,m)},[a]),g=xe.useCallback(m=>{if(f(m),typeof window<"u")if(m){const r=L(m,"yyyy-MM-dd");localStorage.setItem(`${a}_date`,r)}else localStorage.removeItem(`${a}_date`)},[a]),x=xe.useCallback(()=>{c(i),f(void 0),typeof window<"u"&&(localStorage.removeItem(`${a}_range`),localStorage.removeItem(`${a}_date`))},[a,i]),b=xe.useCallback(()=>{if(n==="custom"&&o){const m=L(o,"yyyy-MM-dd");return{start:m,end:m}}if(n&&n!=="custom"){const m=Xe(n);return m.start?{start:m.start,end:m.end}:null}return null},[n,o]);return{selectedRange:n,selectedDate:o,handleRangeChange:d,handleDateChange:g,clearFilters:x,getDateRangeFilter:b,getSelectedLabel:()=>n==="custom"&&o?L(o,"MMM dd, yyyy"):Xe(n).label}}const sr=ie("/overview")({component:ar});function ar(){const[a,i]=_.useState(null),n=ot("overview","today");_.useEffect(()=>{let b=!0;return(async()=>{var v;const{data:m}=await w.auth.getUser(),r=(v=m.user)==null?void 0:v.id;if(!r)return;const{data:u,error:R}=await w.from("users").select("store_id").eq("id",r).maybeSingle();if(b){if(R){console.error("Error fetching store ID:",R);return}i((u==null?void 0:u.store_id)??null)}})(),()=>{b=!1}},[]);const c=n.getDateRangeFilter(),{data:o=[]}=J({queryKey:["overview-charts",a],queryFn:async()=>{if(!a)return[];const b=new Date;b.setDate(b.getDate()-30);const m=b.toISOString().slice(0,10),{data:r,error:u}=await w.from("omega_daily").select("*").eq("store_id",a).gte("business_date",m).order("business_date",{ascending:!0});if(u)throw u;return r||[]},enabled:!!a}),{data:f=[],isLoading:d,error:g}=J({queryKey:["overview-omega",a,c==null?void 0:c.start,c==null?void 0:c.end],queryFn:async()=>{if(!a)return[];let b=w.from("omega_daily").select("*").eq("store_id",a);c&&(b=b.gte("business_date",c.start).lte("business_date",c.end));const{data:m,error:r}=await b.order("business_date",{ascending:!0});if(r)throw r;return m||[]},enabled:!!a}),x=_.useMemo(()=>{if(f.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const b=f.reduce((R,v)=>({netSales:R.netSales+(v.net_sales||0),compNetSales:R.compNetSales+((v.net_sales||0)-(v.last_year_sales||0)),laborHours:R.laborHours+(v.labor_hours||0),idealLaborHours:R.idealLaborHours+(v.ideal_labor_hours||0),foodVarianceCost:R.foodVarianceCost+(v.food_variance_cost||0),wasteAmount:R.wasteAmount+(v.waste_amount||0),breakfastSales:R.breakfastSales+(v.breakfast_sales||0),nightSales:R.nightSales+(v.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),m=b.netSales>0?b.laborHours/b.netSales*100:0,r=b.netSales>0?b.foodVarianceCost/b.netSales*100:0,u=b.netSales>0?b.wasteAmount/b.netSales*100:0;return{...b,laborPercentage:m,foodVariancePercentage:r,wastePercentage:u}},[f]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",n.getSelectedLabel(),d&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),g&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",g.message]})]}),e.jsx(it,{selectedRange:n.selectedRange,selectedDate:n.selectedDate,onRangeChange:n.handleRangeChange,onDateChange:n.handleDateChange,onClearFilters:n.clearFilters,compact:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(oe,{title:"Net Sales",value:x.netSales,format:"currency",delta:x.compNetSales,deltaLabel:"vs Last Year",icon:Ye,trend:x.compNetSales>=0?"up":"down"}),e.jsx(oe,{title:"Labor Hours",value:x.laborHours,format:"number",delta:x.laborHours-x.idealLaborHours,deltaLabel:"vs Ideal",icon:nt,trend:x.laborHours>x.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(oe,{title:"Labor %",value:x.laborPercentage,format:"percentage",icon:ge,trend:"neutral"}),e.jsx(oe,{title:"Food Variance",value:x.foodVarianceCost,format:"currency",delta:x.foodVariancePercentage,deltaLabel:"% of Sales",icon:Se,trend:x.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(oe,{title:"Waste Amount",value:x.wasteAmount,format:"currency",delta:x.wastePercentage,deltaLabel:"% of Sales",icon:Se,trend:x.wasteAmount>=0?"down":"up"}),e.jsx(oe,{title:"Breakfast Sales",value:x.breakfastSales,format:"currency",icon:Ye,trend:"neutral"}),e.jsx(oe,{title:"Night Sales",value:x.nightSales,format:"currency",icon:Ye,trend:"neutral"}),e.jsx(oe,{title:"Comp Net Sales",value:x.compNetSales,format:"currency",icon:ge,trend:x.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(we,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!o.length&&!g,error:g==null?void 0:g.message,children:o.length>0?e.jsx(Ja,{data:o}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(we,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!o.length&&!g,error:g==null?void 0:g.message,children:o.length>0?e.jsx(Xa,{data:o}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Za,{}),e.jsx(er,{})]})]})}function rr({columns:a,data:i,mobileCardRender:n,className:c,emptyMessage:o="No data available",loading:f=!1}){if(f)return e.jsx(nr,{columns:a});const d=g=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:a.map(x=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[x.label,":"]}),e.jsx("span",{className:"text-sm",children:x.render?x.render(g[x.key],g):g[x.key]})]},x.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:S("hidden md:block",c),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:a.map(g=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:g.label},g.key))})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"py-8 px-4 text-center text-gray-500",children:o})}):i.map((g,x)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:a.map(b=>e.jsx("td",{className:S("py-3 px-4 text-sm",b.className),children:b.render?b.render(g[b.key],g):g[b.key]},b.key))},g.id||x))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:i.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:o}):i.map((g,x)=>e.jsx("div",{children:n?n(g):d(g)},g.id||x))})})]})}function nr({columns:a}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:a.map(i=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},i.key))})}),e.jsx("tbody",{children:[...Array(3)].map((i,n)=>e.jsx("tr",{className:"border-b border-gray-100",children:a.map(c=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},c.key))},n))})]})})})}const ir=ie("/omega-daily")({component:or});function or(){const[a,i]=_.useState(!1),[n,c]=_.useState(null),{toast:o}=se(),f=Ce(),[d,g]=_.useState(null),x=ot("omega-daily","last30"),b=async()=>{if(!d){o({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const t=[],l=new Date;for(let p=9;p>=0;p--){const D=new Date(l);D.setDate(D.getDate()-p),t.push({store_id:d,business_date:L(D,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:s}=await w.from("omega_daily").insert(t);if(s)throw s;o({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),f.invalidateQueries({queryKey:["omega_daily","last30",d]})}catch(t){o({title:"Error adding sample data",description:t.message,variant:"destructive"})}},m=()=>{f.invalidateQueries({queryKey:["omega_daily",d]}),o({title:"Refreshing data...",description:"Reloading your OMEGA entries."})},r=Me({resolver:Oe(Fa),defaultValues:{business_date:L(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),u=X({onMutate:async t=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");await f.cancelQueries({queryKey:["omega_daily"]});const l=`temp-${Date.now()}`,s={id:l,store_id:d,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales},p=[],D=f.getQueriesData({queryKey:["omega_daily"]});for(const[q,Z]of D){const B=q;if(!B.includes(d))continue;let K=!0;const lt=typeof B[2]=="string"?String(B[2]):void 0,dt=typeof B[3]=="string"?String(B[3]):void 0;if(lt&&dt&&(K=t.business_date>=lt&&t.business_date<=dt),!K)continue;const ct=[s,...Z||[]];ct.sort((mt,ut)=>mt.business_date>ut.business_date?-1:mt.business_date<ut.business_date?1:0),p.push({queryKey:q,previousData:Z}),f.setQueryData(q,ct)}return{optimisticId:l,touchedCaches:p}},mutationFn:async t=>{if(console.log("🔄 Starting insertMutation with payload:",t),console.log("🏪 Store ID:",d),!d)throw console.error("❌ No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const l={store_id:d,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales};console.log("📤 Inserting data:",l);const{data:s,error:p}=await w.from("omega_daily").insert(l).select();if(console.log("📥 Supabase response - data:",s,"error:",p),p)throw console.error("❌ Supabase error:",p),p;return console.log("✅ Insert successful:",s),s},onError:(t,l,s)=>{if(s!=null&&s.touchedCaches)for(const{queryKey:p,previousData:D}of s.touchedCaches)f.setQueryData(p,D||[]);console.error("💥 Insert mutation failed (rolled back):",t),o({title:"Save failed",description:(t==null?void 0:t.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(t,l,s)=>{console.log("🎉 Insert mutation succeeded with data:",t),o({title:"Success!",description:"Daily metrics saved successfully."});const p=Array.isArray(t)&&t[0]?t[0]:void 0;if(p&&(s!=null&&s.touchedCaches)&&s.optimisticId)for(const{queryKey:D}of s.touchedCaches){const Z=(f.getQueryData(D)??[]).map(B=>B.id===s.optimisticId?p:B);f.setQueryData(D,Z)}i(!1),c(null),r.reset()}}),R=X({mutationFn:async({id:t,payload:l})=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const{error:s}=await w.from("omega_daily").update({business_date:l.business_date,net_sales:l.net_sales,last_year_sales:l.last_year_sales,labor_hours:l.labor_hours,ideal_labor_hours:l.ideal_labor_hours,labor_percentage:l.labor_percentage,food_variance_cost:l.food_variance_cost,waste_amount:l.waste_amount,breakfast_sales:l.breakfast_sales,night_sales:l.night_sales}).eq("id",t);if(s)throw s},onSuccess:()=>{o({title:"Updated!",description:"Daily metrics updated successfully."}),i(!1),c(null),r.reset(),f.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:t=>{o({title:"Update failed",description:t.message,variant:"destructive"})}}),v=t=>{console.log("🚀 onSubmit called with data:",t),console.log("📋 Form errors:",r.formState.errors),console.log("🏪 Store ID:",d),console.log("✏️ Editing entry:",n),console.log("🔄 Insert mutation pending:",u.isPending),console.log("🔄 Update mutation pending:",R.isPending),n?(console.log("📝 Calling updateMutation..."),R.mutate({id:n.id,payload:t})):(console.log("➕ Calling insertMutation..."),u.mutate(t))},M=t=>{console.error("❌ Form validation failed with errors:",t),o({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},j=X({mutationFn:async t=>{const{error:l}=await w.from("omega_daily").delete().eq("id",t);if(l)throw l},onSuccess:()=>{o({title:"Deleted",description:"Daily metrics entry removed."}),f.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:t=>{o({title:"Delete failed",description:t.message,variant:"destructive"})}});_.useEffect(()=>{let t=!0;return(async()=>{var Z;console.log("🔐 Checking user authentication...");const{data:l,error:s}=await w.auth.getUser();console.log("👤 Auth data:",l,"Auth error:",s);const p=(Z=l.user)==null?void 0:Z.id;if(!p){console.log("❌ No user ID found - user not authenticated");return}console.log("🔍 Looking up store for user:",p);const{data:D,error:q}=await w.from("users").select("store_id").eq("id",p).maybeSingle();if(console.log("🏪 Store lookup result - data:",D,"error:",q),!!t){if(q){console.error("❌ Store lookup error:",q),o({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}g((D==null?void 0:D.store_id)??null),console.log("✅ Store ID set to:",(D==null?void 0:D.store_id)??null),D!=null&&D.store_id||(console.log("⚠️ No store linked to user account"),o({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{t=!1}},[]);const h=x.getDateRangeFilter(),{data:N=[],isLoading:U,error:I}=J({queryKey:["omega_daily",d,h==null?void 0:h.start,h==null?void 0:h.end],queryFn:async()=>{if(!d)return[];let t=w.from("omega_daily").select("*").eq("store_id",d);h&&(t=t.gte("business_date",h.start).lte("business_date",h.end));const{data:l,error:s}=await t.order("business_date",{ascending:!1}).limit(100);if(s)throw s;return l},enabled:!!d}),{data:z=[]}=J({queryKey:["omega_daily_charts",d],queryFn:async()=>{if(!d)return[];const t=new Date;t.setDate(t.getDate()-30);const l=L(t,"yyyy-MM-dd"),{data:s,error:p}=await w.from("omega_daily").select("*").eq("store_id",d).gte("business_date",l).order("business_date",{ascending:!0});if(p)throw p;return s},enabled:!!d}),{data:W=[]}=J({queryKey:["omega_daily_mtd",d],queryFn:async()=>{if(!d)return[];const{start:t,end:l}=Xe("mtd"),{data:s,error:p}=await w.from("omega_daily").select("*").eq("store_id",d).gte("business_date",t).lte("business_date",l).order("business_date",{ascending:!0});if(p)throw p;return s},enabled:!!d}),y=t=>{if(!t)return;x.handleRangeChange("custom");const l=Number(t.slice(0,4)),s=Number(t.slice(5,7)),p=Number(t.slice(8,10));x.handleDateChange(new Date(l,(s||1)-1,p||1))},k=_.useMemo(()=>z.length?z.map(t=>({date:$.dateShort(t.business_date),dateFull:$.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),comp_net_sales_percentage:t.last_year_sales?(t.net_sales-t.last_year_sales)/t.last_year_sales*100:0})):[],[z]),H=_.useMemo(()=>z.length?z.map(t=>({date:$.dateShort(t.business_date),dateFull:$.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),waste_percentage:t.net_sales?t.waste_amount/t.net_sales*100:0,food_variance_percentage:t.net_sales?-(t.food_variance_cost/t.net_sales)*100:0})):[],[z]),G=t=>{c(t);const l={business_date:t.business_date||L(new Date,"yyyy-MM-dd"),net_sales:t.net_sales!=null?Number(t.net_sales):0,last_year_sales:t.last_year_sales!=null?Number(t.last_year_sales):0,labor_hours:t.labor_hours!=null?Number(t.labor_hours):0,ideal_labor_hours:t.ideal_labor_hours!=null?Number(t.ideal_labor_hours):0,labor_percentage:t.labor_percentage!=null?Number(t.labor_percentage):0,food_variance_cost:t.food_variance_cost!=null?Number(t.food_variance_cost):0,waste_amount:t.waste_amount!=null?Number(t.waste_amount):0,breakfast_sales:t.breakfast_sales!=null?Number(t.breakfast_sales):0,night_sales:t.night_sales!=null?Number(t.night_sales):0};r.reset(l),i(!0)},Y=t=>{j.mutate(t)},A=r.watch(),pe=A.last_year_sales>0?(A.net_sales-A.last_year_sales)/A.last_year_sales*100:0,me=A.labor_hours-A.ideal_labor_hours,Ue=A.net_sales>0?A.food_variance_cost/A.net_sales*100:0,ue=A.net_sales>0?A.waste_amount/A.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(T,{onClick:()=>{c(null),r.reset({business_date:L(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),i(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),d&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(T,{onClick:b,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(T,{onClick:m,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const t=W.reduce((D,q)=>D+(Number(q.net_sales)||0),0),l=W.length>0?W.reduce((D,q)=>D+(Number(q.labor_percentage)||0),0)/W.length:0,s=W.reduce((D,q)=>D+(Number(q.waste_amount)||0),0),p=t>0?s/t*100:0;return e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:ne(t)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:Q(l)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:Q(p)})]})]})})()}),e.jsx(it,{selectedRange:x.selectedRange,selectedDate:x.selectedDate,onRangeChange:x.handleRangeChange,onDateChange:x.handleDateChange,onClearFilters:x.clearFilters}),I&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",I.message]}),e.jsxs("div",{className:"grid-auto",children:[e.jsx(we,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!z.length&&!I,error:I==null?void 0:I.message,children:k.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:k,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(je,{...P.tooltip,formatter:t=>[$.percent(t,1),"Comp Sales %"],labelFormatter:(t,l)=>{var s;return l&&l[0]&&((s=l[0].payload)==null?void 0:s.dateFull)||t}}),e.jsx(Ee,{type:"monotone",dataKey:"comp_net_sales_percentage",stroke:F.sales,strokeWidth:2,dot:{fill:F.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:F.salesSecondary,strokeWidth:2},onClick:t=>{var l;return y((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(we,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!z.length&&!I,error:I==null?void 0:I.message,children:H.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Qt,{data:H,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(je,{...P.tooltip,formatter:t=>[$.percent(t,2),"Waste %"],labelFormatter:(t,l)=>{var s;return l&&l[0]&&((s=l[0].payload)==null?void 0:s.dateFull)||t}}),e.jsx(ht,{y:.5,stroke:F.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:F.textSecondary,fontSize:12}}),e.jsx(Jt,{dataKey:"waste_percentage",fill:F.waste,opacity:.7,onClick:t=>{var l;return y((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(we,{title:"Food Variance",subtitle:"Last 30 days",loading:!z.length&&!I,error:I==null?void 0:I.message,children:H.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:H,children:[e.jsx(be,{...P.cartesianGrid}),e.jsx(Ne,{dataKey:"date",...P.xAxis}),e.jsx(ve,{...P.yAxis,tickFormatter:t=>$.percent(t)}),e.jsx(je,{...P.tooltip,formatter:(t,l,s)=>{var D;const p=((D=s==null?void 0:s.payload)==null?void 0:D.food_variance_percentage)!==void 0?-s.payload.food_variance_percentage:0;return[$.percent(p,2),"Food Variance %"]},labelFormatter:(t,l)=>{var s;return l&&l[0]&&((s=l[0].payload)==null?void 0:s.dateFull)||t}}),e.jsx(ht,{y:0,stroke:F.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:F.textSecondary,fontSize:12}}),e.jsx(Ee,{type:"monotone",dataKey:"food_variance_percentage",stroke:F.foodVariance,strokeWidth:2,dot:{fill:F.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:F.warning,strokeWidth:2},onClick:t=>{var l;return y((l=t==null?void 0:t.payload)==null?void 0:l.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:x.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[U?"Loading...":`${N.length} entries`,x.selectedRange!=="last30"&&` for ${x.getSelectedLabel()}`,(x.selectedRange!=="last30"||x.selectedDate)&&e.jsx(T,{variant:"ghost",size:"sm",onClick:x.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(N==null?void 0:N.length)===0&&!U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:d?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:x.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),d&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(T,{onClick:()=>i(!0),className:"wendys-button",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(T,{onClick:b,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx(rr,{columns:[{key:"business_date",label:"Date",render:t=>le(t)},{key:"net_sales",label:"Net Sales",render:t=>ne(t)},{key:"comp_sales",label:"Comp Sales",render:(t,l)=>{const s=(l.net_sales??0)-(l.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${s>=0?"text-green-600":"text-red-600"}`,children:[s>=0?e.jsx(ge,{className:"h-3 w-3 mr-1"}):e.jsx(Se,{className:"h-3 w-3 mr-1"}),ne(Math.abs(s))]})}},{key:"labor_hours",label:"Labor Hours",render:t=>`${t}h`},{key:"labor_percentage",label:"Labor %",render:t=>Q(t)},{key:"food_variance",label:"Food Variance",render:(t,l)=>{const s=l.net_sales?l.food_variance_cost/l.net_sales*100:0;return Q(s)}},{key:"waste",label:"Waste",render:(t,l)=>{const s=l.net_sales?l.waste_amount/l.net_sales*100:0;return Q(s)}},{key:"actions",label:"Actions",render:(t,l)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>G(l),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>{y(l.business_date),o({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Yt,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>Y(l.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})}],data:N,mobileCardRender:t=>{const l=(t.net_sales??0)-(t.last_year_sales??0),s=t.net_sales?t.food_variance_cost/t.net_sales*100:0,p=t.net_sales?t.waste_amount/t.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:le(t.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>G(t),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>Y(t.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:ne(t.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${l>=0?"text-green-600":"text-red-600"}`,children:[l>=0?e.jsx(ge,{className:"h-3 w-3 mr-1"}):e.jsx(Se,{className:"h-3 w-3 mr-1"}),ne(Math.abs(l))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[t.labor_hours,"h (",Q(t.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:Q(s)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:Q(p)})]})]})]})},emptyMessage:"No entries found",loading:U})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:n?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(T,{variant:"ghost",onClick:()=>{i(!1),c(null),r.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:r.handleSubmit(v,M),className:"space-y-4",children:[Object.keys(r.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(r.formState.errors).map(([t,l])=>e.jsxs("li",{children:["• ",l==null?void 0:l.message]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(E,{children:"Business Date"}),e.jsxs(Ge,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),r.watch("business_date")?le(r.watch("business_date")):"Pick a date"]})}),e.jsx(Fe,{className:"w-auto p-0",children:e.jsx(De,{mode:"single",selected:(()=>{const t=r.watch("business_date");if(!t)return;const l=Number(t.slice(0,4)),s=Number(t.slice(5,7)),p=Number(t.slice(8,10));return new Date(l,(s||1)-1,p||1)})(),onSelect:t=>{const l=t?L(t,"yyyy-MM-dd"):"";if(r.setValue("business_date",l),l){const s=N.find(p=>p.business_date===l);s?(c(s),r.reset({business_date:s.business_date,net_sales:s.net_sales!=null?Number(s.net_sales):0,last_year_sales:s.last_year_sales!=null?Number(s.last_year_sales):0,labor_hours:s.labor_hours!=null?Number(s.labor_hours):0,ideal_labor_hours:s.ideal_labor_hours!=null?Number(s.ideal_labor_hours):0,labor_percentage:s.labor_percentage!=null?Number(s.labor_percentage):0,food_variance_cost:s.food_variance_cost!=null?Number(s.food_variance_cost):0,waste_amount:s.waste_amount!=null?Number(s.waste_amount):0,breakfast_sales:s.breakfast_sales!=null?Number(s.breakfast_sales):0,night_sales:s.night_sales!=null?Number(s.night_sales):0}),o({title:"Loaded existing entry",description:`Loaded data for ${le(s.business_date)} to edit.`})):(c(null),r.reset({business_date:l,net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}))}},initialFocus:!0})})]}),r.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(C,{id:"net_sales",type:"number",step:"0.01",...r.register("net_sales")}),r.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(C,{id:"last_year_sales",type:"number",step:"0.01",...r.register("last_year_sales")}),r.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(C,{id:"comp_net_sales",value:Q(pe),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(C,{id:"labor_hours",type:"number",step:"0.1",...r.register("labor_hours")}),r.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(C,{id:"ideal_labor_hours",type:"number",step:"0.1",...r.register("ideal_labor_hours")}),r.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(C,{id:"labor_hours_diff",value:`${me>=0?"+":""}${me.toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(C,{id:"labor_percentage",type:"number",step:"0.1",...r.register("labor_percentage")}),r.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(C,{id:"food_variance_cost",type:"number",step:"0.01",...r.register("food_variance_cost")}),r.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(C,{id:"food_variance_percentage",value:Q(Ue),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(C,{id:"waste_amount",type:"number",step:"0.01",...r.register("waste_amount")}),r.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(C,{id:"waste_percentage",value:Q(ue),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(C,{id:"breakfast_sales",type:"number",step:"0.01",...r.register("breakfast_sales")}),r.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(C,{id:"night_sales",type:"number",step:"0.01",...r.register("night_sales")}),r.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.night_sales.message})]})]}),!d&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn’t linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>{i(!1),c(null),r.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(T,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:u.isPending||R.isPending||!d,children:n?"Update Entry":"Save Entry"})]})]})]})})]})}const lr=ie("/weekending-sheet")({component:dr});function dr(){const[a,i]=_.useState(!1),[n,c]=_.useState(null),[o,f]=_.useState(!1),{toast:d}=se(),g=Ce(),[x,b]=_.useState(null),m=()=>{const k=Ys(new Date,{weekStartsOn:6});return L(Bs(k,{weekStartsOn:6}),"yyyy-MM-dd")},r=Me({resolver:Oe(qa),defaultValues:{week_ending_date:m(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}}),u=X({mutationFn:async y=>{if(!x)throw new Error("No store is linked to your account. See Setup to link one.");const k={store_id:x,...y},{data:H,error:G}=await w.from("weekending_sheet").insert(k).select();if(G)throw G;return H},onSuccess:()=>{d({title:"Success!",description:"Weekending sheet saved successfully."}),i(!1),c(null),r.reset({week_ending_date:m(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}),g.invalidateQueries({queryKey:["weekending_sheet",x]})},onError:y=>{d({title:"Save failed",description:(y==null?void 0:y.message)||"Unable to save entry.",variant:"destructive"})}}),R=X({mutationFn:async({id:y,payload:k})=>{if(!x)throw new Error("No store is linked to your account. See Setup to link one.");const{error:H}=await w.from("weekending_sheet").update({...k}).eq("id",y);if(H)throw H},onSuccess:()=>{d({title:"Updated!",description:"Weekending sheet updated successfully."}),i(!1),c(null),r.reset(),g.invalidateQueries({queryKey:["weekending_sheet",x]})},onError:y=>{d({title:"Update failed",description:y.message,variant:"destructive"})}}),v=X({mutationFn:async y=>{const{error:k}=await w.from("weekending_sheet").delete().eq("id",y);if(k)throw k},onSuccess:()=>{d({title:"Deleted",description:"Weekending sheet entry removed."}),g.invalidateQueries({queryKey:["weekending_sheet",x]})},onError:y=>{d({title:"Delete failed",description:y.message,variant:"destructive"})}}),M=y=>{n?R.mutate({id:n.id,payload:y}):u.mutate(y)},j=y=>{console.error("Form validation failed:",y),d({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})};_.useEffect(()=>{let y=!0;return(async()=>{var Y;const{data:k}=await w.auth.getUser(),H=(Y=k.user)==null?void 0:Y.id;if(!H)return;const{data:G}=await w.from("users").select("store_id").eq("id",H).maybeSingle();y&&b((G==null?void 0:G.store_id)??null)})(),()=>{y=!1}},[]);const{data:h=[],isLoading:N,error:U}=J({queryKey:["weekending_sheet",x],queryFn:async()=>{if(!x)return[];const{data:y,error:k}=await w.from("weekending_sheet").select("*").eq("store_id",x).order("week_ending_date",{ascending:!1}).limit(100);if(k)throw k;return y},enabled:!!x}),I=y=>{c(y),r.reset({week_ending_date:y.week_ending_date,manager_name:y.manager_name,breakfast_sales:y.breakfast_sales||0,late_night_sales:y.late_night_sales||0,net_sales:y.net_sales||0,discounts:y.discounts||0,cash:y.cash||0,food_total:y.food_total||0,food_cost:y.food_cost||0,variance_dollars:y.variance_dollars||0,food_variance_percentage:y.food_variance_percentage||0,labor:y.labor||0,credit_hours:y.credit_hours||0,reason:y.reason||"",onboarding:y.onboarding||!1,crew_food_safety_quiz:y.crew_food_safety_quiz||0,mgr_food_safety_quiz:y.mgr_food_safety_quiz||0,new_hire_name:y.new_hire_name||"",terminations:y.terminations||"",term_date:y.term_date||""}),i(!0)},z=y=>{confirm("Are you sure you want to delete this entry?")&&v.mutate(y)},W=()=>{if(h.length===0){d({title:"No data",description:"No entries to export.",variant:"destructive"});return}const k=[["Week Ending Date","Manager","Breakfast Sales","Late Night Sales","Net Sales","Discounts","Cash","Food Total","Food Cost","Variance Dollars","Food Variance %","Labor","Credit Hours","Reason","Onboarding","Crew Food Safety Quiz","MGR Food Safety Quiz","New Hire Name","Terminations","Term Date"].join(","),...h.map(A=>[A.week_ending_date,A.manager_name,A.breakfast_sales,A.late_night_sales,A.net_sales,A.discounts,A.cash,A.food_total,A.food_cost,A.variance_dollars,A.food_variance_percentage,A.labor,A.credit_hours,A.reason||"",A.onboarding?"Yes":"No",A.crew_food_safety_quiz,A.mgr_food_safety_quiz,A.new_hire_name||"",A.terminations||"",A.term_date||""].join(","))].join(`
`),H=new Blob([k],{type:"text/csv"}),G=window.URL.createObjectURL(H),Y=document.createElement("a");Y.href=G,Y.download=`weekending-sheet-${L(new Date,"yyyy-MM-dd")}.csv`,Y.click(),window.URL.revokeObjectURL(G),d({title:"Exported!",description:"CSV file downloaded successfully."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Weekending Sheet"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Weekly operational data and metrics tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(T,{onClick:()=>{c(null),r.reset({week_ending_date:m(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_total:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",onboarding:!1,crew_food_safety_quiz:0,mgr_food_safety_quiz:0,new_hire_name:"",terminations:"",term_date:""}),i(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Add Weekending Entry"]}),h.length>0&&e.jsxs(T,{onClick:W,variant:"outline",size:"sm",className:"w-full md:w-auto border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Total Entries"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Latest Week"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length>0?le(h[0].week_ending_date):"N/A"})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Avg Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length>0?ne(h.reduce((y,k)=>y+(k.net_sales||0),0)/h.length):"$0"})]})]})}),U&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",U.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Weekending Entries"}),e.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:N?"Loading...":`${h.length} entries`})]}),(h==null?void 0:h.length)===0&&!N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:x?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:"You haven't added any weekending entries yet."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),x&&e.jsxs(T,{onClick:()=>i(!0),className:"wendys-button",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Week Ending"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Manager"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Sales"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Food Variance"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Labor"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:le(y.week_ending_date)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:y.manager_name}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:ne(y.net_sales)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:Q(y.food_variance_percentage)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:ne(y.labor)}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>I(y),className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>z(y.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})})]},y.id))})]})})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:n?"Edit Weekending Entry":"Add Weekending Entry"}),e.jsx(T,{variant:"ghost",onClick:()=>{i(!1),c(null),r.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:r.handleSubmit(M,j),className:"space-y-6",children:[Object.keys(r.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(r.formState.errors).map(([y,k])=>e.jsxs("li",{children:["• ",k==null?void 0:k.message]},y))})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"form-section-title",children:[e.jsx(st,{className:"mr-2"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(E,{children:"Week Ending Date"}),e.jsxs(Ge,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),r.watch("week_ending_date")?le(r.watch("week_ending_date")):"Pick a date"]})}),e.jsx(Fe,{className:"w-auto p-0",children:e.jsx(De,{mode:"single",selected:(()=>{const y=r.watch("week_ending_date");if(!y)return;const k=Number(y.slice(0,4)),H=Number(y.slice(5,7)),G=Number(y.slice(8,10));return new Date(k,(H||1)-1,G||1)})(),onSelect:y=>{const k=y?L(y,"yyyy-MM-dd"):"";r.setValue("week_ending_date",k)},initialFocus:!0})})]}),r.formState.errors.week_ending_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.week_ending_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"manager_name",children:"Manager Name"}),e.jsxs("select",{id:"manager_name",...r.register("manager_name"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",children:[e.jsx("option",{value:"Scott",children:"Scott"}),e.jsx("option",{value:"Sophear",children:"Sophear"}),e.jsx("option",{value:"Letoya",children:"Letoya"}),e.jsx("option",{value:"Carissa",children:"Carissa"})]}),r.formState.errors.manager_name&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.manager_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"reason",children:"Reason"}),e.jsx(C,{id:"reason",placeholder:"Optional notes or reason",...r.register("reason")}),r.formState.errors.reason&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.reason.message})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("h3",{className:"form-section-title",children:[e.jsx(Ks,{className:"mr-2"}),"Sales & Financial Data"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"breakfast_sales",children:"Breakfast Sales (DP1) ($)"}),e.jsx(C,{id:"breakfast_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("breakfast_sales")}),r.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"late_night_sales",children:"Late Night Sales (DP6) ($)"}),e.jsx(C,{id:"late_night_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("late_night_sales")}),r.formState.errors.late_night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.late_night_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(C,{id:"net_sales",type:"number",step:"0.01",placeholder:"0.00",...r.register("net_sales")}),r.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"discounts",children:"Discounts ($)"}),e.jsx(C,{id:"discounts",type:"number",step:"0.01",placeholder:"0.00",...r.register("discounts")}),r.formState.errors.discounts&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.discounts.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"cash",children:"Cash ($)"}),e.jsx(C,{id:"cash",type:"number",step:"0.01",placeholder:"0.00",...r.register("cash")}),r.formState.errors.cash&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.cash.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_total",children:"Food Total ($)"}),e.jsx(C,{id:"food_total",type:"number",step:"0.01",placeholder:"0.00",...r.register("food_total")}),r.formState.errors.food_total&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_total.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_cost",children:"Food Cost ($)"}),e.jsx(C,{id:"food_cost",type:"number",step:"0.01",placeholder:"0.00",...r.register("food_cost")}),r.formState.errors.food_cost&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"variance_dollars",children:"Variance Dollars ($)"}),e.jsx(C,{id:"variance_dollars",type:"number",step:"0.01",placeholder:"0.00",...r.register("variance_dollars")}),r.formState.errors.variance_dollars&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.variance_dollars.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(C,{id:"food_variance_percentage",type:"number",step:"0.1",placeholder:"0.0",...r.register("food_variance_percentage")}),r.formState.errors.food_variance_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.food_variance_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"labor",children:"Labor ($)"}),e.jsx(C,{id:"labor",type:"number",step:"0.01",placeholder:"0.00",...r.register("labor")}),r.formState.errors.labor&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.labor.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"credit_hours",children:"Credit Hours"}),e.jsx(C,{id:"credit_hours",type:"number",step:"0.1",placeholder:"0.0",...r.register("credit_hours")}),r.formState.errors.credit_hours&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.credit_hours.message})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("button",{type:"button",onClick:()=>f(!o),className:"form-section-title w-full text-left flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Lt,{className:"mr-2"}),"WeLearn & Training"]}),o?e.jsx(at,{className:"h-5 w-5"}):e.jsx($e,{className:"h-5 w-5"})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"md:col-span-2 space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"onboarding",type:"checkbox",...r.register("onboarding"),className:"h-4 w-4 text-wendys-red focus:ring-wendys-red border-gray-300 rounded"}),e.jsx(E,{htmlFor:"onboarding",children:"Onboarding Completed"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"crew_food_safety_quiz",children:"Crew Food Safety Quiz Score"}),e.jsx(C,{id:"crew_food_safety_quiz",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0-100",...r.register("crew_food_safety_quiz")}),r.formState.errors.crew_food_safety_quiz&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.crew_food_safety_quiz.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"mgr_food_safety_quiz",children:"MGR Food Safety Quiz Score"}),e.jsx(C,{id:"mgr_food_safety_quiz",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0-100",...r.register("mgr_food_safety_quiz")}),r.formState.errors.mgr_food_safety_quiz&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.mgr_food_safety_quiz.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"new_hire_name",children:"New Hire Name"}),e.jsx(C,{id:"new_hire_name",placeholder:"Optional",...r.register("new_hire_name")}),r.formState.errors.new_hire_name&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.new_hire_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"terminations",children:"Terminations"}),e.jsx(C,{id:"terminations",placeholder:"Optional",...r.register("terminations")}),r.formState.errors.terminations&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.terminations.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"term_date",children:"Termination Date"}),e.jsx(C,{id:"term_date",type:"date",...r.register("term_date")}),r.formState.errors.term_date&&e.jsx("p",{className:"text-sm text-red-600",children:r.formState.errors.term_date.message})]})]})]}),!x&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn't linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>{i(!1),c(null),r.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(T,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:u.isPending||R.isPending||!x,children:n?"Update Entry":"Save Entry"})]})]})]})})]})}const He=_.forwardRef(({className:a,...i},n)=>e.jsx("textarea",{className:S("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:n,...i}));He.displayName="Textarea";const cr=ie("/calendar")({component:mr});function mr(){var ue,t,l;const[a,i]=_.useState(!1),[n,c]=_.useState(!1),[o,f]=_.useState(null),[d,g]=_.useState(null),[x,b]=_.useState(new Date),[m,r]=_.useState("month"),{toast:u}=se(),R=Ce(),[v,M]=_.useState(null);_.useEffect(()=>{(async()=>{const{data:{user:p}}=await w.auth.getUser();M((p==null?void 0:p.id)||null)})()},[]);const{data:j=[]}=J({queryKey:["calendar-events",v],queryFn:async()=>{if(!v)return[];const{data:s,error:p}=await w.from("calendar_events").select("*").eq("created_by",v).order("start_date",{ascending:!0});if(p)throw p;return s||[]},enabled:!!v}),{data:h=[]}=J({queryKey:["calendar-reminders",v],queryFn:async()=>{if(!v)return[];const{data:s,error:p}=await w.from("calendar_reminders").select("*").eq("created_by",v).order("due_date",{ascending:!0});if(p)throw p;return s||[]},enabled:!!v}),N=X({mutationFn:async s=>{if(!v)throw new Error("User not authenticated");if(o){const{error:p}=await w.from("calendar_events").update({...s,updated_at:new Date().toISOString()}).eq("id",o.id);if(p)throw p}else{const{error:p}=await w.from("calendar_events").insert({...s,created_by:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(p)throw p}},onSuccess:()=>{u({title:o?"Event updated!":"Event created!",description:o?"Your event has been updated successfully.":"Your event has been created successfully."}),i(!1),f(null),R.invalidateQueries({queryKey:["calendar-events",v]})},onError:s=>{u({title:"Error",description:s.message||"Failed to save event",variant:"destructive"})}}),U=X({mutationFn:async s=>{if(!v)throw new Error("User not authenticated");if(d){const{error:p}=await w.from("calendar_reminders").update({...s,updated_at:new Date().toISOString()}).eq("id",d.id);if(p)throw p}else{const{error:p}=await w.from("calendar_reminders").insert({...s,created_by:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(p)throw p}},onSuccess:()=>{u({title:d?"Reminder updated!":"Reminder created!",description:d?"Your reminder has been updated successfully.":"Your reminder has been created successfully."}),c(!1),g(null),R.invalidateQueries({queryKey:["calendar-reminders",v]})},onError:s=>{u({title:"Error",description:s.message||"Failed to save reminder",variant:"destructive"})}}),I=X({mutationFn:async s=>{const{error:p}=await w.from("calendar_events").delete().eq("id",s);if(p)throw p},onSuccess:()=>{u({title:"Event deleted",description:"Event has been removed successfully."}),R.invalidateQueries({queryKey:["calendar-events",v]})},onError:s=>{u({title:"Delete failed",description:s.message,variant:"destructive"})}}),z=X({mutationFn:async s=>{const{error:p}=await w.from("calendar_reminders").delete().eq("id",s);if(p)throw p},onSuccess:()=>{u({title:"Reminder deleted",description:"Reminder has been removed successfully."}),R.invalidateQueries({queryKey:["calendar-reminders",v]})},onError:s=>{u({title:"Delete failed",description:s.message,variant:"destructive"})}}),W=X({mutationFn:async({id:s,completed:p})=>{const{error:D}=await w.from("calendar_reminders").update({completed:p,updated_at:new Date().toISOString()}).eq("id",s);if(D)throw D},onSuccess:()=>{R.invalidateQueries({queryKey:["calendar-reminders",v]})},onError:s=>{u({title:"Error",description:s.message,variant:"destructive"})}}),y=j.filter(s=>Le(_e(s.start_date),x)),k=h.filter(s=>Le(_e(s.due_date),x)),H=Qs({start:Js(x),end:Xs(x)}),G=s=>j.filter(p=>Le(_e(p.start_date),s)),Y=s=>h.filter(p=>Le(_e(p.due_date),s)),A=s=>{s&&b(s)},pe=s=>{f(s||null),i(!0)},me=s=>{g(s||null),c(!0)},Ue=s=>{switch(s){case"high":return e.jsx(de,{className:"h-3 w-3 fill-red-500 text-red-500"});case"medium":return e.jsx(de,{className:"h-3 w-3 fill-yellow-500 text-yellow-500"});case"low":return e.jsx(de,{className:"h-3 w-3 fill-green-500 text-green-500"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-wendys-red via-red-600 to-wendys-dark-red opacity-10"}),e.jsx("div",{className:"relative px-6 py-8 sm:px-8 lg:px-12",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold bg-gradient-to-r from-wendys-charcoal to-gray-700 bg-clip-text text-transparent",children:"Calendar"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl",children:"Organize your schedule with beautiful events and smart reminders"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(T,{onClick:()=>pe(),className:"wendys-button shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(fe,{className:"h-5 w-5 mr-2"}),"Add Event"]}),e.jsxs(T,{onClick:()=>me(),variant:"outline",className:"border-2 border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(gt,{className:"h-5 w-5 mr-2"}),"Add Reminder"]})]})]})})})]}),e.jsx("div",{className:"px-6 sm:px-8 lg:px-12 pb-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex bg-white rounded-xl p-1 shadow-lg border border-gray-200",children:["month","week","day"].map(s=>e.jsx(T,{variant:m===s?"default":"ghost",onClick:()=>r(s),size:"sm",className:`rounded-lg px-6 py-2 font-medium transition-all duration-200 ${m===s?"wendys-button shadow-md":"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:e.jsx(De,{mode:"single",selected:x,onSelect:A,className:"rounded-xl border-0",classNames:{day_selected:"bg-wendys-red text-white hover:bg-wendys-dark-red focus:bg-wendys-dark-red",day_today:"bg-wendys-red/10 text-wendys-red font-bold",day:"h-12 w-12 text-center text-sm p-0 font-normal aria-selected:opacity-100 hover:bg-gray-100 rounded-lg transition-colors duration-200",head_cell:"text-gray-500 font-semibold text-sm uppercase tracking-wide pb-4",nav_button:"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100 rounded-lg transition-colors duration-200",nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",caption:"relative px-8 py-4 text-center text-xl font-semibold text-wendys-charcoal",caption_label:"text-xl font-semibold text-wendys-charcoal",table:"w-full border-collapse space-y-1",head_row:"flex",row:"flex w-full mt-2",cell:"h-12 w-12 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20"}})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-wendys-red to-wendys-dark-red rounded-full mb-4",children:e.jsx(te,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal",children:L(x,"EEEE")}),e.jsx("p",{className:"text-lg text-gray-600",children:L(x,"MMMM d, yyyy")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),"Events (",y.length,")"]}),y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No events scheduled"})]}):e.jsx("div",{className:"space-y-3",children:y.map(s=>e.jsx("div",{className:"group bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-blue-900 text-lg",children:s.title}),s.description&&e.jsx("p",{className:"text-sm text-blue-700 mt-2 leading-relaxed",children:s.description}),e.jsxs("div",{className:"flex items-center text-xs text-blue-600 mt-3 space-x-4",children:[e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx(nt,{className:"h-3 w-3 mr-1"}),L(_e(s.start_date),"h:mm a")]}),s.location&&e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx(rt,{className:"h-3 w-3 mr-1"}),s.location]})]})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>pe(s),className:"h-8 w-8 p-0 hover:bg-blue-200",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>I.mutate(s.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},s.id))})]}),e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-3"}),"Reminders (",k.length,")"]}),k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(gt,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No reminders due"})]}):e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsx("div",{className:`group border rounded-xl p-4 transition-all duration-200 hover:shadow-md ${s.completed?"bg-gray-50 border-gray-200":s.priority==="high"?"bg-gradient-to-r from-red-50 to-red-100 border-red-200":s.priority==="medium"?"bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-200":"bg-gradient-to-r from-green-50 to-green-100 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>W.mutate({id:s.id,completed:!s.completed}),className:"flex-shrink-0",children:s.completed?e.jsx(qe,{className:"h-5 w-5 text-green-600"}):e.jsx(qt,{className:"h-5 w-5 text-gray-400 hover:text-gray-600 transition-colors duration-200"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Ue(s.priority),e.jsx("h5",{className:`font-semibold text-lg ${s.completed?"text-gray-500 line-through":"text-gray-900"}`,children:s.title})]})]}),s.description&&e.jsx("p",{className:`text-sm mt-2 leading-relaxed ${s.completed?"text-gray-500":"text-gray-700"}`,children:s.description}),e.jsx("div",{className:"flex items-center mt-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.priority==="high"?"bg-red-100 text-red-800":s.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[s.priority.charAt(0).toUpperCase()+s.priority.slice(1)," Priority"]})})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>me(s),className:"h-8 w-8 p-0 hover:bg-gray-200",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>z.mutate(s.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},s.id))})]})]})})]}),m==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal mb-6 text-center",children:L(x,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-500 py-3 px-2",children:s},s)),H.map((s,p)=>{const D=G(s),q=Y(s),Z=Zs(s),B=Le(s,x),re=ea(s,x);return e.jsxs("div",{className:`min-h-[100px] p-2 border border-gray-200 cursor-pointer transition-all duration-200 rounded-lg ${re?"bg-white hover:bg-gray-50":"bg-gray-50 text-gray-400"} ${Z?"bg-gradient-to-br from-wendys-red/20 to-wendys-dark-red/20 border-wendys-red/30 shadow-md":""} ${B?"bg-blue-50 border-blue-300 shadow-md":""}`,onClick:()=>b(s),children:[e.jsx("div",{className:`text-sm font-semibold mb-2 ${Z?"text-wendys-red":re?"text-gray-900":"text-gray-400"}`,children:L(s,"d")}),D.slice(0,2).map(K=>e.jsx("div",{className:"text-xs bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded-full mb-1 truncate shadow-sm",title:K.title,children:K.title},K.id)),q.slice(0,2).map(K=>e.jsx("div",{className:`text-xs px-2 py-1 rounded-full mb-1 truncate shadow-sm ${K.completed?"bg-gray-400 text-white":K.priority==="high"?"bg-gradient-to-r from-red-500 to-red-600 text-white":K.priority==="medium"?"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white":"bg-gradient-to-r from-green-500 to-green-600 text-white"}`,title:K.title,children:K.title},K.id)),D.length+q.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 text-center bg-gray-100 rounded-full py-1 mt-1",children:["+",D.length+q.length-4," more"]})]},p)})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:o?"Edit Event":"Add Event"}),e.jsx(T,{variant:"ghost",onClick:()=>{i(!1),f(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const p=new FormData(s.currentTarget),D={title:p.get("title"),description:p.get("description"),start_date:p.get("start_date"),end_date:p.get("end_date")||void 0,all_day:p.get("all_day")==="on",location:p.get("location"),reminder_type:p.get("reminder_type")};N.mutate(D)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"title",className:"text-sm font-semibold text-gray-700",children:"Event Title *"}),e.jsx(C,{id:"title",name:"title",defaultValue:o==null?void 0:o.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event title"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(He,{id:"description",name:"description",defaultValue:o==null?void 0:o.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"start_date",className:"text-sm font-semibold text-gray-700",children:"Start Date *"}),e.jsx(C,{id:"start_date",name:"start_date",type:"datetime-local",defaultValue:(ue=o==null?void 0:o.start_date)==null?void 0:ue.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"end_date",className:"text-sm font-semibold text-gray-700",children:"End Date"}),e.jsx(C,{id:"end_date",name:"end_date",type:"datetime-local",defaultValue:(t=o==null?void 0:o.end_date)==null?void 0:t.slice(0,16),className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{id:"all_day",name:"all_day",type:"checkbox",defaultChecked:o==null?void 0:o.all_day,className:"rounded border-gray-300 text-wendys-red focus:ring-wendys-red/20 h-4 w-4"}),e.jsx(E,{htmlFor:"all_day",className:"text-sm font-medium text-gray-700",children:"All day event"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"location",className:"text-sm font-semibold text-gray-700",children:"Location"}),e.jsx(C,{id:"location",name:"location",defaultValue:o==null?void 0:o.location,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter location"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_type",className:"text-sm font-semibold text-gray-700",children:"Reminder"}),e.jsxs("select",{id:"reminder_type",name:"reminder_type",defaultValue:(o==null?void 0:o.reminder_type)||"none",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"none",children:"No reminder"}),e.jsx("option",{value:"15min",children:"15 minutes before"}),e.jsx("option",{value:"1hour",children:"1 hour before"}),e.jsx("option",{value:"1day",children:"1 day before"}),e.jsx("option",{value:"1week",children:"1 week before"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>{i(!1),f(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(T,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:o?"Update Event":"Create Event"})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:d?"Edit Reminder":"Add Reminder"}),e.jsx(T,{variant:"ghost",onClick:()=>{c(!1),g(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const p=new FormData(s.currentTarget),D={title:p.get("title"),description:p.get("description"),due_date:p.get("due_date"),priority:p.get("priority"),completed:!1};U.mutate(D)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_title",className:"text-sm font-semibold text-gray-700",children:"Reminder Title *"}),e.jsx(C,{id:"reminder_title",name:"title",defaultValue:d==null?void 0:d.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder title"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(He,{id:"reminder_description",name:"description",defaultValue:d==null?void 0:d.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder description"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_due_date",className:"text-sm font-semibold text-gray-700",children:"Due Date *"}),e.jsx(C,{id:"reminder_due_date",name:"due_date",type:"datetime-local",defaultValue:(l=d==null?void 0:d.due_date)==null?void 0:l.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reminder_priority",className:"text-sm font-semibold text-gray-700",children:"Priority"}),e.jsxs("select",{id:"reminder_priority",name:"priority",defaultValue:(d==null?void 0:d.priority)||"medium",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>{c(!1),g(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(T,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:d?"Update Reminder":"Create Reminder"})]})]})]})})]})}const vt=ia,jt=oa,Ze=_.forwardRef(({className:a,children:i,...n},c)=>e.jsxs(Xt,{ref:c,className:S("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[i,e.jsx(ta,{asChild:!0,children:e.jsx($e,{className:"h-4 w-4 opacity-50"})})]}));Ze.displayName=Xt.displayName;const hs=_.forwardRef(({className:a,...i},n)=>e.jsx(Zt,{ref:n,className:S("flex cursor-default items-center justify-center py-1",a),...i,children:e.jsx(at,{className:"h-4 w-4"})}));hs.displayName=Zt.displayName;const gs=_.forwardRef(({className:a,...i},n)=>e.jsx(es,{ref:n,className:S("flex cursor-default items-center justify-center py-1",a),...i,children:e.jsx($e,{className:"h-4 w-4"})}));gs.displayName=es.displayName;const et=_.forwardRef(({className:a,children:i,position:n="popper",...c},o)=>e.jsx(sa,{children:e.jsxs(ts,{ref:o,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...c,children:[e.jsx(hs,{}),e.jsx(aa,{className:S("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(gs,{})]})}));et.displayName=ts.displayName;const ur=_.forwardRef(({className:a,...i},n)=>e.jsx(ss,{ref:n,className:S("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...i}));ur.displayName=ss.displayName;const ee=_.forwardRef(({className:a,children:i,...n},c)=>e.jsxs(as,{ref:c,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ra,{children:e.jsx(Ut,{className:"h-4 w-4"})})}),e.jsx(na,{children:i})]}));ee.displayName=as.displayName;const xr=_.forwardRef(({className:a,...i},n)=>e.jsx(rs,{ref:n,className:S("-mx-1 my-1 h-px bg-muted",a),...i}));xr.displayName=rs.displayName;const hr=ie("/interviews")({component:gr});function gr(){const[a,i]=_.useState(null),[n,c]=_.useState(null),[o,f]=_.useState([]),[d,g]=_.useState(!1),[x,b]=_.useState(null),[m,r]=_.useState(""),[u,R]=_.useState("ALL"),[v,M]=_.useState(!1),{toast:j}=se(),h=Ce(),[N,U]=_.useState({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""});_.useEffect(()=>{(async()=>{try{const{data:{user:l}}=await w.auth.getUser();if(!l)return;c(l.id);const{data:s}=await w.from("users").select("store_id").eq("id",l.id).single();s!=null&&s.store_id&&(i(s.store_id),W(s.store_id),z(s.store_id))}catch(l){console.error("Error getting store ID:",l)}})()},[]);const I=async()=>{try{console.log("🔧 Starting database enum migration..."),console.log("Step 1: Updating DONE to COMPLETED...");const{error:t}=await w.from("interviews").update({status:"COMPLETED"}).eq("status","DONE");t?console.log("Update error (may be expected if no DONE values exist):",t.message):console.log("✅ Updated existing DONE values to COMPLETED"),console.log("Step 2: Attempting enum recreation via RPC..."),console.log("⚠️  Manual migration required!"),console.log("Please run this SQL in your Supabase SQL Editor:"),console.log(`
-- Migration SQL to run in Supabase Dashboard:
DROP TYPE IF EXISTS interview_status CASCADE;
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Then recreate the interviews table if it was dropped:
-- (Copy the CREATE TABLE statement from schema.sql)
      `),j({title:"Migration Instructions",description:"Check console for SQL commands to run in Supabase Dashboard",variant:"default"})}catch(t){console.error("Migration error:",t),j({title:"Migration Error",description:"See console for details",variant:"destructive"})}},z=async t=>{try{console.log("🔍 Checking database enum values...");const{data:l,error:s}=await w.rpc("get_enum_values",{enum_name:"interview_status"});if(s){console.log("Could not get enum values via RPC, trying direct query...");const p=["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"];for(const D of p)try{console.log(`Testing status: "${D}"`);const{error:q}=await w.from("interviews").insert([{store_id:t,candidate_name:`TEST_${D}`,interview_date:new Date().toISOString().split("T")[0],interview_time:"12:00:00",status:D,position:"Test Position"}]).select();q?console.log(`❌ Status "${D}" rejected:`,q.message):(console.log(`✅ Status "${D}" accepted`),await w.from("interviews").delete().eq("candidate_name",`TEST_${D}`))}catch(q){console.log(`❌ Status "${D}" failed:`,q)}}else console.log("✅ Database enum values:",l)}catch(l){console.error("Error checking database enum values:",l)}},W=async t=>{try{M(!0);const{data:l,error:s}=await w.from("interviews").select("*").eq("store_id",t).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(s)throw s;f(l||[])}catch(l){console.error("Error fetching interviews:",l),j({title:"Error",description:"Failed to fetch interviews",variant:"destructive"})}finally{M(!1)}},y=(t,l)=>{U(s=>({...s,[t]:l}))},k=()=>{U({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""}),b(null)},H=async t=>{if(!n)return null;try{const{data:l,error:s}=await w.from("calendar_events").select("id").eq("created_by",n).ilike("title","Interview: %").ilike("description",`%interviewId: ${t}%`).single();return s&&s.code!=="PGRST116"?(console.error("Error finding calendar event:",s),null):l}catch(l){return console.error("Error in findCalendarEvent:",l),null}},G=async t=>{if(!n){console.warn("No user ID available for calendar event deletion");return}try{const l=await H(t);if(l){const{error:s}=await w.from("calendar_events").delete().eq("id",l.id);if(s)throw console.error("Error deleting calendar event:",s),s;console.log("Calendar event deleted successfully for interview:",t),h.invalidateQueries({queryKey:["calendar-events",n]}),h.refetchQueries({queryKey:["calendar-events",n]})}else console.log("No calendar event found to delete for interview:",t)}catch(l){throw console.error("Error in deleteCalendarEvent:",l),l}},Y=async(t,l=!1)=>{if(!n){console.warn("No user ID available for calendar event creation");return}try{if(t.status!=="SCHEDULED"){console.log("Interview status is not SCHEDULED, removing calendar event if it exists"),await G(t.id);return}if(!t.interview_date||!t.interview_time){console.warn("Invalid date or time for calendar event:",{date:t.interview_date,time:t.interview_time});return}const s=t.interview_time.includes(":")&&t.interview_time.split(":").length===2?`${t.interview_time}:00`:t.interview_time,p=`${t.interview_date}T${s}`,D=new Date(p);if(isNaN(D.getTime()))throw console.error("Invalid start date created:",p,"from:",{date:t.interview_date,time:t.interview_time,formattedTime:s}),new Error("Invalid interview date/time format");const q=new Date(D.getTime()+60*60*1e3);if(isNaN(q.getTime()))throw console.error("Invalid end date calculated from start date:",D),new Error("Invalid end date calculation");const Z=q.toISOString(),B={title:`Interview: ${t.candidate_name}`,description:`Interview for ${t.position||"position"}
${t.notes||""}
Phone: ${t.phone||"N/A"}
Email: ${t.email||"N/A"}
interviewId: ${t.id}`,start_date:p,end_date:Z,all_day:!1,location:"Store Interview Room",reminder_type:"15min",updated_at:new Date().toISOString()};if(l){const re=await H(t.id);if(re){const{error:K}=await w.from("calendar_events").update(B).eq("id",re.id);K?console.error("Error updating calendar event:",K):(console.log("Calendar event updated successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",n]}),h.refetchQueries({queryKey:["calendar-events",n]}))}else{const{error:K}=await w.from("calendar_events").insert([{...B,created_by:n}]);K?console.error("Error creating calendar event:",K):(console.log("Calendar event created successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",n]}),h.refetchQueries({queryKey:["calendar-events",n]}))}}else{const{error:re}=await w.from("calendar_events").insert([{...B,created_by:n}]);re?(console.error("Error creating calendar event:",re),j({title:"Warning",description:"Interview scheduled but calendar event creation failed.",variant:"destructive"})):(console.log("Calendar event created successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",n]}),h.refetchQueries({queryKey:["calendar-events",n]}))}}catch(s){throw console.error("Error in createOrUpdateCalendarEvent:",s),s}},A=async()=>{if(!n){j({title:"Error",description:"User not authenticated",variant:"destructive"});return}if(!a){j({title:"Error",description:"No store selected",variant:"destructive"});return}if(!N.candidate_name.trim()){j({title:"Error",description:"Candidate name is required",variant:"destructive"});return}if(!N.position.trim()){j({title:"Error",description:"Position is required",variant:"destructive"});return}if(!N.interview_date){j({title:"Error",description:"Interview date is required",variant:"destructive"});return}if(!N.interview_time){j({title:"Error",description:"Interview time is required",variant:"destructive"});return}console.log("Saving interview with data:",N),console.log("Interview date format:",typeof N.interview_date,N.interview_date),console.log("Interview time format:",typeof N.interview_time,N.interview_time);const t=N.interview_time.includes(":")&&N.interview_time.split(":").length===2?`${N.interview_time}:00`:N.interview_time;console.log("Formatted time for database:",t);try{if(x){const{data:l,error:s}=await w.from("interviews").update({candidate_name:N.candidate_name,phone:N.phone||null,email:N.email||null,position:N.position,interview_date:N.interview_date,interview_time:t,status:N.status,notes:N.notes||null}).eq("id",x.id).select().single();if(s)throw s;if(l)try{await Y(l,!0)}catch(p){console.warn("Calendar event update failed, but interview was saved:",p)}j({title:"Success!",description:N.status==="SCHEDULED"?"Interview updated and calendar synced!":"Interview updated and removed from calendar!"})}else{const{data:l,error:s}=await w.from("interviews").insert([{store_id:a,candidate_name:N.candidate_name,phone:N.phone||null,email:N.email||null,position:N.position,interview_date:N.interview_date,interview_time:t,status:N.status,notes:N.notes||null}]).select().single();if(s)throw s;if(l)try{await Y(l,!1)}catch(p){console.warn("Calendar event creation failed, but interview was saved:",p)}j({title:"Success!",description:N.status==="SCHEDULED"?"Interview scheduled and added to calendar!":"Interview saved successfully!"})}W(a),g(!1),k()}catch(l){console.error("Error saving interview:",l),console.error("Full error object:",JSON.stringify(l,null,2)),console.error("Error message:",l.message),console.error("Error details:",l.details),console.error("Error hint:",l.hint),console.error("Error code:",l.code);let s="Failed to save interview";l.message?s=l.message:l.details?s=`Database error: ${l.details}`:l.hint?s=`Hint: ${l.hint}`:l.code&&(s=`Error code: ${l.code}`),j({title:"Error",description:s,variant:"destructive"})}},pe=t=>{b(t),U({candidate_name:t.candidate_name,phone:t.phone||"",email:t.email||"",position:t.position||"",interview_date:t.interview_date,interview_time:t.interview_time,status:t.status,notes:t.notes||""}),g(!0)},me=async t=>{if(confirm("Are you sure you want to delete this interview?"))try{try{await G(t)}catch(s){console.warn("Calendar event deletion failed, but continuing with interview deletion:",s)}const{error:l}=await w.from("interviews").delete().eq("id",t);if(l)throw l;j({title:"Deleted!",description:"Interview and calendar event removed successfully."}),W(a)}catch(l){console.error("Error deleting interview:",l),j({title:"Error",description:l.message||"Failed to delete interview",variant:"destructive"})}},ue=o.filter(t=>{const l=t.candidate_name.toLowerCase().includes(m.toLowerCase())||(t.position||"").toLowerCase().includes(m.toLowerCase()),s=u==="ALL"||t.status===u;return l&&s}).reduce((t,l)=>{const s=l.interview_date;return t[s]||(t[s]=[]),t[s].push(l),t},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(T,{onClick:()=>g(!0),className:"wendys-button",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(C,{placeholder:"Search by name or position...",value:m,onChange:t=>r(t.target.value),className:"pl-10"})]})}),e.jsxs(vt,{value:u,onValueChange:R,children:[e.jsx(Ze,{className:"w-full sm:w-48",children:e.jsx(jt,{placeholder:"Filter by status"})}),e.jsxs(et,{children:[e.jsx(ee,{value:"ALL",children:"All Statuses"}),e.jsx(ee,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(ee,{value:"COMPLETED",children:"Completed"}),e.jsx(ee,{value:"NO_SHOW",children:"No Show"}),e.jsx(ee,{value:"HIRED",children:"Hired"}),e.jsx(ee,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[v&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!v&&Object.keys(ue).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(ue).map(([t,l])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),le(t)]}),e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:s.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ns(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{children:s.position||"No position specified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:fa(s.interview_time)})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(la,{className:"h-4 w-4"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsx("span",{children:s.email})]})]}),s.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx(st,{className:"h-4 w-4 inline mr-1"}),s.notes]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>pe(s),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>me(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})},s.id))})]},t))]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:x?"Edit Interview":"Schedule New Interview"}),e.jsx(T,{variant:"ghost",onClick:()=>{g(!1),k()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),A()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(C,{id:"candidate_name",value:N.candidate_name,onChange:t=>y("candidate_name",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"position",children:"Position"}),e.jsx(C,{id:"position",value:N.position,onChange:t=>y("position",t.target.value),placeholder:"e.g., Crew Member, Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"phone",children:"Phone"}),e.jsx(C,{id:"phone",type:"tel",value:N.phone,onChange:t=>y("phone",t.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"email",children:"Email"}),e.jsx(C,{id:"email",type:"email",value:N.email,onChange:t=>y("email",t.target.value),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(C,{id:"interview_date",type:"date",value:N.interview_date,onChange:t=>y("interview_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(C,{id:"interview_time",type:"time",value:N.interview_time,onChange:t=>y("interview_time",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"status",children:"Status *"}),e.jsxs(vt,{value:N.status,onValueChange:t=>y("status",t),children:[e.jsx(Ze,{id:"status",children:e.jsx(jt,{})}),e.jsxs(et,{children:[e.jsx(ee,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(ee,{value:"COMPLETED",children:"Completed"}),e.jsx(ee,{value:"NO_SHOW",children:"No Show"}),e.jsx(ee,{value:"HIRED",children:"Hired"}),e.jsx(ee,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"notes",children:"Notes"}),e.jsx(He,{id:"notes",value:N.notes,onChange:t=>y("notes",t.target.value),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>z(a),className:"text-xs",children:"Test Enum"}),e.jsx(T,{type:"button",variant:"outline",onClick:I,className:"text-xs",children:"Migrate DB"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>{g(!1),k()},children:"Cancel"}),e.jsx(T,{type:"submit",className:"wendys-button",children:x?"Update Interview":"Schedule Interview"})]})]})]})]})})]})}const fr=ce({sales_target:O.number().min(0),labor_target_pct:O.number().min(0),waste_target_pct:O.number().min(0),food_variance_target_pct:O.number().min(0),team_notes:V().optional()});function pr(){const{toast:a}=se(),i=Ce(),[n,c]=_.useState(null),o=ot("goals","wtd"),f=o.getDateRangeFilter(),d=(f==null?void 0:f.start)||L(new Date,"yyyy-MM-dd"),g=(f==null?void 0:f.end)||L(new Date,"yyyy-MM-dd"),x=o.selectedRange==="mtd"?"month":o.selectedRange==="wtd"?"week":"custom",b=Me({resolver:Oe(fr),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});_.useEffect(()=>{let j=!0;return(async()=>{var z;const{data:h}=await w.auth.getUser(),N=(z=h.user)==null?void 0:z.id;if(!N)return;const{data:U,error:I}=await w.from("users").select("store_id").eq("id",N).maybeSingle();j&&(I||c((U==null?void 0:U.store_id)??null))})(),()=>{j=!1}},[]);const{data:m}=J({queryKey:["goals_settings",n,d,g],queryFn:async()=>{if(!n)return null;try{const{data:j,error:h}=await w.from("goals").select("*").eq("store_id",n).eq("period_start",d).eq("period_end",g).maybeSingle();if(h&&h.code!=="PGRST116"){const N=String(h.code||""),U=String(h.message||"");if(N.startsWith("42")||U.toLowerCase().includes("relation")||U.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw h}return j||null}catch(j){const h=String((j==null?void 0:j.code)||""),N=String((j==null?void 0:j.message)||"");if(h.startsWith("42")||N.toLowerCase().includes("relation")||N.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw j}},enabled:!!n});_.useEffect(()=>{m&&b.reset({sales_target:m.sales_target,labor_target_pct:m.labor_target_pct,waste_target_pct:m.waste_target_pct,food_variance_target_pct:m.food_variance_target_pct,team_notes:m.team_notes||""})},[m]);const{data:r=[]}=J({queryKey:["omega_daily_for_goals",n,d,g],queryFn:async()=>{if(!n)return[];const{data:j,error:h}=await w.from("omega_daily").select("*").eq("store_id",n).gte("business_date",d).lte("business_date",g).order("business_date",{ascending:!0});if(h)throw h;return j},enabled:!!n}),u=_.useMemo(()=>{const j=r.reduce((W,y)=>W+(Number(y.net_sales)||0),0),h=r.length>0?r.reduce((W,y)=>W+(Number(y.labor_percentage)||0),0)/r.length:0,N=r.reduce((W,y)=>W+(Number(y.waste_amount)||0),0),U=r.reduce((W,y)=>W+(Number(y.food_variance_cost)||0),0),I=j>0?N/j*100:0,z=j>0?U/j*100:0;return{totalSales:j,avgLaborPct:h,wastePct:I,foodVarPct:z}},[r]),R=X({mutationFn:async j=>{if(!n)throw new Error("No store is linked to your account. See Setup to link one.");const h={store_id:n,scope:x,period_start:d,period_end:g,sales_target:j.sales_target,labor_target_pct:j.labor_target_pct,waste_target_pct:j.waste_target_pct,food_variance_target_pct:j.food_variance_target_pct,team_notes:j.team_notes||null},{error:N}=await w.from("goals").upsert(h,{onConflict:"store_id,period_start,period_end"});if(N){const U=String(N.code||""),I=String(N.message||"");throw U.startsWith("42")||I.toLowerCase().includes("relation")||I.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):N}},onSuccess:()=>{a({title:"Saved",description:"Goals saved for selected period."}),i.invalidateQueries({queryKey:["goals_settings",n,d,g]})},onError:j=>{a({title:"Save failed",description:j.message,variant:"destructive"})}}),v=()=>{b.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""})},M=(j,h)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${j?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Goal Setting"}),e.jsx("p",{className:"text-gray-600",children:"Set targets and track progress against Omega Daily actuals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",onClick:v,children:"Reset Goals"}),e.jsx(T,{className:"wendys-button",onClick:b.handleSubmit(j=>R.mutate(j)),disabled:!n||R.isPending,children:"Save Goals"})]})]}),e.jsx(it,{selectedRange:o.selectedRange,selectedDate:o.selectedDate,onRangeChange:o.handleRangeChange,onDateChange:o.handleDateChange,onClearFilters:o.clearFilters}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Sales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target"}),e.jsx(C,{type:"number",step:"0.01",...b.register("sales_target")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual"}),e.jsxs("p",{className:"text-xl font-semibold",children:["$",u.totalSales.toLocaleString()]})]})]}),e.jsx("div",{children:M(u.totalSales>=(b.watch("sales_target")||0),u.totalSales>=(b.watch("sales_target")||0)?"On Track":"Behind")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Labor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target %"}),e.jsx(C,{type:"number",step:"0.1",...b.register("labor_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[u.avgLaborPct.toFixed(1),"%"]})]})]}),e.jsx("div",{children:M(u.avgLaborPct<=(b.watch("labor_target_pct")||0),u.avgLaborPct<=(b.watch("labor_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Waste & Food"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Target %"}),e.jsx(C,{type:"number",step:"0.1",...b.register("waste_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[u.wastePct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:M(u.wastePct<=(b.watch("waste_target_pct")||0),u.wastePct<=(b.watch("waste_target_pct")||0)?"On Track":"High")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Target %"}),e.jsx(C,{type:"number",step:"0.1",...b.register("food_variance_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[u.foodVarPct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:M(u.foodVarPct<=(b.watch("food_variance_target_pct")||0),u.foodVarPct<=(b.watch("food_variance_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card md:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Team & Personal"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"team_notes",children:"Notes"}),e.jsx(C,{id:"team_notes",...b.register("team_notes"),placeholder:"Notes, personal goals, shout-outs..."})]})})]})]})]})}const yr=ie("/goals")({component:pr}),_r=ie("/")({beforeLoad:()=>{throw da({to:"/overview"})}}),br=Ka.update({id:"/smg",path:"/smg",getParentRoute:()=>ae}),Nr=Ba.update({id:"/setup",path:"/setup",getParentRoute:()=>ae}),vr=sr.update({id:"/overview",path:"/overview",getParentRoute:()=>ae}),jr=ir.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>ae}),wr=lr.update({id:"/weekending-sheet",path:"/weekending-sheet",getParentRoute:()=>ae}),Er=cr.update({id:"/calendar",path:"/calendar",getParentRoute:()=>ae}),Sr=hr.update({id:"/interviews",path:"/interviews",getParentRoute:()=>ae}),Tr=yr.update({id:"/goals",path:"/goals",getParentRoute:()=>ae}),Rr=_r.update({id:"/",path:"/",getParentRoute:()=>ae}),Cr={IndexRoute:Rr,CalendarRoute:Er,GoalsRoute:Tr,InterviewsRoute:Sr,OmegaDailyRoute:jr,WeekendingSheetRoute:wr,OverviewRoute:vr,SetupRoute:Nr,SmgRoute:br},Dr=ae._addFileChildren(Cr)._addFileTypes(),fs=new ca({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),Lr=ma({routeTree:Dr,context:{queryClient:fs},defaultPreload:"intent"});ua.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsxs(xa,{client:fs,children:[e.jsx(ha,{router:Lr}),e.jsx(Ea,{}),e.jsx(ga,{initialIsOpen:!1})]})}));
