import{t as Wt,c as $t,f as q,p as qe,r as v,j as e,V as Bs,R as Ys,a as Rs,A as Qs,C as Gs,X as Je,T as Js,D as Xs,P as Ht,b as Kt,S as Bt,u as Yt,B as Zs,d as ne,F as ms,e as ye,U as et,M as Qt,g as us,h as Ds,i as ps,W as Gt,k as Ye,L as xs,l as ke,m as st,n as Jt,o as tt,q as Xt,s as at,I as rt,v as nt,w as it,x as lt,y as ot,z as dt,E as ct,G as mt,H as Zt,J as ea,K as sa,N as ut,O as ta,Q as je,Y as H,Z as Y,_ as ts,$ as xt,a0 as aa,a1 as ra,a2 as ht,a3 as $e,a4 as He,a5 as gt,a6 as Se,a7 as ze,a8 as Ce,a9 as na,aa as ia,ab as la,ac as oa,ad as da,ae as ft,af as ca,ag as ma,ah as ge,ai as Ue,aj as ie,ak as se,al as _e,am as ua,an as Ae,ao as Ne,ap as xa,aq as yt,ar as ha,as as Oe,at as ga,au as be,av as Fe,aw as we,ax as fa,ay as he,az as pt,aA as Te,aB as Re,aC as De,aD as Le,aE as vt,aF as ks,aG as Ms,aH as bt,aI as Ls,aJ as _t,aK as ya,aL as Nt,aM as wt,aN as pa,aO as jt,aP as va,aQ as Et,aR as St,aS as ba,aT as _a,aU as kt,aV as Na,aW as wa,aX as hs,aY as ja,aZ as gs,a_ as Ea,a$ as Vs,b0 as Os,b1 as Ct,b2 as Tt,b3 as Qe,b4 as fe,b5 as As,b6 as We,b7 as as,b8 as Sa,b9 as ka,ba as Ca,bb as js,bc as rs,bd as Be,be as Ta,bf as Ra,bg as Da,bh as Fs,bi as La,bj as Aa,bk as Ia,bl as Ma,bm as Va,bn as Oa,bo as Fa,bp as Ua,bq as Pa}from"./vendor-Huh9Imhk.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const p of l)if(p.type==="childList")for(const d of p.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function a(l){const p={};return l.integrity&&(p.integrity=l.integrity),l.referrerPolicy&&(p.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?p.credentials="include":l.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(l){if(l.ep)return;l.ep=!0;const p=a(l);fetch(l.href,p)}})();function I(...s){return Wt($t(s))}function me(s){return s==null||isNaN(s)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function re(s,n=1){return s==null||isNaN(s)?"0%":`${s.toFixed(n)}%`}function oe(s){const n=typeof s=="string"?new Date(Number(s.slice(0,4)),Number(s.slice(5,7))-1,Number(s.slice(8,10))):s;return q(n,"MMM dd, yyyy")}function qa(s){return q(qe(`2000-01-01T${s}`),"h:mm a")}function Rt(s){switch(s.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const za=Ht,Dt=v.forwardRef(({className:s,...n},a)=>e.jsx(Bs,{ref:a,className:I("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...n}));Dt.displayName=Bs.displayName;const Wa=Rs("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Lt=v.forwardRef(({className:s,variant:n,...a},c)=>e.jsx(Ys,{ref:c,className:I(Wa({variant:n}),s),...a}));Lt.displayName=Ys.displayName;const $a=v.forwardRef(({className:s,...n},a)=>e.jsx(Qs,{ref:a,className:I("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...n}));$a.displayName=Qs.displayName;const At=v.forwardRef(({className:s,...n},a)=>e.jsx(Gs,{ref:a,className:I("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...n,children:e.jsx(Je,{className:"h-4 w-4"})}));At.displayName=Gs.displayName;const It=v.forwardRef(({className:s,...n},a)=>e.jsx(Js,{ref:a,className:I("text-sm font-semibold",s),...n}));It.displayName=Js.displayName;const Mt=v.forwardRef(({className:s,...n},a)=>e.jsx(Xs,{ref:a,className:I("text-sm opacity-90",s),...n}));Mt.displayName=Xs.displayName;const Ha=1,Ka=1e6;let Es=0;function Ba(){return Es=(Es+1)%Number.MAX_SAFE_INTEGER,Es.toString()}const Ss=new Map,Us=s=>{if(Ss.has(s))return;const n=setTimeout(()=>{Ss.delete(s),Ge({type:"REMOVE_TOAST",toastId:s})},Ka);Ss.set(s,n)},Ya=(s,n)=>{switch(n.type){case"ADD_TOAST":return{...s,toasts:[n.toast,...s.toasts].slice(0,Ha)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===n.toast.id?{...a,...n.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=n;return a?Us(a):s.toasts.forEach(c=>{Us(c.id)}),{...s,toasts:s.toasts.map(c=>c.id===a||a===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return n.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==n.toastId)}}},ds=[];let cs={toasts:[]};function Ge(s){cs=Ya(cs,s),ds.forEach(n=>{n(cs)})}function Qa({...s}){const n=Ba(),a=l=>Ge({type:"UPDATE_TOAST",toast:{...l,id:n}}),c=()=>Ge({type:"DISMISS_TOAST",toastId:n});return Ge({type:"ADD_TOAST",toast:{...s,id:n,open:!0,onOpenChange:l=>{l||c()}}}),{id:n,dismiss:c,update:a}}function de(){const[s,n]=v.useState(cs);return v.useEffect(()=>(ds.push(n),()=>{const a=ds.indexOf(n);a>-1&&ds.splice(a,1)}),[s]),{...s,toast:Qa,dismiss:a=>Ge({type:"DISMISS_TOAST",toastId:a})}}function Ga(){const{toasts:s}=de();return e.jsxs(za,{children:[s.map(function({id:n,title:a,description:c,action:l,...p}){return e.jsxs(Lt,{...p,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(It,{children:a}),c&&e.jsx(Mt,{children:c})]}),l,e.jsx(At,{})]},n)}),e.jsx(Dt,{})]})}const Ja="https://qewndmyixpzmtgjjihoj.supabase.co",Xa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",D=Kt(Ja,Xa,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),P=v.forwardRef(({className:s,type:n,...a},c)=>e.jsx("input",{type:n,className:I("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:c,...a}));P.displayName="Input";const Cs=Rs("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),R=v.forwardRef(({className:s,variant:n,size:a,asChild:c=!1,...l},p)=>{const d=c?Bt:"button";return e.jsx(d,{className:I(Cs({variant:n,size:a,className:s})),ref:p,...l})});R.displayName="Button";const Ps=[{name:"Overview",href:"/overview",icon:Zs,description:"Key metrics and trends",category:"main",priority:"high"},{name:"Omega Daily",href:"/omega-daily",icon:ne,description:"Daily business metrics",category:"main",priority:"high"},{name:"Weekending Sheet",href:"/weekending-sheet",icon:ms,description:"Weekly operational data",category:"main",priority:"high"},{name:"Calendar",href:"/calendar",icon:ye,description:"Events and reminders",category:"main",priority:"medium"},{name:"Interviews & Hires",href:"/interviews",icon:et,description:"Manage candidates and hiring",category:"main",priority:"medium"},{name:"OSAT",href:"/smg",icon:Qt,description:"Customer feedback metrics",category:"main",priority:"medium"},{name:"Soft Inventory",href:"/soft-inventory",icon:us,description:"Track variance percentages",category:"main",priority:"medium"},{name:"Goal Setting",href:"/goals",icon:Ds,description:"Set goals & track progress",category:"main",priority:"medium"},{name:"Settings",href:"/settings",icon:ps,description:"Configure dashboard preferences",category:"main",priority:"medium"},{name:"Setup",href:"/setup",icon:Gt,description:"Copy SQL & configure",category:"main",priority:"low"}],Vt=v.forwardRef(({open:s,isMobile:n,onClose:a},c)=>{const l=Yt(),[p,d]=v.useState(""),[N,f]=v.useState(null),S=v.useMemo(()=>{if(!p.trim())return Ps;const i=p.toLowerCase();return Ps.filter(y=>y.name.toLowerCase().includes(i)||y.description.toLowerCase().includes(i))},[p]),x=()=>{n&&a()};return n?e.jsx("div",{ref:c,className:I("fixed top-0 left-0 w-80 h-full bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",s?"translate-x-0":"-translate-x-full"),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("h2",{className:"font-semibold text-wendys-charcoal",children:"Navigation"})]}),e.jsx(R,{variant:"ghost",size:"sm",onClick:a,className:"tap","aria-label":"Close navigation",children:"×"})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{placeholder:"Search navigation...",value:p,onChange:i=>d(i.target.value),className:"pl-10 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-2",children:S.map(i=>{const y=l.pathname===i.href,k=i.icon;return e.jsxs(xs,{to:i.href,onClick:x,className:I("flex items-center space-x-3 p-4 rounded-lg transition-all duration-200 tap",y?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg":"text-gray-700 hover:bg-gray-50"),children:[e.jsx("div",{className:I("flex-shrink-0 p-2 rounded-lg",y?"bg-white/20":"bg-gray-100"),children:e.jsx(k,{className:I("h-5 w-5",y?"text-white":"text-gray-600")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:I("font-semibold text-sm",y?"text-white":"text-gray-800"),children:i.name}),i.priority==="high"&&e.jsx(ke,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:I("text-xs mt-1",y?"text-red-100":"text-gray-500"),children:i.description})]})]},i.href)})}),p.trim()&&S.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ye,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-xs mt-1",children:"Try a different search term"})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})}):e.jsx("div",{className:I("bg-gradient-to-b from-white to-gray-50 shadow-2xl border-r border-gray-200 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",s?"w-64":"w-16"),children:e.jsxs("div",{className:"flex flex-col h-full relative",children:[s&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{placeholder:"Search navigation...",value:p,onChange:i=>d(i.target.value),className:"pl-10 h-9 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:I("overflow-y-auto flex-1",s?"p-4":"p-2"),children:[e.jsx("div",{className:"space-y-1",children:S.map(i=>{const y=l.pathname===i.href,k=i.icon;return e.jsxs("div",{className:"relative",children:[e.jsxs(xs,{to:i.href,className:I("flex items-center transition-all duration-200 group relative",s?"space-x-3 p-3 rounded-lg mx-0":"justify-center p-3 rounded-lg mx-1",y?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg ring-1 ring-red-200":"text-gray-700 hover:bg-white hover:shadow-sm hover:ring-1 hover:ring-gray-200"),onMouseEnter:()=>!s&&f(i.href),onMouseLeave:()=>!s&&f(null),children:[e.jsx("div",{className:I("flex-shrink-0 p-2 rounded-lg transition-all duration-200",y?"bg-white/20":"bg-gray-100 group-hover:bg-wendys-red/10 group-hover:scale-110"),children:e.jsx(k,{className:I("h-5 w-5 transition-colors duration-200",y?"text-white":"text-gray-600 group-hover:text-wendys-red")})}),s&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:I("font-semibold text-sm",y?"text-white":"text-gray-800"),children:i.name}),i.priority==="high"&&e.jsx(ke,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:I("text-xs mt-1",y?"text-red-100":"text-gray-500"),children:i.description})]})]}),!s&&N===i.href&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 transform -translate-y-1/2 z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-sm px-3 py-2 rounded-lg shadow-lg whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:i.name}),e.jsx("div",{className:"text-gray-300 text-xs mt-1",children:i.description}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-900 rotate-45"})]})})]},i.href)})}),p.trim()&&S.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ye,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Try a different search term"})]})]}),s&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})})});Vt.displayName="RightNavDrawer";const Za=Zt,er=ea,sr=v.forwardRef(({className:s,inset:n,children:a,...c},l)=>e.jsxs(st,{ref:l,className:I("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",s),...c,children:[a,e.jsx(Jt,{className:"ml-auto h-4 w-4"})]}));sr.displayName=st.displayName;const tr=v.forwardRef(({className:s,...n},a)=>e.jsx(tt,{ref:a,className:I("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n}));tr.displayName=tt.displayName;const Ot=v.forwardRef(({className:s,sideOffset:n=4,...a},c)=>e.jsx(Xt,{children:e.jsx(at,{ref:c,sideOffset:n,className:I("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));Ot.displayName=at.displayName;const Ft=v.forwardRef(({className:s,inset:n,...a},c)=>e.jsx(rt,{ref:c,className:I("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",s),...a}));Ft.displayName=rt.displayName;const ar=v.forwardRef(({className:s,children:n,checked:a,...c},l)=>e.jsxs(nt,{ref:l,className:I("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...c,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(it,{children:e.jsx(lt,{className:"h-4 w-4"})})}),n]}));ar.displayName=nt.displayName;const rr=v.forwardRef(({className:s,children:n,...a},c)=>e.jsxs(ot,{ref:c,className:I("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(it,{children:e.jsx(dt,{className:"h-2 w-2 fill-current"})})}),n]}));rr.displayName=ot.displayName;const nr=v.forwardRef(({className:s,inset:n,...a},c)=>e.jsx(ct,{ref:c,className:I("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...a}));nr.displayName=ct.displayName;const ir=v.forwardRef(({className:s,...n},a)=>e.jsx(mt,{ref:a,className:I("-mx-1 my-1 h-px bg-muted",s),...n}));ir.displayName=mt.displayName;function lr({user:s,onNavToggle:n,navOpen:a}){const{toast:c}=de(),l=async()=>{try{await D.auth.signOut(),c({title:"Signed out",description:"You have been successfully signed out."})}catch(p){console.error("Error signing out:",p),c({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:n,className:"tap p-2 hover:bg-gray-100","aria-label":a?"Close navigation":"Open navigation",children:e.jsx(sa,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm sm:text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg sm:text-xl font-bold text-wendys-charcoal",children:[e.jsx("span",{className:"hidden sm:inline",children:"SE 14th GM Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Dashboard"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 hide-on-mobile",children:q(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:e.jsxs(Za,{children:[e.jsx(er,{asChild:!0,children:e.jsxs(R,{variant:"ghost",className:"flex items-center space-x-1 sm:space-x-2 tap",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:s.email})]})}),e.jsx(Ot,{align:"end",children:e.jsxs(Ft,{onClick:l,children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const or=je({business_date:Y().min(1,"Business date is required"),net_sales:H.number().min(0,"Net sales must be positive"),last_year_sales:H.number().min(0,"Last year sales must be positive"),labor_hours:H.number().min(0,"Labor hours must be positive"),ideal_labor_hours:H.number().min(0,"Ideal labor hours must be positive"),labor_percentage:H.number().min(0,"Labor percentage must be positive"),theoretical_food_cost:H.number().min(0,"Theoretical food cost must be positive"),food_variance_cost:H.number(),waste_amount:H.number().min(0,"Waste amount must be positive"),breakfast_sales:H.number().min(0,"Breakfast sales must be positive"),night_sales:H.number().min(0,"Night sales must be positive")}),dr=je({date:Y().min(1,"Date is required"),accuracy_decimal:ts().min(0,"Accuracy must be 0 or greater"),zod_per_10k:ts().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:ts().min(0,"CC Complaints must be 0 or greater"),osat_decimal:ts().min(0,"OSAT Score must be 0 or greater"),notes:Y().optional()});je({candidate_name:Y().min(1,"Candidate name is required"),phone:Y().optional(),email:Y().email("Invalid email format").optional().or(aa("")),position:Y().optional(),interview_date:Y().min(1,"Interview date is required"),interview_time:Y().min(1,"Interview time is required"),status:xt(["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"]),notes:Y().optional()});je({entry_date:Y().min(1,"Entry date is required"),accuracy_of_order:H.number().min(0).max(5).optional(),zone_of_defection:H.number().min(0).max(5).optional(),customer_computers:H.number().min(0).max(5).optional(),taste_of_food:H.number().min(0).max(5).optional(),osat:H.number().min(0).max(5).optional()});je({documents_received:ra().default(!1),documents_folder:Y().optional(),onboarding_sent_date:Y().optional(),onboarding_completed_date:Y().optional(),manager_reviewed_date:Y().optional(),entered_in_system_date:Y().optional(),fingerprint_scheduled_date:Y().optional(),first_day:Y().optional(),notes:Y().optional()});const cr=je({email:Y().email("Invalid email format"),password:Y().min(6,"Password must be at least 6 characters")}),mr=je({week_ending_date:Y().min(1,"Week ending date is required"),manager_name:xt(["Scott","Sophear","Letoya","Carissa"],{required_error:"Please select a manager"}),breakfast_sales:H.number().min(0,"Breakfast sales must be positive"),late_night_sales:H.number().min(0,"Late night sales must be positive"),net_sales:H.number().min(0,"Net sales must be positive"),discounts:H.number().default(0),cash:H.number().default(0),food_cost:H.number().default(0),variance_dollars:H.number().default(0),food_variance_percentage:H.number().default(0),labor:H.number().min(0,"Labor must be positive"),credit_hours:H.number().min(0,"Credit hours must be positive"),reason:Y().optional(),new_hire_name:Y().optional(),terminations:Y().optional(),term_date:Y().optional()}),ur=je({business_date:Y().min(1,"Business date is required"),bacon_variance:H.number().default(0),beef_4oz_variance:H.number().default(0),beef_small_variance:H.number().default(0),chicken_breaded_variance:H.number().default(0),chicken_diced_variance:H.number().default(0),chicken_nuggets_variance:H.number().default(0),chicken_nuggets_spicy_variance:H.number().default(0),chicken_patty_3_1_variance:H.number().default(0),chicken_breaded_spicy_variance:H.number().default(0),chicken_strips_variance:H.number().default(0),sausage_patty_variance:H.number().default(0),notes:Y().optional()}),xr=Rs("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),M=v.forwardRef(({className:s,...n},a)=>e.jsx(ht,{ref:a,className:I(xr(),s),...n}));M.displayName=ht.displayName;function hr(){const[s,n]=v.useState(!1),[a,c]=v.useState(!1),{toast:l}=de(),{register:p,handleSubmit:d,formState:{errors:N}}=$e({resolver:He(cr)}),f=async S=>{n(!0);try{const{error:x}=await D.auth.signInWithPassword({email:S.email,password:S.password});if(x)throw x;l({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(x){console.error("Login error:",x),l({title:"Login failed",description:x.message||"Please check your credentials and try again.",variant:"destructive"})}finally{n(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:d(f),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...p("email")})]}),N.email&&e.jsx("p",{className:"text-red-600 text-sm",children:N.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"password",type:a?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...p("password")}),e.jsx("button",{type:"button",onClick:()=>c(!a),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:a?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]}),N.password&&e.jsx("p",{className:"text-red-600 text-sm",children:N.password.message})]}),e.jsx(R,{type:"submit",className:"w-full wendys-button",disabled:s,children:s?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const xe=na({component:gr});function gr(){const[s,n]=v.useState(null),[a,c]=v.useState(!0),[l,p]=v.useState(()=>{const i=localStorage.getItem("navOpen"),y=typeof window<"u"?window.innerWidth>=768:!0;return i?JSON.parse(i):y}),[d,N]=v.useState(typeof window<"u"?window.innerWidth<768:!1),f=v.useRef(null),{toast:S}=de(),x=ia();return v.useEffect(()=>{const i=()=>{const y=window.innerWidth<768;N(y),y&&l&&p(!1)};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[l]),v.useEffect(()=>{const i=k=>{k.key==="Escape"&&l&&d&&p(!1)},y=k=>{d&&l&&f.current&&!f.current.contains(k.target)&&p(!1)};return l&&d?(document.addEventListener("keydown",i),document.addEventListener("mousedown",y),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.removeEventListener("keydown",i),document.removeEventListener("mousedown",y),document.body.style.overflow="unset"}},[l,d]),v.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){n({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),c(!1);return}const{data:{session:y}}=await D.auth.getSession();y!=null&&y.user&&n(y.user)}catch(y){console.error("Error checking session:",y),n({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{c(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:y}}=D.auth.onAuthStateChange(async(k,E)=>{k==="SIGNED_IN"&&(E!=null&&E.user)?(n(E.user),S({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):k==="SIGNED_OUT"&&(n(null),x({to:"/"}),S({title:"Signed out",description:"You have been successfully signed out."}))});return()=>y.unsubscribe()}},[x,S]),v.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(l))},[l]),a?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"}),e.jsx(lr,{user:s,onNavToggle:()=>p(!l),navOpen:l}),e.jsxs("div",{className:"flex relative",children:[d&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 backdrop-blur-sm",onClick:()=>p(!1)}),e.jsx(Vt,{open:l,isMobile:d,onClose:()=>p(!1),ref:f}),e.jsx("main",{id:"main-content",className:I("flex-1 transition-all duration-300 ease-in-out mobile-container","ml-0"),children:e.jsx(la,{})})]})]}):e.jsx(hr,{})}function Ke({className:s,classNames:n,showOutsideDays:a=!0,...c}){return e.jsx(oa,{showOutsideDays:a,className:I("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:I(Cs({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:I(Cs({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...n},...c})}Ke.displayName="Calendar";const vs=ca,bs=ma,ss=v.forwardRef(({className:s,align:n="center",sideOffset:a=4,...c},l)=>e.jsx(da,{children:e.jsx(ft,{ref:l,align:n,sideOffset:a,className:I("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...c})}));ss.displayName=ft.displayName;const fr=ge("/weekending-sheet")({component:yr});function yr(){const[s,n]=v.useState(!1),[a,c]=v.useState(null),{toast:l}=de(),p=Ue(),[d,N]=v.useState(null),f=()=>{const o=yt(new Date,{weekStartsOn:6});return q(ha(o,{weekStartsOn:6}),"yyyy-MM-dd")},S=()=>({week_ending_date:f(),manager_name:"Scott",breakfast_sales:0,late_night_sales:0,net_sales:0,discounts:0,cash:0,food_cost:0,variance_dollars:0,food_variance_percentage:0,labor:0,credit_hours:0,reason:"",new_hire_name:"",terminations:"",term_date:""}),x=m=>m==="Scott"||m==="Sophear"||m==="Letoya"||m==="Carissa"?m:"Scott",i=$e({resolver:He(mr),defaultValues:S()}),y=ie({mutationFn:async m=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const o={store_id:d,...m};console.log("Attempting to insert data:",o),console.log("Store ID:",d),console.log("Payload:",m);const{data:C,error:O}=await D.from("weekending_sheet").insert(o).select();if(O)throw console.error("Supabase insert error:",O),console.error("Error details:",O.details),console.error("Error hint:",O.hint),console.error("Error message:",O.message),O;return C},onSuccess:()=>{l({title:"Success!",description:"Weekending sheet saved successfully."}),n(!1),c(null),i.reset(S()),console.log("🔄 Invalidating queries after weekending save..."),p.invalidateQueries({queryKey:["weekending_sheet",d]}),p.invalidateQueries({predicate:m=>{const o=m.queryKey[0]==="overview-weekending"||m.queryKey[0]==="overview-weekending-charts";return o&&console.log("🗑️ Invalidating query:",m.queryKey),o}}),console.log("✅ Query invalidation complete")},onError:m=>{l({title:"Save failed",description:(m==null?void 0:m.message)||"Unable to save entry.",variant:"destructive"})}}),k=ie({mutationFn:async({id:m,payload:o})=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const{error:C}=await D.from("weekending_sheet").update({...o}).eq("id",m);if(C)throw C},onSuccess:()=>{l({title:"Updated!",description:"Weekending sheet updated successfully."}),n(!1),c(null),i.reset(),console.log("🔄 Invalidating queries after weekending save..."),p.invalidateQueries({queryKey:["weekending_sheet",d]}),p.invalidateQueries({predicate:m=>{const o=m.queryKey[0]==="overview-weekending"||m.queryKey[0]==="overview-weekending-charts";return o&&console.log("🗑️ Invalidating query:",m.queryKey),o}}),console.log("✅ Query invalidation complete")},onError:m=>{l({title:"Update failed",description:(m==null?void 0:m.message)||"Unable to update entry.",variant:"destructive"})}}),E=ie({mutationFn:async m=>{const{error:o}=await D.from("weekending_sheet").delete().eq("id",m);if(o)throw o},onSuccess:()=>{l({title:"Deleted",description:"Weekending sheet entry removed."}),console.log("🔄 Invalidating queries after weekending save..."),p.invalidateQueries({queryKey:["weekending_sheet",d]}),p.invalidateQueries({predicate:m=>{const o=m.queryKey[0]==="overview-weekending"||m.queryKey[0]==="overview-weekending-charts";return o&&console.log("🗑️ Invalidating query:",m.queryKey),o}}),console.log("✅ Query invalidation complete")},onError:m=>{l({title:"Delete failed",description:(m==null?void 0:m.message)||"Unable to delete entry.",variant:"destructive"})}}),U=m=>{const o={...m,breakfast_sales:Number(m.breakfast_sales)||0,late_night_sales:Number(m.late_night_sales)||0,net_sales:Number(m.net_sales)||0,discounts:Number(m.discounts)||0,cash:Number(m.cash)||0,food_cost:Number(m.food_cost)||0,variance_dollars:Number(m.variance_dollars)||0,food_variance_percentage:Number(m.food_variance_percentage)||0,labor:Number(m.labor)||0,credit_hours:Number(m.credit_hours)||0,term_date:m.term_date&&m.term_date.trim()!==""?m.term_date:null};a?k.mutate({id:a.id,payload:o}):y.mutate(o)},F=m=>{console.error("Form validation failed:",m),m.discounts&&console.error("Discounts error:",m.discounts),m.cash&&console.error("Cash error:",m.cash),m.food_cost&&console.error("Food cost error:",m.food_cost),l({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})};v.useEffect(()=>{let m=!0;return(async()=>{var C;try{const{data:O}=await D.auth.getUser(),b=(C=O.user)==null?void 0:C.id;if(!b||!m)return;console.log("Resolving store_id for user:",b);const{data:T}=await D.from("users").select("store_id").eq("id",b).maybeSingle();console.log("User data from database:",T),console.log("Store ID resolved:",T==null?void 0:T.store_id),m&&N((T==null?void 0:T.store_id)??null)}catch(O){console.error("Error resolving store ID:",O),m&&N(null)}})(),()=>{m=!1}},[]);const{data:h=[],isLoading:g,error:w}=se({queryKey:["weekending_sheet",d],queryFn:async()=>{if(!d)return[];const{data:m,error:o}=await D.from("weekending_sheet").select("*").eq("store_id",d).order("week_ending_date",{ascending:!1}).limit(100);if(o)throw o;return m},enabled:!!d}),j=m=>{c(m),i.reset({week_ending_date:m.week_ending_date,manager_name:x(m.manager_name),breakfast_sales:m.breakfast_sales||0,late_night_sales:m.late_night_sales||0,net_sales:m.net_sales||0,discounts:m.discounts||0,cash:m.cash||0,food_cost:m.food_cost||0,variance_dollars:m.variance_dollars||0,food_variance_percentage:m.food_variance_percentage||0,labor:m.labor||0,credit_hours:m.credit_hours||0,reason:m.reason||"",new_hire_name:m.new_hire_name||"",terminations:m.terminations||"",term_date:m.term_date||""}),n(!0)},A=m=>{confirm("Are you sure you want to delete this entry?")&&E.mutate(m)},V=()=>{if(h.length===0){l({title:"No data",description:"No entries to export.",variant:"destructive"});return}const o=[["Week Ending Date","Manager","Breakfast Sales","Late Night Sales","Net Sales","Discounts","Cash","Food Cost","Variance Dollars","Food Variance %","Labor","Credit Hours","Reason","New Hire Name","Terminations","Term Date"].join(","),...h.map(T=>[T.week_ending_date,T.manager_name,T.breakfast_sales,T.late_night_sales,T.net_sales,T.discounts,T.cash,T.food_cost,T.variance_dollars,T.food_variance_percentage,T.labor,T.credit_hours,T.reason||"",T.new_hire_name||"",T.terminations||"",T.term_date||""].join(","))].join(`
`),C=new Blob([o],{type:"text/csv"}),O=window.URL.createObjectURL(C),b=document.createElement("a");b.href=O,b.download=`weekending-sheet-${q(new Date,"yyyy-MM-dd")}.csv`,b.click(),window.URL.revokeObjectURL(O),l({title:"Exported!",description:"CSV file downloaded successfully."})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Weekending Sheet"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Weekly operational data and metrics tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(R,{onClick:()=>{c(null),i.reset(S()),n(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Weekending Entry"]}),h.length>0&&e.jsxs(R,{onClick:V,variant:"outline",size:"sm",className:"w-full md:w-auto border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:[e.jsx(ua,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Total Entries"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Latest Week"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length>0?oe(h[0].week_ending_date):"N/A"})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Avg Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:h.length>0?me(h.reduce((m,o)=>m+(o.net_sales||0),0)/h.length):"$0"})]})]})}),w&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",w.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Weekending Entries"}),e.jsx("div",{className:"text-xs md:text-sm text-gray-600",children:g?"Loading...":`${h.length} entries`})]}),(h==null?void 0:h.length)===0&&!g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:d?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:"You haven't added any weekending entries yet."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),d&&e.jsxs(R,{onClick:()=>n(!0),className:"wendys-button",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Week Ending"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Manager"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Net Sales"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Food Variance"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Labor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:oe(m.week_ending_date)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:m.manager_name})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:me(m.net_sales)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.food_variance_percentage>0?"bg-red-100 text-red-800":m.food_variance_percentage<0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:re(m.food_variance_percentage)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:me(m.labor)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>j(m),className:"h-8 w-8 p-0 hover:bg-blue-100 hover:text-blue-700",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>A(m.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-100",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},m.id))})]})}),e.jsx("div",{className:"lg:hidden space-y-4",children:h.map(m=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:oe(m.week_ending_date)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Week Ending"})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>j(m),className:"h-8 w-8 p-0 hover:bg-blue-100 hover:text-blue-700",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>A(m.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-100",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Manager"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:m.manager_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Net Sales"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:me(m.net_sales)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Food Variance"}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${m.food_variance_percentage>0?"bg-red-100 text-red-800":m.food_variance_percentage<0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:re(m.food_variance_percentage)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Labor"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:me(m.labor)})]})]})]},m.id))})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-4 sm:p-6 w-full max-w-5xl max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-wendys-red/10 rounded-lg",children:e.jsx(ms,{className:"h-5 w-5 text-wendys-red"})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-wendys-charcoal",children:a?"Edit Weekending Entry":"Add Weekending Entry"})]}),e.jsx(R,{variant:"ghost",onClick:()=>{n(!1),c(null),i.reset()},className:"h-10 w-10 p-0 hover:bg-gray-100 rounded-full",children:e.jsx("span",{className:"text-xl",children:"×"})})]}),e.jsxs("form",{onSubmit:i.handleSubmit(U,F),className:"space-y-6",children:[Object.keys(i.formState.errors).length>0&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-2 space-y-1",children:Object.entries(i.formState.errors).map(([m,o])=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-400 rounded-full mr-2"}),o==null?void 0:o.message]},m))})]})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg mr-3",children:e.jsx(ms,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[e.jsx(M,{className:"text-sm font-medium text-gray-700",children:"Week Ending Date *"}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:"w-full justify-start text-left font-normal h-12 border-gray-300 hover:border-gray-400 focus:ring-2 focus:ring-wendys-red/20",children:[e.jsx(ye,{className:"mr-3 h-5 w-5 text-gray-500"}),e.jsx("span",{className:i.watch("week_ending_date")?"text-gray-900":"text-gray-500",children:i.watch("week_ending_date")?oe(i.watch("week_ending_date")):"Select week ending date"})]})}),e.jsx(ss,{className:"w-auto p-0 shadow-lg",children:e.jsx(Ke,{mode:"single",selected:(()=>{const m=i.watch("week_ending_date");if(!m)return;const o=Number(m.slice(0,4)),C=Number(m.slice(5,7)),O=Number(m.slice(8,10));return new Date(o,(C||1)-1,O||1)})(),onSelect:m=>{const o=m?q(m,"yyyy-MM-dd"):"";i.setValue("week_ending_date",o)},initialFocus:!0})})]}),i.formState.errors.week_ending_date&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.week_ending_date.message]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[e.jsx(M,{htmlFor:"reason",className:"text-sm font-medium text-gray-700",children:"Reason (Optional)"}),e.jsx(P,{id:"reason",placeholder:"Add any notes or reason for this entry...",className:"h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("reason")}),i.formState.errors.reason&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.reason.message]})]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg mr-3",children:e.jsx(xa,{className:"h-5 w-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sales & Financial Data"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"breakfast_sales",className:"text-sm font-medium text-gray-700",children:"Breakfast Sales (DP1) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"breakfast_sales",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("breakfast_sales")})]}),i.formState.errors.breakfast_sales&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.breakfast_sales.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"late_night_sales",className:"text-sm font-medium text-gray-700",children:"Late Night Sales (DP6) *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"late_night_sales",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("late_night_sales")})]}),i.formState.errors.late_night_sales&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.late_night_sales.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"net_sales",className:"text-sm font-medium text-gray-700",children:"Net Sales *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"net_sales",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("net_sales")})]}),i.formState.errors.net_sales&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.net_sales.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"discounts",className:"text-sm font-medium text-gray-700",children:"Discounts (Can be negative)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"discounts",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("discounts")})]}),i.formState.errors.discounts&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.discounts.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"cash",className:"text-sm font-medium text-gray-700",children:"Cash (Can be negative)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"cash",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("cash")})]}),i.formState.errors.cash&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.cash.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"food_cost",className:"text-sm font-medium text-gray-700",children:"Food Cost (Can be negative)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"food_cost",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("food_cost")})]}),i.formState.errors.food_cost&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.food_cost.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"variance_dollars",className:"text-sm font-medium text-gray-700",children:"Variance Dollars (Can be negative)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"variance_dollars",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("variance_dollars")})]}),i.formState.errors.variance_dollars&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.variance_dollars.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"food_variance_percentage",className:"text-sm font-medium text-gray-700",children:"Food Variance % (Can be negative)"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"%"})}),e.jsx(P,{id:"food_variance_percentage",type:"number",step:"0.1",placeholder:"0.0",className:"pr-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("food_variance_percentage")})]}),i.formState.errors.food_variance_percentage&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.food_variance_percentage.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"labor",className:"text-sm font-medium text-gray-700",children:"Labor *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),e.jsx(P,{id:"labor",type:"number",step:"0.01",placeholder:"0.00",className:"pl-7 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("labor")})]}),i.formState.errors.labor&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.labor.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"credit_hours",className:"text-sm font-medium text-gray-700",children:"Credit Hours *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"hrs"})}),e.jsx(P,{id:"credit_hours",type:"number",step:"0.1",placeholder:"0.0",className:"pr-12 h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("credit_hours")})]}),i.formState.errors.credit_hours&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.credit_hours.message]})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg mr-3",children:e.jsx(et,{className:"h-5 w-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Personnel"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"new_hire_name",className:"text-sm font-medium text-gray-700",children:"New Hire Name (Optional)"}),e.jsx(P,{id:"new_hire_name",placeholder:"Enter new hire's name...",className:"h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("new_hire_name")}),i.formState.errors.new_hire_name&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.new_hire_name.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"terminations",className:"text-sm font-medium text-gray-700",children:"Terminations (Optional)"}),e.jsx(P,{id:"terminations",placeholder:"Enter termination details...",className:"h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("terminations")}),i.formState.errors.terminations&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.terminations.message]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[e.jsx(M,{htmlFor:"term_date",className:"text-sm font-medium text-gray-700",children:"Termination Date (Optional)"}),e.jsx(P,{id:"term_date",type:"date",className:"h-12 border-gray-300 focus:ring-2 focus:ring-wendys-red/20 focus:border-wendys-red",...i.register("term_date")}),i.formState.errors.term_date&&e.jsxs("div",{className:"flex items-center text-sm text-red-600",children:[e.jsx("svg",{className:"h-4 w-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i.formState.errors.term_date.message]})]})]})]}),!d&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn't linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{n(!1),c(null),i.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:y.isPending||k.isPending||!d,children:a?"Update Entry":"Save Entry"})]})]})]})})]})}const Xe=v.forwardRef(({className:s,...n},a)=>e.jsx("textarea",{className:I("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...n}));Xe.displayName="Textarea";function ue({title:s,subtitle:n,className:a,children:c,loading:l=!1,error:p,onRefresh:d}){return e.jsxs("div",{className:I("wendys-card",a),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),n&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n})]}),d&&e.jsx("button",{onClick:d,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),p?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:p}),d&&e.jsx("button",{onClick:d,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):l?e.jsx(pr,{}):c]})}function pr(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((s,n)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},n))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((s,n)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},n))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((s,n)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},n))})]})})}const Z={currency:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),currencyDetailed:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),percent:(s,n=1)=>`${(s??0).toFixed(n)}%`,hours:(s,n=1)=>`${(s??0).toFixed(n)}h`,dateShort:s=>{const n=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return q(n,"MMM d")},dateFull:s=>{const n=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return q(n,"MMM dd, yyyy")},currencyCompact:s=>{if(s==null||isNaN(s))return"$0";const n=Math.abs(s);return n>=1e6?`$${(s/1e6).toFixed(1)}M`:n>=1e3?`$${(s/1e3).toFixed(1)}k`:Z.currency(s)}},K={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},Q={cartesianGrid:{strokeDasharray:"3 3",stroke:K.gridStroke},xAxis:{stroke:K.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:K.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${K.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:K.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:K.textSecondary}}},Ts=(s,n=new Date)=>{const a=new Date(n);switch(s){case"today":return{start:q(a,"yyyy-MM-dd"),end:q(a,"yyyy-MM-dd"),label:"Today"};case"wtd":const c=new Date(a);return c.setDate(a.getDate()-a.getDay()),{start:q(c,"yyyy-MM-dd"),end:q(a,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const l=new Date(a.getFullYear(),a.getMonth(),1);return{start:q(l,"yyyy-MM-dd"),end:q(a,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const p=new Date(a);return p.setDate(a.getDate()-6),{start:q(p,"yyyy-MM-dd"),end:q(a,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const d=new Date(a);return d.setDate(a.getDate()-29),{start:q(d,"yyyy-MM-dd"),end:q(a,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},qs=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function _s({selectedRange:s="last30",selectedDate:n,onRangeChange:a,onDateChange:c,onClearFilters:l,className:p,compact:d=!1}){const N=s!=="last30"||n,f=x=>{a==null||a(x),x!=="custom"&&(c==null||c(void 0))},S=()=>{if(s==="custom"&&n)return q(n,"MMM dd, yyyy");const x=qs.find(i=>i.key===s);return(x==null?void 0:x.label)||"Last 30"};return e.jsxs("div",{className:I("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",d&&"p-3",p),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ga,{className:"h-4 w-4"}),e.jsx("span",{className:I("text-sm font-medium",d&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:qs.map(x=>e.jsx(R,{variant:s===x.key?"default":"ghost",size:"sm",onClick:()=>f(x.key),className:I("text-xs h-7 px-2",s===x.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",d&&"text-[11px] h-6 px-1.5"),title:x.description,children:x.label},x.key))}),s==="custom"&&e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"sm",className:I("justify-start text-left font-normal h-7",!n&&"text-muted-foreground",d&&"h-6 text-xs"),children:[e.jsx(ye,{className:"mr-1 h-3 w-3"}),n?q(n,"MMM dd"):"Pick date"]})}),e.jsx(ss,{className:"w-auto p-0",align:"start",children:e.jsx(Ke,{mode:"single",selected:n,onSelect:c,initialFocus:!0})})]}),!d&&N&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:S()})]}),N&&l&&e.jsxs(R,{variant:"ghost",size:"sm",onClick:l,className:I("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",d&&"h-6 px-1.5"),children:[e.jsx(Je,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function Ns(s,n="last30"){const[a,c]=Oe.useState(()=>typeof window<"u"&&localStorage.getItem(`${s}_range`)||n),[l,p]=Oe.useState(()=>{if(typeof window<"u"){const x=localStorage.getItem(`${s}_date`);if(x){const[i,y,k]=x.split("-").map(Number);return new Date(i,(y||1)-1,k||1)}return}}),d=Oe.useCallback(x=>{c(x),typeof window<"u"&&localStorage.setItem(`${s}_range`,x)},[s]),N=Oe.useCallback(x=>{if(p(x),typeof window<"u")if(x){const i=q(x,"yyyy-MM-dd");localStorage.setItem(`${s}_date`,i)}else localStorage.removeItem(`${s}_date`)},[s]),f=Oe.useCallback(()=>{c(n),p(void 0),typeof window<"u"&&(localStorage.removeItem(`${s}_range`),localStorage.removeItem(`${s}_date`))},[s,n]),S=Oe.useCallback(()=>{if(a==="custom"&&l){const x=q(l,"yyyy-MM-dd");return{start:x,end:x}}if(a&&a!=="custom"){const x=Ts(a);return x.start?{start:x.start,end:x.end}:null}return null},[a,l]);return{selectedRange:a,selectedDate:l,handleRangeChange:d,handleDateChange:N,clearFilters:f,getDateRangeFilter:S,getSelectedLabel:()=>a==="custom"&&l?q(l,"MMM dd, yyyy"):Ts(a).label}}function J({title:s,value:n,format:a,delta:c,deltaLabel:l,icon:p,trend:d,suffix:N,sparklineData:f,className:S}){const x=k=>{if(k==null||isNaN(k))return"0";switch(a){case"currency":return me(k);case"percentage":return re(k);case"number":return k.toLocaleString();default:return k.toString()}},i=()=>{switch(d){case"up":return e.jsx(ne,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(he,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(fa,{className:"h-4 w-4 text-gray-400"})}},y=()=>{switch(d){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:I("wendys-card",S),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(p,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[x(n),N&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:N})]}),f&&f.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsx(Fe,{data:f,children:e.jsx(we,{type:"monotone",dataKey:"value",stroke:d==="up"?K.positive:d==="down"?K.waste:K.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),c!=null&&l&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[i(),e.jsxs("span",{className:I("text-sm font-medium",y()),children:[c>0?"+":"",Math.abs(c)<1&&a!=="percentage"?re(Math.abs(c)*100):x(Math.abs(c)),N&&a!=="percentage"&&e.jsx("span",{className:"ml-1",children:N})]}),e.jsx("span",{className:"text-xs text-gray-500",children:l})]})]})})})}const vr=ge("/soft-inventory")({component:br}),ve=[{key:"bacon_variance",label:"Bacon",color:"#ef4444"},{key:"beef_4oz_variance",label:"Beef 4oz",color:"#dc2626"},{key:"beef_small_variance",label:"Beef Small",color:"#b91c1c"},{key:"chicken_breaded_variance",label:"Chicken Breaded",color:"#16a34a"},{key:"chicken_diced_variance",label:"Chicken Diced",color:"#15803d"},{key:"chicken_nuggets_variance",label:"Chicken Nuggets",color:"#ca8a04"},{key:"chicken_nuggets_spicy_variance",label:"Chicken Nuggets Spicy",color:"#a16207"},{key:"chicken_patty_3_1_variance",label:"Chicken Patty 3.1",color:"#059669"},{key:"chicken_breaded_spicy_variance",label:"Chicken Breaded Spicy",color:"#047857"},{key:"chicken_strips_variance",label:"Chicken Strips",color:"#0891b2"},{key:"sausage_patty_variance",label:"Sausage Patty",color:"#7c2d12"}];function br(){const[s,n]=v.useState(null),[a,c]=v.useState(null),[l,p]=v.useState(!1),{toast:d}=de(),N=Ue(),f=Ns("soft-inventory","today");v.useEffect(()=>{let o=!0;return(async()=>{var z;const{data:C}=await D.auth.getUser(),O=(z=C.user)==null?void 0:z.id;if(!O)return;const{data:b,error:T}=await D.from("users").select("store_id").eq("id",O).maybeSingle();if(o){if(T){console.error("Error fetching store ID:",T);return}n((b==null?void 0:b.store_id)??null)}})(),()=>{o=!1}},[]);const S=f.getDateRangeFilter(),{data:x=[],isLoading:i,error:y}=se({queryKey:["soft-inventory-variance",s,S==null?void 0:S.start,S==null?void 0:S.end],queryFn:async()=>{if(!s)return[];let o=D.from("soft_inventory_variance").select("*").eq("store_id",s);S&&(o=o.gte("business_date",S.start).lte("business_date",S.end));const{data:C,error:O}=await o.order("business_date",{ascending:!1});if(O)throw O;return C||[]},enabled:!!s}),{data:k=[]}=se({queryKey:["soft-inventory-charts",s],queryFn:async()=>{if(!s)return[];const o=new Date;o.setDate(o.getDate()-30);const C=o.toISOString().slice(0,10),{data:O,error:b}=await D.from("soft_inventory_variance").select("*").eq("store_id",s).gte("business_date",C).order("business_date",{ascending:!0});if(b)throw b;return O||[]},enabled:!!s}),E=$e({resolver:He(ur),defaultValues:{business_date:q(new Date,"yyyy-MM-dd"),bacon_variance:0,beef_4oz_variance:0,beef_small_variance:0,chicken_breaded_variance:0,chicken_diced_variance:0,chicken_nuggets_variance:0,chicken_nuggets_spicy_variance:0,chicken_patty_3_1_variance:0,chicken_breaded_spicy_variance:0,chicken_strips_variance:0,sausage_patty_variance:0,notes:""}}),U=ie({mutationFn:async o=>{if(!s)throw new Error("Store ID not available");const C={store_id:s,business_date:o.business_date,bacon_variance:o.bacon_variance,beef_4oz_variance:o.beef_4oz_variance,beef_small_variance:o.beef_small_variance,chicken_breaded_variance:o.chicken_breaded_variance,chicken_diced_variance:o.chicken_diced_variance,chicken_nuggets_variance:o.chicken_nuggets_variance,chicken_nuggets_spicy_variance:o.chicken_nuggets_spicy_variance,chicken_patty_3_1_variance:o.chicken_patty_3_1_variance,chicken_breaded_spicy_variance:o.chicken_breaded_spicy_variance,chicken_strips_variance:o.chicken_strips_variance,sausage_patty_variance:o.sausage_patty_variance,notes:o.notes||null};if(a){const{error:O}=await D.from("soft_inventory_variance").update(C).eq("id",a);if(O)throw O}else{const{error:O}=await D.from("soft_inventory_variance").insert(C);if(O)throw O}},onSuccess:()=>{N.invalidateQueries({queryKey:["soft-inventory-variance"]}),N.invalidateQueries({queryKey:["soft-inventory-charts"]}),N.invalidateQueries({queryKey:["overview"]}),c(null),p(!1),E.reset(),d({title:"Success",description:a?"Variance entry updated successfully":"Variance entry added successfully"})},onError:o=>{d({title:"Error",description:o.message||"Failed to save variance entry",variant:"destructive"})}}),F=ie({mutationFn:async o=>{const{error:C}=await D.from("soft_inventory_variance").delete().eq("id",o);if(C)throw C},onSuccess:()=>{N.invalidateQueries({queryKey:["soft-inventory-variance"]}),N.invalidateQueries({queryKey:["soft-inventory-charts"]}),N.invalidateQueries({queryKey:["overview"]}),d({title:"Success",description:"Variance entry deleted successfully"})},onError:o=>{d({title:"Error",description:o.message||"Failed to delete variance entry",variant:"destructive"})}}),h=v.useMemo(()=>x.length===0?ve.reduce((o,C)=>({...o,[C.key]:{totalEntries:0,averageVariance:0,positiveVariance:0,negativeVariance:0,bestVariance:0,worstVariance:0}}),{}):ve.reduce((o,C)=>{const O=x.map(z=>z[C.key]),b=O.filter(z=>z>0),T=O.filter(z=>z<0);return o[C.key]={totalEntries:x.length,averageVariance:O.reduce((z,B)=>z+B,0)/O.length,positiveVariance:b.length,negativeVariance:T.length,bestVariance:Math.max(...O),worstVariance:Math.min(...O)},o},{}),[x]),g=v.useMemo(()=>{if(x.length===0)return{totalEntries:0,averageVariance:0,positiveVariance:0,negativeVariance:0};const o=x.flatMap(b=>ve.map(T=>b[T.key])),C=o.filter(b=>b>0),O=o.filter(b=>b<0);return{totalEntries:x.length,averageVariance:o.reduce((b,T)=>b+T,0)/o.length,positiveVariance:C.length,negativeVariance:O.length}},[x]),w=v.useMemo(()=>k.map(o=>({date:o.business_date,formattedDate:q(new Date(o.business_date),"MMM dd"),...ve.reduce((C,O)=>(C[O.label]=o[O.key],C),{})})),[k]),j=o=>{c(o.id),p(!1),E.reset({business_date:o.business_date,bacon_variance:o.bacon_variance||0,beef_4oz_variance:o.beef_4oz_variance||0,beef_small_variance:o.beef_small_variance||0,chicken_breaded_variance:o.chicken_breaded_variance||0,chicken_diced_variance:o.chicken_diced_variance||0,chicken_nuggets_variance:o.chicken_nuggets_variance||0,chicken_nuggets_spicy_variance:o.chicken_nuggets_spicy_variance||0,chicken_patty_3_1_variance:o.chicken_patty_3_1_variance||0,chicken_breaded_spicy_variance:o.chicken_breaded_spicy_variance||0,chicken_strips_variance:o.chicken_strips_variance||0,sausage_patty_variance:o.sausage_patty_variance||0,notes:o.notes||""})},A=o=>{confirm("Are you sure you want to delete this variance entry?")&&F.mutate(o)},V=()=>{c(null),p(!1),E.reset({business_date:q(new Date,"yyyy-MM-dd"),bacon_variance:0,beef_4oz_variance:0,beef_small_variance:0,chicken_breaded_variance:0,chicken_diced_variance:0,chicken_nuggets_variance:0,chicken_nuggets_spicy_variance:0,chicken_patty_3_1_variance:0,chicken_breaded_spicy_variance:0,chicken_strips_variance:0,sausage_patty_variance:0,notes:""})},m=o=>{U.mutate(o)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Soft Inventory Analysis"}),e.jsxs("p",{className:"text-gray-600",children:["Track daily variance percentages for specific food items",i&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),y&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",y.message]})]}),e.jsx(_s,{selectedRange:f.selectedRange,selectedDate:f.selectedDate,onRangeChange:f.handleRangeChange,onDateChange:f.handleDateChange,onClearFilters:f.clearFilters,compact:!0})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:l?"Add New Variance Entry":a?"Edit Variance Entry":"Variance Entry Form"}),!l&&!a&&e.jsxs(R,{onClick:()=>p(!0),className:"bg-wendys-red hover:bg-wendys-dark-red text-white",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Entry"]})]}),(l||a)&&e.jsxs("form",{onSubmit:E.handleSubmit(m),className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(M,{htmlFor:"business_date",children:"Business Date"}),e.jsx(P,{id:"business_date",type:"date",...E.register("business_date"),className:E.formState.errors.business_date?"border-red-500":""}),E.formState.errors.business_date&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:E.formState.errors.business_date.message})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ve.map(o=>{var C;return e.jsxs("div",{children:[e.jsxs(M,{htmlFor:o.key,className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:o.color}}),o.label]}),e.jsx(P,{id:o.key,type:"number",step:"0.01",placeholder:"0.00",...E.register(o.key,{setValueAs:O=>O===""?0:parseFloat(O)}),className:E.formState.errors[o.key]?"border-red-500":""}),E.formState.errors[o.key]&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:(C=E.formState.errors[o.key])==null?void 0:C.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter positive for overage, negative for shortage (e.g., -66.38)"})]},o.key)})}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Xe,{id:"notes",placeholder:"Add any additional notes about this variance...",...E.register("notes"),rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{type:"submit",disabled:U.isPending,className:"bg-wendys-red hover:bg-wendys-dark-red text-white",children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),U.isPending?"Saving...":a?"Update":"Save"]}),e.jsxs(R,{type:"button",variant:"outline",onClick:V,disabled:U.isPending,children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Total Entries",value:g.totalEntries,format:"number",icon:us,trend:"neutral"}),e.jsx(J,{title:"Average Variance",value:g.averageVariance,format:"percentage",icon:Zs,trend:g.averageVariance>=0?"up":"down"}),e.jsx(J,{title:"Positive Variances",value:g.positiveVariance,format:"number",icon:ne,trend:"neutral",suffix:"count"}),e.jsx(J,{title:"Negative Variances",value:g.negativeVariance,format:"number",icon:he,trend:"neutral",suffix:"count"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ue,{title:"Variance Trend by Item",subtitle:"Last 30 days",loading:!w.length&&!y,error:y==null?void 0:y.message,children:w.length>0?e.jsx("div",{className:"h-[400px]",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:w,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(Re,{dataKey:"formattedDate",tick:{fontSize:12},interval:"preserveStartEnd"}),e.jsx(De,{tick:{fontSize:12},tickFormatter:o=>`${o}%`}),e.jsx(Le,{formatter:(o,C)=>[`${o}%`,C],labelFormatter:o=>`Date: ${o}`}),e.jsx(vt,{}),e.jsx(ks,{y:0,stroke:"#666",strokeDasharray:"2 2"}),ve.map(o=>e.jsx(we,{type:"monotone",dataKey:o.label,stroke:o.color,strokeWidth:2,dot:{fill:o.color,strokeWidth:2,r:3},activeDot:{r:5,stroke:o.color,strokeWidth:2}},o.key))]})})}):e.jsx("div",{className:"flex items-center justify-center h-[400px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No variance data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries below to see trends"})]})})}),e.jsx(ue,{title:"Item Performance Summary",subtitle:"Average variance by item",loading:!w.length&&!y,error:y==null?void 0:y.message,children:w.length>0?e.jsx("div",{className:"h-[400px] overflow-y-auto",children:e.jsx("div",{className:"space-y-3",children:ve.map(o=>{const C=h[o.key];return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",style:{color:o.color},children:o.label}),e.jsxs("span",{className:`text-sm font-bold ${C.averageVariance>0?"text-green-600":C.averageVariance<0?"text-red-600":"text-gray-600"}`,children:[C.averageVariance>0?"+":"",C.averageVariance.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Best: ",C.bestVariance.toFixed(1),"%"]}),e.jsxs("span",{children:["Worst: ",C.worstVariance.toFixed(1),"%"]})]})]},o.key)})})}):e.jsx("div",{className:"flex items-center justify-center h-[400px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No variance data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries below to see performance"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Variance Entries"}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No variance entries found"}),e.jsx("p",{className:"text-sm mt-1",children:"Add your first entry using the form above"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Date"}),ve.map(o=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:o.label},o.key)),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Notes"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(o=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:q(new Date(o.business_date),"MMM dd, yyyy")}),ve.map(C=>{const O=o[C.key];return e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`font-medium ${O>0?"text-green-600":O<0?"text-red-600":"text-gray-600"}`,children:[O>0?"+":"",O.toFixed(1),"%"]})},C.key)}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:o.notes||"-"}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>j(o),disabled:F.isPending,children:e.jsx(Ae,{className:"h-3 w-3"})}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>A(o.id),disabled:F.isPending,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ne,{className:"h-3 w-3"})})]})})]},o.id))})]})})]})]})}function _r({columns:s,data:n,className:a,emptyMessage:c="No data available",loading:l=!1}){const[p,d]=v.useState(null),[N,f]=v.useState(null),S=v.useMemo(()=>!p||!N?n:[...n].sort((y,k)=>{const E=y[p],U=k[p];if(E==null&&U==null)return 0;if(E==null)return N==="asc"?-1:1;if(U==null)return N==="asc"?1:-1;if(typeof E=="number"&&typeof U=="number")return N==="asc"?E-U:U-E;if(typeof E=="string"&&typeof U=="string")return N==="asc"?E.localeCompare(U):U.localeCompare(E);if(E instanceof Date&&U instanceof Date)return N==="asc"?E.getTime()-U.getTime():U.getTime()-E.getTime();const F=String(E),h=String(U);return N==="asc"?F.localeCompare(h):h.localeCompare(F)}),[n,p,N]),x=y=>{p===y?N==="asc"?f("desc"):N==="desc"&&(f(null),d(null)):(d(y),f("asc"))},i=y=>p!==y?e.jsx(Ms,{className:"h-3 w-3 text-gray-400"}):N==="asc"?e.jsx(bt,{className:"h-3 w-3 text-gray-600"}):N==="desc"?e.jsx(Ls,{className:"h-3 w-3 text-gray-600"}):e.jsx(Ms,{className:"h-3 w-3 text-gray-400"});return l?e.jsx(Nr,{columns:s}):e.jsx("div",{className:I("overflow-x-auto",a),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(y=>e.jsx("th",{className:I("py-3 px-4 font-medium text-gray-700 text-sm",y.align==="center"&&"text-center",y.align==="right"&&"text-right",y.sortable&&"cursor-pointer hover:bg-gray-100 select-none",y.className),onClick:()=>y.sortable&&x(y.key),children:e.jsxs("div",{className:I("flex items-center gap-1",y.align==="center"&&"justify-center",y.align==="right"&&"justify-end"),children:[y.label,y.sortable&&i(y.key)]})},y.key))})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:c})}):S.map((y,k)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:s.map(E=>e.jsx("td",{className:I("py-3 px-4 text-sm",E.align==="center"&&"text-center",E.align==="right"&&"text-right",E.className),children:E.render?E.render(y[E.key],y):y[E.key]},E.key))},y.id||k))})]})})}function Nr({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(n=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},n.key))})}),e.jsx("tbody",{children:[...Array(5)].map((n,a)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(c=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},c.key))},a))})]})})})}const wr=ge("/smg")({component:jr});function jr(){const[s,n]=v.useState(null),[a,c]=v.useState(),{toast:l}=de(),p=Ue(),d=$e({resolver:He(dr),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});v.useEffect(()=>{let h=!0;return(async()=>{var V;const{data:g}=await D.auth.getUser(),w=(V=g.user)==null?void 0:V.id;if(!w)return;const{data:j,error:A}=await D.from("users").select("store_id").eq("id",w).maybeSingle();h&&(A||n((j==null?void 0:j.store_id)??null))})(),()=>{h=!1}},[]);const{data:N=[],isLoading:f,error:S}=se({queryKey:["smg_daily",s],queryFn:async()=>{if(!s)return[];const{data:h,error:g}=await D.from("smg_daily").select("*").eq("store_id",s).order("date",{ascending:!1});if(g)throw g;return h||[]},enabled:!!s}),{data:x=[]}=se({queryKey:["smg_entries_import",s],queryFn:async()=>{if(!s)return[];const{data:h,error:g}=await D.from("smg_entries").select("*").eq("store_id",s).order("entry_date",{ascending:!1});if(g)throw g;return h||[]},enabled:!!s}),i=v.useMemo(()=>N.length>0?N:x.length?x.map(h=>({id:h.id,date:h.entry_date,accuracy_decimal:Number(h.accuracy_of_order)||0,zod_per_10k:Number(h.zone_of_defection)||0,cc_complaints:Number(h.customer_computers)||0,osat_decimal:Number(h.osat)||0,notes:"",created_at:h.created_at})):[],[N,x]),y=ie({mutationFn:async h=>{if(!s)throw new Error("Store not connected");const{error:g}=await D.from("smg_daily").insert({store_id:s,date:h.date,accuracy_decimal:h.accuracy_decimal,zod_per_10k:h.zod_per_10k,cc_complaints:h.cc_complaints,osat_decimal:h.osat_decimal,notes:h.notes||null});if(g)throw g},onSuccess:()=>{p.invalidateQueries({queryKey:["smg_daily",s]}),d.reset(),c(void 0),l({title:"Success",description:"SMG entry saved successfully."})},onError:h=>{l({title:"Error",description:h.message||"Failed to save SMG entry.",variant:"destructive"})}}),k=h=>{y.mutate(h)},E=h=>{const g=Number(h.slice(0,4)),w=Number(h.slice(5,7)),j=Number(h.slice(8,10));return new Date(g,(w||1)-1,j||1)},U=[{key:"date",label:"Date",sortable:!0,render:h=>q(E(h),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:h=>(h??0).toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:h=>(h??0).toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:h=>(h??0).toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:h=>(h??0).toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:h=>e.jsx("div",{className:"max-w-32 truncate",title:h,children:h||"-"})}],F=v.useMemo(()=>i.length?i.slice().reverse().map(h=>({date:Z.dateShort(h.date),osat:h.osat_decimal})):[],[i]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),S&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",S.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:d.handleSubmit(k),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"date",children:"Date *"}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(R,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),a?q(a,"MMM dd, yyyy"):"Select date"]})}),e.jsx(ss,{className:"w-auto p-0",align:"start",children:e.jsx(Ke,{mode:"single",selected:a,onSelect:h=>{c(h),h&&d.setValue("date",q(h,"yyyy-MM-dd"))},initialFocus:!0})})]}),d.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(P,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("accuracy_decimal",{valueAsNumber:!0})}),d.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(P,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("zod_per_10k",{valueAsNumber:!0})}),d.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(P,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("cc_complaints",{valueAsNumber:!0})}),d.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(P,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("osat_decimal",{valueAsNumber:!0})}),d.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(M,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...d.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(R,{type:"submit",disabled:y.isPending||!s,className:"bg-wendys-red hover:bg-wendys-red/90",children:y.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(ue,{title:"OSAT Score Trend",subtitle:`${i.length} entries`,loading:f,error:S==null?void 0:S.message,children:F.length>0?e.jsx(be,{width:"100%",height:300,children:e.jsxs(Fe,{data:F,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:h=>(h??0).toFixed(1)}),e.jsx(Le,{...Q.tooltip,formatter:h=>[(h??0).toFixed(2),"OSAT Score"]}),e.jsx(we,{type:"monotone",dataKey:"osat",stroke:K.sales,strokeWidth:3,dot:{fill:K.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:K.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:f?"Loading...":`${i.length} entries`})]}),s?e.jsx(_r,{columns:U,data:i,loading:f,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const zs=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create Soft Inventory Analysis table
CREATE TABLE soft_inventory_variance (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  business_date date NOT NULL,
  bacon_variance numeric(10,2) NOT NULL DEFAULT 0,
  beef_4oz_variance numeric(10,2) NOT NULL DEFAULT 0,
  beef_small_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_breaded_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_diced_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_nuggets_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_nuggets_spicy_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_patty_3_1_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_breaded_spicy_variance numeric(10,2) NOT NULL DEFAULT 0,
  chicken_strips_variance numeric(10,2) NOT NULL DEFAULT 0,
  sausage_patty_variance numeric(10,2) NOT NULL DEFAULT 0,
  notes text,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON soft_inventory_variance (store_id, business_date);

-- Enable RLS for soft_inventory_variance
ALTER TABLE soft_inventory_variance ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for soft_inventory_variance
CREATE POLICY "Users can view their store's soft inventory variance data" ON soft_inventory_variance
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert soft inventory variance data for their store" ON soft_inventory_variance
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's soft inventory variance data" ON soft_inventory_variance
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's soft inventory variance data" ON soft_inventory_variance
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
CREATE INDEX idx_soft_inventory_variance_store_date ON soft_inventory_variance(store_id, business_date);
`,Ws=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, theoretical_food_cost, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 3750.00, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 3540.00, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 3960.00, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 3450.00, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 3840.00, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 3630.00, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 4050.00, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 3360.00, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 3870.00, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 3480.00, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 3690.00, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 3570.00, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 3930.00, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 3510.00, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 3780.00, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 3600.00, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 4020.00, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 3420.00, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 3810.00, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 3540.00, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 3900.00, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 3480.00, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 3720.00, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 3660.00, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 3990.00, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 3390.00, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 3840.00, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 3570.00, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 3960.00, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 3450.00, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 3810.00, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 3510.00, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 3750.00, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 3630.00, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 3900.00, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'COMPLETED', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,Er=ge("/setup")({component:Sr});function $s(s){navigator.clipboard.writeText(s)}function Sr(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase → Auth → Providers → Email: enable. Then Auth → Users → Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase → SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(R,{onClick:()=>$s(zs),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:zs})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(R,{onClick:()=>$s(Ws),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:Ws})]})]})}const fs=Na,ys=wa,Ze=v.forwardRef(({className:s,children:n,...a},c)=>e.jsxs(_t,{ref:c,className:I("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[n,e.jsx(ya,{asChild:!0,children:e.jsx(Ls,{className:"h-4 w-4 opacity-50"})})]}));Ze.displayName=_t.displayName;const Ut=v.forwardRef(({className:s,...n},a)=>e.jsx(Nt,{ref:a,className:I("flex cursor-default items-center justify-center py-1",s),...n,children:e.jsx(bt,{className:"h-4 w-4"})}));Ut.displayName=Nt.displayName;const Pt=v.forwardRef(({className:s,...n},a)=>e.jsx(wt,{ref:a,className:I("flex cursor-default items-center justify-center py-1",s),...n,children:e.jsx(Ls,{className:"h-4 w-4"})}));Pt.displayName=wt.displayName;const es=v.forwardRef(({className:s,children:n,position:a="popper",...c},l)=>e.jsx(pa,{children:e.jsxs(jt,{ref:l,className:I("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...c,children:[e.jsx(Ut,{}),e.jsx(va,{className:I("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx(Pt,{})]})}));es.displayName=jt.displayName;const kr=v.forwardRef(({className:s,...n},a)=>e.jsx(Et,{ref:a,className:I("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...n}));kr.displayName=Et.displayName;const le=v.forwardRef(({className:s,children:n,...a},c)=>e.jsxs(St,{ref:c,className:I("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ba,{children:e.jsx(lt,{className:"h-4 w-4"})})}),e.jsx(_a,{children:n})]}));le.displayName=St.displayName;const Cr=v.forwardRef(({className:s,...n},a)=>e.jsx(kt,{ref:a,className:I("-mx-1 my-1 h-px bg-muted",s),...n}));Cr.displayName=kt.displayName;const qt=[{value:"banner-video.mp4",label:"Banner Video (Original)"},{value:"banner-video (2).mp4",label:"Banner Video 2"},{value:"video-banner.mp4",label:"Video Banner"},{value:"dashboard-8_30_2025, 8_58 PM.mp4",label:"Dashboard Demo"}];function ws(){try{const s=localStorage.getItem("available-videos");if(s)return JSON.parse(s).map(l=>({...l,lastModified:l.lastModified?new Date(l.lastModified):void 0})).filter((l,p,d)=>p===d.findIndex(N=>N.value===l.value))}catch(s){console.error("Error loading videos from localStorage:",s)}return qt}function Is(s){try{localStorage.setItem("available-videos",JSON.stringify(s))}catch(n){console.error("Error saving videos to localStorage:",n)}}function Tr(s){const n=ws(),a=n.findIndex(l=>l.value===s.value);let c;return a>=0?(c=[...n],c[a]=s):c=[...n,s],Is(c),c}function Rr(s){const a=ws().filter(c=>c.value!==s);return Is(a),a}function Dr(s){if(!s.type.startsWith("video/"))return{valid:!1,error:"Please select a video file"};if(s.size>50*1024*1024)return{valid:!1,error:"Video file must be less than 50MB"};const n=[".mp4",".webm",".avi",".mov",".mkv"],a=s.name.toLowerCase().substring(s.name.lastIndexOf("."));return n.includes(a)?{valid:!0}:{valid:!1,error:"Unsupported video format. Please use MP4, WebM, AVI, MOV, or MKV"}}function Lr(s){const n=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(s)/Math.log(1024));return Math.round(s/Math.pow(1024,a)*100)/100+" "+n[a]}function Ar(s){return{value:s.name,label:s.name.replace(/\.[^/.]+$/,""),size:s.size,lastModified:new Date(s.lastModified),type:s.type}}function Hs(s){return new Promise(n=>{const a=document.createElement("video");a.onloadedmetadata=()=>{n({duration:a.duration,width:a.videoWidth,height:a.videoHeight})},a.onerror=()=>n(null),a.src=`/${s}`})}function Ir(){return localStorage.removeItem("available-videos"),qt}function Mr(){const s=ws();return Is(s),s}function Vr({selectedVideo:s,onVideoChange:n,onVideosUpdate:a}){const[c,l]=v.useState([]),[p,d]=v.useState(!1),[N,f]=v.useState(!1),[S,x]=v.useState(null),[i,y]=v.useState({}),k=v.useRef(null),{toast:E}=de(),U=async()=>{try{const g=Mr();l(g),a(g);const w={};for(const j of g){const A=await Hs(j.value);A&&(w[j.value]=A)}y(w)}catch(g){console.error("Error loading videos:",g),E({title:"Error",description:"Failed to load video list",variant:"destructive"})}};v.useEffect(()=>{U()},[]);const F=async g=>{var A;const w=(A=g.target.files)==null?void 0:A[0];if(!w)return;const j=Dr(w);if(!j.valid){E({title:"Invalid File",description:j.error,variant:"destructive"});return}d(!0);try{const V=Ar(w),m=Tr(V);l(m),a(m);const o=await Hs(V.value);o&&y(C=>({...C,[V.value]:o})),E({title:"Success",description:`Video "${V.label}" added successfully. Note: In a production app, this would upload to a server.`}),k.current&&(k.current.value="")}catch(V){console.error("Error uploading video:",V),E({title:"Upload Failed",description:"Failed to add video file",variant:"destructive"})}finally{d(!1)}},h=g=>{if(g===s){E({title:"Cannot Delete",description:"Cannot delete the currently selected video",variant:"destructive"});return}const w=c.find(j=>j.value===g);if(w&&window.confirm(`Are you sure you want to delete "${w.label}"?`)){const j=Rr(g);l(j),a(j),y(A=>{const V={...A};return delete V[g],V}),E({title:"Deleted",description:`Video "${w.label}" has been removed`})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Banner Video"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>f(!N),className:"flex items-center gap-2",children:[e.jsx(ps,{className:"h-4 w-4"}),"Manage Videos"]}),e.jsxs(fs,{value:s,onValueChange:n,children:[e.jsx(Ze,{className:"w-[200px]",children:e.jsx(ys,{placeholder:"Select video"})}),e.jsx(es,{children:c.map(g=>e.jsx(le,{value:g.value,children:g.label},g.value))})]})]})]}),N&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:"Video Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>{if(window.confirm("Reset all videos to defaults? This will remove any custom videos you've added.")){const g=Ir();l(g),a(g),E({title:"Reset Complete",description:"Videos have been reset to defaults"})}},className:"text-xs",children:"Reset to Defaults"}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>f(!1),children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ja,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Upload a new video file"}),e.jsx("input",{ref:k,type:"file",accept:"video/*",onChange:F,className:"hidden",disabled:p}),e.jsxs(R,{variant:"outline",onClick:()=>{var g;return(g=k.current)==null?void 0:g.click()},disabled:p,className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),p?"Uploading...":"Choose Video File"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supported formats: MP4, WebM, AVI. Max size: 50MB"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium text-wendys-charcoal",children:"Available Videos"}),e.jsx("div",{className:"space-y-2",children:c.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(hs,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:g.label}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:[g.size?Lr(g.size):"Unknown size",g.lastModified&&` • ${g.lastModified.toLocaleDateString()}`]}),i[g.value]&&e.jsxs("p",{children:[i[g.value].width,"x",i[g.value].height," •",Math.round(i[g.value].duration),"s"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>x(g.value),children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>h(g.value),disabled:g.value===s,className:"text-red-600 hover:text-red-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]},g.value))})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-4xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:"Video Preview"}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>x(null),children:e.jsx(Je,{className:"h-4 w-4"})})]}),e.jsx("video",{src:`/${S}`,controls:!0,className:"w-full rounded-lg",style:{maxHeight:"60vh"},children:"Your browser does not support the video tag."})]})})]})}function Or({onAuthenticated:s,onPasswordChange:n,currentPassword:a}){const[c,l]=v.useState(""),[p,d]=v.useState(!1),[N,f]=v.useState(!1),[S,x]=v.useState(""),[i,y]=v.useState(""),[k,E]=v.useState(!1),[U,F]=v.useState(!1),[h,g]=v.useState(""),{toast:w}=de(),j=()=>{c===a?(g(""),s(),w({title:"Access Granted",description:"Successfully authenticated to settings."})):g("Incorrect password. Please try again.")},A=()=>{if(S!==i){g("New passwords do not match.");return}if(S.length<4){g("Password must be at least 4 characters long.");return}n(S),x(""),y(""),f(!1),g(""),w({title:"Password Updated",description:"Settings password has been changed successfully."})},V=m=>{m.key==="Enter"&&(N?A():j())};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-wendys-red/10 rounded-full flex items-center justify-center mb-4",children:e.jsx(Se,{className:"h-6 w-6 text-wendys-red"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:N?"Change Settings Password":"Settings Access"}),e.jsx("p",{className:"text-gray-600 mt-2",children:N?"Enter a new password to protect the settings page":"Enter the settings password to continue"})]}),N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"newPassword",className:"text-wendys-charcoal font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"newPassword",type:k?"text":"password",placeholder:"Enter new password",className:"pl-10 pr-10",value:S,onChange:m=>x(m.target.value),onKeyPress:V}),e.jsx("button",{type:"button",onClick:()=>E(!k),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:k?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"confirmPassword",className:"text-wendys-charcoal font-medium",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"confirmPassword",type:U?"text":"password",placeholder:"Confirm new password",className:"pl-10 pr-10",value:i,onChange:m=>y(m.target.value),onKeyPress:V}),e.jsx("button",{type:"button",onClick:()=>F(!U),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:U?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{onClick:A,className:"flex-1 wendys-button",disabled:!S.trim()||!i.trim(),children:"Update Password"}),e.jsx(R,{onClick:()=>{f(!1),g(""),x(""),y("")},variant:"outline",className:"flex-1",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Settings Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"password",type:p?"text":"password",placeholder:"Enter settings password",className:"pl-10 pr-10",value:c,onChange:m=>l(m.target.value),onKeyPress:V}),e.jsx("button",{type:"button",onClick:()=>d(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:p?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:h})]}),e.jsx(R,{onClick:j,className:"w-full wendys-button",disabled:!c.trim(),children:"Access Settings"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>f(!0),className:"text-sm text-wendys-red hover:text-wendys-red/80 underline",children:"Change Password"})})]})]})})})}const Fr=ge("/settings")({component:Ur});function Ur(){var O;const[s,n]=v.useState("banner-video.mp4"),[a,c]=v.useState([]),[l,p]=v.useState(!1),[d,N]=v.useState(""),[f,S]=v.useState(!1),[x,i]=v.useState(""),[y,k]=v.useState(""),[E,U]=v.useState(!1),[F,h]=v.useState(!1),[g,w]=v.useState(""),{toast:j}=de();v.useEffect(()=>{const b=localStorage.getItem("banner-video-selection");b&&n(b);const T=localStorage.getItem("settings-password");if(T)N(T);else{const z="admin123";N(z),localStorage.setItem("settings-password",z)}},[]);const A=b=>{n(b),localStorage.setItem("banner-video-selection",b)},V=b=>{if(c(b),!b.some(T=>T.value===s)&&b.length>0){const T=b[0].value;n(T),localStorage.setItem("banner-video-selection",T)}},m=()=>{p(!0)},o=b=>{N(b),localStorage.setItem("settings-password",b)},C=()=>{if(x!==y){w("Passwords do not match.");return}if(x.length<4){w("Password must be at least 4 characters long.");return}N(x),localStorage.setItem("settings-password",x),i(""),k(""),S(!1),w(""),j({title:"Password Updated",description:"Settings password has been changed successfully."})};return l?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ps,{className:"h-8 w-8 text-wendys-red"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure your dashboard preferences and appearance"})]})]}),e.jsx(R,{onClick:()=>p(!1),variant:"outline",className:"text-wendys-red border-wendys-red hover:bg-wendys-red hover:text-white",children:"Lock Settings"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(hs,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Banner Video Settings"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Manage your banner videos for the overview page. Upload new videos, delete unwanted ones, and preview them before selecting."}),e.jsx(Vr,{selectedVideo:s,onVideoChange:A,onVideosUpdate:V})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ea,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Current Video"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Selected Video:"}),e.jsx("p",{className:"text-gray-600",children:((O=a.find(b=>b.value===s))==null?void 0:O.label)||s})]}),e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-32 object-cover",children:[e.jsx("source",{src:`/${s}`,type:"video/mp4"}),e.jsx("p",{children:"Your browser does not support the video tag."})]},s)})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vs,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Quick Actions"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium mb-2",children:"Video Management:"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Upload new videos (MP4, WebM, AVI, MOV, MKV)"}),e.jsx("li",{children:"• Preview videos before selecting"}),e.jsx("li",{children:"• Delete unwanted videos"}),e.jsx("li",{children:"• Reset to default videos"})]})]})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Os,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"System Info"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Videos:"}),e.jsx("span",{className:"font-medium",children:a.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Selected Video:"}),e.jsx("span",{className:"font-medium text-xs truncate max-w-32",children:s})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Storage:"}),e.jsx("span",{className:"font-medium",children:"Local"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Se,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Password Management"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Change the password required to access the settings page."}),f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"newPassword",className:"text-wendys-charcoal font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"newPassword",type:E?"text":"password",placeholder:"Enter new password",className:"pl-10 pr-10",value:x,onChange:b=>i(b.target.value)}),e.jsx("button",{type:"button",onClick:()=>U(!E),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:E?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"confirmPassword",className:"text-wendys-charcoal font-medium",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{id:"confirmPassword",type:F?"text":"password",placeholder:"Confirm new password",className:"pl-10 pr-10",value:y,onChange:b=>k(b.target.value)}),e.jsx("button",{type:"button",onClick:()=>h(!F),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:F?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:g})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{onClick:C,className:"flex-1 wendys-button",disabled:!x.trim()||!y.trim(),children:"Update Password"}),e.jsx(R,{onClick:()=>{S(!1),w(""),i(""),k("")},variant:"outline",className:"flex-1",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• Current password is set and active"}),e.jsx("p",{children:"• Password protects access to all settings"}),e.jsx("p",{children:"• Click below to change the password"})]}),e.jsx(R,{onClick:()=>S(!0),className:"wendys-button",children:"Change Password"})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vs,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Appearance"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Customize the look and feel of your dashboard."}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• Theme customization (coming soon)"}),e.jsx("p",{children:"• Color scheme options (coming soon)"}),e.jsx("p",{children:"• Layout preferences (coming soon)"})]})})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Os,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Data Management"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Manage your data and storage preferences."}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"• Data export options (coming soon)"}),e.jsx("p",{children:"• Backup and restore (coming soon)"}),e.jsx("p",{children:"• Cache management (coming soon)"})]})})]})]}):e.jsx(Or,{onAuthenticated:m,onPasswordChange:o,currentPassword:d})}function Pr({data:s=[]}){const n=v.useMemo(()=>{if(!s.length){const a=[];for(let c=13;c>=0;c--){const l=new Date;l.setDate(l.getDate()-c),a.push({date:Z.dateShort(l.toISOString().slice(0,10)),sales:0})}return a}return s.sort((a,c)=>new Date(a.business_date).getTime()-new Date(c.business_date).getTime()).slice(-30).map(a=>({date:Z.dateShort(a.business_date),sales:a.net_sales||0}))},[s]);return e.jsx(be,{width:"100%",height:300,children:e.jsxs(Fe,{data:n,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:a=>Z.currencyCompact(a)}),e.jsx(Le,{...Q.tooltip,formatter:a=>[Z.currencyDetailed(a),"Net Sales"]}),e.jsx(we,{type:"monotone",dataKey:"sales",stroke:K.sales,strokeWidth:3,dot:{fill:K.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:K.salesSecondary,strokeWidth:2}})]})})}function qr({data:s=[]}){console.log("🔍 LaborVsIdealChart received data:",s.slice(0,3));const n=v.useMemo(()=>{if(!s.length){const c=[];for(let l=6;l>=0;l--){const p=new Date;p.setDate(p.getDate()-l),c.push({date:Z.dateShort(p.toISOString().slice(0,10)),ideal:0,actual:0})}return c}const a=s.sort((c,l)=>new Date(c.business_date).getTime()-new Date(l.business_date).getTime()).slice(-30).map(c=>{const l=Number(c.ideal_labor_hours)||0,p=Number(c.labor_hours)||0;return console.log("🔍 Processing entry:",c.business_date,"ideal:",c.ideal_labor_hours,"=>",l,"actual:",c.labor_hours,"=>",p),{date:Z.dateShort(c.business_date),ideal:l,actual:p}});return console.log("🔍 Processed chart data:",a.slice(0,3)),a},[s]);return console.log("🔍 Final chartData being rendered:",n.slice(0,3)),e.jsx(be,{width:"100%",height:300,children:e.jsxs(Ct,{data:n,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:a=>Z.hours(a)}),e.jsx(Le,{...Q.tooltip,formatter:(a,c)=>[Z.hours(a),c==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(vt,{...Q.legend}),e.jsx(Tt,{dataKey:"ideal",fill:K.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(we,{type:"monotone",dataKey:"actual",stroke:K.labor,strokeWidth:3,dot:{fill:K.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:K.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function zr(){const[s,n]=v.useState(null);v.useEffect(()=>{let x=!0;return(async()=>{var y;const{data:i}=await D.from("users").select("store_id").eq("id",(y=(await D.auth.getUser()).data.user)==null?void 0:y.id).single();x&&n((i==null?void 0:i.store_id)??null)})(),()=>{x=!1}},[]);const{data:a=[],isLoading:c}=se({queryKey:["smg_snapshot",s],queryFn:async()=>{if(!s)return[];const x=new Date;x.setDate(x.getDate()-30);const{data:i,error:y}=await D.from("smg_daily").select("*").eq("store_id",s).gte("date",x.toISOString().split("T")[0]).order("date",{ascending:!1});if(y)throw y;return i||[]},enabled:!!s}),l=a.length>0?{accuracy:a.reduce((x,i)=>x+i.accuracy_decimal,0)/a.length,zod:a.reduce((x,i)=>x+i.zod_per_10k,0)/a.length,complaints:a.reduce((x,i)=>x+i.cc_complaints,0)/a.length,osat:a.reduce((x,i)=>x+i.osat_decimal,0)/a.length}:{accuracy:0,zod:0,complaints:0,osat:0},p=x=>{if(x.length<4)return"neutral";const i=Math.floor(x.length/2),y=x.slice(0,i).reduce((U,F)=>U+F,0)/i,E=x.slice(i).reduce((U,F)=>U+F,0)/(x.length-i)-y;return Math.abs(E)<.1?"neutral":E>0?"up":"down"},d={accuracy:p(a.map(x=>x.accuracy_decimal).reverse()),zod:p(a.map(x=>x.zod_per_10k).reverse()),complaints:p(a.map(x=>x.cc_complaints).reverse()),osat:p(a.map(x=>x.osat_decimal).reverse())},N=(x,i=!1)=>i?x<=1?"text-green-600":x<=3?"text-yellow-600":"text-red-600":x>=90?"text-green-600":x>=80?"text-yellow-600":"text-red-600",f=(x,i=!1)=>i?x<=1?e.jsx(Qe,{className:"h-4 w-4 text-green-600"}):x<=3?e.jsx(fe,{className:"h-4 w-4 text-yellow-600"}):e.jsx(fe,{className:"h-4 w-4 text-red-600"}):x>=90?e.jsx(Qe,{className:"h-4 w-4 text-green-600"}):x>=80?e.jsx(fe,{className:"h-4 w-4 text-yellow-600"}):e.jsx(fe,{className:"h-4 w-4 text-red-600"}),S=x=>{switch(x){case"up":return e.jsx(ne,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(he,{className:"h-3 w-3 text-red-600"});default:return null}};return c?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((x,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},i))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(ke,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[a.length," entries"]})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ke,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ke,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S(d.osat),f(l.osat),e.jsx("span",{className:I("text-xl font-bold",N(l.osat)),children:(l.osat??0).toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Qe,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S(d.accuracy),f(l.accuracy),e.jsx("span",{className:I("text-xl font-bold",N(l.accuracy)),children:(l.accuracy??0).toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S(d.zod==="up"?"down":d.zod==="down"?"up":"neutral"),f(l.zod,!0),e.jsx("span",{className:I("text-xl font-bold",N(l.zod,!0)),children:(l.zod??0).toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S(d.complaints==="up"?"down":d.complaints==="down"?"up":"neutral"),f(l.complaints,!0),e.jsx("span",{className:I("text-xl font-bold",N(l.complaints,!0)),children:(l.complaints??0).toFixed(1)})]})]})]})]})}function Wr(){const[s,n]=v.useState(null),a=q(new Date,"EEEE, MMMM d"),c=q(new Date,"yyyy-MM-dd");v.useEffect(()=>{let N=!0;return(async()=>{var k;console.log("🔐 [InterviewsToday] Checking user authentication...");const{data:f,error:S}=await D.auth.getUser();console.log("👤 [InterviewsToday] Auth data:",f,"Auth error:",S);const x=(k=f.user)==null?void 0:k.id;if(!x){console.log("❌ [InterviewsToday] No user ID found - user not authenticated");return}console.log("🔍 [InterviewsToday] Looking up store for user:",x);const{data:i,error:y}=await D.from("users").select("store_id").eq("id",x).maybeSingle();if(console.log("🏪 [InterviewsToday] Store lookup result - data:",i,"error:",y),!!N){if(y){console.error("❌ [InterviewsToday] Store lookup error:",y);return}n((i==null?void 0:i.store_id)??null),console.log("✅ [InterviewsToday] Store ID set to:",(i==null?void 0:i.store_id)??null)}})(),()=>{N=!1}},[]);const{data:l=[],isLoading:p}=se({queryKey:["interviews-today",s,c],queryFn:async()=>{if(!s)return[];const{data:N,error:f}=await D.from("interviews").select("*").eq("store_id",s).eq("interview_date",c).order("interview_time",{ascending:!0});if(f)throw f;return N||[]},enabled:!!s}),d=N=>q(new Date(`2000-01-01T${N}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:a})]})]}),p?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ut,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:l.map(N=>e.jsx(xs,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:N.candidate_name}),e.jsx("span",{className:$r("px-2 py-1 text-xs font-medium rounded-full",Rt(N.status)),children:N.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(As,{className:"h-3 w-3"}),e.jsx("span",{children:N.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(We,{className:"h-3 w-3"}),e.jsx("span",{children:d(N.interview_time)})]})]}),N.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',N.notes,'"']})]})})},N.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(xs,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"→"})]})})]})}function $r(...s){return s.filter(Boolean).join(" ")}const Hr=ge("/overview")({component:Kr});function Kr(){const[s,n]=v.useState(null),[a,c]=v.useState("banner-video.mp4"),[l,p]=v.useState([]),d=Ns("overview","today");v.useEffect(()=>{const j=ws();p(j);const A=localStorage.getItem("banner-video-selection");A&&j.some(V=>V.value===A)?c(A):j.length>0&&c(j[0].value)},[]);const N=j=>{c(j),localStorage.setItem("banner-video-selection",j)};v.useEffect(()=>{let j=!0;return(async()=>{var C;const{data:A}=await D.auth.getUser(),V=(C=A.user)==null?void 0:C.id;if(!V)return;const{data:m,error:o}=await D.from("users").select("store_id").eq("id",V).maybeSingle();if(j){if(o){console.error("Error fetching store ID:",o);return}n((m==null?void 0:m.store_id)??null)}})(),()=>{j=!1}},[]);const f=d.getDateRangeFilter(),{data:S=[]}=se({queryKey:["overview-charts",s],queryFn:async()=>{if(!s)return[];const j=new Date;j.setDate(j.getDate()-30);const A=j.toISOString().slice(0,10),{data:V,error:m}=await D.from("omega_daily").select("*").eq("store_id",s).gte("business_date",A).order("business_date",{ascending:!0});if(m)throw m;return V||[]},enabled:!!s}),{data:x=[],isLoading:i,error:y}=se({queryKey:["overview-omega",s,f==null?void 0:f.start,f==null?void 0:f.end],queryFn:async()=>{if(!s)return[];let j=D.from("omega_daily").select("*").eq("store_id",s);f&&(j=j.gte("business_date",f.start).lte("business_date",f.end));const{data:A,error:V}=await j.order("business_date",{ascending:!0});if(V)throw V;return A||[]},enabled:!!s}),{data:k=[]}=se({queryKey:["overview-weekending",s,f==null?void 0:f.start,f==null?void 0:f.end],queryFn:async()=>{if(!s)return[];console.log("📊 Fetching overview weekending data with filters:",{storeId:s,dateRangeFilter:f,queryKey:["overview-weekending",s,f==null?void 0:f.start,f==null?void 0:f.end]}),console.log("📊 Date range details:",{start:f==null?void 0:f.start,end:f==null?void 0:f.end,hasFilter:!!f});let j=D.from("weekending_sheet").select("*").eq("store_id",s);f&&(j=j.gte("week_ending_date",f.start).lte("week_ending_date",f.end));const{data:A,error:V}=await j.order("week_ending_date",{ascending:!0});if(V)throw V;return console.log("📊 Overview weekending data fetched:",(A==null?void 0:A.length)||0,"entries"),A||[]},enabled:!!s}),{data:E=[]}=se({queryKey:["overview-weekending-charts",s],queryFn:async()=>{if(!s)return[];const j=new Date;j.setDate(j.getDate()-84);const A=j.toISOString().slice(0,10);console.log("📈 Fetching overview weekending chart data:",{storeId:s,startDate:A,queryKey:["overview-weekending-charts",s]});const{data:V,error:m}=await D.from("weekending_sheet").select("*").eq("store_id",s).gte("week_ending_date",A).order("week_ending_date",{ascending:!0});if(m)throw m;return console.log("📈 Overview weekending chart data fetched:",(V==null?void 0:V.length)||0,"entries"),V||[]},enabled:!!s}),{data:U=[]}=se({queryKey:["overview-soft-inventory",s,f==null?void 0:f.start,f==null?void 0:f.end],queryFn:async()=>{if(!s)return[];let j=D.from("soft_inventory_variance").select("*").eq("store_id",s);f&&(j=j.gte("business_date",f.start).lte("business_date",f.end));const{data:A,error:V}=await j.order("business_date",{ascending:!0});if(V)throw V;return A||[]},enabled:!!s}),{data:F=[]}=se({queryKey:["overview-soft-inventory-charts",s],queryFn:async()=>{if(!s)return[];const j=new Date;j.setDate(j.getDate()-30);const A=j.toISOString().slice(0,10),{data:V,error:m}=await D.from("soft_inventory_variance").select("*").eq("store_id",s).gte("business_date",A).order("business_date",{ascending:!0});if(m)throw m;return V||[]},enabled:!!s}),h=v.useMemo(()=>{if(x.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const j=x.reduce((o,C)=>({netSales:o.netSales+(C.net_sales||0),compNetSales:o.compNetSales+((C.net_sales||0)-(C.last_year_sales||0)),laborHours:o.laborHours+(C.labor_hours||0),idealLaborHours:o.idealLaborHours+(C.ideal_labor_hours||0),foodVarianceCost:o.foodVarianceCost+(C.food_variance_cost||0),wasteAmount:o.wasteAmount+(C.waste_amount||0),breakfastSales:o.breakfastSales+(C.breakfast_sales||0),nightSales:o.nightSales+(C.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),A=j.netSales>0?j.laborHours/j.netSales*100:0,V=j.netSales>0?j.foodVarianceCost/j.netSales*100:0,m=j.netSales>0?j.wasteAmount/j.netSales*100:0;return{...j,laborPercentage:A,foodVariancePercentage:V,wastePercentage:m}},[x]),g=v.useMemo(()=>{if(k.length===0)return{weeklyNetSales:0,weeklyLabor:0,weeklyFoodVariance:0,weeklyBreakfastSales:0,weeklyLateNightSales:0,weeklyOnboarding:0,weeklyCrewQuiz:0,weeklyMgrQuiz:0,weeklyNewHires:0,weeklyTerminations:0};const j=k.reduce((o,C)=>({weeklyNetSales:o.weeklyNetSales+(C.net_sales||0),weeklyLabor:o.weeklyLabor+(C.labor||0),weeklyFoodVariance:o.weeklyFoodVariance+(C.food_variance_percentage||0),weeklyBreakfastSales:o.weeklyBreakfastSales+(C.breakfast_sales||0),weeklyLateNightSales:o.weeklyLateNightSales+(C.late_night_sales||0),weeklyOnboarding:o.weeklyOnboarding+(C.onboarding?1:0),weeklyCrewQuiz:o.weeklyCrewQuiz+(C.crew_food_safety_quiz||0),weeklyMgrQuiz:o.weeklyMgrQuiz+(C.mgr_food_safety_quiz||0),weeklyNewHires:o.weeklyNewHires+(C.new_hire_name?1:0),weeklyTerminations:o.weeklyTerminations+(C.terminations?1:0)}),{weeklyNetSales:0,weeklyLabor:0,weeklyFoodVariance:0,weeklyBreakfastSales:0,weeklyLateNightSales:0,weeklyOnboarding:0,weeklyCrewQuiz:0,weeklyMgrQuiz:0,weeklyNewHires:0,weeklyTerminations:0}),A=k.length>0?j.weeklyCrewQuiz/k.length:0,V=k.length>0?j.weeklyMgrQuiz/k.length:0,m=k.length>0?j.weeklyFoodVariance/k.length:0;return{...j,avgCrewQuiz:A,avgMgrQuiz:V,avgFoodVariance:m}},[k]),w=v.useMemo(()=>{if(U.length===0)return{totalEntries:0,averageVariance:0,positiveVariance:0,negativeVariance:0,bestVariance:0,worstVariance:0};const j=["bacon_variance","beef_4oz_variance","beef_small_variance","chicken_breaded_variance","chicken_diced_variance","chicken_nuggets_variance","chicken_nuggets_spicy_variance","chicken_patty_3_1_variance","chicken_breaded_spicy_variance","chicken_strips_variance","sausage_patty_variance"],A=U.flatMap(o=>j.map(C=>o[C])),V=A.filter(o=>o>0),m=A.filter(o=>o<0);return{totalEntries:U.length,averageVariance:A.reduce((o,C)=>o+C,0)/A.length,positiveVariance:V.length,negativeVariance:m.length,bestVariance:Math.max(...A),worstVariance:Math.min(...A)}},[U]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",d.getSelectedLabel(),i&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),y&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",y.message]})]}),e.jsx(_s,{selectedRange:d.selectedRange,selectedDate:d.selectedDate,onRangeChange:d.handleRangeChange,onDateChange:d.handleDateChange,onClearFilters:d.clearFilters,compact:!0})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Banner Video"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fs,{value:a,onValueChange:N,children:[e.jsx(Ze,{className:"w-[200px]",children:e.jsx(ys,{placeholder:"Select video"})}),e.jsx(es,{children:l.map(j=>e.jsx(le,{value:j.value,children:j.label},j.value))})]}),e.jsxs("a",{href:"/settings",className:"flex items-center gap-1 text-sm text-gray-600 hover:text-wendys-red transition-colors",title:"Manage videos in Settings",children:[e.jsx(ps,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Manage"})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full rounded-lg shadow-lg opacity-60",style:{height:"200px",objectFit:"cover",width:"100%",pointerEvents:"none"},children:[e.jsx("source",{src:`/${a}`,type:"video/mp4"}),e.jsx("p",{children:"Your browser does not support the video tag."})]},a)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Net Sales",value:h.netSales,format:"currency",delta:h.compNetSales,deltaLabel:"vs Last Year",icon:as,trend:h.compNetSales>=0?"up":"down"}),e.jsx(J,{title:"Labor Hours",value:h.laborHours,format:"number",delta:h.laborHours-h.idealLaborHours,deltaLabel:"vs Ideal",icon:We,trend:h.laborHours>h.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(J,{title:"Labor %",value:h.laborPercentage,format:"percentage",icon:ne,trend:"neutral"}),e.jsx(J,{title:"Food Variance",value:h.foodVarianceCost,format:"currency",delta:h.foodVariancePercentage,deltaLabel:"% of Sales",icon:he,trend:h.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Waste Amount",value:h.wasteAmount,format:"currency",delta:h.wastePercentage,deltaLabel:"% of Sales",icon:he,trend:h.wasteAmount>=0?"down":"up"}),e.jsx(J,{title:"Breakfast Sales",value:h.breakfastSales,format:"currency",icon:as,trend:"neutral"}),e.jsx(J,{title:"Night Sales",value:h.nightSales,format:"currency",icon:as,trend:"neutral"}),e.jsx(J,{title:"Comp Net Sales",value:h.compNetSales,format:"currency",icon:ne,trend:h.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Weekly Net Sales",value:g.weeklyNetSales,format:"currency",icon:as,trend:"neutral"}),e.jsx(J,{title:"Weekly Labor",value:g.weeklyLabor,format:"currency",icon:We,trend:"neutral"}),e.jsx(J,{title:"Avg Food Variance %",value:g.avgFoodVariance,format:"percentage",icon:he,trend:g.avgFoodVariance>=0?"down":"up"}),e.jsx(J,{title:"Weekly Onboarding",value:g.weeklyOnboarding,format:"number",icon:ne,trend:"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Avg Crew Quiz Score",value:g.avgCrewQuiz,format:"number",icon:ne,trend:"neutral",suffix:"/100"}),e.jsx(J,{title:"Avg MGR Quiz Score",value:g.avgMgrQuiz,format:"number",icon:ne,trend:"neutral",suffix:"/100"}),e.jsx(J,{title:"Weekly New Hires",value:g.weeklyNewHires,format:"number",icon:ne,trend:"neutral"}),e.jsx(J,{title:"Weekly Terminations",value:g.weeklyTerminations,format:"number",icon:he,trend:"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(J,{title:"Soft Inventory Entries",value:w.totalEntries,format:"number",icon:us,trend:"neutral"}),e.jsx(J,{title:"Avg Variance %",value:w.averageVariance,format:"percentage",icon:ne,trend:w.averageVariance>=0?"up":"down"}),e.jsx(J,{title:"Positive Variance Days",value:w.positiveVariance,format:"number",icon:ne,trend:"neutral",suffix:"days"}),e.jsx(J,{title:"Negative Variance Days",value:w.negativeVariance,format:"number",icon:he,trend:"neutral",suffix:"days"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ue,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!S.length&&!y,error:y==null?void 0:y.message,children:S.length>0?e.jsx(Pr,{data:S}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(ue,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!S.length&&!y,error:y==null?void 0:y.message,children:S.length>0?e.jsx(qr,{data:S}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ue,{title:"Weekly Net Sales Trend",subtitle:"Last 12 weeks",loading:!E.length&&!y,error:y==null?void 0:y.message,children:E.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:me(g.weeklyNetSales)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Weekly Sales"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[E.length," weeks of data"]})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No weekly data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Weekending Sheet to see trends"})]})})}),e.jsx(ue,{title:"Weekly Training Metrics",subtitle:"Last 12 weeks",loading:!E.length&&!y,error:y==null?void 0:y.message,children:E.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-medium text-wendys-charcoal",children:[(g.avgCrewQuiz??0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Crew Quiz"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-medium text-wendys-charcoal",children:[(g.avgMgrQuiz??0).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Avg MGR Quiz"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:g.weeklyOnboarding}),e.jsx("p",{className:"text-sm text-gray-600",children:"Onboarding"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-wendys-charcoal",children:g.weeklyNewHires}),e.jsx("p",{className:"text-sm text-gray-600",children:"New Hires"})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No training data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Weekending Sheet to see metrics"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Data Integration Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Daily Entries"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:x.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"OMEGA Daily records"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weekly Entries"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:k.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Weekending records"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Soft Inventory"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:U.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Variance entries"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:me(h.netSales+g.weeklyNetSales)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Combined daily + weekly"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Coverage"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:x.length>0||k.length>0||U.length>0?"Active":"No Data"}),e.jsx("p",{className:"text-xs text-gray-500",children:"System status"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ue,{title:"Soft Inventory Variance Trend",subtitle:"Last 30 days",loading:!F.length&&!y,error:y==null?void 0:y.message,children:F.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:w.positiveVariance}),e.jsx("p",{className:"text-sm text-green-600",children:"Positive Variances"})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:w.negativeVariance}),e.jsx("p",{className:"text-sm text-red-600",children:"Negative Variances"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:F.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Entries"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[w.averageVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-blue-600",children:"Average"})]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No soft inventory data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Soft Inventory Analysis to see trends"})]})})}),e.jsx(ue,{title:"Soft Inventory Performance",subtitle:"Variance distribution",loading:!F.length&&!y,error:y==null?void 0:y.message,children:F.length>0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg",children:[e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[w.bestVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-green-600",children:"Best Variance"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-red-50 to-red-100 rounded-lg",children:[e.jsxs("p",{className:"text-3xl font-bold text-red-600",children:[w.worstVariance.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-red-600",children:"Worst Variance"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[F.length," entries tracked"]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No soft inventory data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in Soft Inventory Analysis to see performance"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(zr,{}),e.jsx(Wr,{})]})]})}function Br({columns:s,data:n,mobileCardRender:a,className:c,emptyMessage:l="No data available",loading:p=!1}){if(p)return e.jsx(Yr,{columns:s});const d=N=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:s.map(f=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[f.label,":"]}),e.jsx("span",{className:"text-sm",children:f.render?f.render(N[f.key],N):N[f.key]})]},f.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:I("hidden md:block",c),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(N=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:N.label},N.key))})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:l})}):n.map((N,f)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:s.map(S=>e.jsx("td",{className:I("py-3 px-4 text-sm",S.className),children:S.render?S.render(N[S.key],N):N[S.key]},S.key))},N.id||f))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:l}):n.map((N,f)=>e.jsx("div",{children:a?a(N):d(N)},N.id||f))})})]})}function Yr({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(n=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},n.key))})}),e.jsx("tbody",{children:[...Array(3)].map((n,a)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(c=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},c.key))},a))})]})})})}const Qr=ge("/omega-daily")({component:Gr});function Gr(){const[s,n]=v.useState(!1),[a,c]=v.useState(null),{toast:l}=de(),p=Ue(),[d,N]=v.useState(null),f=Ns("omega-daily","last30"),S=async()=>{if(!d){l({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const t=[],u=new Date;for(let _=9;_>=0;_--){const L=new Date(u);L.setDate(L.getDate()-_),t.push({store_id:d,business_date:q(L,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,theoretical_food_cost:Math.floor(Math.random()*2e3)+3e3,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:r}=await D.from("omega_daily").insert(t);if(r)throw r;l({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),p.invalidateQueries({queryKey:["omega_daily"]})}catch(t){l({title:"Error adding sample data",description:t.message,variant:"destructive"})}},x=()=>{p.invalidateQueries({queryKey:["omega_daily",d]}),p.invalidateQueries({queryKey:["omega_daily_charts",d]}),l({title:"Refreshing data...",description:"Reloading your OMEGA entries and charts."})},i=$e({resolver:He(or),defaultValues:{business_date:q(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,theoretical_food_cost:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),y=ie({onMutate:async t=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");await p.cancelQueries({queryKey:["omega_daily"]});const u=`temp-${Date.now()}`,r={id:u,store_id:d,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,theoretical_food_cost:t.theoretical_food_cost,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales},_=[],L=p.getQueriesData({queryKey:["omega_daily"]});for(const[$,X]of L){const W=$;if(!W.includes(d))continue;let G=!0;const Pe=typeof W[2]=="string"?String(W[2]):void 0,Ee=typeof W[3]=="string"?String(W[3]):void 0;if(Pe&&Ee&&(G=t.business_date>=Pe&&t.business_date<=Ee),!G)continue;const pe=[r,...X||[]];pe.sort((ce,Ie)=>ce.business_date>Ie.business_date?-1:ce.business_date<Ie.business_date?1:0),_.push({queryKey:$,previousData:X}),p.setQueryData($,pe)}return{optimisticId:u,touchedCaches:_}},mutationFn:async t=>{if(console.log("🔄 Starting insertMutation with payload:",t),console.log("🏪 Store ID:",d),!d)throw console.error("❌ No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const u={store_id:d,business_date:t.business_date,net_sales:t.net_sales,last_year_sales:t.last_year_sales,labor_hours:t.labor_hours,ideal_labor_hours:t.ideal_labor_hours,labor_percentage:t.labor_percentage,theoretical_food_cost:t.theoretical_food_cost,food_variance_cost:t.food_variance_cost,waste_amount:t.waste_amount,breakfast_sales:t.breakfast_sales,night_sales:t.night_sales};console.log("📤 Inserting data:",u);const{data:r,error:_}=await D.from("omega_daily").insert(u).select();if(console.log("📥 Supabase response - data:",r,"error:",_),_)throw console.error("❌ Supabase error:",_),_;return console.log("✅ Insert successful:",r),r},onError:(t,u,r)=>{if(r!=null&&r.touchedCaches)for(const{queryKey:_,previousData:L}of r.touchedCaches)p.setQueryData(_,L||[]);console.error("💥 Insert mutation failed (rolled back):",t),l({title:"Save failed",description:(t==null?void 0:t.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(t,u,r)=>{console.log("🎉 Insert mutation succeeded with data:",t),l({title:"Success!",description:"Daily metrics saved successfully."});const _=Array.isArray(t)&&t[0]?t[0]:void 0;if(_&&(r!=null&&r.touchedCaches)&&r.optimisticId)for(const{queryKey:L}of r.touchedCaches){const X=(p.getQueryData(L)??[]).map(W=>W.id===r.optimisticId?_:W);p.setQueryData(L,X)}n(!1),c(null),i.reset(),p.invalidateQueries({queryKey:["omega_daily"]}),p.invalidateQueries({queryKey:["omega_daily_charts",d]})}}),k=ie({mutationFn:async({id:t,payload:u})=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const{error:r}=await D.from("omega_daily").update({business_date:u.business_date,net_sales:u.net_sales,last_year_sales:u.last_year_sales,labor_hours:u.labor_hours,ideal_labor_hours:u.ideal_labor_hours,labor_percentage:u.labor_percentage,theoretical_food_cost:u.theoretical_food_cost,food_variance_cost:u.food_variance_cost,waste_amount:u.waste_amount,breakfast_sales:u.breakfast_sales,night_sales:u.night_sales}).eq("id",t);if(r)throw r},onSuccess:()=>{l({title:"Updated!",description:"Daily metrics updated successfully."}),n(!1),c(null),i.reset(),p.invalidateQueries({queryKey:["omega_daily"]}),p.invalidateQueries({queryKey:["omega_daily_charts",d]})},onError:t=>{l({title:"Update failed",description:t.message,variant:"destructive"})}}),E=t=>{console.log("🚀 onSubmit called with data:",t),console.log("📋 Form errors:",i.formState.errors),console.log("🏪 Store ID:",d),console.log("✏️ Editing entry:",a),console.log("🔄 Insert mutation pending:",y.isPending),console.log("🔄 Update mutation pending:",k.isPending),a?(console.log("📝 Calling updateMutation..."),k.mutate({id:a.id,payload:t})):(console.log("➕ Calling insertMutation..."),y.mutate(t))},U=t=>{console.error("❌ Form validation failed with errors:",t),l({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},F=ie({mutationFn:async t=>{const{error:u}=await D.from("omega_daily").delete().eq("id",t);if(u)throw u},onSuccess:()=>{l({title:"Deleted",description:"Daily metrics entry removed."}),p.invalidateQueries({queryKey:["omega_daily"]}),p.invalidateQueries({queryKey:["omega_daily_charts",d]})},onError:t=>{l({title:"Delete failed",description:t.message,variant:"destructive"})}});v.useEffect(()=>{let t=!0;return(async()=>{var X;console.log("🔐 Checking user authentication...");const{data:u,error:r}=await D.auth.getUser();console.log("👤 Auth data:",u,"Auth error:",r);const _=(X=u.user)==null?void 0:X.id;if(!_){console.log("❌ No user ID found - user not authenticated");return}console.log("🔍 Looking up store for user:",_);const{data:L,error:$}=await D.from("users").select("store_id").eq("id",_).maybeSingle();if(console.log("🏪 Store lookup result - data:",L,"error:",$),!!t){if($){console.error("❌ Store lookup error:",$),l({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}N((L==null?void 0:L.store_id)??null),console.log("✅ Store ID set to:",(L==null?void 0:L.store_id)??null),L!=null&&L.store_id||(console.log("⚠️ No store linked to user account"),l({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{t=!1}},[]);const h=f.getDateRangeFilter(),{data:g=[],isLoading:w,error:j}=se({queryKey:["omega_daily",d,h==null?void 0:h.start,h==null?void 0:h.end],queryFn:async()=>{if(!d)return[];let t=D.from("omega_daily").select("*").eq("store_id",d);h&&(t=t.gte("business_date",h.start).lte("business_date",h.end));const{data:u,error:r}=await t.order("business_date",{ascending:!1}).limit(100);if(r)throw r;return u},enabled:!!d}),{data:A=[]}=se({queryKey:["omega_daily_charts",d],queryFn:async()=>{if(!d)return[];const t=new Date;t.setDate(t.getDate()-30);const u=q(t,"yyyy-MM-dd"),{data:r,error:_}=await D.from("omega_daily").select("*").eq("store_id",d).gte("business_date",u).order("business_date",{ascending:!0});if(_)throw _;return r},enabled:!!d}),{data:V=[]}=se({queryKey:["omega_daily_mtd",d],queryFn:async()=>{if(!d)return[];const{start:t,end:u}=Ts("mtd"),{data:r,error:_}=await D.from("omega_daily").select("*").eq("store_id",d).gte("business_date",t).lte("business_date",u).order("business_date",{ascending:!0});if(_)throw _;return r},enabled:!!d}),m=t=>{if(!t)return;f.handleRangeChange("custom");const u=Number(t.slice(0,4)),r=Number(t.slice(5,7)),_=Number(t.slice(8,10));f.handleDateChange(new Date(u,(r||1)-1,_||1))},o=v.useMemo(()=>A.length?A.map(t=>({date:Z.dateShort(t.business_date),dateFull:Z.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),comp_net_sales_percentage:t.last_year_sales?(t.net_sales-t.last_year_sales)/t.last_year_sales*100:0})):[],[A]),C=v.useMemo(()=>A.length?A.map(t=>({date:Z.dateShort(t.business_date),dateFull:Z.dateFull(t.business_date),isoDate:(typeof t.business_date=="string",t.business_date),waste_percentage:t.net_sales?t.waste_amount/t.net_sales*100:0,food_variance_percentage:t.net_sales?-(t.food_variance_cost/t.net_sales)*100:0})):[],[A]),O=t=>{c(t);const u={business_date:t.business_date||q(new Date,"yyyy-MM-dd"),net_sales:t.net_sales!=null?Number(t.net_sales):0,last_year_sales:t.last_year_sales!=null?Number(t.last_year_sales):0,labor_hours:t.labor_hours!=null?Number(t.labor_hours):0,ideal_labor_hours:t.ideal_labor_hours!=null?Number(t.ideal_labor_hours):0,labor_percentage:t.labor_percentage!=null?Number(t.labor_percentage):0,theoretical_food_cost:t.theoretical_food_cost!=null?Number(t.theoretical_food_cost):0,food_variance_cost:t.food_variance_cost!=null?Number(t.food_variance_cost):0,waste_amount:t.waste_amount!=null?Number(t.waste_amount):0,breakfast_sales:t.breakfast_sales!=null?Number(t.breakfast_sales):0,night_sales:t.night_sales!=null?Number(t.night_sales):0};i.reset(u),n(!0)},b=t=>{F.mutate(t)},T=i.watch(),z=T.last_year_sales>0?(T.net_sales-T.last_year_sales)/T.last_year_sales*100:0,B=T.labor_hours-T.ideal_labor_hours,ae=T.net_sales>0?T.food_variance_cost/T.net_sales*100:0,ee=T.net_sales>0?T.waste_amount/T.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(R,{onClick:()=>{c(null),i.reset({business_date:q(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,theoretical_food_cost:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),n(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),d&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(R,{onClick:S,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(R,{onClick:x,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const t=V.reduce((L,$)=>L+(Number($.net_sales)||0),0),u=V.length>0?V.reduce((L,$)=>L+(Number($.labor_percentage)||0),0)/V.length:0,r=V.reduce((L,$)=>L+(Number($.waste_amount)||0),0),_=t>0?r/t*100:0;return e.jsxs("div",{className:"grid-auto",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:me(t)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:re(u)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:re(_)})]})]})})()}),e.jsx(_s,{selectedRange:f.selectedRange,selectedDate:f.selectedDate,onRangeChange:f.handleRangeChange,onDateChange:f.handleDateChange,onClearFilters:f.clearFilters}),j&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",j.message]}),e.jsxs("div",{className:"grid-auto",children:[e.jsx(ue,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!A.length&&!j,error:j==null?void 0:j.message,children:o.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:o,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:t=>Z.percent(t)}),e.jsx(Le,{...Q.tooltip,formatter:t=>[Z.percent(t,1),"Comp Sales %"],labelFormatter:(t,u)=>{var r;return u&&u[0]&&((r=u[0].payload)==null?void 0:r.dateFull)||t}}),e.jsx(we,{type:"monotone",dataKey:"comp_net_sales_percentage",stroke:K.sales,strokeWidth:2,dot:{fill:K.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:K.salesSecondary,strokeWidth:2},onClick:t=>{var u;return m((u=t==null?void 0:t.payload)==null?void 0:u.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ue,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!A.length&&!j,error:j==null?void 0:j.message,children:C.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:C,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:t=>Z.percent(t)}),e.jsx(Le,{...Q.tooltip,formatter:t=>[Z.percent(t,2),"Waste %"],labelFormatter:(t,u)=>{var r;return u&&u[0]&&((r=u[0].payload)==null?void 0:r.dateFull)||t}}),e.jsx(ks,{y:.5,stroke:K.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:K.textSecondary,fontSize:12}}),e.jsx(Tt,{dataKey:"waste_percentage",fill:K.waste,opacity:.7,onClick:t=>{var u;return m((u=t==null?void 0:t.payload)==null?void 0:u.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ue,{title:"Food Variance",subtitle:"Last 30 days",loading:!A.length&&!j,error:j==null?void 0:j.message,children:C.length>0?e.jsx("div",{className:"chart-container",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:C,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",...Q.xAxis}),e.jsx(De,{...Q.yAxis,tickFormatter:t=>Z.percent(t)}),e.jsx(Le,{...Q.tooltip,formatter:(t,u,r)=>{var L;const _=((L=r==null?void 0:r.payload)==null?void 0:L.food_variance_percentage)!==void 0?-r.payload.food_variance_percentage:0;return[Z.percent(_,2),"Food Variance %"]},labelFormatter:(t,u)=>{var r;return u&&u[0]&&((r=u[0].payload)==null?void 0:r.dateFull)||t}}),e.jsx(ks,{y:0,stroke:K.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:K.textSecondary,fontSize:12}}),e.jsx(we,{type:"monotone",dataKey:"food_variance_percentage",stroke:K.foodVariance,strokeWidth:2,dot:{fill:K.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:K.warning,strokeWidth:2},onClick:t=>{var u;return m((u=t==null?void 0:t.payload)==null?void 0:u.isoDate)}})]})})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:f.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[w?"Loading...":`${g.length} entries`,f.selectedRange!=="last30"&&` for ${f.getSelectedLabel()}`,(f.selectedRange!=="last30"||f.selectedDate)&&e.jsx(R,{variant:"ghost",size:"sm",onClick:f.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(g==null?void 0:g.length)===0&&!w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:d?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:f.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),d&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(R,{onClick:()=>n(!0),className:"wendys-button",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(R,{onClick:S,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx(Br,{columns:[{key:"business_date",label:"Date",render:t=>oe(t)},{key:"net_sales",label:"Net Sales",render:t=>me(t)},{key:"comp_sales",label:"Comp Sales",render:(t,u)=>{const r=(u.net_sales??0)-(u.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${r>=0?"text-green-600":"text-red-600"}`,children:[r>=0?e.jsx(ne,{className:"h-3 w-3 mr-1"}):e.jsx(he,{className:"h-3 w-3 mr-1"}),me(Math.abs(r))]})}},{key:"labor_hours",label:"Labor Hours",render:t=>`${t}h`},{key:"labor_percentage",label:"Labor %",render:t=>re(t)},{key:"food_variance",label:"Food Variance",render:(t,u)=>{const r=u.net_sales?u.food_variance_cost/u.net_sales*100:0;return re(r)}},{key:"waste",label:"Waste",render:(t,u)=>{const r=u.net_sales?u.waste_amount/u.net_sales*100:0;return re(r)}},{key:"actions",label:"Actions",render:(t,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>O(u),className:"h-8 w-8 p-0",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>{m(u.business_date),l({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>b(u.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})}],data:g,mobileCardRender:t=>{const u=(t.net_sales??0)-(t.last_year_sales??0),r=t.net_sales?t.food_variance_cost/t.net_sales*100:0,_=t.net_sales?t.waste_amount/t.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:oe(t.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>O(t),className:"h-8 w-8 p-0",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>b(t.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:me(t.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${u>=0?"text-green-600":"text-red-600"}`,children:[u>=0?e.jsx(ne,{className:"h-3 w-3 mr-1"}):e.jsx(he,{className:"h-3 w-3 mr-1"}),me(Math.abs(u))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[t.labor_hours,"h (",re(t.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:re(r)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:re(_)})]})]})]})},emptyMessage:"No entries found",loading:w})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:a?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>{const t=i.watch("business_date");if(t){const u=g.find($=>$.business_date===t),r=Object.values(i.getValues()).some($=>typeof $=="number"?$!==0:$!==""&&$!==null);let _=`Current date: ${oe(t)}

`;u&&(_+=`⚠️ There's already saved data for this date.

`),r&&(_+=`📝 You have unsaved changes in the form.

`),_+="Enter new date (YYYY-MM-DD):";const L=prompt(_,t);if(L&&L!==t)if(/^\d{4}-\d{2}-\d{2}$/.test(L)){const X=new Date(L);if(isNaN(X.getTime()))l({title:"Invalid date",description:"Please enter a valid date in YYYY-MM-DD format.",variant:"destructive"});else{const W=g.find(te=>te.business_date===L);W?confirm(`There's already data for ${oe(L)}.

Do you want to load that data instead? (This will replace your current form data)`)?(c(W),i.reset({business_date:W.business_date,net_sales:W.net_sales!=null?Number(W.net_sales):0,last_year_sales:W.last_year_sales!=null?Number(W.last_year_sales):0,labor_hours:W.labor_hours!=null?Number(W.labor_hours):0,ideal_labor_hours:W.ideal_labor_hours!=null?Number(W.ideal_labor_hours):0,labor_percentage:W.labor_percentage!=null?Number(W.labor_percentage):0,theoretical_food_cost:W.theoretical_food_cost!=null?Number(W.theoretical_food_cost):0,food_variance_cost:W.food_variance_cost!=null?Number(W.food_variance_cost):0,waste_amount:W.waste_amount!=null?Number(W.waste_amount):0,breakfast_sales:W.breakfast_sales!=null?Number(W.breakfast_sales):0,night_sales:W.night_sales!=null?Number(W.night_sales):0}),l({title:"Loaded existing data",description:`Loaded data for ${oe(L)}.`}),p.invalidateQueries({queryKey:["omega_daily_charts",d]})):(i.setValue("business_date",L),c(null),l({title:"Date changed",description:`Changed date to ${oe(L)}. Your current data is preserved.`}),p.invalidateQueries({queryKey:["omega_daily_charts",d]})):(i.setValue("business_date",L),c(null),l({title:"Date changed",description:`Changed date to ${oe(L)}. Your data is preserved.`}),p.invalidateQueries({queryKey:["omega_daily_charts",d]}))}}else l({title:"Invalid format",description:"Please enter date in YYYY-MM-DD format.",variant:"destructive"})}},className:"text-xs border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"📅 Change Date"})]}),e.jsx(R,{variant:"ghost",onClick:()=>{n(!1),c(null),i.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:i.handleSubmit(E,U),className:"space-y-4",children:[Object.keys(i.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(i.formState.errors).map(([t,u])=>e.jsxs("li",{children:["• ",u==null?void 0:u.message]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(M,{children:"Business Date"}),e.jsxs(vs,{children:[e.jsx(bs,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),i.watch("business_date")?oe(i.watch("business_date")):"Pick a date"]})}),e.jsx(ss,{className:"w-auto p-0",children:e.jsx(Ke,{mode:"single",selected:(()=>{const t=i.watch("business_date");if(!t)return;const u=Number(t.slice(0,4)),r=Number(t.slice(5,7)),_=Number(t.slice(8,10));return new Date(u,(r||1)-1,_||1)})(),onSelect:t=>{const u=t?q(t,"yyyy-MM-dd"):"";i.setValue("business_date",u),u&&g.find(_=>_.business_date===u)&&l({title:"Existing entry found",description:`There's already data for ${oe(u)}. Use "Change Date" button to switch dates while keeping your current data.`,variant:"default"})},initialFocus:!0})})]}),i.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(P,{id:"net_sales",type:"number",step:"0.01",...i.register("net_sales")}),i.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(P,{id:"last_year_sales",type:"number",step:"0.01",...i.register("last_year_sales")}),i.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(P,{id:"comp_net_sales",value:re(z),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(P,{id:"labor_hours",type:"number",step:"0.1",...i.register("labor_hours")}),i.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(P,{id:"ideal_labor_hours",type:"number",step:"0.1",...i.register("ideal_labor_hours")}),i.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(P,{id:"labor_hours_diff",value:`${(B??0)>=0?"+":""}${(B??0).toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(P,{id:"labor_percentage",type:"number",step:"0.1",...i.register("labor_percentage")}),i.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"theoretical_food_cost",children:"Theoretical Food Cost ($)"}),e.jsx(P,{id:"theoretical_food_cost",type:"number",step:"0.01",...i.register("theoretical_food_cost")}),i.formState.errors.theoretical_food_cost&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.theoretical_food_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(P,{id:"food_variance_cost",type:"number",step:"0.01",...i.register("food_variance_cost")}),i.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(P,{id:"food_variance_percentage",value:re(ae),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(P,{id:"waste_amount",type:"number",step:"0.01",...i.register("waste_amount")}),i.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(P,{id:"waste_percentage",value:re(ee),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(P,{id:"breakfast_sales",type:"number",step:"0.01",...i.register("breakfast_sales")}),i.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(P,{id:"night_sales",type:"number",step:"0.01",...i.register("night_sales")}),i.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:i.formState.errors.night_sales.message})]})]}),!d&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn’t linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{n(!1),c(null),i.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:y.isPending||k.isPending||!d,children:a?"Update Entry":"Save Entry"})]})]})]})})]})}const Jr=ge("/interviews")({component:Xr});function Xr(){const[s,n]=v.useState(null),[a,c]=v.useState(null),[l,p]=v.useState([]),[d,N]=v.useState(!1),[f,S]=v.useState(null),[x,i]=v.useState(""),[y,k]=v.useState("ALL"),[E,U]=v.useState(!1),{toast:F}=de(),h=Ue(),[g,w]=v.useState({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""});v.useEffect(()=>{(async()=>{try{const{data:{user:u}}=await D.auth.getUser();if(!u)return;c(u.id);const{data:r}=await D.from("users").select("store_id").eq("id",u.id).single();r!=null&&r.store_id&&(n(r.store_id),V(r.store_id),A(r.store_id))}catch(u){console.error("Error getting store ID:",u)}})()},[]);const j=async()=>{try{console.log("🔧 Starting database enum migration..."),console.log("Step 1: Updating DONE to COMPLETED...");const{error:t}=await D.from("interviews").update({status:"COMPLETED"}).eq("status","DONE");t?console.log("Update error (may be expected if no DONE values exist):",t.message):console.log("✅ Updated existing DONE values to COMPLETED"),console.log("Step 2: Attempting enum recreation via RPC..."),console.log("⚠️  Manual migration required!"),console.log("Please run this SQL in your Supabase SQL Editor:"),console.log(`
-- Migration SQL to run in Supabase Dashboard:
DROP TYPE IF EXISTS interview_status CASCADE;
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Then recreate the interviews table if it was dropped:
-- (Copy the CREATE TABLE statement from schema.sql)
      `),F({title:"Migration Instructions",description:"Check console for SQL commands to run in Supabase Dashboard",variant:"default"})}catch(t){console.error("Migration error:",t),F({title:"Migration Error",description:"See console for details",variant:"destructive"})}},A=async t=>{try{console.log("🔍 Checking database enum values...");const{data:u,error:r}=await D.rpc("get_enum_values",{enum_name:"interview_status"});if(r){console.log("Could not get enum values via RPC, trying direct query...");const _=["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"];for(const L of _)try{console.log(`Testing status: "${L}"`);const{error:$}=await D.from("interviews").insert([{store_id:t,candidate_name:`TEST_${L}`,interview_date:new Date().toISOString().split("T")[0],interview_time:"12:00:00",status:L,position:"Test Position"}]).select();$?console.log(`❌ Status "${L}" rejected:`,$.message):(console.log(`✅ Status "${L}" accepted`),await D.from("interviews").delete().eq("candidate_name",`TEST_${L}`))}catch($){console.log(`❌ Status "${L}" failed:`,$)}}else console.log("✅ Database enum values:",u)}catch(u){console.error("Error checking database enum values:",u)}},V=async t=>{try{U(!0);const{data:u,error:r}=await D.from("interviews").select("*").eq("store_id",t).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(r)throw r;p(u||[])}catch(u){console.error("Error fetching interviews:",u),F({title:"Error",description:"Failed to fetch interviews",variant:"destructive"})}finally{U(!1)}},m=(t,u)=>{w(r=>({...r,[t]:u}))},o=()=>{w({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""}),S(null)},C=async t=>{if(!a)return null;try{const{data:u,error:r}=await D.from("calendar_events").select("id").eq("created_by",a).ilike("title","Interview: %").ilike("description",`%interviewId: ${t}%`).single();return r&&r.code!=="PGRST116"?(console.error("Error finding calendar event:",r),null):u}catch(u){return console.error("Error in findCalendarEvent:",u),null}},O=async t=>{if(!a){console.warn("No user ID available for calendar event deletion");return}try{const u=await C(t);if(u){const{error:r}=await D.from("calendar_events").delete().eq("id",u.id);if(r)throw console.error("Error deleting calendar event:",r),r;console.log("Calendar event deleted successfully for interview:",t),h.invalidateQueries({queryKey:["calendar-events",a]}),h.refetchQueries({queryKey:["calendar-events",a]})}else console.log("No calendar event found to delete for interview:",t)}catch(u){throw console.error("Error in deleteCalendarEvent:",u),u}},b=async(t,u=!1)=>{if(!a){console.warn("No user ID available for calendar event creation");return}try{if(t.status!=="SCHEDULED"){console.log("Interview status is not SCHEDULED, removing calendar event if it exists"),await O(t.id);return}if(!t.interview_date||!t.interview_time){console.warn("Invalid date or time for calendar event:",{date:t.interview_date,time:t.interview_time});return}const r=t.interview_time.includes(":")&&t.interview_time.split(":").length===2?`${t.interview_time}:00`:t.interview_time,_=`${t.interview_date}T${r}`,L=new Date(_);if(isNaN(L.getTime()))throw console.error("Invalid start date created:",_,"from:",{date:t.interview_date,time:t.interview_time,formattedTime:r}),new Error("Invalid interview date/time format");const $=new Date(L.getTime()+60*60*1e3);if(isNaN($.getTime()))throw console.error("Invalid end date calculated from start date:",L),new Error("Invalid end date calculation");const X=$.toISOString(),W={title:`Interview: ${t.candidate_name}`,description:`Interview for ${t.position||"position"}
${t.notes||""}
Phone: ${t.phone||"N/A"}
Email: ${t.email||"N/A"}
interviewId: ${t.id}`,start_date:_,end_date:X,all_day:!1,location:"Store Interview Room",reminder_type:"15min",updated_at:new Date().toISOString()};if(u){const te=await C(t.id);if(te){const{error:G}=await D.from("calendar_events").update(W).eq("id",te.id);G?console.error("Error updating calendar event:",G):(console.log("Calendar event updated successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",a]}),h.refetchQueries({queryKey:["calendar-events",a]}))}else{const{error:G}=await D.from("calendar_events").insert([{...W,created_by:a}]);G?console.error("Error creating calendar event:",G):(console.log("Calendar event created successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",a]}),h.refetchQueries({queryKey:["calendar-events",a]}))}}else{const{error:te}=await D.from("calendar_events").insert([{...W,created_by:a}]);te?(console.error("Error creating calendar event:",te),F({title:"Warning",description:"Interview scheduled but calendar event creation failed.",variant:"destructive"})):(console.log("Calendar event created successfully for interview:",t.id),h.invalidateQueries({queryKey:["calendar-events",a]}),h.refetchQueries({queryKey:["calendar-events",a]}))}}catch(r){throw console.error("Error in createOrUpdateCalendarEvent:",r),r}},T=async()=>{if(!a){F({title:"Error",description:"User not authenticated",variant:"destructive"});return}if(!s){F({title:"Error",description:"No store selected",variant:"destructive"});return}if(!g.candidate_name.trim()){F({title:"Error",description:"Candidate name is required",variant:"destructive"});return}if(!g.position.trim()){F({title:"Error",description:"Position is required",variant:"destructive"});return}if(!g.interview_date){F({title:"Error",description:"Interview date is required",variant:"destructive"});return}if(!g.interview_time){F({title:"Error",description:"Interview time is required",variant:"destructive"});return}console.log("Saving interview with data:",g),console.log("Interview date format:",typeof g.interview_date,g.interview_date),console.log("Interview time format:",typeof g.interview_time,g.interview_time);const t=g.interview_time.includes(":")&&g.interview_time.split(":").length===2?`${g.interview_time}:00`:g.interview_time;console.log("Formatted time for database:",t);try{if(f){const{data:u,error:r}=await D.from("interviews").update({candidate_name:g.candidate_name,phone:g.phone||null,email:g.email||null,position:g.position,interview_date:g.interview_date,interview_time:t,status:g.status,notes:g.notes||null}).eq("id",f.id).select().single();if(r)throw r;if(u)try{await b(u,!0)}catch(_){console.warn("Calendar event update failed, but interview was saved:",_)}F({title:"Success!",description:g.status==="SCHEDULED"?"Interview updated and calendar synced!":"Interview updated and removed from calendar!"})}else{const{data:u,error:r}=await D.from("interviews").insert([{store_id:s,candidate_name:g.candidate_name,phone:g.phone||null,email:g.email||null,position:g.position,interview_date:g.interview_date,interview_time:t,status:g.status,notes:g.notes||null}]).select().single();if(r)throw r;if(u)try{await b(u,!1)}catch(_){console.warn("Calendar event creation failed, but interview was saved:",_)}F({title:"Success!",description:g.status==="SCHEDULED"?"Interview scheduled and added to calendar!":"Interview saved successfully!"})}V(s),N(!1),o()}catch(u){console.error("Error saving interview:",u),console.error("Full error object:",JSON.stringify(u,null,2)),console.error("Error message:",u.message),console.error("Error details:",u.details),console.error("Error hint:",u.hint),console.error("Error code:",u.code);let r="Failed to save interview";u.message?r=u.message:u.details?r=`Database error: ${u.details}`:u.hint?r=`Hint: ${u.hint}`:u.code&&(r=`Error code: ${u.code}`),F({title:"Error",description:r,variant:"destructive"})}},z=t=>{S(t),w({candidate_name:t.candidate_name,phone:t.phone||"",email:t.email||"",position:t.position||"",interview_date:t.interview_date,interview_time:t.interview_time,status:t.status,notes:t.notes||""}),N(!0)},B=async t=>{if(confirm("Are you sure you want to delete this interview?"))try{try{await O(t)}catch(r){console.warn("Calendar event deletion failed, but continuing with interview deletion:",r)}const{error:u}=await D.from("interviews").delete().eq("id",t);if(u)throw u;F({title:"Deleted!",description:"Interview and calendar event removed successfully."}),V(s)}catch(u){console.error("Error deleting interview:",u),F({title:"Error",description:u.message||"Failed to delete interview",variant:"destructive"})}},ee=l.filter(t=>{const u=t.candidate_name.toLowerCase().includes(x.toLowerCase())||(t.position||"").toLowerCase().includes(x.toLowerCase()),r=y==="ALL"||t.status===y;return u&&r}).reduce((t,u)=>{const r=u.interview_date;return t[r]||(t[r]=[]),t[r].push(u),t},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(R,{onClick:()=>N(!0),className:"wendys-button",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(P,{placeholder:"Search by name or position...",value:x,onChange:t=>i(t.target.value),className:"pl-10"})]})}),e.jsxs(fs,{value:y,onValueChange:k,children:[e.jsx(Ze,{className:"w-full sm:w-48",children:e.jsx(ys,{placeholder:"Filter by status"})}),e.jsxs(es,{children:[e.jsx(le,{value:"ALL",children:"All Statuses"}),e.jsx(le,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(le,{value:"COMPLETED",children:"Completed"}),e.jsx(le,{value:"NO_SHOW",children:"No Show"}),e.jsx(le,{value:"HIRED",children:"Hired"}),e.jsx(le,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[E&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!E&&Object.keys(ee).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(ee).map(([t,u])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 mr-2"}),oe(t)]}),e.jsx("div",{className:"space-y-3",children:u.map(r=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:r.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Rt(r.status)}`,children:r.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:r.position||"No position specified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:qa(r.interview_time)})]}),r.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Sa,{className:"h-4 w-4"}),e.jsx("span",{children:r.phone})]}),r.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gt,{className:"h-4 w-4"}),e.jsx("span",{children:r.email})]})]}),r.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx(ms,{className:"h-4 w-4 inline mr-1"}),r.notes]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>z(r),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>B(r.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})},r.id))})]},t))]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:f?"Edit Interview":"Schedule New Interview"}),e.jsx(R,{variant:"ghost",onClick:()=>{N(!1),o()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),T()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(P,{id:"candidate_name",value:g.candidate_name,onChange:t=>m("candidate_name",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"position",children:"Position"}),e.jsx(P,{id:"position",value:g.position,onChange:t=>m("position",t.target.value),placeholder:"e.g., Crew Member, Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"phone",children:"Phone"}),e.jsx(P,{id:"phone",type:"tel",value:g.phone,onChange:t=>m("phone",t.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"Email"}),e.jsx(P,{id:"email",type:"email",value:g.email,onChange:t=>m("email",t.target.value),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(P,{id:"interview_date",type:"date",value:g.interview_date,onChange:t=>m("interview_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(P,{id:"interview_time",type:"time",value:g.interview_time,onChange:t=>m("interview_time",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"status",children:"Status *"}),e.jsxs(fs,{value:g.status,onValueChange:t=>m("status",t),children:[e.jsx(Ze,{id:"status",children:e.jsx(ys,{})}),e.jsxs(es,{children:[e.jsx(le,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(le,{value:"COMPLETED",children:"Completed"}),e.jsx(le,{value:"NO_SHOW",children:"No Show"}),e.jsx(le,{value:"HIRED",children:"Hired"}),e.jsx(le,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"notes",children:"Notes"}),e.jsx(Xe,{id:"notes",value:g.notes,onChange:t=>m("notes",t.target.value),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>A(s),className:"text-xs",children:"Test Enum"}),e.jsx(R,{type:"button",variant:"outline",onClick:j,className:"text-xs",children:"Migrate DB"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{N(!1),o()},children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button",children:f?"Update Interview":"Schedule Interview"})]})]})]})]})})]})}const Zr={"on-track":{color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",icon:Qe,label:"On Track"},caution:{color:"text-amber-600",bgColor:"bg-amber-50",borderColor:"border-amber-200",icon:fe,label:"Caution"},behind:{color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",icon:fe,label:"Behind"},exceeded:{color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",icon:Ds,label:"Exceeded"}},en={up:ne,down:he,stable:We};function ns({title:s,target:n,actual:a,unit:c,status:l,progress:p,trend:d,trendValue:N,insight:f,historicalBenchmark:S,successRate:x,isEditing:i=!1,onEdit:y,className:k}){const E=Zr[l],U=E.icon,F=d?en[d]:null,h=w=>{switch(c){case"currency":return Z.currency(w);case"percentage":return Z.percent(w,1);case"hours":return Z.hours(w,1);case"count":return w.toLocaleString();default:return w.toString()}},g=()=>{switch(l){case"on-track":return"bg-green-500";case"caution":return"bg-amber-500";case"behind":return"bg-red-500";case"exceeded":return"bg-blue-500";default:return"bg-gray-500"}};return e.jsxs("div",{className:I("wendys-card p-6 transition-all duration-200 hover:shadow-lg",E.borderColor,"border-l-4",k),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),e.jsxs("div",{className:I("flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium",E.bgColor,E.color),children:[e.jsx(U,{className:"w-4 h-4"}),E.label]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Target"}),e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:i?e.jsx("input",{type:"number",value:n,onChange:w=>y==null?void 0:y(Number(w.target.value)),className:"w-full text-2xl font-bold bg-transparent border-b border-gray-300 focus:border-wendys-red focus:outline-none"}):h(n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Actual"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold text-wendys-charcoal",children:h(a)}),F&&N&&e.jsxs("div",{className:I("flex items-center gap-1 text-sm",d==="up"?"text-green-600":d==="down"?"text-red-600":"text-gray-600"),children:[e.jsx(F,{className:"w-4 h-4"}),e.jsxs("span",{children:[Math.abs(N).toFixed(1),"%"]})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[p.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:I("h-2 rounded-full transition-all duration-300",g()),style:{width:`${Math.min(p,100)}%`}})})]}),S&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Last Week"}),e.jsx("p",{className:"text-sm font-medium",children:h(S.lastWeek)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Last Year"}),e.jsx("p",{className:"text-sm font-medium",children:h(S.lastYear)})]})]}),x&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Success Rate"}),e.jsxs("p",{className:"text-sm font-medium text-blue-800",children:["Hit ",x.hit," of last ",x.total," periods"]})]}),f&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("p",{className:"text-xs text-amber-600 mb-1",children:"Insight"}),e.jsx("p",{className:"text-sm text-amber-800",children:f})]})]})}function Ks({data:s,unit:n,className:a}){const c=p=>{switch(n){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(p);case"percentage":return`${p.toFixed(1)}%`;case"hours":return`${p.toFixed(1)}h`;case"count":return p.toLocaleString();default:return p.toString()}},l=p=>new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsx("div",{className:a,children:e.jsx("div",{className:"h-32",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:s,children:[e.jsx(Te,{...Q.cartesianGrid}),e.jsx(Re,{dataKey:"date",tickFormatter:l,...Q.xAxis}),e.jsx(De,{tickFormatter:c,...Q.yAxis}),e.jsx(Le,{content:({active:p,payload:d,label:N})=>{var f,S;return p&&d&&d.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-medium text-gray-900",children:l(N)}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-blue-600",children:"Target:"})," ",c(Number((f=d[0])==null?void 0:f.value)||0)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Actual:"})," ",c(Number((S=d[1])==null?void 0:S.value)||0)]})]})]}):null}}),e.jsx(we,{type:"monotone",dataKey:"target",stroke:K.textSecondary,strokeWidth:2,strokeDasharray:"5 5",dot:!1}),e.jsx(we,{type:"monotone",dataKey:"actual",stroke:K.sales,strokeWidth:3,dot:{fill:K.sales,strokeWidth:2,r:4}})]})})})})}const sn={warning:{icon:fe,bgColor:"bg-amber-50",borderColor:"border-amber-200",textColor:"text-amber-800",iconColor:"text-amber-600"},success:{icon:Ds,bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-800",iconColor:"text-green-600"},info:{icon:We,bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",iconColor:"text-blue-600"},alert:{icon:fe,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800",iconColor:"text-red-600"}};function tn({insights:s,className:n}){return s.length===0?null:e.jsxs("div",{className:I("space-y-3",n),children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Key Insights"}),s.map((a,c)=>{const l=sn[a.type],p=l.icon;return e.jsx("div",{className:I("p-3 rounded-lg border",l.bgColor,l.borderColor),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:I("w-5 h-5 mt-0.5 flex-shrink-0",l.iconColor)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:I("text-sm font-medium",l.textColor),children:a.title}),e.jsx("p",{className:I("text-sm mt-1",l.textColor),children:a.message}),a.action&&e.jsx("button",{onClick:a.onAction,className:I("mt-2 text-xs font-medium underline hover:no-underline",l.textColor),children:a.action})]})]})},c)})]})}const an=je({sales_target:H.number().min(0),labor_target_pct:H.number().min(0),waste_target_pct:H.number().min(0),food_variance_target_pct:H.number().min(0),team_notes:Y().optional()}),is=(s,n,a=!1)=>{if(n===0)return"behind";const c=s/n*100,l=5;return a?c<=100-l?"on-track":c<=100+l?"caution":"behind":c>=100+l?"exceeded":c>=100-l?"on-track":c>=100-l*2?"caution":"behind"},ls=(s,n)=>{if(n===0)return{trend:"stable",value:0};const a=(s-n)/n*100;return Math.abs(a)<1?{trend:"stable",value:0}:{trend:a>0?"up":"down",value:Math.abs(a)}},os=(s,n)=>{const{actual:a,target:c,progress:l,status:p,trend:d}=s;if(p==="behind"){const N=c-a;return`${n} is ${N.toLocaleString()} below target. Consider reviewing operational efficiency.`}return p==="caution"?`${n} is close to target but needs attention. Monitor closely for improvement opportunities.`:p==="exceeded"?`Excellent! ${n} exceeded target by ${(a-c).toLocaleString()}.`:d==="up"&&l>80?`${n} trending positively and on track to meet goal.`:`${n} performing well within target range.`};function rn(){const{toast:s}=de(),n=Ue(),[a,c]=v.useState(null),[l,p]=v.useState(!1),[d,N]=v.useState(null),f=Ns("goals","wtd"),S=f.getDateRangeFilter(),x=(S==null?void 0:S.start)||q(new Date,"yyyy-MM-dd"),i=(S==null?void 0:S.end)||q(new Date,"yyyy-MM-dd"),y=f.selectedRange==="mtd"?"month":f.selectedRange==="wtd"?"week":"custom",k=$e({resolver:He(an),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});v.useEffect(()=>{let b=!0;return(async()=>{var ee;const{data:T}=await D.auth.getUser(),z=(ee=T.user)==null?void 0:ee.id;if(!z)return;const{data:B,error:ae}=await D.from("users").select("store_id").eq("id",z).maybeSingle();b&&(ae||c((B==null?void 0:B.store_id)??null))})(),()=>{b=!1}},[]);const{data:E}=se({queryKey:["goals_settings",a,x,i],queryFn:async()=>{if(!a)return null;try{const{data:b,error:T}=await D.from("goals").select("*").eq("store_id",a).eq("period_start",x).eq("period_end",i).maybeSingle();if(T&&T.code!=="PGRST116"){const z=String(T.code||""),B=String(T.message||"");if(z.startsWith("42")||B.toLowerCase().includes("relation")||B.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw T}return b||null}catch(b){const T=String((b==null?void 0:b.code)||""),z=String((b==null?void 0:b.message)||"");if(T.startsWith("42")||z.toLowerCase().includes("relation")||z.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw b}},enabled:!!a});v.useEffect(()=>{E&&k.reset({sales_target:E.sales_target,labor_target_pct:E.labor_target_pct,waste_target_pct:E.waste_target_pct,food_variance_target_pct:E.food_variance_target_pct,team_notes:E.team_notes||""})},[E]);const{data:U=[]}=se({queryKey:["omega_daily_for_goals",a,x,i],queryFn:async()=>{if(!a)return[];const{data:b,error:T}=await D.from("omega_daily").select("*").eq("store_id",a).gte("business_date",x).lte("business_date",i).order("business_date",{ascending:!0});if(T)throw T;return b},enabled:!!a}),{data:F}=se({queryKey:["historical_data_for_goals",a,x,i],queryFn:async()=>{if(!a)return{lastWeek:[],lastMonth:[],lastYear:[]};const b=new Date(x),T=new Date(i),z=q(js(b,1),"yyyy-MM-dd"),B=q(js(T,1),"yyyy-MM-dd"),ae=q(rs(b,1),"yyyy-MM-dd"),ee=q(rs(T,1),"yyyy-MM-dd"),t=q(rs(b,12),"yyyy-MM-dd"),u=q(rs(T,12),"yyyy-MM-dd"),[r,_,L]=await Promise.all([D.from("omega_daily").select("*").eq("store_id",a).gte("business_date",z).lte("business_date",B).order("business_date",{ascending:!0}),D.from("omega_daily").select("*").eq("store_id",a).gte("business_date",ae).lte("business_date",ee).order("business_date",{ascending:!0}),D.from("omega_daily").select("*").eq("store_id",a).gte("business_date",t).lte("business_date",u).order("business_date",{ascending:!0})]);return{lastWeek:r.data||[],lastMonth:_.data||[],lastYear:L.data||[]}},enabled:!!a}),{data:h}=se({queryKey:["success_rate_data",a],queryFn:async()=>{if(!a)return{sales:{hit:0,total:0},labor:{hit:0,total:0},waste:{hit:0,total:0},foodVariance:{hit:0,total:0}};const b=q(js(new Date,12),"yyyy-MM-dd"),T=q(new Date,"yyyy-MM-dd"),{data:z,error:B}=await D.from("omega_daily").select("*").eq("store_id",a).gte("business_date",b).lte("business_date",T).order("business_date",{ascending:!0});if(B)throw B;const ee=(z||[]).reduce((r,_)=>{const L=yt(new Date(_.business_date),{weekStartsOn:0}),$=q(L,"yyyy-MM-dd");return r[$]||(r[$]=[]),r[$].push(_),r},{}),t=Object.values(ee).slice(-12),u=(r,_,L=!1)=>{let $=0;return r.forEach(X=>{const W=X.reduce((Me,Ve)=>Me+(Ve.net_sales||0),0),te=X.reduce((Me,Ve)=>Me+(Ve.labor_percentage||0),0)/X.length,G=X.reduce((Me,Ve)=>Me+(Ve.waste_amount||0),0),Pe=W>0?G/W*100:0,Ee=X.reduce((Me,Ve)=>Me+(Ve.food_variance_cost||0),0),pe=W>0?Ee/W*100:0;let ce=0;_===25?ce=te:_===.5?ce=Pe:_===.5?ce=pe:ce=W,(L?ce<=_:ce>=_)&&$++}),{hit:$,total:r.length}};return{sales:u(t,0,!1),labor:u(t,25,!0),waste:u(t,.5,!0),foodVariance:u(t,.5,!0)}},enabled:!!a}),g=v.useMemo(()=>{const b=U.reduce((r,_)=>r+(Number(_.net_sales)||0),0),T=U.reduce((r,_)=>r+(Number(_.labor_hours)||0),0),z=U.reduce((r,_)=>r+(Number(_.ideal_labor_hours)||0),0),B=z>0?T/z*100:0,ae=U.reduce((r,_)=>r+(Number(_.waste_amount)||0),0),ee=U.reduce((r,_)=>r+(Number(_.food_variance_cost)||0),0),t=b>0?ae/b*100:0,u=b>0?ee/b*100:0;return{totalSales:b,avgLaborPct:B,wastePct:t,foodVarPct:u}},[U]),w=v.useMemo(()=>{const b=k.getValues(),T=(G,Pe=!1)=>{if(!G||G.length===0)return 0;if(Pe){const Ee=G.reduce((ce,Ie)=>ce+(Number(Ie.labor_hours)||0),0),pe=G.reduce((ce,Ie)=>ce+(Number(Ie.ideal_labor_hours)||0),0);return pe>0?Ee/pe*100:0}else return G.reduce((Ee,pe)=>Ee+(Number(pe.net_sales)||0),0)},z=F?{lastWeek:T(F.lastWeek),lastMonth:T(F.lastMonth),lastYear:T(F.lastYear)}:{lastWeek:0,lastMonth:0,lastYear:0},B=b.sales_target>0?g.totalSales/b.sales_target*100:0,ae=is(g.totalSales,b.sales_target,!1),ee=ls(g.totalSales,z.lastWeek),t=b.labor_target_pct>0?g.avgLaborPct/b.labor_target_pct*100:0,u=is(g.avgLaborPct,b.labor_target_pct,!0),r=ls(g.avgLaborPct,z.lastWeek),_=b.waste_target_pct>0?g.wastePct/b.waste_target_pct*100:0,L=is(g.wastePct,b.waste_target_pct,!0),$=ls(g.wastePct,z.lastWeek),X=b.food_variance_target_pct>0?g.foodVarPct/b.food_variance_target_pct*100:0,W=is(g.foodVarPct,b.food_variance_target_pct,!0),te=ls(g.foodVarPct,z.lastWeek);return{sales:{actual:g.totalSales,target:b.sales_target,progress:B,status:ae,trend:ee.trend,trendValue:ee.value,historical:z,successRate:(h==null?void 0:h.sales)||{hit:0,total:0},insight:os({actual:g.totalSales,target:b.sales_target,progress:B,status:ae,trend:ee.trend,trendValue:ee.value,successRate:(h==null?void 0:h.sales)||{}},"Sales")},labor:{actual:g.avgLaborPct,target:b.labor_target_pct,progress:t,status:u,trend:r.trend,trendValue:r.value,historical:z,successRate:(h==null?void 0:h.labor)||{hit:0,total:0},insight:os({actual:g.avgLaborPct,target:b.labor_target_pct,progress:t,status:u,trend:r.trend,trendValue:r.value,successRate:(h==null?void 0:h.labor)||{}},"Labor")},waste:{actual:g.wastePct,target:b.waste_target_pct,progress:_,status:L,trend:$.trend,trendValue:$.value,historical:z,successRate:(h==null?void 0:h.waste)||{hit:0,total:0},insight:os({actual:g.wastePct,target:b.waste_target_pct,progress:_,status:L,trend:$.trend,trendValue:$.value,successRate:(h==null?void 0:h.waste)||{}},"Waste")},foodVariance:{actual:g.foodVarPct,target:b.food_variance_target_pct,progress:X,status:W,trend:te.trend,trendValue:te.value,historical:z,successRate:(h==null?void 0:h.foodVariance)||{hit:0,total:0},insight:os({actual:g.foodVarPct,target:b.food_variance_target_pct,progress:X,status:W,trend:te.trend,trendValue:te.value,successRate:(h==null?void 0:h.foodVariance)||{}},"Food Variance")}}},[g,k.watch(),F,h,x,i]),j=v.useMemo(()=>{const b=[],T=Math.max(.1,(Date.now()-new Date(x).getTime())/(new Date(i).getTime()-new Date(x).getTime()));return w.sales.progress/T<.8&&w.sales.status==="behind"&&b.push({type:"alert",title:"Sales Pacing Alert",message:`Sales are ${w.sales.progress.toFixed(1)}% of target but only ${(T*100).toFixed(1)}% of time has passed. Consider immediate action.`,action:"Review Operations"}),w.labor.status==="behind"&&b.push({type:"warning",title:"Labor Over Target",message:`Labor is ${w.labor.actual.toFixed(1)}% vs target of ${w.labor.target.toFixed(1)}%. Review scheduling and efficiency.`,action:"Adjust Schedule"}),w.waste.status==="behind"&&b.push({type:"warning",title:"Waste Over Target",message:`Waste is ${w.waste.actual.toFixed(2)}% vs target of ${w.waste.target.toFixed(2)}%. Review inventory management.`,action:"Check Inventory"}),w.sales.successRate.hit/w.sales.successRate.total<.5&&b.push({type:"info",title:"Sales Consistency",message:`Sales goal hit only ${w.sales.successRate.hit} of last ${w.sales.successRate.total} periods. Focus on consistency.`}),b},[w,x,i]),A=ie({mutationFn:async b=>{if(!a)throw new Error("No store is linked to your account. See Setup to link one.");const T={store_id:a,scope:y,period_start:x,period_end:i,sales_target:b.sales_target,labor_target_pct:b.labor_target_pct,waste_target_pct:b.waste_target_pct,food_variance_target_pct:b.food_variance_target_pct,team_notes:b.team_notes||null},{error:z}=await D.from("goals").upsert(T,{onConflict:"store_id,period_start,period_end"});if(z){const B=String(z.code||""),ae=String(z.message||"");throw B.startsWith("42")||ae.toLowerCase().includes("relation")||ae.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):z}},onSuccess:()=>{s({title:"Goals Saved",description:"Goals have been successfully saved for the selected period."}),n.invalidateQueries({queryKey:["goals_settings",a,x,i]}),N(k.getValues()),p(!1)},onError:b=>{s({title:"Save Failed",description:b.message,variant:"destructive"})}}),V=v.useCallback(()=>{N(k.getValues()),p(!0)},[k]),m=v.useCallback(()=>{d&&k.reset(d),p(!1)},[k,d]),o=v.useCallback(()=>{k.handleSubmit(b=>A.mutate(b))()},[k,A]),C=v.useCallback(()=>{n.invalidateQueries({queryKey:["omega_daily_for_goals",a,x,i]}),n.invalidateQueries({queryKey:["historical_data_for_goals",a,x,i]}),n.invalidateQueries({queryKey:["success_rate_data",a]}),s({title:"Refreshed",description:"Goal data has been refreshed with latest information."})},[n,a,x,i,s]),O=v.useCallback(()=>{k.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}),p(!0)},[k]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-wendys-charcoal",children:"Goal Performance Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Set targets, track progress, and gain insights into your store's performance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{variant:"outline",onClick:C,disabled:!a,className:"flex items-center gap-2",children:[e.jsx(ka,{className:"w-4 h-4"}),"Refresh"]}),l?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",onClick:m,children:"Cancel"}),e.jsxs(R,{onClick:o,disabled:A.isPending,className:"wendys-button flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),A.isPending?"Saving...":"Save Goals"]})]}):e.jsx(R,{onClick:V,className:"wendys-button",children:"Edit Goals"}),e.jsxs(R,{variant:"outline",onClick:O,className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"w-4 h-4"}),"Reset"]})]})]}),e.jsx(_s,{selectedRange:f.selectedRange,selectedDate:f.selectedDate,onRangeChange:f.handleRangeChange,onDateChange:f.handleDateChange,onClearFilters:f.clearFilters}),j.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(gs,{className:"w-5 h-5 text-amber-600"}),e.jsx("h3",{className:"text-lg font-semibold text-amber-800",children:"Performance Alerts"})]}),e.jsx(tn,{insights:j})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(ns,{title:"Sales Target",target:w.sales.target,actual:w.sales.actual,unit:"currency",status:w.sales.status,progress:w.sales.progress,trend:w.sales.trend,trendValue:w.sales.trendValue,insight:w.sales.insight,historicalBenchmark:{lastWeek:w.sales.historical.lastWeek,lastYear:w.sales.historical.lastYear},successRate:w.sales.successRate,isEditing:l,onEdit:b=>k.setValue("sales_target",b)}),e.jsx(ns,{title:"Labor Efficiency",target:w.labor.target,actual:w.labor.actual,unit:"percentage",status:w.labor.status,progress:w.labor.progress,trend:w.labor.trend,trendValue:w.labor.trendValue,insight:w.labor.insight,historicalBenchmark:{lastWeek:w.labor.historical.lastWeek,lastYear:w.labor.historical.lastYear},successRate:w.labor.successRate,isEditing:l,onEdit:b=>k.setValue("labor_target_pct",b)}),e.jsx(ns,{title:"Waste Control",target:w.waste.target,actual:w.waste.actual,unit:"percentage",status:w.waste.status,progress:w.waste.progress,trend:w.waste.trend,trendValue:w.waste.trendValue,insight:w.waste.insight,historicalBenchmark:{lastWeek:w.waste.historical.lastWeek,lastYear:w.waste.historical.lastYear},successRate:w.waste.successRate,isEditing:l,onEdit:b=>k.setValue("waste_target_pct",b)}),e.jsx(ns,{title:"Food Variance",target:w.foodVariance.target,actual:w.foodVariance.actual,unit:"percentage",status:w.foodVariance.status,progress:w.foodVariance.progress,trend:w.foodVariance.trend,trendValue:w.foodVariance.trendValue,insight:w.foodVariance.insight,historicalBenchmark:{lastWeek:w.foodVariance.historical.lastWeek,lastYear:w.foodVariance.historical.lastYear},successRate:w.foodVariance.successRate,isEditing:l,onEdit:b=>k.setValue("food_variance_target_pct",b)}),e.jsxs("div",{className:"wendys-card p-6 lg:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Team Notes & Goals"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"team_notes",className:"text-sm font-medium text-gray-700",children:"Notes & Observations"}),e.jsx(P,{id:"team_notes",...k.register("team_notes"),placeholder:"Team notes, personal goals, shout-outs, operational insights...",className:"mt-1",disabled:!l})]}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Tip:"})," Use this space to track team performance, note operational improvements, or celebrate achievements that contribute to your goals."]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"wendys-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Sales Progress Trend"}),e.jsx(Ks,{data:U.map(b=>({date:b.business_date,actual:b.net_sales,target:w.sales.target,period:q(new Date(b.business_date),"MMM d")})),unit:"currency"})]}),e.jsxs("div",{className:"wendys-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:"Labor Efficiency Trend"}),e.jsx(Ks,{data:U.map(b=>({date:b.business_date,actual:b.labor_percentage,target:w.labor.target,period:q(new Date(b.business_date),"MMM d")})),unit:"percentage"})]})]})]})}const nn=ge("/goals")({component:rn}),ln=ge("/calendar")({component:on});function on(){var ee,t,u;const[s,n]=v.useState(!1),[a,c]=v.useState(!1),[l,p]=v.useState(null),[d,N]=v.useState(null),[f,S]=v.useState(new Date),[x,i]=v.useState("month"),{toast:y}=de(),k=Ue(),[E,U]=v.useState(null);v.useEffect(()=>{(async()=>{const{data:{user:_}}=await D.auth.getUser();U((_==null?void 0:_.id)||null)})()},[]);const{data:F=[]}=se({queryKey:["calendar-events",E],queryFn:async()=>{if(!E)return[];const{data:r,error:_}=await D.from("calendar_events").select("*").eq("created_by",E).order("start_date",{ascending:!0});if(_)throw _;return r||[]},enabled:!!E}),{data:h=[]}=se({queryKey:["calendar-reminders",E],queryFn:async()=>{if(!E)return[];const{data:r,error:_}=await D.from("calendar_reminders").select("*").eq("created_by",E).order("due_date",{ascending:!0});if(_)throw _;return r||[]},enabled:!!E}),g=ie({mutationFn:async r=>{if(!E)throw new Error("User not authenticated");if(l){const{error:_}=await D.from("calendar_events").update({...r,updated_at:new Date().toISOString()}).eq("id",l.id);if(_)throw _}else{const{error:_}=await D.from("calendar_events").insert({...r,created_by:E,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(_)throw _}},onSuccess:()=>{y({title:l?"Event updated!":"Event created!",description:l?"Your event has been updated successfully.":"Your event has been created successfully."}),n(!1),p(null),k.invalidateQueries({queryKey:["calendar-events",E]})},onError:r=>{y({title:"Error",description:r.message||"Failed to save event",variant:"destructive"})}}),w=ie({mutationFn:async r=>{if(!E)throw new Error("User not authenticated");if(d){const{error:_}=await D.from("calendar_reminders").update({...r,updated_at:new Date().toISOString()}).eq("id",d.id);if(_)throw _}else{const{error:_}=await D.from("calendar_reminders").insert({...r,created_by:E,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(_)throw _}},onSuccess:()=>{y({title:d?"Reminder updated!":"Reminder created!",description:d?"Your reminder has been updated successfully.":"Your reminder has been created successfully."}),c(!1),N(null),k.invalidateQueries({queryKey:["calendar-reminders",E]})},onError:r=>{y({title:"Error",description:r.message||"Failed to save reminder",variant:"destructive"})}}),j=ie({mutationFn:async r=>{const{error:_}=await D.from("calendar_events").delete().eq("id",r);if(_)throw _},onSuccess:()=>{y({title:"Event deleted",description:"Event has been removed successfully."}),k.invalidateQueries({queryKey:["calendar-events",E]})},onError:r=>{y({title:"Delete failed",description:r.message,variant:"destructive"})}}),A=ie({mutationFn:async r=>{const{error:_}=await D.from("calendar_reminders").delete().eq("id",r);if(_)throw _},onSuccess:()=>{y({title:"Reminder deleted",description:"Reminder has been removed successfully."}),k.invalidateQueries({queryKey:["calendar-reminders",E]})},onError:r=>{y({title:"Delete failed",description:r.message,variant:"destructive"})}}),V=ie({mutationFn:async({id:r,completed:_})=>{const{error:L}=await D.from("calendar_reminders").update({completed:_,updated_at:new Date().toISOString()}).eq("id",r);if(L)throw L},onSuccess:()=>{k.invalidateQueries({queryKey:["calendar-reminders",E]})},onError:r=>{y({title:"Error",description:r.message,variant:"destructive"})}}),m=F.filter(r=>Be(qe(r.start_date),f)),o=h.filter(r=>Be(qe(r.due_date),f)),C=Ta({start:Ra(f),end:Da(f)}),O=r=>F.filter(_=>Be(qe(_.start_date),r)),b=r=>h.filter(_=>Be(qe(_.due_date),r)),T=r=>{r&&S(r)},z=r=>{p(r||null),n(!0)},B=r=>{N(r||null),c(!0)},ae=r=>{switch(r){case"high":return e.jsx(ke,{className:"h-3 w-3 fill-red-500 text-red-500"});case"medium":return e.jsx(ke,{className:"h-3 w-3 fill-yellow-500 text-yellow-500"});case"low":return e.jsx(ke,{className:"h-3 w-3 fill-green-500 text-green-500"});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-wendys-red via-red-600 to-wendys-dark-red opacity-10"}),e.jsx("div",{className:"relative px-6 py-8 sm:px-8 lg:px-12",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold bg-gradient-to-r from-wendys-charcoal to-gray-700 bg-clip-text text-transparent",children:"Calendar"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl",children:"Organize your schedule with beautiful events and smart reminders"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(R,{onClick:()=>z(),className:"wendys-button shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(_e,{className:"h-5 w-5 mr-2"}),"Add Event"]}),e.jsxs(R,{onClick:()=>B(),variant:"outline",className:"border-2 border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:[e.jsx(Fs,{className:"h-5 w-5 mr-2"}),"Add Reminder"]})]})]})})})]}),e.jsx("div",{className:"px-6 sm:px-8 lg:px-12 pb-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"inline-flex bg-white rounded-xl p-1 shadow-lg border border-gray-200",children:["month","week","day"].map(r=>e.jsx(R,{variant:x===r?"default":"ghost",onClick:()=>i(r),size:"sm",className:`rounded-lg px-6 py-2 font-medium transition-all duration-200 ${x===r?"wendys-button shadow-md":"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100"}`,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:e.jsx(Ke,{mode:"single",selected:f,onSelect:T,className:"rounded-xl border-0",classNames:{day_selected:"bg-wendys-red text-white hover:bg-wendys-dark-red focus:bg-wendys-dark-red",day_today:"bg-wendys-red/10 text-wendys-red font-bold",day:"h-12 w-12 text-center text-sm p-0 font-normal aria-selected:opacity-100 hover:bg-gray-100 rounded-lg transition-colors duration-200",head_cell:"text-gray-500 font-semibold text-sm uppercase tracking-wide pb-4",nav_button:"text-gray-600 hover:text-wendys-charcoal hover:bg-gray-100 rounded-lg transition-colors duration-200",nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",caption:"relative px-8 py-4 text-center text-xl font-semibold text-wendys-charcoal",caption_label:"text-xl font-semibold text-wendys-charcoal",table:"w-full border-collapse space-y-1",head_row:"flex",row:"flex w-full mt-2",cell:"h-12 w-12 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20"}})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-wendys-red to-wendys-dark-red rounded-full mb-4",children:e.jsx(ye,{className:"h-8 w-8 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal",children:q(f,"EEEE")}),e.jsx("p",{className:"text-lg text-gray-600",children:q(f,"MMMM d, yyyy")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3"}),"Events (",m.length,")"]}),m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No events scheduled"})]}):e.jsx("div",{className:"space-y-3",children:m.map(r=>e.jsx("div",{className:"group bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-blue-900 text-lg",children:r.title}),r.description&&e.jsx("p",{className:"text-sm text-blue-700 mt-2 leading-relaxed",children:r.description}),e.jsxs("div",{className:"flex items-center text-xs text-blue-600 mt-3 space-x-4",children:[e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx(We,{className:"h-3 w-3 mr-1"}),q(qe(r.start_date),"h:mm a")]}),r.location&&e.jsxs("span",{className:"flex items-center bg-blue-200 px-2 py-1 rounded-full",children:[e.jsx(As,{className:"h-3 w-3 mr-1"}),r.location]})]})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>z(r),className:"h-8 w-8 p-0 hover:bg-blue-200",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>j.mutate(r.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})},r.id))})]}),e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 flex items-center text-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-3"}),"Reminders (",o.length,")"]}),o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Fs,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No reminders due"})]}):e.jsx("div",{className:"space-y-3",children:o.map(r=>e.jsx("div",{className:`group border rounded-xl p-4 transition-all duration-200 hover:shadow-md ${r.completed?"bg-gray-50 border-gray-200":r.priority==="high"?"bg-gradient-to-r from-red-50 to-red-100 border-red-200":r.priority==="medium"?"bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-200":"bg-gradient-to-r from-green-50 to-green-100 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>V.mutate({id:r.id,completed:!r.completed}),className:"flex-shrink-0",children:r.completed?e.jsx(Qe,{className:"h-5 w-5 text-green-600"}):e.jsx(dt,{className:"h-5 w-5 text-gray-400 hover:text-gray-600 transition-colors duration-200"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[ae(r.priority),e.jsx("h5",{className:`font-semibold text-lg ${r.completed?"text-gray-500 line-through":"text-gray-900"}`,children:r.title})]})]}),r.description&&e.jsx("p",{className:`text-sm mt-2 leading-relaxed ${r.completed?"text-gray-500":"text-gray-700"}`,children:r.description}),e.jsx("div",{className:"flex items-center mt-3",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${r.priority==="high"?"bg-red-100 text-red-800":r.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[r.priority.charAt(0).toUpperCase()+r.priority.slice(1)," Priority"]})})]}),e.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>B(r),className:"h-8 w-8 p-0 hover:bg-gray-200",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>A.mutate(r.id),className:"h-8 w-8 p-0 text-red-600 hover:bg-red-100",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})},r.id))})]})]})})]}),x==="month"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-200 p-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-wendys-charcoal mb-6 text-center",children:q(f,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(r=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-500 py-3 px-2",children:r},r)),C.map((r,_)=>{const L=O(r),$=b(r),X=La(r),W=Be(r,f),te=Aa(r,f);return e.jsxs("div",{className:`min-h-[100px] p-2 border border-gray-200 cursor-pointer transition-all duration-200 rounded-lg ${te?"bg-white hover:bg-gray-50":"bg-gray-50 text-gray-400"} ${X?"bg-gradient-to-br from-wendys-red/20 to-wendys-dark-red/20 border-wendys-red/30 shadow-md":""} ${W?"bg-blue-50 border-blue-300 shadow-md":""}`,onClick:()=>S(r),children:[e.jsx("div",{className:`text-sm font-semibold mb-2 ${X?"text-wendys-red":te?"text-gray-900":"text-gray-400"}`,children:q(r,"d")}),L.slice(0,2).map(G=>e.jsx("div",{className:"text-xs bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded-full mb-1 truncate shadow-sm",title:G.title,children:G.title},G.id)),$.slice(0,2).map(G=>e.jsx("div",{className:`text-xs px-2 py-1 rounded-full mb-1 truncate shadow-sm ${G.completed?"bg-gray-400 text-white":G.priority==="high"?"bg-gradient-to-r from-red-500 to-red-600 text-white":G.priority==="medium"?"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white":"bg-gradient-to-r from-green-500 to-green-600 text-white"}`,title:G.title,children:G.title},G.id)),L.length+$.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 text-center bg-gray-100 rounded-full py-1 mt-1",children:["+",L.length+$.length-4," more"]})]},_)})]})]})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:l?"Edit Event":"Add Event"}),e.jsx(R,{variant:"ghost",onClick:()=>{n(!1),p(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:r=>{r.preventDefault();const _=new FormData(r.currentTarget),L={title:_.get("title"),description:_.get("description"),start_date:_.get("start_date"),end_date:_.get("end_date")||void 0,all_day:_.get("all_day")==="on",location:_.get("location"),reminder_type:_.get("reminder_type")};g.mutate(L)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"title",className:"text-sm font-semibold text-gray-700",children:"Event Title *"}),e.jsx(P,{id:"title",name:"title",defaultValue:l==null?void 0:l.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event title"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(Xe,{id:"description",name:"description",defaultValue:l==null?void 0:l.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter event description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"start_date",className:"text-sm font-semibold text-gray-700",children:"Start Date *"}),e.jsx(P,{id:"start_date",name:"start_date",type:"datetime-local",defaultValue:(ee=l==null?void 0:l.start_date)==null?void 0:ee.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"end_date",className:"text-sm font-semibold text-gray-700",children:"End Date"}),e.jsx(P,{id:"end_date",name:"end_date",type:"datetime-local",defaultValue:(t=l==null?void 0:l.end_date)==null?void 0:t.slice(0,16),className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{id:"all_day",name:"all_day",type:"checkbox",defaultChecked:l==null?void 0:l.all_day,className:"rounded border-gray-300 text-wendys-red focus:ring-wendys-red/20 h-4 w-4"}),e.jsx(M,{htmlFor:"all_day",className:"text-sm font-medium text-gray-700",children:"All day event"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"location",className:"text-sm font-semibold text-gray-700",children:"Location"}),e.jsx(P,{id:"location",name:"location",defaultValue:l==null?void 0:l.location,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter location"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reminder_type",className:"text-sm font-semibold text-gray-700",children:"Reminder"}),e.jsxs("select",{id:"reminder_type",name:"reminder_type",defaultValue:(l==null?void 0:l.reminder_type)||"none",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"none",children:"No reminder"}),e.jsx("option",{value:"15min",children:"15 minutes before"}),e.jsx("option",{value:"1hour",children:"1 hour before"}),e.jsx("option",{value:"1day",children:"1 day before"}),e.jsx("option",{value:"1week",children:"1 week before"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{n(!1),p(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:l?"Update Event":"Create Event"})]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-wendys-charcoal",children:d?"Edit Reminder":"Add Reminder"}),e.jsx(R,{variant:"ghost",onClick:()=>{c(!1),N(null)},className:"h-10 w-10 p-0 rounded-full hover:bg-gray-100",children:"×"})]}),e.jsxs("form",{onSubmit:r=>{r.preventDefault();const _=new FormData(r.currentTarget),L={title:_.get("title"),description:_.get("description"),due_date:_.get("due_date"),priority:_.get("priority"),completed:!1};w.mutate(L)},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reminder_title",className:"text-sm font-semibold text-gray-700",children:"Reminder Title *"}),e.jsx(P,{id:"reminder_title",name:"title",defaultValue:d==null?void 0:d.title,required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder title"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reminder_description",className:"text-sm font-semibold text-gray-700",children:"Description"}),e.jsx(Xe,{id:"reminder_description",name:"description",defaultValue:d==null?void 0:d.description,rows:3,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg",placeholder:"Enter reminder description"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reminder_due_date",className:"text-sm font-semibold text-gray-700",children:"Due Date *"}),e.jsx(P,{id:"reminder_due_date",name:"due_date",type:"datetime-local",defaultValue:(u=d==null?void 0:d.due_date)==null?void 0:u.slice(0,16),required:!0,className:"mt-2 border-gray-300 focus:border-wendys-red focus:ring-wendys-red/20 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reminder_priority",className:"text-sm font-semibold text-gray-700",children:"Priority"}),e.jsxs("select",{id:"reminder_priority",name:"priority",defaultValue:(d==null?void 0:d.priority)||"medium",className:"mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red/20",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6",children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>{c(!1),N(null)},className:"border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg",children:"Cancel"}),e.jsx(R,{type:"submit",className:"wendys-button rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:d?"Update Reminder":"Create Reminder"})]})]})]})})]})}const dn=ge("/")({beforeLoad:()=>{throw Ia({to:"/overview"})}}),cn=fr.update({id:"/weekending-sheet",path:"/weekending-sheet",getParentRoute:()=>xe}),mn=vr.update({id:"/soft-inventory",path:"/soft-inventory",getParentRoute:()=>xe}),un=wr.update({id:"/smg",path:"/smg",getParentRoute:()=>xe}),xn=Er.update({id:"/setup",path:"/setup",getParentRoute:()=>xe}),hn=Fr.update({id:"/settings",path:"/settings",getParentRoute:()=>xe}),gn=Hr.update({id:"/overview",path:"/overview",getParentRoute:()=>xe}),fn=Qr.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>xe}),yn=Jr.update({id:"/interviews",path:"/interviews",getParentRoute:()=>xe}),pn=nn.update({id:"/goals",path:"/goals",getParentRoute:()=>xe}),vn=ln.update({id:"/calendar",path:"/calendar",getParentRoute:()=>xe}),bn=dn.update({id:"/",path:"/",getParentRoute:()=>xe}),_n={IndexRoute:bn,CalendarRoute:vn,GoalsRoute:pn,InterviewsRoute:yn,OmegaDailyRoute:fn,OverviewRoute:gn,SettingsRoute:hn,SetupRoute:xn,SmgRoute:un,SoftInventoryRoute:mn,WeekendingSheetRoute:cn},Nn=xe._addFileChildren(_n)._addFileTypes(),zt=new Ma({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),wn=Va({routeTree:Nn,context:{queryClient:zt},defaultPreload:"intent"});Oa.createRoot(document.getElementById("root")).render(e.jsx(Oe.StrictMode,{children:e.jsxs(Fa,{client:zt,children:[e.jsx(Ua,{router:wn}),e.jsx(Ga,{}),e.jsx(Pa,{initialIsOpen:!1})]})}));
