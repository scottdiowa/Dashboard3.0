import{t as ct,c as mt,f as D,p as me,r as f,j as e,V as Ns,R as js,a as Qe,A as vs,C as ws,X as Es,T as Ss,D as Ts,P as ut,b as xt,u as ht,B as gt,d as le,e as ae,U as pt,M as yt,g as ft,W as _t,S as ze,L as Ge,h as Le,i as bt,k as Rs,l as Nt,m as Cs,n as jt,o as As,I as Ds,q as Ls,s as Is,v as ks,w as Ms,x as vt,y as Os,z as Us,E as wt,F as Et,G as St,H as Fs,J as Tt,K as oe,N as z,O as V,Q as De,Y as Rt,Z as Ct,_ as At,$ as Vs,a0 as Oe,a1 as Ue,a2 as Ps,a3 as Dt,a4 as Lt,a5 as qs,a6 as It,a7 as kt,a8 as Mt,a9 as Ot,aa as Ut,ab as Ws,ac as Ft,ad as Vt,ae as cs,af as Hs,ag as Je,ah as re,ai as Fe,aj as B,ak as J,al as ve,am as ie,an as we,ao as xe,ap as he,aq as ge,ar as pe,as as fe,at as Pt,au as _e,av as zs,aw as qt,ax as Gs,ay as Pe,az as de,aA as Xe,aB as Ze,aC as ne,aD as Wt,aE as qe,aF as ms,aG as Ee,aH as Se,aI as ce,aJ as Ht,aK as zt,aL as Gt,aM as us,aN as $s,aO as $t,aP as Ys,aQ as Ks,aR as Yt,aS as Bs,aT as Kt,aU as Qs,aV as Js,aW as Bt,aX as Qt,aY as Xs,aZ as Jt,a_ as Xt,a$ as Zt,b0 as ea,b1 as sa,b2 as ta,b3 as aa,b4 as ra,b5 as na,b6 as ia,b7 as la}from"./vendor-B3gIGAvO.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function t(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(i){if(i.ep)return;i.ep=!0;const h=t(i);fetch(i.href,h)}})();function N(...s){return ct(mt(s))}function ue(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function K(s,r=1){return`${s.toFixed(r)}%`}function Ne(s){const r=typeof s=="string"?new Date(Number(s.slice(0,4)),Number(s.slice(5,7))-1,Number(s.slice(8,10))):s;return D(r,"MMM dd, yyyy")}function oa(s){return D(me(`2000-01-01T${s}`),"h:mm a")}function Zs(s){switch(s.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const da=ut,et=f.forwardRef(({className:s,...r},t)=>e.jsx(Ns,{ref:t,className:N("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r}));et.displayName=Ns.displayName;const ca=Qe("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),st=f.forwardRef(({className:s,variant:r,...t},o)=>e.jsx(js,{ref:o,className:N(ca({variant:r}),s),...t}));st.displayName=js.displayName;const ma=f.forwardRef(({className:s,...r},t)=>e.jsx(vs,{ref:t,className:N("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...r}));ma.displayName=vs.displayName;const tt=f.forwardRef(({className:s,...r},t)=>e.jsx(ws,{ref:t,className:N("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...r,children:e.jsx(Es,{className:"h-4 w-4"})}));tt.displayName=ws.displayName;const at=f.forwardRef(({className:s,...r},t)=>e.jsx(Ss,{ref:t,className:N("text-sm font-semibold",s),...r}));at.displayName=Ss.displayName;const rt=f.forwardRef(({className:s,...r},t)=>e.jsx(Ts,{ref:t,className:N("text-sm opacity-90",s),...r}));rt.displayName=Ts.displayName;const ua=1,xa=1e6;let We=0;function ha(){return We=(We+1)%Number.MAX_SAFE_INTEGER,We.toString()}const He=new Map,xs=s=>{if(He.has(s))return;const r=setTimeout(()=>{He.delete(s),je({type:"REMOVE_TOAST",toastId:s})},xa);He.set(s,r)},ga=(s,r)=>{switch(r.type){case"ADD_TOAST":return{...s,toasts:[r.toast,...s.toasts].slice(0,ua)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===r.toast.id?{...t,...r.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=r;return t?xs(t):s.toasts.forEach(o=>{xs(o.id)}),{...s,toasts:s.toasts.map(o=>o.id===t||t===void 0?{...o,open:!1}:o)}}case"REMOVE_TOAST":return r.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==r.toastId)}}},Ie=[];let ke={toasts:[]};function je(s){ke=ga(ke,s),Ie.forEach(r=>{r(ke)})}function pa({...s}){const r=ha(),t=i=>je({type:"UPDATE_TOAST",toast:{...i,id:r}}),o=()=>je({type:"DISMISS_TOAST",toastId:r});return je({type:"ADD_TOAST",toast:{...s,id:r,open:!0,onOpenChange:i=>{i||o()}}}),{id:r,dismiss:o,update:t}}function ee(){const[s,r]=f.useState(ke);return f.useEffect(()=>(Ie.push(r),()=>{const t=Ie.indexOf(r);t>-1&&Ie.splice(t,1)}),[s]),{...s,toast:pa,dismiss:t=>je({type:"DISMISS_TOAST",toastId:t})}}function ya(){const{toasts:s}=ee();return e.jsxs(da,{children:[s.map(function({id:r,title:t,description:o,action:i,...h}){return e.jsxs(st,{...h,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(at,{children:t}),o&&e.jsx(rt,{children:o})]}),i,e.jsx(tt,{})]},r)}),e.jsx(et,{})]})}const fa="https://qewndmyixpzmtgjjihoj.supabase.co",_a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",S=xt(fa,_a,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),A=f.forwardRef(({className:s,type:r,...t},o)=>e.jsx("input",{type:r,className:N("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:o,...t}));A.displayName="Input";const hs=[{name:"Overview",href:"/overview",icon:gt,description:"Key metrics and trends",category:"main",priority:"high"},{name:"Omega Daily",href:"/omega-daily",icon:le,description:"Daily business metrics",category:"main",priority:"high"},{name:"Calendar",href:"/calendar",icon:ae,description:"Events and reminders",category:"main",priority:"medium"},{name:"Interviews & Hires",href:"/interviews",icon:pt,description:"Manage candidates and hiring",category:"main",priority:"medium"},{name:"OSAT",href:"/smg",icon:yt,description:"Customer feedback metrics",category:"main",priority:"medium"},{name:"Goal Setting",href:"/goals",icon:ft,description:"Set goals & track progress",category:"main",priority:"medium"},{name:"Setup",href:"/setup",icon:_t,description:"Copy SQL & configure",category:"main",priority:"low"}];function ba({open:s}){const r=ht(),[t,o]=f.useState(""),[i,h]=f.useState(null),d=f.useMemo(()=>{if(!t.trim())return hs;const u=t.toLowerCase();return hs.filter(x=>x.name.toLowerCase().includes(u)||x.description.toLowerCase().includes(u))},[t]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:N("bg-gradient-to-b from-white to-gray-50 shadow-2xl border-r border-gray-200 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",s?"w-64":"w-16"),children:e.jsxs("div",{className:"flex flex-col h-full relative",children:[s&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(A,{placeholder:"Search navigation...",value:t,onChange:u=>o(u.target.value),className:"pl-10 h-9 bg-gray-50 border-gray-200 focus:border-wendys-red focus:ring-wendys-red/20"})]})}),e.jsxs("nav",{className:N("overflow-y-auto flex-1",s?"p-4":"p-2"),children:[e.jsx("div",{className:"space-y-1",children:d.map(u=>{const x=r.pathname===u.href,p=u.icon;return e.jsxs("div",{className:"relative",children:[e.jsxs(Ge,{to:u.href,className:N("flex items-center transition-all duration-200 group relative",s?"space-x-3 p-3 rounded-lg mx-0":"justify-center p-3 rounded-lg mx-1",x?"bg-gradient-to-r from-wendys-red to-wendys-dark-red text-white shadow-lg ring-1 ring-red-200":"text-gray-700 hover:bg-white hover:shadow-sm hover:ring-1 hover:ring-gray-200"),onMouseEnter:()=>!s&&h(u.href),onMouseLeave:()=>!s&&h(null),children:[e.jsx("div",{className:N("flex-shrink-0 p-2 rounded-lg transition-all duration-200",x?"bg-white/20":"bg-gray-100 group-hover:bg-wendys-red/10 group-hover:scale-110"),children:e.jsx(p,{className:N("h-5 w-5 transition-colors duration-200",x?"text-white":"text-gray-600 group-hover:text-wendys-red")})}),s&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:N("font-semibold text-sm",x?"text-white":"text-gray-800"),children:u.name}),u.priority==="high"&&e.jsx(Le,{className:"h-3 w-3 text-yellow-500 fill-current"})]}),e.jsx("div",{className:N("text-xs mt-1",x?"text-red-100":"text-gray-500"),children:u.description})]})]}),!s&&i===u.href&&e.jsx("div",{className:"absolute left-full ml-2 top-1/2 transform -translate-y-1/2 z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white text-sm px-3 py-2 rounded-lg shadow-lg whitespace-nowrap",children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsx("div",{className:"text-gray-300 text-xs mt-1",children:u.description}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-900 rotate-45"})]})})]},u.href)})}),t.trim()&&d.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ze,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No navigation items found"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Try a different search term"})]})]}),s&&e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white/80 backdrop-blur-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-wendys-red rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"W"})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Dashboard v3.0"})]})})]})})})}const $e=Qe("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),E=f.forwardRef(({className:s,variant:r,size:t,asChild:o=!1,...i},h)=>{const d=o?bt:"button";return e.jsx(d,{className:N($e({variant:r,size:t,className:s})),ref:h,...i})});E.displayName="Button";const Na=wt,ja=Et,va=f.forwardRef(({className:s,inset:r,children:t,...o},i)=>e.jsxs(Rs,{ref:i,className:N("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",s),...o,children:[t,e.jsx(Nt,{className:"ml-auto h-4 w-4"})]}));va.displayName=Rs.displayName;const wa=f.forwardRef(({className:s,...r},t)=>e.jsx(Cs,{ref:t,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r}));wa.displayName=Cs.displayName;const nt=f.forwardRef(({className:s,sideOffset:r=4,...t},o)=>e.jsx(jt,{children:e.jsx(As,{ref:o,sideOffset:r,className:N("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));nt.displayName=As.displayName;const it=f.forwardRef(({className:s,inset:r,...t},o)=>e.jsx(Ds,{ref:o,className:N("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",s),...t}));it.displayName=Ds.displayName;const Ea=f.forwardRef(({className:s,children:r,checked:t,...o},i)=>e.jsxs(Ls,{ref:i,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Is,{children:e.jsx(ks,{className:"h-4 w-4"})})}),r]}));Ea.displayName=Ls.displayName;const Sa=f.forwardRef(({className:s,children:r,...t},o)=>e.jsxs(Ms,{ref:o,className:N("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Is,{children:e.jsx(vt,{className:"h-2 w-2 fill-current"})})}),r]}));Sa.displayName=Ms.displayName;const Ta=f.forwardRef(({className:s,inset:r,...t},o)=>e.jsx(Os,{ref:o,className:N("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...t}));Ta.displayName=Os.displayName;const Ra=f.forwardRef(({className:s,...r},t)=>e.jsx(Us,{ref:t,className:N("-mx-1 my-1 h-px bg-muted",s),...r}));Ra.displayName=Us.displayName;function Ca({user:s,onNavToggle:r,navOpen:t}){const{toast:o}=ee(),i=async()=>{try{await S.auth.signOut(),o({title:"Signed out",description:"You have been successfully signed out."})}catch(h){console.error("Error signing out:",h),o({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:r,className:"p-2 hover:bg-gray-100","aria-label":t?"Close navigation":"Open navigation",children:e.jsx(St,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-wendys-charcoal",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500",children:D(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(Na,{children:[e.jsx(ja,{asChild:!0,children:e.jsxs(E,{variant:"ghost",className:"flex items-center space-x-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.email})]})}),e.jsx(nt,{align:"end",children:e.jsxs(it,{onClick:i,children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const Aa=oe({business_date:V().min(1,"Business date is required"),net_sales:z.number().min(0,"Net sales must be positive"),last_year_sales:z.number().min(0,"Last year sales must be positive"),labor_hours:z.number().min(0,"Labor hours must be positive"),ideal_labor_hours:z.number().min(0,"Ideal labor hours must be positive"),labor_percentage:z.number().min(0,"Labor percentage must be positive"),food_variance_cost:z.number(),waste_amount:z.number().min(0,"Waste amount must be positive"),breakfast_sales:z.number().min(0,"Breakfast sales must be positive"),night_sales:z.number().min(0,"Night sales must be positive")}),Da=oe({date:V().min(1,"Date is required"),accuracy_decimal:De().min(0,"Accuracy must be 0 or greater"),zod_per_10k:De().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:De().min(0,"CC Complaints must be 0 or greater"),osat_decimal:De().min(0,"OSAT Score must be 0 or greater"),notes:V().optional()});oe({candidate_name:V().min(1,"Candidate name is required"),phone:V().optional(),email:V().email("Invalid email format").optional().or(Ct("")),position:V().optional(),interview_date:V().min(1,"Interview date is required"),interview_time:V().min(1,"Interview time is required"),status:Rt(["SCHEDULED","COMPLETED","NO_SHOW","HIRED","REJECTED"]),notes:V().optional()});oe({entry_date:V().min(1,"Entry date is required"),accuracy_of_order:z.number().min(0).max(5).optional(),zone_of_defection:z.number().min(0).max(5).optional(),customer_computers:z.number().min(0).max(5).optional(),taste_of_food:z.number().min(0).max(5).optional(),osat:z.number().min(0).max(5).optional()});oe({documents_received:At().default(!1),documents_folder:V().optional(),onboarding_sent_date:V().optional(),onboarding_completed_date:V().optional(),manager_reviewed_date:V().optional(),entered_in_system_date:V().optional(),fingerprint_scheduled_date:V().optional(),first_day:V().optional(),notes:V().optional()});const La=oe({email:V().email("Invalid email format"),password:V().min(6,"Password must be at least 6 characters")}),Ia=Qe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),C=f.forwardRef(({className:s,...r},t)=>e.jsx(Vs,{ref:t,className:N(Ia(),s),...r}));C.displayName=Vs.displayName;function ka(){const[s,r]=f.useState(!1),[t,o]=f.useState(!1),{toast:i}=ee(),{register:h,handleSubmit:d,formState:{errors:u}}=Oe({resolver:Ue(La)}),x=async p=>{r(!0);try{const{error:m}=await S.auth.signInWithPassword({email:p.email,password:p.password});if(m)throw m;i({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(m){console.error("Login error:",m),i({title:"Login failed",description:m.message||"Please check your credentials and try again.",variant:"destructive"})}finally{r(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:d(x),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(A,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...h("email")})]}),u.email&&e.jsx("p",{className:"text-red-600 text-sm",children:u.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(A,{id:"password",type:t?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...h("password")}),e.jsx("button",{type:"button",onClick:()=>o(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t?e.jsx(Lt,{className:"h-4 w-4"}):e.jsx(qs,{className:"h-4 w-4"})})]}),u.password&&e.jsx("p",{className:"text-red-600 text-sm",children:u.password.message})]}),e.jsx(E,{type:"submit",className:"w-full wendys-button",disabled:s,children:s?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const se=It({component:Ma});function Ma(){const[s,r]=f.useState(null),[t,o]=f.useState(!0),[i,h]=f.useState(()=>{const x=localStorage.getItem("navOpen");return x?JSON.parse(x):!0}),{toast:d}=ee(),u=kt();return f.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){r({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),o(!1);return}const{data:{session:p}}=await S.auth.getSession();p!=null&&p.user&&r(p.user)}catch(p){console.error("Error checking session:",p),r({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{o(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:p}}=S.auth.onAuthStateChange(async(m,c)=>{m==="SIGNED_IN"&&(c!=null&&c.user)?(r(c.user),d({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):m==="SIGNED_OUT"&&(r(null),u({to:"/"}),d({title:"Signed out",description:"You have been successfully signed out."}))});return()=>p.unsubscribe()}},[u,d]),f.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(i))},[i]),t?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx(Ca,{user:s,onNavToggle:()=>h(!i),navOpen:i}),e.jsxs("div",{className:"flex",children:[e.jsx(ba,{open:i}),e.jsx("main",{className:N("flex-1 p-6 transition-all duration-300 ease-in-out","ml-0"),children:e.jsx(Mt,{})})]})]}):e.jsx(ka,{})}function Te({className:s,classNames:r,showOutsideDays:t=!0,...o}){return e.jsx(Ot,{showOutsideDays:t,className:N("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:N($e({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:N($e({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...r},...o})}Te.displayName="Calendar";const es=Ft,ss=Vt,Ve=f.forwardRef(({className:s,align:r="center",sideOffset:t=4,...o},i)=>e.jsx(Ut,{children:e.jsx(Ws,{ref:i,align:r,sideOffset:t,className:N("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...o})}));Ve.displayName=Ws.displayName;function Oa({columns:s,data:r,className:t,emptyMessage:o="No data available",loading:i=!1}){const[h,d]=f.useState(null),[u,x]=f.useState(null),p=f.useMemo(()=>!h||!u?r:[...r].sort((y,R)=>{const _=y[h],j=R[h];if(_==null&&j==null)return 0;if(_==null)return u==="asc"?-1:1;if(j==null)return u==="asc"?1:-1;if(typeof _=="number"&&typeof j=="number")return u==="asc"?_-j:j-_;if(typeof _=="string"&&typeof j=="string")return u==="asc"?_.localeCompare(j):j.localeCompare(_);if(_ instanceof Date&&j instanceof Date)return u==="asc"?_.getTime()-j.getTime():j.getTime()-_.getTime();const v=String(_),g=String(j);return u==="asc"?v.localeCompare(g):g.localeCompare(v)}),[r,h,u]),m=y=>{h===y?u==="asc"?x("desc"):u==="desc"&&(x(null),d(null)):(d(y),x("asc"))},c=y=>h!==y?e.jsx(cs,{className:"h-3 w-3 text-gray-400"}):u==="asc"?e.jsx(Hs,{className:"h-3 w-3 text-gray-600"}):u==="desc"?e.jsx(Je,{className:"h-3 w-3 text-gray-600"}):e.jsx(cs,{className:"h-3 w-3 text-gray-400"});return i?e.jsx(Ua,{columns:s}):e.jsx("div",{className:N("overflow-x-auto",t),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(y=>e.jsx("th",{className:N("py-3 px-4 font-medium text-gray-700 text-sm",y.align==="center"&&"text-center",y.align==="right"&&"text-right",y.sortable&&"cursor-pointer hover:bg-gray-100 select-none",y.className),onClick:()=>y.sortable&&m(y.key),children:e.jsxs("div",{className:N("flex items-center gap-1",y.align==="center"&&"justify-center",y.align==="right"&&"justify-end"),children:[y.label,y.sortable&&c(y.key)]})},y.key))})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:o})}):p.map((y,R)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:s.map(_=>e.jsx("td",{className:N("py-3 px-4 text-sm",_.align==="center"&&"text-center",_.align==="right"&&"text-right",_.className),children:_.render?_.render(y[_.key],y):y[_.key]},_.key))},y.id||R))})]})})}function Ua({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(r=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},r.key))})}),e.jsx("tbody",{children:[...Array(5)].map((r,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(o=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},o.key))},t))})]})})})}function ye({title:s,subtitle:r,className:t,children:o,loading:i=!1,error:h,onRefresh:d}){return e.jsxs("div",{className:N("wendys-card",t),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),r&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]}),d&&e.jsx("button",{onClick:d,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),h?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:h}),d&&e.jsx("button",{onClick:d,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):i?e.jsx(Fa,{}):o]})}function Fa(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((s,r)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},r))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((s,r)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},r))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((s,r)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},r))})]})})}const W={currency:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),currencyDetailed:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),percent:(s,r=1)=>`${(s??0).toFixed(r)}%`,hours:(s,r=1)=>`${(s??0).toFixed(r)}h`,dateShort:s=>{const r=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return D(r,"MMM d")},dateFull:s=>{const r=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return D(r,"MMM dd, yyyy")},currencyCompact:s=>{const r=Math.abs(s);return r>=1e6?`$${(s/1e6).toFixed(1)}M`:r>=1e3?`$${(s/1e3).toFixed(1)}k`:W.currency(s)}},M={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},F={cartesianGrid:{strokeDasharray:"3 3",stroke:M.gridStroke},xAxis:{stroke:M.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:M.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${M.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:M.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:M.textSecondary}}},Ye=(s,r=new Date)=>{const t=new Date(r);switch(s){case"today":return{start:D(t,"yyyy-MM-dd"),end:D(t,"yyyy-MM-dd"),label:"Today"};case"wtd":const o=new Date(t);return o.setDate(t.getDate()-t.getDay()),{start:D(o,"yyyy-MM-dd"),end:D(t,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const i=new Date(t.getFullYear(),t.getMonth(),1);return{start:D(i,"yyyy-MM-dd"),end:D(t,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const h=new Date(t);return h.setDate(t.getDate()-6),{start:D(h,"yyyy-MM-dd"),end:D(t,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const d=new Date(t);return d.setDate(t.getDate()-29),{start:D(d,"yyyy-MM-dd"),end:D(t,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},Va=re("/smg")({component:Pa});function Pa(){const[s,r]=f.useState(null),[t,o]=f.useState(),{toast:i}=ee(),h=Fe(),d=Oe({resolver:Ue(Da),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});f.useEffect(()=>{let g=!0;return(async()=>{var q;const{data:T}=await S.auth.getUser(),U=(q=T.user)==null?void 0:q.id;if(!U)return;const{data:k,error:P}=await S.from("users").select("store_id").eq("id",U).maybeSingle();g&&(P||r((k==null?void 0:k.store_id)??null))})(),()=>{g=!1}},[]);const{data:u=[],isLoading:x,error:p}=B({queryKey:["smg_daily",s],queryFn:async()=>{if(!s)return[];const{data:g,error:T}=await S.from("smg_daily").select("*").eq("store_id",s).order("date",{ascending:!1});if(T)throw T;return g||[]},enabled:!!s}),{data:m=[]}=B({queryKey:["smg_entries_import",s],queryFn:async()=>{if(!s)return[];const{data:g,error:T}=await S.from("smg_entries").select("*").eq("store_id",s).order("entry_date",{ascending:!1});if(T)throw T;return g||[]},enabled:!!s}),c=f.useMemo(()=>u.length>0?u:m.length?m.map(g=>({id:g.id,date:g.entry_date,accuracy_decimal:Number(g.accuracy_of_order)||0,zod_per_10k:Number(g.zone_of_defection)||0,cc_complaints:Number(g.customer_computers)||0,osat_decimal:Number(g.osat)||0,notes:"",created_at:g.created_at})):[],[u,m]),y=J({mutationFn:async g=>{if(!s)throw new Error("Store not connected");const{error:T}=await S.from("smg_daily").insert({store_id:s,date:g.date,accuracy_decimal:g.accuracy_decimal,zod_per_10k:g.zod_per_10k,cc_complaints:g.cc_complaints,osat_decimal:g.osat_decimal,notes:g.notes||null});if(T)throw T},onSuccess:()=>{h.invalidateQueries({queryKey:["smg_daily",s]}),d.reset(),o(void 0),i({title:"Success",description:"SMG entry saved successfully."})},onError:g=>{i({title:"Error",description:g.message||"Failed to save SMG entry.",variant:"destructive"})}}),R=g=>{y.mutate(g)},_=g=>{const T=Number(g.slice(0,4)),U=Number(g.slice(5,7)),k=Number(g.slice(8,10));return new Date(T,(U||1)-1,k||1)},j=[{key:"date",label:"Date",sortable:!0,render:g=>D(_(g),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:g=>g.toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:g=>g.toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:g=>g.toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:g=>g.toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:g=>e.jsx("div",{className:"max-w-32 truncate",title:g,children:g||"-"})}],v=f.useMemo(()=>c.length?c.slice().reverse().map(g=>({date:W.dateShort(g.date),osat:g.osat_decimal})):[],[c]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),p&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",p.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ve,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:d.handleSubmit(R),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"date",children:"Date *"}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(E,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),t?D(t,"MMM dd, yyyy"):"Select date"]})}),e.jsx(Ve,{className:"w-auto p-0",align:"start",children:e.jsx(Te,{mode:"single",selected:t,onSelect:g=>{o(g),g&&d.setValue("date",D(g,"yyyy-MM-dd"))},initialFocus:!0})})]}),d.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(A,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("accuracy_decimal",{valueAsNumber:!0})}),d.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(A,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("zod_per_10k",{valueAsNumber:!0})}),d.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(A,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("cc_complaints",{valueAsNumber:!0})}),d.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(A,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...d.register("osat_decimal",{valueAsNumber:!0})}),d.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:d.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(C,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...d.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(E,{type:"submit",disabled:y.isPending||!s,className:"bg-wendys-red hover:bg-wendys-red/90",children:y.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(ye,{title:"OSAT Score Trend",subtitle:`${c.length} entries`,loading:x,error:p==null?void 0:p.message,children:v.length>0?e.jsx(ie,{width:"100%",height:300,children:e.jsxs(we,{data:v,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:g=>g.toFixed(1)}),e.jsx(pe,{...F.tooltip,formatter:g=>[g.toFixed(2),"OSAT Score"]}),e.jsx(fe,{type:"monotone",dataKey:"osat",stroke:M.sales,strokeWidth:3,dot:{fill:M.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:M.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:x?"Loading...":`${c.length} entries`})]}),s?e.jsx(Oa,{columns:j,data:c,loading:x,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const gs=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','COMPLETED','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
`,ps=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'DONE', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,qa=re("/setup")({component:Wa});function ys(s){navigator.clipboard.writeText(s)}function Wa(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase → Auth → Providers → Email: enable. Then Auth → Users → Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase → SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(E,{onClick:()=>ys(gs),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:gs})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(E,{onClick:()=>ys(ps),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:ps})]})]})}function te({title:s,value:r,format:t,delta:o,deltaLabel:i,icon:h,trend:d,suffix:u,sparklineData:x,className:p}){const m=R=>{switch(t){case"currency":return ue(R);case"percentage":return K(R);case"number":return R.toLocaleString();default:return R.toString()}},c=()=>{switch(d){case"up":return e.jsx(le,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(_e,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(Pt,{className:"h-4 w-4 text-gray-400"})}},y=()=>{switch(d){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:N("wendys-card",p),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(h,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[m(r),u&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:u})]}),x&&x.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(ie,{width:"100%",height:"100%",children:e.jsx(we,{data:x,children:e.jsx(fe,{type:"monotone",dataKey:"value",stroke:d==="up"?M.positive:d==="down"?M.waste:M.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),o!==void 0&&i&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[c(),e.jsxs("span",{className:N("text-sm font-medium",y()),children:[o>0?"+":"",Math.abs(o)<1&&t!=="percentage"?K(Math.abs(o)*100):m(Math.abs(o)),u&&t!=="percentage"&&e.jsx("span",{className:"ml-1",children:u})]}),e.jsx("span",{className:"text-xs text-gray-500",children:i})]})]})})})}function Ha({data:s=[]}){const r=f.useMemo(()=>{if(!s.length){const t=[];for(let o=13;o>=0;o--){const i=new Date;i.setDate(i.getDate()-o),t.push({date:W.dateShort(i.toISOString().slice(0,10)),sales:0})}return t}return s.sort((t,o)=>new Date(t.business_date).getTime()-new Date(o.business_date).getTime()).slice(-30).map(t=>({date:W.dateShort(t.business_date),sales:t.net_sales||0}))},[s]);return e.jsx(ie,{width:"100%",height:300,children:e.jsxs(we,{data:r,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:t=>W.currencyCompact(t)}),e.jsx(pe,{...F.tooltip,formatter:t=>[W.currencyDetailed(t),"Net Sales"]}),e.jsx(fe,{type:"monotone",dataKey:"sales",stroke:M.sales,strokeWidth:3,dot:{fill:M.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:M.salesSecondary,strokeWidth:2}})]})})}function za({data:s=[]}){console.log("🔍 LaborVsIdealChart received data:",s.slice(0,3));const r=f.useMemo(()=>{if(!s.length){const o=[];for(let i=6;i>=0;i--){const h=new Date;h.setDate(h.getDate()-i),o.push({date:W.dateShort(h.toISOString().slice(0,10)),ideal:0,actual:0})}return o}const t=s.sort((o,i)=>new Date(o.business_date).getTime()-new Date(i.business_date).getTime()).slice(-30).map(o=>{const i=Number(o.ideal_labor_hours)||0,h=Number(o.labor_hours)||0;return console.log("🔍 Processing entry:",o.business_date,"ideal:",o.ideal_labor_hours,"=>",i,"actual:",o.labor_hours,"=>",h),{date:W.dateShort(o.business_date),ideal:i,actual:h}});return console.log("🔍 Processed chart data:",t.slice(0,3)),t},[s]);return console.log("🔍 Final chartData being rendered:",r.slice(0,3)),e.jsx(ie,{width:"100%",height:300,children:e.jsxs(zs,{data:r,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:t=>W.hours(t)}),e.jsx(pe,{...F.tooltip,formatter:(t,o)=>[W.hours(t),o==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(qt,{...F.legend}),e.jsx(Gs,{dataKey:"ideal",fill:M.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(fe,{type:"monotone",dataKey:"actual",stroke:M.labor,strokeWidth:3,dot:{fill:M.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:M.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function Ga(){const[s,r]=f.useState(null);f.useEffect(()=>{let m=!0;return(async()=>{var y;const{data:c}=await S.from("users").select("store_id").eq("id",(y=(await S.auth.getUser()).data.user)==null?void 0:y.id).single();m&&r((c==null?void 0:c.store_id)??null)})(),()=>{m=!1}},[]);const{data:t=[],isLoading:o}=B({queryKey:["smg_snapshot",s],queryFn:async()=>{if(!s)return[];const m=new Date;m.setDate(m.getDate()-30);const{data:c,error:y}=await S.from("smg_daily").select("*").eq("store_id",s).gte("date",m.toISOString().split("T")[0]).order("date",{ascending:!1});if(y)throw y;return c||[]},enabled:!!s}),i=t.length>0?{accuracy:t.reduce((m,c)=>m+c.accuracy_decimal,0)/t.length,zod:t.reduce((m,c)=>m+c.zod_per_10k,0)/t.length,complaints:t.reduce((m,c)=>m+c.cc_complaints,0)/t.length,osat:t.reduce((m,c)=>m+c.osat_decimal,0)/t.length}:{accuracy:0,zod:0,complaints:0,osat:0},h=m=>{if(m.length<4)return"neutral";const c=Math.floor(m.length/2),y=m.slice(0,c).reduce((j,v)=>j+v,0)/c,_=m.slice(c).reduce((j,v)=>j+v,0)/(m.length-c)-y;return Math.abs(_)<.1?"neutral":_>0?"up":"down"},d={accuracy:h(t.map(m=>m.accuracy_decimal).reverse()),zod:h(t.map(m=>m.zod_per_10k).reverse()),complaints:h(t.map(m=>m.cc_complaints).reverse()),osat:h(t.map(m=>m.osat_decimal).reverse())},u=(m,c=!1)=>c?m<=1?"text-green-600":m<=3?"text-yellow-600":"text-red-600":m>=90?"text-green-600":m>=80?"text-yellow-600":"text-red-600",x=(m,c=!1)=>c?m<=1?e.jsx(Pe,{className:"h-4 w-4 text-green-600"}):m<=3?e.jsx(de,{className:"h-4 w-4 text-yellow-600"}):e.jsx(de,{className:"h-4 w-4 text-red-600"}):m>=90?e.jsx(Pe,{className:"h-4 w-4 text-green-600"}):m>=80?e.jsx(de,{className:"h-4 w-4 text-yellow-600"}):e.jsx(de,{className:"h-4 w-4 text-red-600"}),p=m=>{switch(m){case"up":return e.jsx(le,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(_e,{className:"h-3 w-3 text-red-600"});default:return null}};return o?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((m,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},c))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(Le,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[t.length," entries"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Le,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Le,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p(d.osat),x(i.osat),e.jsx("span",{className:N("text-xl font-bold",u(i.osat)),children:i.osat.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pe,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p(d.accuracy),x(i.accuracy),e.jsx("span",{className:N("text-xl font-bold",u(i.accuracy)),children:i.accuracy.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p(d.zod==="up"?"down":d.zod==="down"?"up":"neutral"),x(i.zod,!0),e.jsx("span",{className:N("text-xl font-bold",u(i.zod,!0)),children:i.zod.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p(d.complaints==="up"?"down":d.complaints==="down"?"up":"neutral"),x(i.complaints,!0),e.jsx("span",{className:N("text-xl font-bold",u(i.complaints,!0)),children:i.complaints.toFixed(1)})]})]})]})]})}function $a(){const[s,r]=f.useState(null),t=D(new Date,"EEEE, MMMM d"),o=D(new Date,"yyyy-MM-dd");f.useEffect(()=>{let u=!0;return(async()=>{var R;console.log("🔐 [InterviewsToday] Checking user authentication...");const{data:x,error:p}=await S.auth.getUser();console.log("👤 [InterviewsToday] Auth data:",x,"Auth error:",p);const m=(R=x.user)==null?void 0:R.id;if(!m){console.log("❌ [InterviewsToday] No user ID found - user not authenticated");return}console.log("🔍 [InterviewsToday] Looking up store for user:",m);const{data:c,error:y}=await S.from("users").select("store_id").eq("id",m).maybeSingle();if(console.log("🏪 [InterviewsToday] Store lookup result - data:",c,"error:",y),!!u){if(y){console.error("❌ [InterviewsToday] Store lookup error:",y);return}r((c==null?void 0:c.store_id)??null),console.log("✅ [InterviewsToday] Store ID set to:",(c==null?void 0:c.store_id)??null)}})(),()=>{u=!1}},[]);const{data:i=[],isLoading:h}=B({queryKey:["interviews-today",s,o],queryFn:async()=>{if(!s)return[];const{data:u,error:x}=await S.from("interviews").select("*").eq("store_id",s).eq("interview_date",o).order("interview_time",{ascending:!0});if(x)throw x;return u||[]},enabled:!!s}),d=u=>D(new Date(`2000-01-01T${u}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:t})]})]}),h?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Fs,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:i.map(u=>e.jsx(Ge,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:u.candidate_name}),e.jsx("span",{className:Ya("px-2 py-1 text-xs font-medium rounded-full",Zs(u.status)),children:u.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Xe,{className:"h-3 w-3"}),e.jsx("span",{children:u.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),e.jsx("span",{children:d(u.interview_time)})]})]}),u.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',u.notes,'"']})]})})},u.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(Ge,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"→"})]})})]})}function Ya(...s){return s.filter(Boolean).join(" ")}const fs=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function ts({selectedRange:s="last30",selectedDate:r,onRangeChange:t,onDateChange:o,onClearFilters:i,className:h,compact:d=!1}){const u=s!=="last30"||r,x=m=>{t==null||t(m),m!=="custom"&&(o==null||o(void 0))},p=()=>{if(s==="custom"&&r)return D(r,"MMM dd, yyyy");const m=fs.find(c=>c.key===s);return(m==null?void 0:m.label)||"Last 30"};return e.jsxs("div",{className:N("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",d&&"p-3",h),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Wt,{className:"h-4 w-4"}),e.jsx("span",{className:N("text-sm font-medium",d&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:fs.map(m=>e.jsx(E,{variant:s===m.key?"default":"ghost",size:"sm",onClick:()=>x(m.key),className:N("text-xs h-7 px-2",s===m.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",d&&"text-[11px] h-6 px-1.5"),title:m.description,children:m.label},m.key))}),s==="custom"&&e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:N("justify-start text-left font-normal h-7",!r&&"text-muted-foreground",d&&"h-6 text-xs"),children:[e.jsx(ae,{className:"mr-1 h-3 w-3"}),r?D(r,"MMM dd"):"Pick date"]})}),e.jsx(Ve,{className:"w-auto p-0",align:"start",children:e.jsx(Te,{mode:"single",selected:r,onSelect:o,initialFocus:!0})})]}),!d&&u&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:p()})]}),u&&i&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:i,className:N("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",d&&"h-6 px-1.5"),children:[e.jsx(Es,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function as(s,r="last30"){const[t,o]=ne.useState(()=>typeof window<"u"&&localStorage.getItem(`${s}_range`)||r),[i,h]=ne.useState(()=>{if(typeof window<"u"){const m=localStorage.getItem(`${s}_date`);if(m){const[c,y,R]=m.split("-").map(Number);return new Date(c,(y||1)-1,R||1)}return}}),d=ne.useCallback(m=>{o(m),typeof window<"u"&&localStorage.setItem(`${s}_range`,m)},[s]),u=ne.useCallback(m=>{if(h(m),typeof window<"u")if(m){const c=D(m,"yyyy-MM-dd");localStorage.setItem(`${s}_date`,c)}else localStorage.removeItem(`${s}_date`)},[s]),x=ne.useCallback(()=>{o(r),h(void 0),typeof window<"u"&&(localStorage.removeItem(`${s}_range`),localStorage.removeItem(`${s}_date`))},[s,r]),p=ne.useCallback(()=>{if(t==="custom"&&i){const m=D(i,"yyyy-MM-dd");return{start:m,end:m}}if(t&&t!=="custom"){const m=Ye(t);return m.start?{start:m.start,end:m.end}:null}return null},[t,i]);return{selectedRange:t,selectedDate:i,handleRangeChange:d,handleDateChange:u,clearFilters:x,getDateRangeFilter:p,getSelectedLabel:()=>t==="custom"&&i?D(i,"MMM dd, yyyy"):Ye(t).label}}const Ka=re("/overview")({component:Ba});function Ba(){const[s,r]=f.useState(null),t=as("overview","today");f.useEffect(()=>{let p=!0;return(async()=>{var _;const{data:m}=await S.auth.getUser(),c=(_=m.user)==null?void 0:_.id;if(!c)return;const{data:y,error:R}=await S.from("users").select("store_id").eq("id",c).maybeSingle();if(p){if(R){console.error("Error fetching store ID:",R);return}r((y==null?void 0:y.store_id)??null)}})(),()=>{p=!1}},[]);const o=t.getDateRangeFilter(),{data:i=[]}=B({queryKey:["overview-charts",s],queryFn:async()=>{if(!s)return[];const p=new Date;p.setDate(p.getDate()-30);const m=p.toISOString().slice(0,10),{data:c,error:y}=await S.from("omega_daily").select("*").eq("store_id",s).gte("business_date",m).order("business_date",{ascending:!0});if(y)throw y;return c||[]},enabled:!!s}),{data:h=[],isLoading:d,error:u}=B({queryKey:["overview-omega",s,o==null?void 0:o.start,o==null?void 0:o.end],queryFn:async()=>{if(!s)return[];let p=S.from("omega_daily").select("*").eq("store_id",s);o&&(p=p.gte("business_date",o.start).lte("business_date",o.end));const{data:m,error:c}=await p.order("business_date",{ascending:!0});if(c)throw c;return m||[]},enabled:!!s}),x=f.useMemo(()=>{if(h.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const p=h.reduce((R,_)=>({netSales:R.netSales+(_.net_sales||0),compNetSales:R.compNetSales+((_.net_sales||0)-(_.last_year_sales||0)),laborHours:R.laborHours+(_.labor_hours||0),idealLaborHours:R.idealLaborHours+(_.ideal_labor_hours||0),foodVarianceCost:R.foodVarianceCost+(_.food_variance_cost||0),wasteAmount:R.wasteAmount+(_.waste_amount||0),breakfastSales:R.breakfastSales+(_.breakfast_sales||0),nightSales:R.nightSales+(_.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),m=p.netSales>0?p.laborHours/p.netSales*100:0,c=p.netSales>0?p.foodVarianceCost/p.netSales*100:0,y=p.netSales>0?p.wasteAmount/p.netSales*100:0;return{...p,laborPercentage:m,foodVariancePercentage:c,wastePercentage:y}},[h]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",t.getSelectedLabel(),d&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),u&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",u.message]})]}),e.jsx(ts,{selectedRange:t.selectedRange,selectedDate:t.selectedDate,onRangeChange:t.handleRangeChange,onDateChange:t.handleDateChange,onClearFilters:t.clearFilters,compact:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(te,{title:"Net Sales",value:x.netSales,format:"currency",delta:x.compNetSales,deltaLabel:"vs Last Year",icon:qe,trend:x.compNetSales>=0?"up":"down"}),e.jsx(te,{title:"Labor Hours",value:x.laborHours,format:"number",delta:x.laborHours-x.idealLaborHours,deltaLabel:"vs Ideal",icon:Ze,trend:x.laborHours>x.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(te,{title:"Labor %",value:x.laborPercentage,format:"percentage",icon:le,trend:"neutral"}),e.jsx(te,{title:"Food Variance",value:x.foodVarianceCost,format:"currency",delta:x.foodVariancePercentage,deltaLabel:"% of Sales",icon:_e,trend:x.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(te,{title:"Waste Amount",value:x.wasteAmount,format:"currency",delta:x.wastePercentage,deltaLabel:"% of Sales",icon:_e,trend:x.wasteAmount>=0?"down":"up"}),e.jsx(te,{title:"Breakfast Sales",value:x.breakfastSales,format:"currency",icon:qe,trend:"neutral"}),e.jsx(te,{title:"Night Sales",value:x.nightSales,format:"currency",icon:qe,trend:"neutral"}),e.jsx(te,{title:"Comp Net Sales",value:x.compNetSales,format:"currency",icon:le,trend:x.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ye,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!i.length&&!u,error:u==null?void 0:u.message,children:i.length>0?e.jsx(Ha,{data:i}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(ye,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!i.length&&!u,error:u==null?void 0:u.message,children:i.length>0?e.jsx(za,{data:i}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Ga,{}),e.jsx($a,{})]})]})}function Qa({columns:s,data:r,mobileCardRender:t,className:o,emptyMessage:i="No data available",loading:h=!1}){if(h)return e.jsx(Ja,{columns:s});const d=u=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:s.map(x=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[x.label,":"]}),e.jsx("span",{className:"text-sm",children:x.render?x.render(u[x.key],u):u[x.key]})]},x.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:N("hidden md:block",o),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(u=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:u.label},u.key))})}),e.jsx("tbody",{children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:i})}):r.map((u,x)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:s.map(p=>e.jsx("td",{className:N("py-3 px-4 text-sm",p.className),children:p.render?p.render(u[p.key],u):u[p.key]},p.key))},u.id||x))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:i}):r.map((u,x)=>e.jsx("div",{children:t?t(u):d(u)},u.id||x))})})]})}function Ja({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(r=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},r.key))})}),e.jsx("tbody",{children:[...Array(3)].map((r,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(o=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},o.key))},t))})]})})})}const Xa=re("/omega-daily")({component:Za});function Za(){const[s,r]=f.useState(!1),[t,o]=f.useState(null),{toast:i}=ee(),h=Fe(),[d,u]=f.useState(null),x=as("omega-daily","last30"),p=async()=>{if(!d){i({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const a=[],n=new Date;for(let w=9;w>=0;w--){const I=new Date(n);I.setDate(I.getDate()-w),a.push({store_id:d,business_date:D(I,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:l}=await S.from("omega_daily").insert(a);if(l)throw l;i({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),h.invalidateQueries({queryKey:["omega_daily","last30",d]})}catch(a){i({title:"Error adding sample data",description:a.message,variant:"destructive"})}},m=()=>{h.invalidateQueries({queryKey:["omega_daily",d]}),i({title:"Refreshing data...",description:"Reloading your OMEGA entries."})},c=Oe({resolver:Ue(Aa),defaultValues:{business_date:D(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),y=J({onMutate:async a=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");await h.cancelQueries({queryKey:["omega_daily"]});const n=`temp-${Date.now()}`,l={id:n,store_id:d,business_date:a.business_date,net_sales:a.net_sales,last_year_sales:a.last_year_sales,labor_hours:a.labor_hours,ideal_labor_hours:a.ideal_labor_hours,labor_percentage:a.labor_percentage,food_variance_cost:a.food_variance_cost,waste_amount:a.waste_amount,breakfast_sales:a.breakfast_sales,night_sales:a.night_sales},w=[],I=h.getQueriesData({queryKey:["omega_daily"]});for(const[$,Z]of I){const H=$;if(!H.includes(d))continue;let rs=!0;const ns=typeof H[2]=="string"?String(H[2]):void 0,is=typeof H[3]=="string"?String(H[3]):void 0;if(ns&&is&&(rs=a.business_date>=ns&&a.business_date<=is),!rs)continue;const ls=[l,...Z||[]];ls.sort((os,ds)=>os.business_date>ds.business_date?-1:os.business_date<ds.business_date?1:0),w.push({queryKey:$,previousData:Z}),h.setQueryData($,ls)}return{optimisticId:n,touchedCaches:w}},mutationFn:async a=>{if(console.log("🔄 Starting insertMutation with payload:",a),console.log("🏪 Store ID:",d),!d)throw console.error("❌ No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const n={store_id:d,business_date:a.business_date,net_sales:a.net_sales,last_year_sales:a.last_year_sales,labor_hours:a.labor_hours,ideal_labor_hours:a.ideal_labor_hours,labor_percentage:a.labor_percentage,food_variance_cost:a.food_variance_cost,waste_amount:a.waste_amount,breakfast_sales:a.breakfast_sales,night_sales:a.night_sales};console.log("📤 Inserting data:",n);const{data:l,error:w}=await S.from("omega_daily").insert(n).select();if(console.log("📥 Supabase response - data:",l,"error:",w),w)throw console.error("❌ Supabase error:",w),w;return console.log("✅ Insert successful:",l),l},onError:(a,n,l)=>{if(l!=null&&l.touchedCaches)for(const{queryKey:w,previousData:I}of l.touchedCaches)h.setQueryData(w,I||[]);console.error("💥 Insert mutation failed (rolled back):",a),i({title:"Save failed",description:(a==null?void 0:a.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(a,n,l)=>{console.log("🎉 Insert mutation succeeded with data:",a),i({title:"Success!",description:"Daily metrics saved successfully."});const w=Array.isArray(a)&&a[0]?a[0]:void 0;if(w&&(l!=null&&l.touchedCaches)&&l.optimisticId)for(const{queryKey:I}of l.touchedCaches){const Z=(h.getQueryData(I)??[]).map(H=>H.id===l.optimisticId?w:H);h.setQueryData(I,Z)}r(!1),o(null),c.reset()}}),R=J({mutationFn:async({id:a,payload:n})=>{if(!d)throw new Error("No store is linked to your account. See Setup to link one.");const{error:l}=await S.from("omega_daily").update({business_date:n.business_date,net_sales:n.net_sales,last_year_sales:n.last_year_sales,labor_hours:n.labor_hours,ideal_labor_hours:n.ideal_labor_hours,labor_percentage:n.labor_percentage,food_variance_cost:n.food_variance_cost,waste_amount:n.waste_amount,breakfast_sales:n.breakfast_sales,night_sales:n.night_sales}).eq("id",a);if(l)throw l},onSuccess:()=>{i({title:"Updated!",description:"Daily metrics updated successfully."}),r(!1),o(null),c.reset(),h.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:a=>{i({title:"Update failed",description:a.message,variant:"destructive"})}}),_=a=>{console.log("🚀 onSubmit called with data:",a),console.log("📋 Form errors:",c.formState.errors),console.log("🏪 Store ID:",d),console.log("✏️ Editing entry:",t),console.log("🔄 Insert mutation pending:",y.isPending),console.log("🔄 Update mutation pending:",R.isPending),t?(console.log("📝 Calling updateMutation..."),R.mutate({id:t.id,payload:a})):(console.log("➕ Calling insertMutation..."),y.mutate(a))},j=a=>{console.error("❌ Form validation failed with errors:",a),i({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},v=J({mutationFn:async a=>{const{error:n}=await S.from("omega_daily").delete().eq("id",a);if(n)throw n},onSuccess:()=>{i({title:"Deleted",description:"Daily metrics entry removed."}),h.invalidateQueries({queryKey:["omega_daily","last30",d]})},onError:a=>{i({title:"Delete failed",description:a.message,variant:"destructive"})}});f.useEffect(()=>{let a=!0;return(async()=>{var Z;console.log("🔐 Checking user authentication...");const{data:n,error:l}=await S.auth.getUser();console.log("👤 Auth data:",n,"Auth error:",l);const w=(Z=n.user)==null?void 0:Z.id;if(!w){console.log("❌ No user ID found - user not authenticated");return}console.log("🔍 Looking up store for user:",w);const{data:I,error:$}=await S.from("users").select("store_id").eq("id",w).maybeSingle();if(console.log("🏪 Store lookup result - data:",I,"error:",$),!!a){if($){console.error("❌ Store lookup error:",$),i({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}u((I==null?void 0:I.store_id)??null),console.log("✅ Store ID set to:",(I==null?void 0:I.store_id)??null),I!=null&&I.store_id||(console.log("⚠️ No store linked to user account"),i({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{a=!1}},[]);const g=x.getDateRangeFilter(),{data:T=[],isLoading:U,error:k}=B({queryKey:["omega_daily",d,g==null?void 0:g.start,g==null?void 0:g.end],queryFn:async()=>{if(!d)return[];let a=S.from("omega_daily").select("*").eq("store_id",d);g&&(a=a.gte("business_date",g.start).lte("business_date",g.end));const{data:n,error:l}=await a.order("business_date",{ascending:!1}).limit(100);if(l)throw l;return n},enabled:!!d}),{data:P=[]}=B({queryKey:["omega_daily_charts",d],queryFn:async()=>{if(!d)return[];const a=new Date;a.setDate(a.getDate()-30);const n=D(a,"yyyy-MM-dd"),{data:l,error:w}=await S.from("omega_daily").select("*").eq("store_id",d).gte("business_date",n).order("business_date",{ascending:!0});if(w)throw w;return l},enabled:!!d}),{data:q=[]}=B({queryKey:["omega_daily_mtd",d],queryFn:async()=>{if(!d)return[];const{start:a,end:n}=Ye("mtd"),{data:l,error:w}=await S.from("omega_daily").select("*").eq("store_id",d).gte("business_date",a).lte("business_date",n).order("business_date",{ascending:!0});if(w)throw w;return l},enabled:!!d}),G=a=>{if(!a)return;x.handleRangeChange("custom");const n=Number(a.slice(0,4)),l=Number(a.slice(5,7)),w=Number(a.slice(8,10));x.handleDateChange(new Date(n,(l||1)-1,w||1))},X=f.useMemo(()=>P.length?P.map(a=>({date:W.dateShort(a.business_date),dateFull:W.dateFull(a.business_date),isoDate:(typeof a.business_date=="string",a.business_date),comp_net_sales_percentage:a.last_year_sales?(a.net_sales-a.last_year_sales)/a.last_year_sales*100:0})):[],[P]),b=f.useMemo(()=>P.length?P.map(a=>({date:W.dateShort(a.business_date),dateFull:W.dateFull(a.business_date),isoDate:(typeof a.business_date=="string",a.business_date),waste_percentage:a.net_sales?a.waste_amount/a.net_sales*100:0,food_variance_percentage:a.net_sales?-(a.food_variance_cost/a.net_sales)*100:0})):[],[P]),O=a=>{o(a);const n={business_date:a.business_date||D(new Date,"yyyy-MM-dd"),net_sales:a.net_sales!=null?Number(a.net_sales):0,last_year_sales:a.last_year_sales!=null?Number(a.last_year_sales):0,labor_hours:a.labor_hours!=null?Number(a.labor_hours):0,ideal_labor_hours:a.ideal_labor_hours!=null?Number(a.ideal_labor_hours):0,labor_percentage:a.labor_percentage!=null?Number(a.labor_percentage):0,food_variance_cost:a.food_variance_cost!=null?Number(a.food_variance_cost):0,waste_amount:a.waste_amount!=null?Number(a.waste_amount):0,breakfast_sales:a.breakfast_sales!=null?Number(a.breakfast_sales):0,night_sales:a.night_sales!=null?Number(a.night_sales):0};c.reset(n),r(!0)},L=a=>{v.mutate(a)},Y=c.watch(),Re=Y.last_year_sales>0?(Y.net_sales-Y.last_year_sales)/Y.last_year_sales*100:0,be=Y.labor_hours-Y.ideal_labor_hours,Ce=Y.net_sales>0?Y.food_variance_cost/Y.net_sales*100:0,Ae=Y.net_sales>0?Y.waste_amount/Y.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(E,{onClick:()=>{o(null),c.reset({business_date:D(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),r(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),d&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(E,{onClick:p,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(E,{onClick:m,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const a=q.reduce((I,$)=>I+(Number($.net_sales)||0),0),n=q.length>0?q.reduce((I,$)=>I+(Number($.labor_percentage)||0),0)/q.length:0,l=q.reduce((I,$)=>I+(Number($.waste_amount)||0),0),w=a>0?l/a*100:0;return e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:ue(a)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:K(n)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:K(w)})]})]})})()}),e.jsx(ts,{selectedRange:x.selectedRange,selectedDate:x.selectedDate,onRangeChange:x.handleRangeChange,onDateChange:x.handleDateChange,onClearFilters:x.clearFilters}),k&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",k.message]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(ye,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!P.length&&!k,error:k==null?void 0:k.message,children:X.length>0?e.jsx(ie,{width:"100%",height:300,children:e.jsxs(we,{data:X,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:a=>W.percent(a)}),e.jsx(pe,{...F.tooltip,formatter:a=>[W.percent(a,1),"Comp Sales %"],labelFormatter:(a,n)=>{var l;return n&&n[0]&&((l=n[0].payload)==null?void 0:l.dateFull)||a}}),e.jsx(fe,{type:"monotone",dataKey:"comp_net_sales_percentage",stroke:M.sales,strokeWidth:2,dot:{fill:M.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:M.salesSecondary,strokeWidth:2},onClick:a=>{var n;return G((n=a==null?void 0:a.payload)==null?void 0:n.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ye,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!P.length&&!k,error:k==null?void 0:k.message,children:b.length>0?e.jsx(ie,{width:"100%",height:300,children:e.jsxs(zs,{data:b,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:a=>W.percent(a)}),e.jsx(pe,{...F.tooltip,formatter:a=>[W.percent(a,2),"Waste %"],labelFormatter:(a,n)=>{var l;return n&&n[0]&&((l=n[0].payload)==null?void 0:l.dateFull)||a}}),e.jsx(ms,{y:.5,stroke:M.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:M.textSecondary,fontSize:12}}),e.jsx(Gs,{dataKey:"waste_percentage",fill:M.waste,opacity:.7,onClick:a=>{var n;return G((n=a==null?void 0:a.payload)==null?void 0:n.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ye,{title:"Food Variance",subtitle:"Last 30 days",loading:!P.length&&!k,error:k==null?void 0:k.message,children:b.length>0?e.jsx(ie,{width:"100%",height:300,children:e.jsxs(we,{data:b,children:[e.jsx(xe,{...F.cartesianGrid}),e.jsx(he,{dataKey:"date",...F.xAxis}),e.jsx(ge,{...F.yAxis,tickFormatter:a=>W.percent(a)}),e.jsx(pe,{...F.tooltip,formatter:(a,n,l)=>{var I;const w=((I=l==null?void 0:l.payload)==null?void 0:I.food_variance_percentage)!==void 0?-l.payload.food_variance_percentage:0;return[W.percent(w,2),"Food Variance %"]},labelFormatter:(a,n)=>{var l;return n&&n[0]&&((l=n[0].payload)==null?void 0:l.dateFull)||a}}),e.jsx(ms,{y:0,stroke:M.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:M.textSecondary,fontSize:12}}),e.jsx(fe,{type:"monotone",dataKey:"food_variance_percentage",stroke:M.foodVariance,strokeWidth:2,dot:{fill:M.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:M.warning,strokeWidth:2},onClick:a=>{var n;return G((n=a==null?void 0:a.payload)==null?void 0:n.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:x.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[U?"Loading...":`${T.length} entries`,x.selectedRange!=="last30"&&` for ${x.getSelectedLabel()}`,(x.selectedRange!=="last30"||x.selectedDate)&&e.jsx(E,{variant:"ghost",size:"sm",onClick:x.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(T==null?void 0:T.length)===0&&!U?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:d?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:x.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),d&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(E,{onClick:()=>r(!0),className:"wendys-button",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(E,{onClick:p,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx(Qa,{columns:[{key:"business_date",label:"Date",render:a=>Ne(a)},{key:"net_sales",label:"Net Sales",render:a=>ue(a)},{key:"comp_sales",label:"Comp Sales",render:(a,n)=>{const l=(n.net_sales??0)-(n.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${l>=0?"text-green-600":"text-red-600"}`,children:[l>=0?e.jsx(le,{className:"h-3 w-3 mr-1"}):e.jsx(_e,{className:"h-3 w-3 mr-1"}),ue(Math.abs(l))]})}},{key:"labor_hours",label:"Labor Hours",render:a=>`${a}h`},{key:"labor_percentage",label:"Labor %",render:a=>K(a)},{key:"food_variance",label:"Food Variance",render:(a,n)=>{const l=n.net_sales?n.food_variance_cost/n.net_sales*100:0;return K(l)}},{key:"waste",label:"Waste",render:(a,n)=>{const l=n.net_sales?n.waste_amount/n.net_sales*100:0;return K(l)}},{key:"actions",label:"Actions",render:(a,n)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>O(n),className:"h-8 w-8 p-0",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{G(n.business_date),i({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(qs,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>L(n.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"h-4 w-4"})})]})}],data:T,mobileCardRender:a=>{const n=(a.net_sales??0)-(a.last_year_sales??0),l=a.net_sales?a.food_variance_cost/a.net_sales*100:0,w=a.net_sales?a.waste_amount/a.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:Ne(a.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>O(a),className:"h-8 w-8 p-0",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>L(a.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Se,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:ue(a.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${n>=0?"text-green-600":"text-red-600"}`,children:[n>=0?e.jsx(le,{className:"h-3 w-3 mr-1"}):e.jsx(_e,{className:"h-3 w-3 mr-1"}),ue(Math.abs(n))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[a.labor_hours,"h (",K(a.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:K(l)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:K(w)})]})]})]})},emptyMessage:"No entries found",loading:U})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:t?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(E,{variant:"ghost",onClick:()=>{r(!1),o(null),c.reset()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:c.handleSubmit(_,j),className:"space-y-4",children:[Object.keys(c.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(c.formState.errors).map(([a,n])=>e.jsxs("li",{children:["• ",n==null?void 0:n.message]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(C,{children:"Business Date"}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),c.watch("business_date")?Ne(c.watch("business_date")):"Pick a date"]})}),e.jsx(Ve,{className:"w-auto p-0",children:e.jsx(Te,{mode:"single",selected:(()=>{const a=c.watch("business_date");if(!a)return;const n=Number(a.slice(0,4)),l=Number(a.slice(5,7)),w=Number(a.slice(8,10));return new Date(n,(l||1)-1,w||1)})(),onSelect:a=>{const n=a?D(a,"yyyy-MM-dd"):"";if(c.setValue("business_date",n),n){const l=T.find(w=>w.business_date===n);l?(o(l),c.reset({business_date:l.business_date,net_sales:l.net_sales!=null?Number(l.net_sales):0,last_year_sales:l.last_year_sales!=null?Number(l.last_year_sales):0,labor_hours:l.labor_hours!=null?Number(l.labor_hours):0,ideal_labor_hours:l.ideal_labor_hours!=null?Number(l.ideal_labor_hours):0,labor_percentage:l.labor_percentage!=null?Number(l.labor_percentage):0,food_variance_cost:l.food_variance_cost!=null?Number(l.food_variance_cost):0,waste_amount:l.waste_amount!=null?Number(l.waste_amount):0,breakfast_sales:l.breakfast_sales!=null?Number(l.breakfast_sales):0,night_sales:l.night_sales!=null?Number(l.night_sales):0}),i({title:"Loaded existing entry",description:`Loaded data for ${Ne(l.business_date)} to edit.`})):(o(null),c.reset({business_date:n,net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}))}},initialFocus:!0})})]}),c.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(A,{id:"net_sales",type:"number",step:"0.01",...c.register("net_sales")}),c.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(A,{id:"last_year_sales",type:"number",step:"0.01",...c.register("last_year_sales")}),c.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(A,{id:"comp_net_sales",value:K(Re),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(A,{id:"labor_hours",type:"number",step:"0.1",...c.register("labor_hours")}),c.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(A,{id:"ideal_labor_hours",type:"number",step:"0.1",...c.register("ideal_labor_hours")}),c.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(A,{id:"labor_hours_diff",value:`${be>=0?"+":""}${be.toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(A,{id:"labor_percentage",type:"number",step:"0.1",...c.register("labor_percentage")}),c.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(A,{id:"food_variance_cost",type:"number",step:"0.01",...c.register("food_variance_cost")}),c.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(A,{id:"food_variance_percentage",value:K(Ce),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(A,{id:"waste_amount",type:"number",step:"0.01",...c.register("waste_amount")}),c.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(A,{id:"waste_percentage",value:K(Ae),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(A,{id:"breakfast_sales",type:"number",step:"0.01",...c.register("breakfast_sales")}),c.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(A,{id:"night_sales",type:"number",step:"0.01",...c.register("night_sales")}),c.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.night_sales.message})]})]}),!d&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isn’t linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>{r(!1),o(null),c.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(E,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:y.isPending||R.isPending||!d,children:t?"Update Entry":"Save Entry"})]})]})]})})]})}const Me=f.forwardRef(({className:s,...r},t)=>e.jsx("textarea",{className:N("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r}));Me.displayName="Textarea";const er=re("/calendar")({component:sr});function sr(){var Ce,Ae,a;const[s,r]=f.useState(!1),[t,o]=f.useState(!1),[i,h]=f.useState(null),[d,u]=f.useState(null),[x,p]=f.useState(new Date),[m,c]=f.useState("month"),{toast:y}=ee(),R=Fe(),[_,j]=f.useState(null);f.useEffect(()=>{(async()=>{const{data:{user:l}}=await S.auth.getUser();j((l==null?void 0:l.id)||null)})()},[]);const{data:v=[]}=B({queryKey:["calendar-events",_],queryFn:async()=>{if(!_)return[];const{data:n,error:l}=await S.from("calendar_events").select("*").eq("created_by",_).order("start_date",{ascending:!0});if(l)throw l;return n||[]},enabled:!!_}),{data:g=[]}=B({queryKey:["calendar-reminders",_],queryFn:async()=>{if(!_)return[];const{data:n,error:l}=await S.from("calendar_reminders").select("*").eq("created_by",_).order("due_date",{ascending:!0});if(l)throw l;return n||[]},enabled:!!_}),T=J({mutationFn:async n=>{if(!_)throw new Error("User not authenticated");if(i){const{error:l}=await S.from("calendar_events").update({...n,updated_at:new Date().toISOString()}).eq("id",i.id);if(l)throw l}else{const{error:l}=await S.from("calendar_events").insert({...n,created_by:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(l)throw l}},onSuccess:()=>{y({title:i?"Event updated!":"Event created!",description:i?"Your event has been updated successfully.":"Your event has been created successfully."}),r(!1),h(null),R.invalidateQueries({queryKey:["calendar-events",_]})},onError:n=>{y({title:"Error",description:n.message||"Failed to save event",variant:"destructive"})}}),U=J({mutationFn:async n=>{if(!_)throw new Error("User not authenticated");if(d){const{error:l}=await S.from("calendar_reminders").update({...n,updated_at:new Date().toISOString()}).eq("id",d.id);if(l)throw l}else{const{error:l}=await S.from("calendar_reminders").insert({...n,created_by:_,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(l)throw l}},onSuccess:()=>{y({title:d?"Reminder updated!":"Reminder created!",description:d?"Your reminder has been updated successfully.":"Your reminder has been created successfully."}),o(!1),u(null),R.invalidateQueries({queryKey:["calendar-reminders",_]})},onError:n=>{y({title:"Error",description:n.message||"Failed to save reminder",variant:"destructive"})}}),k=J({mutationFn:async n=>{const{error:l}=await S.from("calendar_events").delete().eq("id",n);if(l)throw l},onSuccess:()=>{y({title:"Event deleted",description:"Event has been removed successfully."}),R.invalidateQueries({queryKey:["calendar-events",_]})},onError:n=>{y({title:"Delete failed",description:n.message,variant:"destructive"})}}),P=J({mutationFn:async n=>{const{error:l}=await S.from("calendar_reminders").delete().eq("id",n);if(l)throw l},onSuccess:()=>{y({title:"Reminder deleted",description:"Reminder has been removed successfully."}),R.invalidateQueries({queryKey:["calendar-reminders",_]})},onError:n=>{y({title:"Delete failed",description:n.message,variant:"destructive"})}}),q=J({mutationFn:async({id:n,completed:l})=>{const{error:w}=await S.from("calendar_reminders").update({completed:l,updated_at:new Date().toISOString()}).eq("id",n);if(w)throw w},onSuccess:()=>{R.invalidateQueries({queryKey:["calendar-reminders",_]})},onError:n=>{y({title:"Error",description:n.message,variant:"destructive"})}}),G=v.filter(n=>ce(me(n.start_date),x)),X=g.filter(n=>ce(me(n.due_date),x)),b=Ht({start:zt(x),end:Gt(x)}),O=n=>v.filter(l=>ce(me(l.start_date),n)),L=n=>g.filter(l=>ce(me(l.due_date),n)),Y=n=>{n&&p(n)},Re=n=>{h(n||null),r(!0)},be=n=>{u(n||null),o(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-wendys-charcoal",children:"Calendar"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your events and reminders"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(E,{onClick:()=>Re(),className:"wendys-button",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Add Event"]}),e.jsxs(E,{onClick:()=>be(),variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Add Reminder"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:m==="month"?"default":"outline",onClick:()=>c("month"),size:"sm",children:"Month"}),e.jsx(E,{variant:m==="week"?"default":"outline",onClick:()=>c("week"),size:"sm",children:"Week"}),e.jsx(E,{variant:m==="day"?"default":"outline",onClick:()=>c("day"),size:"sm",children:"Day"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"wendys-card",children:e.jsx(Te,{mode:"single",selected:x,onSelect:Y,className:"rounded-md border"})})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:D(x,"EEEE, MMMM d, yyyy")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-gray-700 flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Events (",G.length,")"]}),G.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No events scheduled"}):G.map(n=>e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-blue-900",children:n.title}),n.description&&e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:n.description}),e.jsxs("div",{className:"flex items-center text-xs text-blue-600 mt-2 space-x-3",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),D(me(n.start_date),"h:mm a")]}),n.location&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"}),n.location]})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Re(n),className:"h-6 w-6 p-0",children:e.jsx(Ee,{className:"h-3 w-3"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>k.mutate(n.id),className:"h-6 w-6 p-0 text-red-600",children:e.jsx(Se,{className:"h-3 w-3"})})]})]})},n.id))]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-700 flex items-center",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Reminders (",X.length,")"]}),X.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No reminders due"}):X.map(n=>e.jsx("div",{className:`border rounded-lg p-3 ${n.completed?"bg-gray-50 border-gray-200":n.priority==="high"?"bg-red-50 border-red-200":n.priority==="medium"?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:n.completed,onChange:l=>q.mutate({id:n.id,completed:l.target.checked}),className:"rounded border-gray-300 text-wendys-red focus:ring-wendys-red"}),e.jsx("h5",{className:`font-medium ${n.completed?"text-gray-500 line-through":"text-gray-900"}`,children:n.title})]}),n.description&&e.jsx("p",{className:`text-sm mt-1 ${n.completed?"text-gray-500":"text-gray-700"}`,children:n.description}),e.jsx("div",{className:"flex items-center text-xs text-gray-600 mt-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n.priority==="high"?"bg-red-100 text-red-800":n.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:n.priority})})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>be(n),className:"h-6 w-6 p-0",children:e.jsx(Ee,{className:"h-3 w-3"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>P.mutate(n.id),className:"h-6 w-6 p-0 text-red-600",children:e.jsx(Se,{className:"h-3 w-3"})})]})]})},n.id))]})]})})]}),m==="month"&&e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4",children:D(x,"MMMM yyyy")}),e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(n=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:n},n)),b.map((n,l)=>{const w=O(n),I=L(n),$=ce(n,new Date),Z=ce(n,x);return e.jsxs("div",{className:`min-h-[80px] p-2 border border-gray-200 cursor-pointer hover:bg-gray-50 ${$?"bg-wendys-red/10 border-wendys-red":""} ${Z?"bg-blue-50 border-blue-300":""}`,onClick:()=>p(n),children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:D(n,"d")}),w.slice(0,2).map(H=>e.jsx("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded mb-1 truncate",title:H.title,children:H.title},H.id)),I.slice(0,2).map(H=>e.jsx("div",{className:`text-xs px-1 py-0.5 rounded mb-1 truncate ${H.completed?"bg-gray-100 text-gray-600":H.priority==="high"?"bg-red-100 text-red-800":H.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,title:H.title,children:H.title},H.id)),w.length+I.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",w.length+I.length-4," more"]})]},l)})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:i?"Edit Event":"Add Event"}),e.jsx(E,{variant:"ghost",onClick:()=>{r(!1),h(null)},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const l=new FormData(n.currentTarget),w={title:l.get("title"),description:l.get("description"),start_date:l.get("start_date"),end_date:l.get("end_date")||void 0,all_day:l.get("all_day")==="on",location:l.get("location"),reminder_type:l.get("reminder_type")};T.mutate(w)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"title",children:"Event Title *"}),e.jsx(A,{id:"title",name:"title",defaultValue:i==null?void 0:i.title,required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"description",children:"Description"}),e.jsx(Me,{id:"description",name:"description",defaultValue:i==null?void 0:i.description,rows:3,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(A,{id:"start_date",name:"start_date",type:"datetime-local",defaultValue:(Ce=i==null?void 0:i.start_date)==null?void 0:Ce.slice(0,16),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"end_date",children:"End Date"}),e.jsx(A,{id:"end_date",name:"end_date",type:"datetime-local",defaultValue:(Ae=i==null?void 0:i.end_date)==null?void 0:Ae.slice(0,16),className:"mt-1"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"all_day",name:"all_day",type:"checkbox",defaultChecked:i==null?void 0:i.all_day,className:"rounded border-gray-300 text-wendys-red focus:ring-wendys-red"}),e.jsx(C,{htmlFor:"all_day",children:"All day event"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"location",children:"Location"}),e.jsx(A,{id:"location",name:"location",defaultValue:i==null?void 0:i.location,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"reminder_type",children:"Reminder"}),e.jsxs("select",{id:"reminder_type",name:"reminder_type",defaultValue:(i==null?void 0:i.reminder_type)||"none",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red",children:[e.jsx("option",{value:"none",children:"No reminder"}),e.jsx("option",{value:"15min",children:"15 minutes before"}),e.jsx("option",{value:"1hour",children:"1 hour before"}),e.jsx("option",{value:"1day",children:"1 day before"}),e.jsx("option",{value:"1week",children:"1 week before"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>{r(!1),h(null)},children:"Cancel"}),e.jsx(E,{type:"submit",className:"wendys-button",children:i?"Update Event":"Create Event"})]})]})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:d?"Edit Reminder":"Add Reminder"}),e.jsx(E,{variant:"ghost",onClick:()=>{o(!1),u(null)},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:n=>{n.preventDefault();const l=new FormData(n.currentTarget),w={title:l.get("title"),description:l.get("description"),due_date:l.get("due_date"),priority:l.get("priority"),completed:!1};U.mutate(w)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"reminder_title",children:"Reminder Title *"}),e.jsx(A,{id:"reminder_title",name:"title",defaultValue:d==null?void 0:d.title,required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"reminder_description",children:"Description"}),e.jsx(Me,{id:"reminder_description",name:"description",defaultValue:d==null?void 0:d.description,rows:3,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"reminder_due_date",children:"Due Date *"}),e.jsx(A,{id:"reminder_due_date",name:"due_date",type:"datetime-local",defaultValue:(a=d==null?void 0:d.due_date)==null?void 0:a.slice(0,16),required:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"reminder_priority",children:"Priority"}),e.jsxs("select",{id:"reminder_priority",name:"priority",defaultValue:(d==null?void 0:d.priority)||"medium",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-wendys-red focus:ring-wendys-red",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>{o(!1),u(null)},children:"Cancel"}),e.jsx(E,{type:"submit",className:"wendys-button",children:d?"Update Reminder":"Create Reminder"})]})]})]})})]})}const _s=Jt,bs=Xt,Ke=f.forwardRef(({className:s,children:r,...t},o)=>e.jsxs($s,{ref:o,className:N("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[r,e.jsx($t,{asChild:!0,children:e.jsx(Je,{className:"h-4 w-4 opacity-50"})})]}));Ke.displayName=$s.displayName;const lt=f.forwardRef(({className:s,...r},t)=>e.jsx(Ys,{ref:t,className:N("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Hs,{className:"h-4 w-4"})}));lt.displayName=Ys.displayName;const ot=f.forwardRef(({className:s,...r},t)=>e.jsx(Ks,{ref:t,className:N("flex cursor-default items-center justify-center py-1",s),...r,children:e.jsx(Je,{className:"h-4 w-4"})}));ot.displayName=Ks.displayName;const Be=f.forwardRef(({className:s,children:r,position:t="popper",...o},i)=>e.jsx(Yt,{children:e.jsxs(Bs,{ref:i,className:N("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...o,children:[e.jsx(lt,{}),e.jsx(Kt,{className:N("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(ot,{})]})}));Be.displayName=Bs.displayName;const tr=f.forwardRef(({className:s,...r},t)=>e.jsx(Qs,{ref:t,className:N("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r}));tr.displayName=Qs.displayName;const Q=f.forwardRef(({className:s,children:r,...t},o)=>e.jsxs(Js,{ref:o,className:N("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Bt,{children:e.jsx(ks,{className:"h-4 w-4"})})}),e.jsx(Qt,{children:r})]}));Q.displayName=Js.displayName;const ar=f.forwardRef(({className:s,...r},t)=>e.jsx(Xs,{ref:t,className:N("-mx-1 my-1 h-px bg-muted",s),...r}));ar.displayName=Xs.displayName;const rr=re("/interviews")({component:nr});function nr(){const[s,r]=f.useState(null),[t,o]=f.useState([]),[i,h]=f.useState(!1),[d,u]=f.useState(null),[x,p]=f.useState(""),[m,c]=f.useState("ALL"),[y,R]=f.useState(!1),{toast:_}=ee(),[j,v]=f.useState({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""});f.useEffect(()=>{(async()=>{try{const{data:{user:O}}=await S.auth.getUser();if(!O)return;const{data:L}=await S.from("users").select("store_id").eq("id",O.id).single();L!=null&&L.store_id&&(r(L.store_id),g(L.store_id))}catch(O){console.error("Error getting store ID:",O)}})()},[]);const g=async b=>{try{R(!0);const{data:O,error:L}=await S.from("interviews").select("*").eq("store_id",b).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(L)throw L;o(O||[])}catch(O){console.error("Error fetching interviews:",O),_({title:"Error",description:"Failed to fetch interviews",variant:"destructive"})}finally{R(!1)}},T=(b,O)=>{v(L=>({...L,[b]:O}))},U=()=>{v({candidate_name:"",phone:"",email:"",position:"",interview_date:"",interview_time:"",status:"SCHEDULED",notes:""}),u(null)},k=async()=>{if(!s){_({title:"Error",description:"No store selected",variant:"destructive"});return}try{if(d){const{error:b}=await S.from("interviews").update({candidate_name:j.candidate_name,phone:j.phone||null,email:j.email||null,position:j.position||"",interview_date:j.interview_date,interview_time:j.interview_time,status:j.status,notes:j.notes||null}).eq("id",d.id);if(b)throw b;_({title:"Success!",description:"Interview updated successfully."})}else{const{error:b}=await S.from("interviews").insert([{store_id:s,candidate_name:j.candidate_name,phone:j.phone||null,email:j.email||null,position:j.position||null,interview_date:j.interview_date,interview_time:j.interview_time,status:j.status,notes:j.notes||null}]);if(b)throw b;_({title:"Success!",description:"Interview scheduled successfully."})}g(s),h(!1),U()}catch(b){console.error("Error saving interview:",b),_({title:"Error",description:b.message||"Failed to save interview",variant:"destructive"})}},P=b=>{u(b),v({candidate_name:b.candidate_name,phone:b.phone||"",email:b.email||"",position:b.position||"",interview_date:b.interview_date,interview_time:b.interview_time,status:b.status,notes:b.notes||""}),h(!0)},q=async b=>{if(confirm("Are you sure you want to delete this interview?"))try{const{error:O}=await S.from("interviews").delete().eq("id",b);if(O)throw O;_({title:"Deleted!",description:"Interview removed successfully."}),g(s)}catch(O){console.error("Error deleting interview:",O),_({title:"Error",description:O.message||"Failed to delete interview",variant:"destructive"})}},X=t.filter(b=>{const O=b.candidate_name.toLowerCase().includes(x.toLowerCase())||(b.position||"").toLowerCase().includes(x.toLowerCase()),L=m==="ALL"||b.status===m;return O&&L}).reduce((b,O)=>{const L=O.interview_date;return b[L]||(b[L]=[]),b[L].push(O),b},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(E,{onClick:()=>h(!0),className:"wendys-button",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(A,{placeholder:"Search by name or position...",value:x,onChange:b=>p(b.target.value),className:"pl-10"})]})}),e.jsxs(_s,{value:m,onValueChange:c,children:[e.jsx(Ke,{className:"w-full sm:w-48",children:e.jsx(bs,{placeholder:"Filter by status"})}),e.jsxs(Be,{children:[e.jsx(Q,{value:"ALL",children:"All Statuses"}),e.jsx(Q,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(Q,{value:"COMPLETED",children:"Completed"}),e.jsx(Q,{value:"NO_SHOW",children:"No Show"}),e.jsx(Q,{value:"HIRED",children:"Hired"}),e.jsx(Q,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[y&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!y&&Object.keys(X).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(X).map(([b,O])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2"}),Ne(b)]}),e.jsx("div",{className:"space-y-3",children:O.map(L=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:L.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Zs(L.status)}`,children:L.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{children:L.position||"No position specified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:oa(L.interview_time)})]}),L.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{children:L.phone})]}),L.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{className:"h-4 w-4"}),e.jsx("span",{children:L.email})]})]}),L.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx(ea,{className:"h-4 w-4 inline mr-1"}),L.notes]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(E,{variant:"outline",size:"sm",onClick:()=>P(L),children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>q(L.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})},L.id))})]},b))]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:d?"Edit Interview":"Schedule New Interview"}),e.jsx(E,{variant:"ghost",onClick:()=>{h(!1),U()},className:"h-8 w-8 p-0",children:"×"})]}),e.jsxs("form",{onSubmit:b=>{b.preventDefault(),k()},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(A,{id:"candidate_name",value:j.candidate_name,onChange:b=>T("candidate_name",b.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"position",children:"Position"}),e.jsx(A,{id:"position",value:j.position,onChange:b=>T("position",b.target.value),placeholder:"e.g., Crew Member, Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"phone",children:"Phone"}),e.jsx(A,{id:"phone",type:"tel",value:j.phone,onChange:b=>T("phone",b.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"email",children:"Email"}),e.jsx(A,{id:"email",type:"email",value:j.email,onChange:b=>T("email",b.target.value),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(A,{id:"interview_date",type:"date",value:j.interview_date,onChange:b=>T("interview_date",b.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(A,{id:"interview_time",type:"time",value:j.interview_time,onChange:b=>T("interview_time",b.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"status",children:"Status *"}),e.jsxs(_s,{value:j.status,onValueChange:b=>T("status",b),children:[e.jsx(Ke,{id:"status",children:e.jsx(bs,{})}),e.jsxs(Be,{children:[e.jsx(Q,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(Q,{value:"COMPLETED",children:"Completed"}),e.jsx(Q,{value:"NO_SHOW",children:"No Show"}),e.jsx(Q,{value:"HIRED",children:"Hired"}),e.jsx(Q,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"notes",children:"Notes"}),e.jsx(Me,{id:"notes",value:j.notes,onChange:b=>T("notes",b.target.value),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>{h(!1),U()},children:"Cancel"}),e.jsx(E,{type:"submit",className:"wendys-button",children:d?"Update Interview":"Schedule Interview"})]})]})]})})]})}const ir=oe({sales_target:z.number().min(0),labor_target_pct:z.number().min(0),waste_target_pct:z.number().min(0),food_variance_target_pct:z.number().min(0),team_notes:V().optional()});function lr(){const{toast:s}=ee(),r=Fe(),[t,o]=f.useState(null),i=as("goals","wtd"),h=i.getDateRangeFilter(),d=(h==null?void 0:h.start)||D(new Date,"yyyy-MM-dd"),u=(h==null?void 0:h.end)||D(new Date,"yyyy-MM-dd"),x=i.selectedRange==="mtd"?"month":i.selectedRange==="wtd"?"week":"custom",p=Oe({resolver:Ue(ir),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});f.useEffect(()=>{let v=!0;return(async()=>{var P;const{data:g}=await S.auth.getUser(),T=(P=g.user)==null?void 0:P.id;if(!T)return;const{data:U,error:k}=await S.from("users").select("store_id").eq("id",T).maybeSingle();v&&(k||o((U==null?void 0:U.store_id)??null))})(),()=>{v=!1}},[]);const{data:m}=B({queryKey:["goals_settings",t,d,u],queryFn:async()=>{if(!t)return null;try{const{data:v,error:g}=await S.from("goals").select("*").eq("store_id",t).eq("period_start",d).eq("period_end",u).maybeSingle();if(g&&g.code!=="PGRST116"){const T=String(g.code||""),U=String(g.message||"");if(T.startsWith("42")||U.toLowerCase().includes("relation")||U.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw g}return v||null}catch(v){const g=String((v==null?void 0:v.code)||""),T=String((v==null?void 0:v.message)||"");if(g.startsWith("42")||T.toLowerCase().includes("relation")||T.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw v}},enabled:!!t});f.useEffect(()=>{m&&p.reset({sales_target:m.sales_target,labor_target_pct:m.labor_target_pct,waste_target_pct:m.waste_target_pct,food_variance_target_pct:m.food_variance_target_pct,team_notes:m.team_notes||""})},[m]);const{data:c=[]}=B({queryKey:["omega_daily_for_goals",t,d,u],queryFn:async()=>{if(!t)return[];const{data:v,error:g}=await S.from("omega_daily").select("*").eq("store_id",t).gte("business_date",d).lte("business_date",u).order("business_date",{ascending:!0});if(g)throw g;return v},enabled:!!t}),y=f.useMemo(()=>{const v=c.reduce((q,G)=>q+(Number(G.net_sales)||0),0),g=c.length>0?c.reduce((q,G)=>q+(Number(G.labor_percentage)||0),0)/c.length:0,T=c.reduce((q,G)=>q+(Number(G.waste_amount)||0),0),U=c.reduce((q,G)=>q+(Number(G.food_variance_cost)||0),0),k=v>0?T/v*100:0,P=v>0?U/v*100:0;return{totalSales:v,avgLaborPct:g,wastePct:k,foodVarPct:P}},[c]),R=J({mutationFn:async v=>{if(!t)throw new Error("No store is linked to your account. See Setup to link one.");const g={store_id:t,scope:x,period_start:d,period_end:u,sales_target:v.sales_target,labor_target_pct:v.labor_target_pct,waste_target_pct:v.waste_target_pct,food_variance_target_pct:v.food_variance_target_pct,team_notes:v.team_notes||null},{error:T}=await S.from("goals").upsert(g,{onConflict:"store_id,period_start,period_end"});if(T){const U=String(T.code||""),k=String(T.message||"");throw U.startsWith("42")||k.toLowerCase().includes("relation")||k.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):T}},onSuccess:()=>{s({title:"Saved",description:"Goals saved for selected period."}),r.invalidateQueries({queryKey:["goals_settings",t,d,u]})},onError:v=>{s({title:"Save failed",description:v.message,variant:"destructive"})}}),_=()=>{p.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""})},j=(v,g)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${v?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Goal Setting"}),e.jsx("p",{className:"text-gray-600",children:"Set targets and track progress against Omega Daily actuals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{variant:"outline",onClick:_,children:"Reset Goals"}),e.jsx(E,{className:"wendys-button",onClick:p.handleSubmit(v=>R.mutate(v)),disabled:!t||R.isPending,children:"Save Goals"})]})]}),e.jsx(ts,{selectedRange:i.selectedRange,selectedDate:i.selectedDate,onRangeChange:i.handleRangeChange,onDateChange:i.handleDateChange,onClearFilters:i.clearFilters}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Sales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target"}),e.jsx(A,{type:"number",step:"0.01",...p.register("sales_target")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual"}),e.jsxs("p",{className:"text-xl font-semibold",children:["$",y.totalSales.toLocaleString()]})]})]}),e.jsx("div",{children:j(y.totalSales>=(p.watch("sales_target")||0),y.totalSales>=(p.watch("sales_target")||0)?"On Track":"Behind")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Labor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target %"}),e.jsx(A,{type:"number",step:"0.1",...p.register("labor_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.avgLaborPct.toFixed(1),"%"]})]})]}),e.jsx("div",{children:j(y.avgLaborPct<=(p.watch("labor_target_pct")||0),y.avgLaborPct<=(p.watch("labor_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Waste & Food"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Target %"}),e.jsx(A,{type:"number",step:"0.1",...p.register("waste_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.wastePct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:j(y.wastePct<=(p.watch("waste_target_pct")||0),y.wastePct<=(p.watch("waste_target_pct")||0)?"On Track":"High")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Target %"}),e.jsx(A,{type:"number",step:"0.1",...p.register("food_variance_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[y.foodVarPct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:j(y.foodVarPct<=(p.watch("food_variance_target_pct")||0),y.foodVarPct<=(p.watch("food_variance_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card md:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Team & Personal"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"team_notes",children:"Notes"}),e.jsx(A,{id:"team_notes",...p.register("team_notes"),placeholder:"Notes, personal goals, shout-outs..."})]})})]})]})]})}const or=re("/goals")({component:lr}),dr=re("/")({beforeLoad:()=>{throw sa({to:"/overview"})}}),cr=Va.update({id:"/smg",path:"/smg",getParentRoute:()=>se}),mr=qa.update({id:"/setup",path:"/setup",getParentRoute:()=>se}),ur=Ka.update({id:"/overview",path:"/overview",getParentRoute:()=>se}),xr=Xa.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>se}),hr=er.update({id:"/calendar",path:"/calendar",getParentRoute:()=>se}),gr=rr.update({id:"/interviews",path:"/interviews",getParentRoute:()=>se}),pr=or.update({id:"/goals",path:"/goals",getParentRoute:()=>se}),yr=dr.update({id:"/",path:"/",getParentRoute:()=>se}),fr={IndexRoute:yr,CalendarRoute:hr,GoalsRoute:pr,InterviewsRoute:gr,OmegaDailyRoute:xr,OverviewRoute:ur,SetupRoute:mr,SmgRoute:cr},_r=se._addFileChildren(fr)._addFileTypes(),dt=new ta({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),br=aa({routeTree:_r,context:{queryClient:dt},defaultPreload:"intent"});ra.createRoot(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsxs(na,{client:dt,children:[e.jsx(ia,{router:br}),e.jsx(ya,{}),e.jsx(la,{initialIsOpen:!1})]})}));
