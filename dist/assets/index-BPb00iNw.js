import{t as ot,c as lt,f as C,p as dt,r as N,j as e,V as fs,R as ys,a as Be,A as _s,C as Ns,X as bs,T as js,D as vs,P as ct,b as mt,u as ut,B as xt,d as de,U as ht,e as be,g as gt,W as pt,L as Ve,S as ft,h as ws,i as yt,k as Es,l as _t,m as Ss,I as Ts,n as Rs,o as Ds,q as Cs,s as As,v as Pe,w as Ls,x as Is,y as Nt,z as bt,M as jt,E as ks,F as vt,G as ce,H as z,J as V,K as Re,N as wt,O as Et,Q as St,Y as Os,Z as Ee,_ as Se,$ as Ms,a0 as Tt,a1 as Rt,a2 as Us,a3 as Dt,a4 as Ct,a5 as At,a6 as Lt,a7 as It,a8 as Fs,a9 as kt,aa as Ot,ab as os,ac as Vs,ad as Ke,ae as me,af as Le,ag as Q,ah as oe,ai as Ae,aj as le,ak as we,al as he,am as ge,an as pe,ao as fe,ap as _e,aq as Mt,ar as Ne,as as Ps,at as Ut,au as qs,av as Oe,aw as se,ax as ue,ay as Hs,az as Qe,aA as ie,aB as Ft,aC as Me,aD as ls,aE as qe,aF as He,aG as Ws,aH as Vt,aI as zs,aJ as Gs,aK as Pt,aL as $s,aM as qt,aN as Ys,aO as Bs,aP as Ht,aQ as Wt,aR as Ks,aS as zt,aT as Gt,aU as $t,aV as Yt,aW as Bt,aX as Kt,aY as Qt,aZ as Jt,a_ as Xt,a$ as Zt,b0 as ea,b1 as sa,b2 as ta}from"./vendor-BiZOmPuo.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const x of n)if(x.type==="childList")for(const c of x.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const x={};return n.integrity&&(x.integrity=n.integrity),n.referrerPolicy&&(x.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?x.credentials="include":n.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function i(n){if(n.ep)return;n.ep=!0;const x=t(n);fetch(n.href,x)}})();function w(...s){return ot(lt(s))}function xe(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function K(s,a=1){return`${s.toFixed(a)}%`}function X(s){const a=typeof s=="string"?new Date(Number(s.slice(0,4)),Number(s.slice(5,7))-1,Number(s.slice(8,10))):s;return C(a,"MMM dd, yyyy")}function ds(s){return C(dt(`2000-01-01T${s}`),"h:mm a")}function We(s){switch(s.toLowerCase()){case"scheduled":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"no_show":return"bg-red-100 text-red-800";case"hired":return"bg-purple-100 text-purple-800";case"rejected":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}}const aa=ct,Qs=N.forwardRef(({className:s,...a},t)=>e.jsx(fs,{ref:t,className:w("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));Qs.displayName=fs.displayName;const ra=Be("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Js=N.forwardRef(({className:s,variant:a,...t},i)=>e.jsx(ys,{ref:i,className:w(ra({variant:a}),s),...t}));Js.displayName=ys.displayName;const na=N.forwardRef(({className:s,...a},t)=>e.jsx(_s,{ref:t,className:w("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));na.displayName=_s.displayName;const Xs=N.forwardRef(({className:s,...a},t)=>e.jsx(Ns,{ref:t,className:w("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(bs,{className:"h-4 w-4"})}));Xs.displayName=Ns.displayName;const Zs=N.forwardRef(({className:s,...a},t)=>e.jsx(js,{ref:t,className:w("text-sm font-semibold",s),...a}));Zs.displayName=js.displayName;const et=N.forwardRef(({className:s,...a},t)=>e.jsx(vs,{ref:t,className:w("text-sm opacity-90",s),...a}));et.displayName=vs.displayName;const ia=1,oa=1e6;let Ue=0;function la(){return Ue=(Ue+1)%Number.MAX_SAFE_INTEGER,Ue.toString()}const Fe=new Map,cs=s=>{if(Fe.has(s))return;const a=setTimeout(()=>{Fe.delete(s),ve({type:"REMOVE_TOAST",toastId:s})},oa);Fe.set(s,a)},da=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,ia)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?cs(t):s.toasts.forEach(i=>{cs(i.id)}),{...s,toasts:s.toasts.map(i=>i.id===t||t===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},De=[];let Ce={toasts:[]};function ve(s){Ce=da(Ce,s),De.forEach(a=>{a(Ce)})}function ca({...s}){const a=la(),t=n=>ve({type:"UPDATE_TOAST",toast:{...n,id:a}}),i=()=>ve({type:"DISMISS_TOAST",toastId:a});return ve({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:n=>{n||i()}}}),{id:a,dismiss:i,update:t}}function te(){const[s,a]=N.useState(Ce);return N.useEffect(()=>(De.push(a),()=>{const t=De.indexOf(a);t>-1&&De.splice(t,1)}),[s]),{...s,toast:ca,dismiss:t=>ve({type:"DISMISS_TOAST",toastId:t})}}function ma(){const{toasts:s}=te();return e.jsxs(aa,{children:[s.map(function({id:a,title:t,description:i,action:n,...x}){return e.jsxs(Js,{...x,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(Zs,{children:t}),i&&e.jsx(et,{children:i})]}),n,e.jsx(Xs,{})]},a)}),e.jsx(Qs,{})]})}const ua="https://qewndmyixpzmtgjjihoj.supabase.co",xa="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFld25kbXlpeHB6bXRnamppaG9qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjI0MDEsImV4cCI6MjA3MTYzODQwMX0.qGJGQ0U-0JjuFCn1deB5aOEA52y_uA9weCvZah3N6kI",v=mt(ua,xa,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),ha=[{name:"Overview",href:"/overview",icon:xt,description:"Key metrics and trends"},{name:"Omega Daily",href:"/omega-daily",icon:de,description:"Daily business metrics"},{name:"Interviews & Hires",href:"/interviews",icon:ht,description:"Manage candidates and hiring"},{name:"OSAT",href:"/smg",icon:be,description:"Customer feedback metrics"},{name:"Goal Setting",href:"/goals",icon:gt,description:"Set goals & track progress"},{name:"Setup",href:"/setup",icon:pt,description:"Copy SQL & configure"}];function ga({open:s}){const a=ut();return e.jsx(e.Fragment,{children:e.jsx("div",{className:w("bg-white shadow-2xl border-r border-gray-100 transition-[width] duration-300 ease-in-out shrink-0 overflow-hidden",s?"w-48":"w-0"),children:e.jsx("div",{className:"flex flex-col h-full relative",children:e.jsx("nav",{className:w("overflow-y-auto",s?"p-3":"p-2.5"),children:e.jsx("div",{className:"space-y-2",children:ha.map(t=>{const i=a.pathname===t.href,n=t.icon;return e.jsxs(Ve,{to:t.href,className:w("flex items-center transition-colors duration-200",s?"space-x-2 p-2 rounded-md mx-2":"justify-center p-2 rounded-md mx-1",i?"bg-wendys-red text-white ring-1 ring-red-200":"text-gray-700 hover:bg-gray-50 hover:ring-1 hover:ring-gray-200"),children:[e.jsx("div",{className:w("flex-shrink-0 p-2 rounded-md",i?"bg-white/20":"bg-gray-100"),children:e.jsx(n,{className:w("h-4.5 w-4.5",i?"text-white":"text-gray-600")})}),s&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:w("font-medium text-sm",i?"text-white":"text-gray-800"),children:t.name}),e.jsx("div",{className:w("text-xs mt-0.5",i?"text-red-100":"text-gray-500"),children:t.description})]})]},t.href)})})})})})})}const ze=Be("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),S=N.forwardRef(({className:s,variant:a,size:t,asChild:i=!1,...n},x)=>{const c=i?ft:"button";return e.jsx(c,{className:w(ze({variant:a,size:t,className:s})),ref:x,...n})});S.displayName="Button";const pa=Nt,fa=bt,ya=N.forwardRef(({className:s,inset:a,children:t,...i},n)=>e.jsxs(ws,{ref:n,className:w("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",s),...i,children:[t,e.jsx(yt,{className:"ml-auto h-4 w-4"})]}));ya.displayName=ws.displayName;const _a=N.forwardRef(({className:s,...a},t)=>e.jsx(Es,{ref:t,className:w("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));_a.displayName=Es.displayName;const st=N.forwardRef(({className:s,sideOffset:a=4,...t},i)=>e.jsx(_t,{children:e.jsx(Ss,{ref:i,sideOffset:a,className:w("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));st.displayName=Ss.displayName;const tt=N.forwardRef(({className:s,inset:a,...t},i)=>e.jsx(Ts,{ref:i,className:w("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",s),...t}));tt.displayName=Ts.displayName;const Na=N.forwardRef(({className:s,children:a,checked:t,...i},n)=>e.jsxs(Rs,{ref:n,className:w("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ds,{children:e.jsx(Cs,{className:"h-4 w-4"})})}),a]}));Na.displayName=Rs.displayName;const ba=N.forwardRef(({className:s,children:a,...t},i)=>e.jsxs(As,{ref:i,className:w("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ds,{children:e.jsx(Pe,{className:"h-2 w-2 fill-current"})})}),a]}));ba.displayName=As.displayName;const ja=N.forwardRef(({className:s,inset:a,...t},i)=>e.jsx(Ls,{ref:i,className:w("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",s),...t}));ja.displayName=Ls.displayName;const va=N.forwardRef(({className:s,...a},t)=>e.jsx(Is,{ref:t,className:w("-mx-1 my-1 h-px bg-muted",s),...a}));va.displayName=Is.displayName;function wa({user:s,onNavToggle:a,navOpen:t}){const{toast:i}=te(),n=async()=>{try{await v.auth.signOut(),i({title:"Signed out",description:"You have been successfully signed out."})}catch(x){console.error("Error signing out:",x),i({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}};return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:a,className:"p-2 hover:bg-gray-100","aria-label":t?"Close navigation":"Open navigation",children:e.jsx(jt,{className:"h-5 w-5 text-wendys-charcoal"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-wendys-red rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xl",children:"W"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-wendys-charcoal",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500",children:C(new Date,"EEEE, MMMM d, yyyy")})]})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(pa,{children:[e.jsx(fa,{asChild:!0,children:e.jsxs(S,{variant:"ghost",className:"flex items-center space-x-2",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.email})]})}),e.jsx(st,{align:"end",children:e.jsxs(tt,{onClick:n,children:[e.jsx(vt,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})})}const Ea=ce({business_date:V().min(1,"Business date is required"),net_sales:z.number().min(0,"Net sales must be positive"),last_year_sales:z.number().min(0,"Last year sales must be positive"),labor_hours:z.number().min(0,"Labor hours must be positive"),ideal_labor_hours:z.number().min(0,"Ideal labor hours must be positive"),labor_percentage:z.number().min(0,"Labor percentage must be positive"),food_variance_cost:z.number(),waste_amount:z.number().min(0,"Waste amount must be positive"),breakfast_sales:z.number().min(0,"Breakfast sales must be positive"),night_sales:z.number().min(0,"Night sales must be positive")}),Sa=ce({date:V().min(1,"Date is required"),accuracy_decimal:Re().min(0,"Accuracy must be 0 or greater"),zod_per_10k:Re().min(0,"ZOD per 10k must be 0 or greater"),cc_complaints:Re().min(0,"CC Complaints must be 0 or greater"),osat_decimal:Re().min(0,"OSAT Score must be 0 or greater"),notes:V().optional()}),Ta=ce({candidate_name:V().min(1,"Candidate name is required"),phone:V().optional(),email:V().email("Invalid email format").optional().or(Et("")),position:V().optional(),interview_date:V().min(1,"Interview date is required"),interview_time:V().min(1,"Interview time is required"),status:wt(["SCHEDULED","DONE","NO_SHOW","HIRED","REJECTED"]),notes:V().optional()});ce({entry_date:V().min(1,"Entry date is required"),accuracy_of_order:z.number().min(0).max(5).optional(),zone_of_defection:z.number().min(0).max(5).optional(),customer_computers:z.number().min(0).max(5).optional(),taste_of_food:z.number().min(0).max(5).optional(),osat:z.number().min(0).max(5).optional()});ce({documents_received:St().default(!1),documents_folder:V().optional(),onboarding_sent_date:V().optional(),onboarding_completed_date:V().optional(),manager_reviewed_date:V().optional(),entered_in_system_date:V().optional(),fingerprint_scheduled_date:V().optional(),first_day:V().optional(),notes:V().optional()});const Ra=ce({email:V().email("Invalid email format"),password:V().min(6,"Password must be at least 6 characters")}),L=N.forwardRef(({className:s,type:a,...t},i)=>e.jsx("input",{type:a,className:w("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:i,...t}));L.displayName="Input";const Da=Be("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),A=N.forwardRef(({className:s,...a},t)=>e.jsx(Os,{ref:t,className:w(Da(),s),...a}));A.displayName=Os.displayName;function Ca(){const[s,a]=N.useState(!1),[t,i]=N.useState(!1),{toast:n}=te(),{register:x,handleSubmit:c,formState:{errors:m}}=Ee({resolver:Se(Ra)}),p=async g=>{a(!0);try{const{error:d}=await v.auth.signInWithPassword({email:g.email,password:g.password});if(d)throw d;n({title:"Welcome!",description:"Successfully signed in to your dashboard."})}catch(d){console.error("Login error:",d),n({title:"Login failed",description:d.message||"Please check your credentials and try again.",variant:"destructive"})}finally{a(!1)}};return e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-wendys-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-white font-bold text-3xl",children:"W"})}),e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal mb-2",children:"SE 14th GM Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to access your restaurant metrics"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 border border-gray-200",children:[e.jsxs("form",{onSubmit:c(p),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",className:"text-wendys-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(L,{id:"email",type:"email",placeholder:"Enter your email",className:"pl-10",...x("email")})]}),m.email&&e.jsx("p",{className:"text-red-600 text-sm",children:m.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",className:"text-wendys-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(L,{id:"password",type:t?"text":"password",placeholder:"Enter your password",className:"pl-10 pr-10",...x("password")}),e.jsx("button",{type:"button",onClick:()=>i(!t),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:t?e.jsx(Rt,{className:"h-4 w-4"}):e.jsx(Us,{className:"h-4 w-4"})})]}),m.password&&e.jsx("p",{className:"text-red-600 text-sm",children:m.password.message})]}),e.jsx(S,{type:"submit",className:"w-full wendys-button",disabled:s,children:s?"Signing in...":"Sign In"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Demo Credentials"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," gm@se14th.wendys.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," test123"]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use these credentials to test the dashboard functionality."})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Â© 2024 Wendy's International, Inc. All rights reserved."})})]})})}const ae=Dt({component:Aa});function Aa(){const[s,a]=N.useState(null),[t,i]=N.useState(!0),[n,x]=N.useState(()=>{const p=localStorage.getItem("navOpen");return p?JSON.parse(p):!0}),{toast:c}=te(),m=Ct();return N.useEffect(()=>{if((async()=>{try{if("https://qewndmyixpzmtgjjihoj.supabase.co".trim()===""){a({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()}),i(!1);return}const{data:{session:g}}=await v.auth.getSession();g!=null&&g.user&&a(g.user)}catch(g){console.error("Error checking session:",g),a({id:"mock-user-id",email:"gm@wendys-se14th.com",app_metadata:{},user_metadata:{},aud:"authenticated",created_at:new Date().toISOString()})}finally{i(!1)}})(),"https://qewndmyixpzmtgjjihoj.supabase.co".trim()!==""){const{data:{subscription:g}}=v.auth.onAuthStateChange(async(d,o)=>{d==="SIGNED_IN"&&(o!=null&&o.user)?(a(o.user),c({title:"Welcome back!",description:"Successfully signed in to your dashboard."})):d==="SIGNED_OUT"&&(a(null),m({to:"/"}),c({title:"Signed out",description:"You have been successfully signed out."}))});return()=>g.unsubscribe()}},[m,c]),N.useEffect(()=>{localStorage.setItem("navOpen",JSON.stringify(n))},[n]),t?e.jsx("div",{className:"min-h-screen bg-wendys-gray flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-wendys-red mx-auto mb-4"}),e.jsx("p",{className:"text-wendys-charcoal",children:"Loading dashboard..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-wendys-gray",children:[e.jsx(wa,{user:s,onNavToggle:()=>x(!n),navOpen:n}),e.jsxs("div",{className:"flex",children:[e.jsx(ga,{open:n}),e.jsx("main",{className:w("flex-1 p-6 transition-all duration-300"),children:e.jsx(At,{})})]})]}):e.jsx(Ca,{})}function Ie({className:s,classNames:a,showOutsideDays:t=!0,...i}){return e.jsx(Lt,{showOutsideDays:t,className:w("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:w(ze({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:w(ze({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},...i})}Ie.displayName="Calendar";const Je=kt,Xe=Ot,ke=N.forwardRef(({className:s,align:a="center",sideOffset:t=4,...i},n)=>e.jsx(It,{children:e.jsx(Fs,{ref:n,align:a,sideOffset:t,className:w("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})}));ke.displayName=Fs.displayName;function La({columns:s,data:a,className:t,emptyMessage:i="No data available",loading:n=!1}){const[x,c]=N.useState(null),[m,p]=N.useState(null),g=N.useMemo(()=>!x||!m?a:[...a].sort((_,T)=>{const j=_[x],O=T[x];if(j==null&&O==null)return 0;if(j==null)return m==="asc"?-1:1;if(O==null)return m==="asc"?1:-1;if(typeof j=="number"&&typeof O=="number")return m==="asc"?j-O:O-j;if(typeof j=="string"&&typeof O=="string")return m==="asc"?j.localeCompare(O):O.localeCompare(j);if(j instanceof Date&&O instanceof Date)return m==="asc"?j.getTime()-O.getTime():O.getTime()-j.getTime();const E=String(j),h=String(O);return m==="asc"?E.localeCompare(h):h.localeCompare(E)}),[a,x,m]),d=_=>{x===_?m==="asc"?p("desc"):m==="desc"&&(p(null),c(null)):(c(_),p("asc"))},o=_=>x!==_?e.jsx(os,{className:"h-3 w-3 text-gray-400"}):m==="asc"?e.jsx(Vs,{className:"h-3 w-3 text-gray-600"}):m==="desc"?e.jsx(Ke,{className:"h-3 w-3 text-gray-600"}):e.jsx(os,{className:"h-3 w-3 text-gray-400"});return n?e.jsx(Ia,{columns:s}):e.jsx("div",{className:w("overflow-x-auto",t),children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(_=>e.jsx("th",{className:w("py-3 px-4 font-medium text-gray-700 text-sm",_.align==="center"&&"text-center",_.align==="right"&&"text-right",_.sortable&&"cursor-pointer hover:bg-gray-100 select-none",_.className),onClick:()=>_.sortable&&d(_.key),children:e.jsxs("div",{className:w("flex items-center gap-1",_.align==="center"&&"justify-center",_.align==="right"&&"justify-end"),children:[_.label,_.sortable&&o(_.key)]})},_.key))})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:i})}):g.map((_,T)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:s.map(j=>e.jsx("td",{className:w("py-3 px-4 text-sm",j.align==="center"&&"text-center",j.align==="right"&&"text-right",j.className),children:j.render?j.render(_[j.key],_):_[j.key]},j.key))},_.id||T))})]})})}function Ia({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200 bg-gray-50/50",children:s.map(a=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},a.key))})}),e.jsx("tbody",{children:[...Array(5)].map((a,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(i=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},i.key))},t))})]})})})}function ye({title:s,subtitle:a,className:t,children:i,loading:n=!1,error:x,onRefresh:c}){return e.jsxs("div",{className:w("wendys-card",t),children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:s}),a&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a})]}),c&&e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 rounded",title:"Refresh chart",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})}),x?e.jsx("div",{className:"flex items-center justify-center h-[300px] text-red-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium",children:"Error loading chart"}),e.jsx("p",{className:"text-xs mt-1 text-red-400",children:x}),c&&e.jsx("button",{onClick:c,className:"mt-2 px-3 py-1 text-xs bg-red-50 text-red-600 rounded hover:bg-red-100",children:"Try again"})]})}):n?e.jsx(ka,{}):i]})}function ka(){return e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"h-[300px] bg-gray-100 rounded flex flex-col justify-end p-4",children:[e.jsx("div",{className:"absolute left-2 top-4 space-y-8",children:[...Array(4)].map((s,a)=>e.jsx("div",{className:"w-8 h-2 bg-gray-200 rounded"},a))}),e.jsx("div",{className:"flex items-end justify-between h-48 mb-4",children:[...Array(12)].map((s,a)=>e.jsx("div",{className:"bg-gray-200 rounded-t",style:{height:`${Math.random()*80+20}%`,width:"6%"}},a))}),e.jsx("div",{className:"flex justify-between",children:[...Array(6)].map((s,a)=>e.jsx("div",{className:"w-12 h-2 bg-gray-200 rounded"},a))})]})})}const P={currency:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),currencyDetailed:s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s),percent:(s,a=1)=>`${(s??0).toFixed(a)}%`,hours:(s,a=1)=>`${(s??0).toFixed(a)}h`,dateShort:s=>{const a=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return C(a,"MMM d")},dateFull:s=>{const a=typeof s=="string"?new Date(Number(String(s).slice(0,4)),Number(String(s).slice(5,7))-1,Number(String(s).slice(8,10))):s;return C(a,"MMM dd, yyyy")},currencyCompact:s=>{const a=Math.abs(s);return a>=1e6?`$${(s/1e6).toFixed(1)}M`:a>=1e3?`$${(s/1e3).toFixed(1)}k`:P.currency(s)}},k={sales:"#E2231A",salesSecondary:"#B71C13",labor:"#374151",laborIdeal:"#6B7280",waste:"#EF4444",foodVariance:"#F59E0B",positive:"#10B981",warning:"#F59E0B",gridStroke:"#E5E7EB",textPrimary:"#111827",textSecondary:"#6B7280"},U={cartesianGrid:{strokeDasharray:"3 3",stroke:k.gridStroke},xAxis:{stroke:k.textSecondary,fontSize:12,tickMargin:8},yAxis:{stroke:k.textSecondary,fontSize:12,tickMargin:8},tooltip:{contentStyle:{backgroundColor:"white",border:`1px solid ${k.gridStroke}`,borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",fontSize:"14px"},labelStyle:{color:k.textPrimary,fontWeight:"600",marginBottom:"4px"}},legend:{iconType:"rect",wrapperStyle:{fontSize:"12px",color:k.textSecondary}}},Ge=(s,a=new Date)=>{const t=new Date(a);switch(s){case"today":return{start:C(t,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Today"};case"wtd":const i=new Date(t);return i.setDate(t.getDate()-t.getDay()),{start:C(i,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Week to Date"};case"mtd":const n=new Date(t.getFullYear(),t.getMonth(),1);return{start:C(n,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Month to Date"};case"last7":const x=new Date(t);return x.setDate(t.getDate()-6),{start:C(x,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Last 7 Days"};case"last30":const c=new Date(t);return c.setDate(t.getDate()-29),{start:C(c,"yyyy-MM-dd"),end:C(t,"yyyy-MM-dd"),label:"Last 30 Days"};default:return{start:"",end:"",label:"All Time"}}},Oa=me("/smg")({component:Ma});function Ma(){const[s,a]=N.useState(null),[t,i]=N.useState(),{toast:n}=te(),x=Le(),c=Ee({resolver:Se(Sa),defaultValues:{date:"",accuracy_decimal:0,zod_per_10k:0,cc_complaints:0,osat_decimal:0,notes:""}});N.useEffect(()=>{let h=!0;return(async()=>{var H;const{data:D}=await v.auth.getUser(),F=(H=D.user)==null?void 0:H.id;if(!F)return;const{data:I,error:q}=await v.from("users").select("store_id").eq("id",F).maybeSingle();h&&(q||a((I==null?void 0:I.store_id)??null))})(),()=>{h=!1}},[]);const{data:m=[],isLoading:p,error:g}=Q({queryKey:["smg_daily",s],queryFn:async()=>{if(!s)return[];const{data:h,error:D}=await v.from("smg_daily").select("*").eq("store_id",s).order("date",{ascending:!1});if(D)throw D;return h||[]},enabled:!!s}),{data:d=[]}=Q({queryKey:["smg_entries_import",s],queryFn:async()=>{if(!s)return[];const{data:h,error:D}=await v.from("smg_entries").select("*").eq("store_id",s).order("entry_date",{ascending:!1});if(D)throw D;return h||[]},enabled:!!s}),o=N.useMemo(()=>m.length>0?m:d.length?d.map(h=>({id:h.id,date:h.entry_date,accuracy_decimal:Number(h.accuracy_of_order)||0,zod_per_10k:Number(h.zone_of_defection)||0,cc_complaints:Number(h.customer_computers)||0,osat_decimal:Number(h.osat)||0,notes:"",created_at:h.created_at})):[],[m,d]),_=oe({mutationFn:async h=>{if(!s)throw new Error("Store not connected");const{error:D}=await v.from("smg_daily").insert({store_id:s,date:h.date,accuracy_decimal:h.accuracy_decimal,zod_per_10k:h.zod_per_10k,cc_complaints:h.cc_complaints,osat_decimal:h.osat_decimal,notes:h.notes||null});if(D)throw D},onSuccess:()=>{x.invalidateQueries({queryKey:["smg_daily",s]}),c.reset(),i(void 0),n({title:"Success",description:"SMG entry saved successfully."})},onError:h=>{n({title:"Error",description:h.message||"Failed to save SMG entry.",variant:"destructive"})}}),T=h=>{_.mutate(h)},j=h=>{const D=Number(h.slice(0,4)),F=Number(h.slice(5,7)),I=Number(h.slice(8,10));return new Date(D,(F||1)-1,I||1)},O=[{key:"date",label:"Date",sortable:!0,render:h=>C(j(h),"MMM dd, yyyy")},{key:"accuracy_decimal",label:"Accuracy of Order",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"zod_per_10k",label:"ZOD per 10k",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"cc_complaints",label:"CC Complaints",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"osat_decimal",label:"OSAT Score",sortable:!0,align:"right",render:h=>h.toFixed(2)},{key:"notes",label:"Notes",sortable:!1,render:h=>e.jsx("div",{className:"max-w-32 truncate",title:h,children:h||"-"})}],E=N.useMemo(()=>o.length?o.slice().reverse().map(h=>({date:P.dateShort(h.date),osat:h.osat_decimal})):[],[o]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"SMG Manual Entry"}),e.jsx("p",{className:"text-gray-600",children:"Record your daily service metrics and customer satisfaction scores"})]})}),g&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",g.message]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ae,{className:"h-5 w-5 text-wendys-red"}),e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Add New Entry"})]}),e.jsxs("form",{onSubmit:c.handleSubmit(T),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"date",children:"Date *"}),e.jsxs(Je,{children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(S,{variant:"outline",id:"date",className:"w-full justify-start text-left font-normal",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),t?C(t,"MMM dd, yyyy"):"Select date"]})}),e.jsx(ke,{className:"w-auto p-0",align:"start",children:e.jsx(Ie,{mode:"single",selected:t,onSelect:h=>{i(h),h&&c.setValue("date",C(h,"yyyy-MM-dd"))},initialFocus:!0})})]}),c.formState.errors.date&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"accuracy_decimal",children:"Accuracy of Order *"}),e.jsx(L,{id:"accuracy_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("accuracy_decimal",{valueAsNumber:!0})}),c.formState.errors.accuracy_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.accuracy_decimal.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"zod_per_10k",children:"ZOD per 10k *"}),e.jsx(L,{id:"zod_per_10k",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("zod_per_10k",{valueAsNumber:!0})}),c.formState.errors.zod_per_10k&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.zod_per_10k.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"cc_complaints",children:"CC Complaints *"}),e.jsx(L,{id:"cc_complaints",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("cc_complaints",{valueAsNumber:!0})}),c.formState.errors.cc_complaints&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.cc_complaints.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"osat_decimal",children:"OSAT Score *"}),e.jsx(L,{id:"osat_decimal",type:"number",step:"0.01",min:"0",placeholder:"Enter decimal value",...c.register("osat_decimal",{valueAsNumber:!0})}),c.formState.errors.osat_decimal&&e.jsx("p",{className:"text-sm text-red-600",children:c.formState.errors.osat_decimal.message})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2 lg:col-span-1",children:[e.jsx(A,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-wendys-red focus:border-wendys-red",placeholder:"Optional notes...",...c.register("notes")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(S,{type:"submit",disabled:_.isPending||!s,className:"bg-wendys-red hover:bg-wendys-red/90",children:_.isPending?"Saving...":"Save Entry"})})]})]}),e.jsx(ye,{title:"OSAT Score Trend",subtitle:`${o.length} entries`,loading:p,error:g==null?void 0:g.message,children:E.length>0?e.jsx(le,{width:"100%",height:300,children:e.jsxs(we,{data:E,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:h=>h.toFixed(1)}),e.jsx(fe,{...U.tooltip,formatter:h=>[h.toFixed(2),"OSAT Score"]}),e.jsx(_e,{type:"monotone",dataKey:"osat",stroke:k.sales,strokeWidth:3,dot:{fill:k.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.salesSecondary,strokeWidth:2},name:"OSAT Score"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see OSAT trends"})]})})}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Previous Entries"}),e.jsx("div",{className:"text-sm text-gray-600",children:p?"Loading...":`${o.length} entries`})]}),s?e.jsx(La,{columns:O,data:o,loading:p,emptyMessage:"No SMG entries found. Add your first entry above."}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})})]})]})}const ms=`-- Goals table for Goal Setting tab
create table if not exists public.goals (
  id uuid primary key default gen_random_uuid(),
  store_id uuid not null references stores(id) on delete cascade,
  scope text not null check (scope in ('week','month','custom')),
  period_start date not null,
  period_end date not null,
  sales_target numeric not null default 0,
  labor_target_pct numeric not null default 0,
  waste_target_pct numeric not null default 0,
  food_variance_target_pct numeric not null default 0,
  service_seconds_target numeric not null default 0,
  team_notes text,
  created_at timestamp with time zone default now(),
  unique (store_id, period_start, period_end)
);
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create stores table
CREATE TABLE stores (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create users table linked to auth.users
CREATE TABLE users (
  id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  store_id uuid NOT NULL REFERENCES stores(id),
  role text NOT NULL DEFAULT 'gm',
  created_at timestamptz DEFAULT now()
);

-- Create Omega Daily table for daily business metrics
CREATE TABLE omega_daily (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  business_date date NOT NULL,
  net_sales numeric NOT NULL,
  last_year_sales numeric NOT NULL,
  comp_net_sales numeric GENERATED ALWAYS AS (net_sales - last_year_sales) STORED,
  labor_hours numeric NOT NULL,
  ideal_labor_hours numeric NOT NULL,
  labor_hours_diff numeric GENERATED ALWAYS AS (labor_hours - ideal_labor_hours) STORED,
  labor_percentage numeric NOT NULL,
  theoretical_food_cost numeric NOT NULL,
  food_variance_cost numeric NOT NULL,
  food_variance_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN theoretical_food_cost = 0 THEN 0 ELSE (food_variance_cost / theoretical_food_cost) * 100 END
  ) STORED,
  waste_amount numeric NOT NULL,
  waste_percentage numeric GENERATED ALWAYS AS (
    CASE WHEN net_sales = 0 THEN 0 ELSE (waste_amount / net_sales) * 100 END
  ) STORED,
  breakfast_sales numeric NOT NULL,
  night_sales numeric NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and business_date
CREATE UNIQUE INDEX ON omega_daily (store_id, business_date);

-- Create interview status enum
CREATE TYPE interview_status AS ENUM ('SCHEDULED','DONE','NO_SHOW','HIRED','REJECTED');

-- Create interviews table
CREATE TABLE interviews (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  candidate_name text NOT NULL,
  phone text,
  email text,
  position text,
  interview_date date NOT NULL,
  interview_time time NOT NULL,
  status interview_status NOT NULL DEFAULT 'SCHEDULED',
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create hiring process table
CREATE TABLE hires (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  interview_id uuid UNIQUE NOT NULL REFERENCES interviews(id) ON DELETE CASCADE,
  documents_received boolean DEFAULT false,
  documents_folder text, -- Supabase Storage path
  onboarding_sent_date date,
  onboarding_completed_date date,
  manager_reviewed_date date,
  entered_in_system_date date,
  fingerprint_scheduled_date date,
  first_day date,
  notes text,
  created_at timestamptz DEFAULT now()
);

-- Create SMG daily entries table
CREATE TABLE smg_entries (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  store_id uuid NOT NULL REFERENCES stores(id),
  entry_date date NOT NULL,
  accuracy_of_order numeric,
  zone_of_defection numeric,
  customer_computers numeric,
  taste_of_food numeric,
  osat numeric,
  created_at timestamptz DEFAULT now()
);

-- Create unique index on store_id and entry_date
CREATE UNIQUE INDEX ON smg_entries (store_id, entry_date);

-- Create view for SMG monthly aggregations
CREATE VIEW smg_monthly AS
SELECT
  store_id,
  date_trunc('month', entry_date)::date AS month_start,
  AVG(accuracy_of_order) AS avg_accuracy_of_order,
  AVG(zone_of_defection) AS avg_zone_of_defection,
  AVG(customer_computers) AS avg_customer_computers,
  AVG(taste_of_food) AS avg_taste_of_food,
  AVG(osat) AS avg_osat,
  COUNT(*) AS total_entries
FROM smg_entries
GROUP BY store_id, date_trunc('month', entry_date);

-- Enable Row Level Security on all tables
ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE omega_daily ENABLE ROW LEVEL SECURITY;
ALTER TABLE interviews ENABLE ROW LEVEL SECURITY;
ALTER TABLE hires ENABLE ROW LEVEL SECURITY;
ALTER TABLE smg_entries ENABLE ROW LEVEL SECURITY;
-- RLS Policies for goals
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
CREATE POLICY goals_isolate ON goals
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for stores (only allow reading own store)
CREATE POLICY stores_isolate ON stores
  FOR ALL USING (id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for users (only allow reading own user record)
CREATE POLICY users_isolate ON users
  FOR ALL USING (id = auth.uid());

-- RLS Policies for omega_daily
CREATE POLICY omega_daily_isolate ON omega_daily
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for interviews
CREATE POLICY interviews_isolate ON interviews
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for hires
CREATE POLICY hires_isolate ON hires
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_entries
CREATE POLICY smg_entries_isolate ON smg_entries
  FOR ALL USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()))
  WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- RLS Policies for smg_monthly view
CREATE POLICY smg_monthly_isolate ON smg_monthly
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create SMG Daily table for manual entry
CREATE TABLE smg_daily (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE,
  date DATE NOT NULL,
  accuracy_decimal NUMERIC NOT NULL CHECK (accuracy_decimal >= 0),
  zod_per_10k NUMERIC NOT NULL CHECK (zod_per_10k >= 0),
  cc_complaints NUMERIC NOT NULL CHECK (cc_complaints >= 0),
  osat_decimal NUMERIC NOT NULL CHECK (osat_decimal >= 0),
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(store_id, date)
);

-- Enable RLS for smg_daily
ALTER TABLE smg_daily ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for smg_daily
CREATE POLICY "Users can view their store's SMG data" ON smg_daily
  FOR SELECT USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can insert SMG data for their store" ON smg_daily
  FOR INSERT WITH CHECK (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can update their store's SMG data" ON smg_daily
  FOR UPDATE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

CREATE POLICY "Users can delete their store's SMG data" ON smg_daily
  FOR DELETE USING (store_id = (SELECT store_id FROM users WHERE id = auth.uid()));

-- Create indexes for better performance
CREATE INDEX idx_omega_daily_store_date ON omega_daily(store_id, business_date);
CREATE INDEX idx_interviews_store_date ON interviews(store_id, interview_date);
CREATE INDEX idx_smg_entries_store_date ON smg_entries(store_id, entry_date);
CREATE INDEX idx_smg_daily_store_date ON smg_daily(store_id, date);
CREATE INDEX idx_hires_interview_id ON hires(interview_id);
`,us=`-- Seed data for Wendy's GM Dashboard
-- This creates a test store, user, and sample data

-- Insert SE 14th store
INSERT INTO stores (id, name) VALUES 
('550e8400-e29b-41d4-a716-446655440000', 'SE 14th');

-- Insert test GM user (password: test123)
-- Note: You'll need to create this user in Supabase Auth first, then update the ID here
INSERT INTO users (id, store_id, role) VALUES 
('550e8400-e29b-41d4-a716-446655440001', '550e8400-e29b-41d4-a716-446655440000', 'gm');

-- Insert sample Omega Daily data (last 35 days for better testing)
INSERT INTO omega_daily (store_id, business_date, net_sales, last_year_sales, labor_hours, ideal_labor_hours, labor_percentage, food_variance_cost, waste_amount, breakfast_sales, night_sales) VALUES
-- Today and recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 12500.00, 11800.00, 85.5, 82.0, 6.8, 125.00, 87.50, 3200.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 11800.00, 11200.00, 82.0, 78.5, 6.9, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 11500.00, 10800.00, 79.5, 76.0, 6.9, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 12100.00, 11400.00, 81.5, 78.0, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 13500.00, 12800.00, 90.0, 87.0, 6.7, 135.00, 94.50, 3375.00, 10125.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 11200.00, 10500.00, 75.5, 72.0, 6.7, 112.00, 78.40, 2800.00, 8400.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 12900.00, 12200.00, 86.5, 83.5, 6.7, 129.00, 90.30, 3225.00, 9675.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
-- Additional days (10-34) for 30+ day testing
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 12300.00, 11600.00, 83.0, 80.0, 6.7, 123.00, 86.10, 3075.00, 9225.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 11900.00, 11300.00, 81.0, 77.5, 6.8, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 13100.00, 12400.00, 87.5, 84.5, 6.7, 131.00, 91.70, 3275.00, 9825.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 11700.00, 11000.00, 79.0, 75.5, 6.8, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 12600.00, 11900.00, 84.5, 81.5, 6.7, 126.00, 88.20, 3150.00, 9450.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 12000.00, 11300.00, 80.5, 77.0, 6.7, 120.00, 84.00, 3000.00, 9000.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 13400.00, 12700.00, 89.5, 86.5, 6.7, 134.00, 93.80, 3350.00, 10050.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 11400.00, 10700.00, 76.5, 73.0, 6.7, 114.00, 79.80, 2850.00, 8550.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 12700.00, 12000.00, 85.0, 82.0, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 11800.00, 11100.00, 79.5, 76.0, 6.7, 118.00, 82.60, 2950.00, 8850.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 11600.00, 10900.00, 78.0, 74.5, 6.7, 116.00, 81.20, 2900.00, 8700.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 12400.00, 11700.00, 83.5, 80.5, 6.7, 124.00, 86.80, 3100.00, 9300.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 12200.00, 11500.00, 82.0, 78.5, 6.7, 122.00, 85.40, 3050.00, 9150.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 13300.00, 12600.00, 88.5, 85.5, 6.7, 133.00, 93.10, 3325.00, 9975.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 11300.00, 10600.00, 76.0, 72.5, 6.7, 113.00, 79.10, 2825.00, 8475.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 12800.00, 12100.00, 86.0, 83.0, 6.7, 128.00, 89.60, 3200.00, 9600.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 11900.00, 11200.00, 80.0, 76.5, 6.7, 119.00, 83.30, 2975.00, 8925.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 13200.00, 12500.00, 88.0, 85.0, 6.7, 132.00, 92.40, 3300.00, 9900.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 11500.00, 10800.00, 77.5, 74.0, 6.7, 115.00, 80.50, 2875.00, 8625.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '30 days', 12700.00, 12000.00, 85.5, 82.5, 6.7, 127.00, 88.90, 3175.00, 9525.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '31 days', 11700.00, 11000.00, 78.5, 75.0, 6.7, 117.00, 81.90, 2925.00, 8775.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '32 days', 12500.00, 11800.00, 84.0, 81.0, 6.7, 125.00, 87.50, 3125.00, 9375.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '33 days', 12100.00, 11400.00, 81.0, 77.5, 6.7, 121.00, 84.70, 3025.00, 9075.00),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '34 days', 13000.00, 12300.00, 87.0, 84.0, 6.7, 130.00, 91.00, 3250.00, 9750.00);

-- Insert sample interviews
INSERT INTO interviews (store_id, candidate_name, phone, email, position, interview_date, interview_time, status, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'John Smith', '555-0101', 'john.smith@email.com', 'Crew Member', CURRENT_DATE + INTERVAL '1 day', '14:00:00', 'SCHEDULED', 'Experienced in food service'),
('550e8400-e29b-41d4-a716-446655440000', 'Sarah Johnson', '555-0102', 'sarah.j@email.com', 'Shift Leader', CURRENT_DATE, '10:00:00', 'DONE', 'Great communication skills, recommended for hire'),
('550e8400-e29b-41d4-a716-446655440000', 'Mike Davis', '555-0103', 'mike.d@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '1 day', '15:30:00', 'NO_SHOW', 'No call, no show'),
('550e8400-e29b-41d4-a716-446655440000', 'Lisa Wilson', '555-0104', 'lisa.w@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '2 days', '11:00:00', 'HIRED', 'Excellent candidate, starting next week'),
('550e8400-e29b-41d4-a716-446655440000', 'Tom Brown', '555-0105', 'tom.b@email.com', 'Crew Member', CURRENT_DATE - INTERVAL '3 days', '16:00:00', 'REJECTED', 'Not a good fit for the team');

-- Insert sample hire for Lisa Wilson
INSERT INTO hires (store_id, interview_id, documents_received, onboarding_sent_date, onboarding_completed_date, manager_reviewed_date, entered_in_system_date, fingerprint_scheduled_date, first_day, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', 
 (SELECT id FROM interviews WHERE candidate_name = 'Lisa Wilson'), 
 true, 
 CURRENT_DATE - INTERVAL '1 day', 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE, 
 CURRENT_DATE + INTERVAL '3 days', 
 CURRENT_DATE + INTERVAL '7 days', 
 'Lisa is very organized and completed all requirements quickly');

-- Insert sample SMG entries (last 30 days)
INSERT INTO smg_entries (store_id, entry_date, accuracy_of_order, zone_of_defection, customer_computers, taste_of_food, osat) VALUES
-- Recent days
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE, 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '11 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '12 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '13 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '14 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '15 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '16 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '17 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '18 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '19 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '20 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '21 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '22 days', 4.9, 1.0, 4.8, 4.9, 4.8),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '23 days', 4.5, 1.5, 4.3, 4.4, 4.3),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '24 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '25 days', 4.7, 1.3, 4.5, 4.6, 4.5),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '26 days', 4.9, 1.1, 4.7, 4.8, 4.7),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '27 days', 4.6, 1.4, 4.4, 4.5, 4.4),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '28 days', 4.8, 1.2, 4.6, 4.7, 4.6),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '29 days', 4.7, 1.3, 4.5, 4.6, 4.5);

-- Add sample SMG daily data
INSERT INTO smg_daily (store_id, date, accuracy_decimal, zod_per_10k, cc_complaints, osat_decimal, notes) VALUES
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '1 day', 0.87, 2.50, 1.25, 0.92, 'Good day overall, slight accuracy issues during lunch rush'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '2 days', 0.91, 1.80, 0.95, 0.94, 'Improvement in accuracy, training paying off'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '3 days', 0.89, 3.20, 2.10, 0.88, 'Busy Friday, some service delays during dinner'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '4 days', 0.93, 1.50, 0.80, 0.96, 'Excellent performance, team working well together'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '5 days', 0.85, 4.10, 1.75, 0.90, 'Weekend rush, need to focus on order accuracy'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '6 days', 0.88, 2.80, 1.45, 0.91, 'Steady performance throughout the day'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '7 days', 0.92, 1.90, 1.05, 0.95, 'Great week start, team motivated'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '8 days', 0.86, 3.50, 1.85, 0.89, 'Some challenges during shift change'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '9 days', 0.90, 2.20, 1.15, 0.93, 'Solid performance across all metrics'),
('550e8400-e29b-41d4-a716-446655440000', CURRENT_DATE - INTERVAL '10 days', 0.94, 1.40, 0.75, 0.97, 'Outstanding day, new training methods working');`,Ua=me("/setup")({component:Fa});function xs(s){navigator.clipboard.writeText(s)}function Fa(){return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Project Setup"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-4 text-gray-700",children:[e.jsx("li",{children:"Supabase â Auth â Providers â Email: enable. Then Auth â Users â Add user (auto-confirm)."}),e.jsx("li",{children:"Supabase â SQL Editor: paste the schema SQL, run it. Then paste the seed SQL, run it."}),e.jsxs("li",{children:["In ",e.jsx("code",{children:".env.local"})," set URL, ANON KEY, set ",e.jsx("code",{children:"VITE_USE_MOCK_DATA=false"}),", restart dev server."]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Schema SQL"}),e.jsx(S,{onClick:()=>xs(ms),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:ms})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-wendys-charcoal",children:"Seed SQL"}),e.jsx(S,{onClick:()=>xs(us),className:"wendys-button",children:"Copy"})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-auto max-h-80 text-xs",children:us})]})]})}function ee({title:s,value:a,format:t,delta:i,deltaLabel:n,icon:x,trend:c,suffix:m,sparklineData:p,className:g}){const d=T=>{switch(t){case"currency":return xe(T);case"percentage":return K(T);case"number":return T.toLocaleString();default:return T.toString()}},o=()=>{switch(c){case"up":return e.jsx(de,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(Ne,{className:"h-4 w-4 text-red-600"});case"neutral":return e.jsx(Mt,{className:"h-4 w-4 text-gray-400"})}},_=()=>{switch(c){case"up":return"text-green-600";case"down":return"text-red-600";case"neutral":return"text-gray-600"}};return e.jsx("div",{className:w("wendys-card",g),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 truncate",children:s}),e.jsx("div",{className:"w-8 h-8 bg-wendys-red bg-opacity-10 rounded-lg flex items-center justify-center flex-shrink-0 ml-2",children:e.jsx(x,{className:"h-4 w-4 text-wendys-red"})})]}),e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-wendys-charcoal",children:[d(a),m&&e.jsx("span",{className:"text-lg ml-1 font-normal",children:m})]}),p&&p.length>0&&e.jsx("div",{className:"w-16 h-8 ml-2",children:e.jsx(le,{width:"100%",height:"100%",children:e.jsx(we,{data:p,children:e.jsx(_e,{type:"monotone",dataKey:"value",stroke:c==="up"?k.positive:c==="down"?k.waste:k.textSecondary,strokeWidth:1.5,dot:!1})})})})]}),i!==void 0&&n&&e.jsxs("div",{className:"flex items-center space-x-1 mt-3",children:[o(),e.jsxs("span",{className:w("text-sm font-medium",_()),children:[i>0?"+":"",Math.abs(i)<1&&t!=="percentage"?K(Math.abs(i)*100):d(Math.abs(i)),m&&t!=="percentage"&&e.jsx("span",{className:"ml-1",children:m})]}),e.jsx("span",{className:"text-xs text-gray-500",children:n})]})]})})})}function Va({data:s=[]}){const a=N.useMemo(()=>{if(!s.length){const t=[];for(let i=13;i>=0;i--){const n=new Date;n.setDate(n.getDate()-i),t.push({date:P.dateShort(n.toISOString().slice(0,10)),sales:0})}return t}return s.sort((t,i)=>new Date(t.business_date).getTime()-new Date(i.business_date).getTime()).slice(-30).map(t=>({date:P.dateShort(t.business_date),sales:t.net_sales||0}))},[s]);return e.jsx(le,{width:"100%",height:300,children:e.jsxs(we,{data:a,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:t=>P.currencyCompact(t)}),e.jsx(fe,{...U.tooltip,formatter:t=>[P.currencyDetailed(t),"Net Sales"]}),e.jsx(_e,{type:"monotone",dataKey:"sales",stroke:k.sales,strokeWidth:3,dot:{fill:k.sales,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.salesSecondary,strokeWidth:2}})]})})}function Pa({data:s=[]}){console.log("ð LaborVsIdealChart received data:",s.slice(0,3));const a=N.useMemo(()=>{if(!s.length){const i=[];for(let n=6;n>=0;n--){const x=new Date;x.setDate(x.getDate()-n),i.push({date:P.dateShort(x.toISOString().slice(0,10)),ideal:0,actual:0})}return i}const t=s.sort((i,n)=>new Date(i.business_date).getTime()-new Date(n.business_date).getTime()).slice(-30).map(i=>{const n=Number(i.ideal_labor_hours)||0,x=Number(i.labor_hours)||0;return console.log("ð Processing entry:",i.business_date,"ideal:",i.ideal_labor_hours,"=>",n,"actual:",i.labor_hours,"=>",x),{date:P.dateShort(i.business_date),ideal:n,actual:x}});return console.log("ð Processed chart data:",t.slice(0,3)),t},[s]);return console.log("ð Final chartData being rendered:",a.slice(0,3)),e.jsx(le,{width:"100%",height:300,children:e.jsxs(Ps,{data:a,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:t=>P.hours(t)}),e.jsx(fe,{...U.tooltip,formatter:(t,i)=>[P.hours(t),i==="ideal"?"Ideal Hours":"Actual Hours"]}),e.jsx(Ut,{...U.legend}),e.jsx(qs,{dataKey:"ideal",fill:k.laborIdeal,opacity:.6,name:"Ideal Hours"}),e.jsx(_e,{type:"monotone",dataKey:"actual",stroke:k.labor,strokeWidth:3,dot:{fill:k.labor,strokeWidth:2,r:4},activeDot:{r:6,stroke:k.textPrimary,strokeWidth:2},name:"Actual Hours"})]})})}function qa(){const[s,a]=N.useState(null);N.useEffect(()=>{let d=!0;return(async()=>{var _;const{data:o}=await v.from("users").select("store_id").eq("id",(_=(await v.auth.getUser()).data.user)==null?void 0:_.id).single();d&&a((o==null?void 0:o.store_id)??null)})(),()=>{d=!1}},[]);const{data:t=[],isLoading:i}=Q({queryKey:["smg_snapshot",s],queryFn:async()=>{if(!s)return[];const d=new Date;d.setDate(d.getDate()-30);const{data:o,error:_}=await v.from("smg_daily").select("*").eq("store_id",s).gte("date",d.toISOString().split("T")[0]).order("date",{ascending:!1});if(_)throw _;return o||[]},enabled:!!s}),n=t.length>0?{accuracy:t.reduce((d,o)=>d+o.accuracy_decimal,0)/t.length,zod:t.reduce((d,o)=>d+o.zod_per_10k,0)/t.length,complaints:t.reduce((d,o)=>d+o.cc_complaints,0)/t.length,osat:t.reduce((d,o)=>d+o.osat_decimal,0)/t.length}:{accuracy:0,zod:0,complaints:0,osat:0},x=d=>{if(d.length<4)return"neutral";const o=Math.floor(d.length/2),_=d.slice(0,o).reduce((O,E)=>O+E,0)/o,j=d.slice(o).reduce((O,E)=>O+E,0)/(d.length-o)-_;return Math.abs(j)<.1?"neutral":j>0?"up":"down"},c={accuracy:x(t.map(d=>d.accuracy_decimal).reverse()),zod:x(t.map(d=>d.zod_per_10k).reverse()),complaints:x(t.map(d=>d.cc_complaints).reverse()),osat:x(t.map(d=>d.osat_decimal).reverse())},m=(d,o=!1)=>o?d<=1?"text-green-600":d<=3?"text-yellow-600":"text-red-600":d>=90?"text-green-600":d>=80?"text-yellow-600":"text-red-600",p=(d,o=!1)=>o?d<=1?e.jsx(se,{className:"h-4 w-4 text-green-600"}):d<=3?e.jsx(ue,{className:"h-4 w-4 text-yellow-600"}):e.jsx(ue,{className:"h-4 w-4 text-red-600"}):d>=90?e.jsx(se,{className:"h-4 w-4 text-green-600"}):d>=80?e.jsx(ue,{className:"h-4 w-4 text-yellow-600"}):e.jsx(ue,{className:"h-4 w-4 text-red-600"}),g=d=>{switch(d){case"up":return e.jsx(de,{className:"h-3 w-3 text-green-600"});case"down":return e.jsx(Ne,{className:"h-3 w-3 text-red-600"});default:return null}};return i?e.jsx("div",{className:"wendys-card",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((d,o)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32 mt-1"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-12"})]},o))})]})}):e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"OSAT Snapshot (Last 30 Days)"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(Oe,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("span",{children:[t.length," entries"]})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Oe,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"font-medium",children:"No OSAT data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in the OSAT tab to see metrics"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Oe,{className:"h-5 w-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"OSAT Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overall satisfaction"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(c.osat),p(n.osat),e.jsx("span",{className:w("text-xl font-bold",m(n.osat)),children:n.osat.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"Accuracy of Order"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Order accuracy metric"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(c.accuracy),p(n.accuracy),e.jsx("span",{className:w("text-xl font-bold",m(n.accuracy)),children:n.accuracy.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"ZOD per 10k"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Zone of defection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(c.zod==="up"?"down":c.zod==="down"?"up":"neutral"),p(n.zod,!0),e.jsx("span",{className:w("text-xl font-bold",m(n.zod,!0)),children:n.zod.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-wendys-charcoal",children:"CC Complaints"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customer complaints"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[g(c.complaints==="up"?"down":c.complaints==="down"?"up":"neutral"),p(n.complaints,!0),e.jsx("span",{className:w("text-xl font-bold",m(n.complaints,!0)),children:n.complaints.toFixed(1)})]})]})]})]})}function Ha(){const[s,a]=N.useState(null),t=C(new Date,"EEEE, MMMM d"),i=C(new Date,"yyyy-MM-dd");N.useEffect(()=>{let m=!0;return(async()=>{var T;console.log("ð [InterviewsToday] Checking user authentication...");const{data:p,error:g}=await v.auth.getUser();console.log("ð¤ [InterviewsToday] Auth data:",p,"Auth error:",g);const d=(T=p.user)==null?void 0:T.id;if(!d){console.log("â [InterviewsToday] No user ID found - user not authenticated");return}console.log("ð [InterviewsToday] Looking up store for user:",d);const{data:o,error:_}=await v.from("users").select("store_id").eq("id",d).maybeSingle();if(console.log("ðª [InterviewsToday] Store lookup result - data:",o,"error:",_),!!m){if(_){console.error("â [InterviewsToday] Store lookup error:",_);return}a((o==null?void 0:o.store_id)??null),console.log("â [InterviewsToday] Store ID set to:",(o==null?void 0:o.store_id)??null)}})(),()=>{m=!1}},[]);const{data:n=[],isLoading:x}=Q({queryKey:["interviews-today",s,i],queryFn:async()=>{if(!s)return[];const{data:m,error:p}=await v.from("interviews").select("*").eq("store_id",s).eq("interview_date",i).order("interview_time",{ascending:!0});if(p)throw p;return m||[]},enabled:!!s}),c=m=>C(new Date(`2000-01-01T${m}`),"h:mm a");return e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interviews Today"}),e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:t})]})]}),x?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ks,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No interviews scheduled for today"})]}):e.jsx("div",{className:"space-y-3",children:n.map(m=>e.jsx(Ve,{to:"/interviews",className:"block p-4 border border-gray-200 rounded-lg hover:border-wendys-red hover:shadow-md transition-all duration-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-wendys-charcoal",children:m.candidate_name}),e.jsx("span",{className:Wa("px-2 py-1 text-xs font-medium rounded-full",We(m.status)),children:m.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Hs,{className:"h-3 w-3"}),e.jsx("span",{children:m.position})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),e.jsx("span",{children:c(m.interview_time)})]})]}),m.notes&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 italic",children:['"',m.notes,'"']})]})})},m.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(Ve,{to:"/interviews",className:"inline-flex items-center space-x-2 text-wendys-red hover:text-wendys-dark-red font-medium text-sm",children:[e.jsx("span",{children:"View all interviews"}),e.jsx("span",{children:"â"})]})})]})}function Wa(...s){return s.filter(Boolean).join(" ")}const hs=[{key:"today",label:"Today"},{key:"wtd",label:"WTD",description:"Week to Date"},{key:"mtd",label:"MTD",description:"Month to Date"},{key:"last7",label:"Last 7",description:"Last 7 Days"},{key:"last30",label:"Last 30",description:"Last 30 Days"},{key:"custom",label:"Custom"}];function Ze({selectedRange:s="last30",selectedDate:a,onRangeChange:t,onDateChange:i,onClearFilters:n,className:x,compact:c=!1}){const m=s!=="last30"||a,p=d=>{t==null||t(d),d!=="custom"&&(i==null||i(void 0))},g=()=>{if(s==="custom"&&a)return C(a,"MMM dd, yyyy");const d=hs.find(o=>o.key===s);return(d==null?void 0:d.label)||"Last 30"};return e.jsxs("div",{className:w("flex items-center gap-3 p-4 bg-gray-50 rounded-lg border",c&&"p-3",x),children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Ft,{className:"h-4 w-4"}),e.jsx("span",{className:w("text-sm font-medium",c&&"hidden sm:inline"),children:"Filters:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:hs.map(d=>e.jsx(S,{variant:s===d.key?"default":"ghost",size:"sm",onClick:()=>p(d.key),className:w("text-xs h-7 px-2",s===d.key?"bg-wendys-red text-white hover:bg-wendys-red/90":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",c&&"text-[11px] h-6 px-1.5"),title:d.description,children:d.label},d.key))}),s==="custom"&&e.jsxs(Je,{children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:w("justify-start text-left font-normal h-7",!a&&"text-muted-foreground",c&&"h-6 text-xs"),children:[e.jsx(be,{className:"mr-1 h-3 w-3"}),a?C(a,"MMM dd"):"Pick date"]})}),e.jsx(ke,{className:"w-auto p-0",align:"start",children:e.jsx(Ie,{mode:"single",selected:a,onSelect:i,initialFocus:!0})})]}),!c&&m&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 text-xs text-gray-500 border-l pl-3 ml-1",children:[e.jsx("span",{children:"Showing:"}),e.jsx("span",{className:"font-medium text-gray-700",children:g()})]}),m&&n&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:n,className:w("text-xs text-gray-500 hover:text-gray-700 h-7 px-2",c&&"h-6 px-1.5"),children:[e.jsx(bs,{className:"h-3 w-3 mr-1"}),"Clear"]})]})}function es(s,a="last30"){const[t,i]=ie.useState(()=>typeof window<"u"&&localStorage.getItem(`${s}_range`)||a),[n,x]=ie.useState(()=>{if(typeof window<"u"){const d=localStorage.getItem(`${s}_date`);if(d){const[o,_,T]=d.split("-").map(Number);return new Date(o,(_||1)-1,T||1)}return}}),c=ie.useCallback(d=>{i(d),typeof window<"u"&&localStorage.setItem(`${s}_range`,d)},[s]),m=ie.useCallback(d=>{if(x(d),typeof window<"u")if(d){const o=C(d,"yyyy-MM-dd");localStorage.setItem(`${s}_date`,o)}else localStorage.removeItem(`${s}_date`)},[s]),p=ie.useCallback(()=>{i(a),x(void 0),typeof window<"u"&&(localStorage.removeItem(`${s}_range`),localStorage.removeItem(`${s}_date`))},[s,a]),g=ie.useCallback(()=>{if(t==="custom"&&n){const d=C(n,"yyyy-MM-dd");return{start:d,end:d}}if(t&&t!=="custom"){const d=Ge(t);return d.start?{start:d.start,end:d.end}:null}return null},[t,n]);return{selectedRange:t,selectedDate:n,handleRangeChange:c,handleDateChange:m,clearFilters:p,getDateRangeFilter:g,getSelectedLabel:()=>t==="custom"&&n?C(n,"MMM dd, yyyy"):Ge(t).label}}const za=me("/overview")({component:Ga});function Ga(){const[s,a]=N.useState(null),t=es("overview","today");N.useEffect(()=>{let g=!0;return(async()=>{var j;const{data:d}=await v.auth.getUser(),o=(j=d.user)==null?void 0:j.id;if(!o)return;const{data:_,error:T}=await v.from("users").select("store_id").eq("id",o).maybeSingle();if(g){if(T){console.error("Error fetching store ID:",T);return}a((_==null?void 0:_.store_id)??null)}})(),()=>{g=!1}},[]);const i=t.getDateRangeFilter(),{data:n=[]}=Q({queryKey:["overview-charts",s],queryFn:async()=>{if(!s)return[];const g=new Date;g.setDate(g.getDate()-30);const d=g.toISOString().slice(0,10),{data:o,error:_}=await v.from("omega_daily").select("*").eq("store_id",s).gte("business_date",d).order("business_date",{ascending:!0});if(_)throw _;return o||[]},enabled:!!s}),{data:x=[],isLoading:c,error:m}=Q({queryKey:["overview-omega",s,i==null?void 0:i.start,i==null?void 0:i.end],queryFn:async()=>{if(!s)return[];let g=v.from("omega_daily").select("*").eq("store_id",s);i&&(g=g.gte("business_date",i.start).lte("business_date",i.end));const{data:d,error:o}=await g.order("business_date",{ascending:!0});if(o)throw o;return d||[]},enabled:!!s}),p=N.useMemo(()=>{if(x.length===0)return{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,laborPercentage:0,foodVarianceCost:0,foodVariancePercentage:0,wasteAmount:0,wastePercentage:0,breakfastSales:0,nightSales:0};const g=x.reduce((T,j)=>({netSales:T.netSales+(j.net_sales||0),compNetSales:T.compNetSales+((j.net_sales||0)-(j.last_year_sales||0)),laborHours:T.laborHours+(j.labor_hours||0),idealLaborHours:T.idealLaborHours+(j.ideal_labor_hours||0),foodVarianceCost:T.foodVarianceCost+(j.food_variance_cost||0),wasteAmount:T.wasteAmount+(j.waste_amount||0),breakfastSales:T.breakfastSales+(j.breakfast_sales||0),nightSales:T.nightSales+(j.night_sales||0)}),{netSales:0,compNetSales:0,laborHours:0,idealLaborHours:0,foodVarianceCost:0,wasteAmount:0,breakfastSales:0,nightSales:0}),d=g.netSales>0?g.laborHours/g.netSales*100:0,o=g.netSales>0?g.foodVarianceCost/g.netSales*100:0,_=g.netSales>0?g.wasteAmount/g.netSales*100:0;return{...g,laborPercentage:d,foodVariancePercentage:o,wastePercentage:_}},[x]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Overview"}),e.jsxs("p",{className:"text-gray-600",children:["Key metrics and performance indicators for ",t.getSelectedLabel(),c&&e.jsx("span",{className:"ml-2 text-sm",children:"(Loading...)"})]}),m&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:["Error loading data: ",m.message]})]}),e.jsx(Ze,{selectedRange:t.selectedRange,selectedDate:t.selectedDate,onRangeChange:t.handleRangeChange,onDateChange:t.handleDateChange,onClearFilters:t.clearFilters,compact:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(ee,{title:"Net Sales",value:p.netSales,format:"currency",delta:p.compNetSales,deltaLabel:"vs Last Year",icon:Me,trend:p.compNetSales>=0?"up":"down"}),e.jsx(ee,{title:"Labor Hours",value:p.laborHours,format:"number",delta:p.laborHours-p.idealLaborHours,deltaLabel:"vs Ideal",icon:Qe,trend:p.laborHours>p.idealLaborHours?"down":"up",suffix:"hrs"}),e.jsx(ee,{title:"Labor %",value:p.laborPercentage,format:"percentage",icon:de,trend:"neutral"}),e.jsx(ee,{title:"Food Variance",value:p.foodVarianceCost,format:"currency",delta:p.foodVariancePercentage,deltaLabel:"% of Sales",icon:Ne,trend:p.foodVarianceCost>=0?"down":"up"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(ee,{title:"Waste Amount",value:p.wasteAmount,format:"currency",delta:p.wastePercentage,deltaLabel:"% of Sales",icon:Ne,trend:p.wasteAmount>=0?"down":"up"}),e.jsx(ee,{title:"Breakfast Sales",value:p.breakfastSales,format:"currency",icon:Me,trend:"neutral"}),e.jsx(ee,{title:"Night Sales",value:p.nightSales,format:"currency",icon:Me,trend:"neutral"}),e.jsx(ee,{title:"Comp Net Sales",value:p.compNetSales,format:"currency",icon:de,trend:p.compNetSales>=0?"up":"down"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsx(ye,{title:"Net Sales Trend",subtitle:"Last 30 days",loading:!n.length&&!m,error:m==null?void 0:m.message,children:n.length>0?e.jsx(Va,{data:n}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})}),e.jsx(ye,{title:"Labor Hours vs Ideal",subtitle:"Last 30 days",loading:!n.length&&!m,error:m==null?void 0:m.message,children:n.length>0?e.jsx(Pa,{data:n}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add entries in OMEGA Daily to see trends"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(qa,{}),e.jsx(Ha,{})]})]})}function $a({columns:s,data:a,mobileCardRender:t,className:i,emptyMessage:n="No data available",loading:x=!1}){if(x)return e.jsx(Ya,{columns:s});const c=m=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-2",children:s.map(p=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[p.label,":"]}),e.jsx("span",{className:"text-sm",children:p.render?p.render(m[p.key],m):m[p.key]})]},p.key))});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:w("hidden md:block",i),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(m=>e.jsx("th",{className:"text-left py-3 px-4 font-medium text-gray-700 text-sm",children:m.label},m.key))})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"py-8 px-4 text-center text-gray-500",children:n})}):a.map((m,p)=>e.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:s.map(g=>e.jsx("td",{className:w("py-3 px-4 text-sm",g.className),children:g.render?g.render(m[g.key],m):m[g.key]},g.key))},m.id||p))})]})})}),e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:n}):a.map((m,p)=>e.jsx("div",{children:t?t(m):c(m)},m.id||p))})})]})}function Ya({columns:s}){return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:s.map(a=>e.jsx("th",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})},a.key))})}),e.jsx("tbody",{children:[...Array(3)].map((a,t)=>e.jsx("tr",{className:"border-b border-gray-100",children:s.map(i=>e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"h-4 bg-gray-100 rounded w-full"})},i.key))},t))})]})})})}const Ba=me("/omega-daily")({component:Ka});function Ka(){const[s,a]=N.useState(!1),[t,i]=N.useState(null),{toast:n}=te(),x=Le(),[c,m]=N.useState(null),p=es("omega-daily","last30"),g=async()=>{if(!c){n({title:"Store not linked",description:"Please link your account to a store first.",variant:"destructive"});return}try{const r=[],u=new Date;for(let R=9;R>=0;R--){const M=new Date(u);M.setDate(M.getDate()-R),r.push({store_id:c,business_date:C(M,"yyyy-MM-dd"),net_sales:Math.floor(Math.random()*5e3)+8e3,last_year_sales:Math.floor(Math.random()*4e3)+7e3,labor_hours:Math.floor(Math.random()*40)+60,ideal_labor_hours:Math.floor(Math.random()*30)+50,labor_percentage:Math.floor(Math.random()*10)+15,food_variance_cost:Math.floor(Math.random()*200)-100,waste_amount:Math.floor(Math.random()*100)+50,breakfast_sales:Math.floor(Math.random()*1e3)+500,night_sales:Math.floor(Math.random()*1500)+1e3})}const{error:f}=await v.from("omega_daily").insert(r);if(f)throw f;n({title:"Sample data added!",description:"10 days of sample OMEGA entries have been created."}),x.invalidateQueries({queryKey:["omega_daily","last30",c]})}catch(r){n({title:"Error adding sample data",description:r.message,variant:"destructive"})}},d=()=>{x.invalidateQueries({queryKey:["omega_daily",c]}),n({title:"Refreshing data...",description:"Reloading your OMEGA entries."})},o=Ee({resolver:Se(Ea),defaultValues:{business_date:C(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}}),_=oe({onMutate:async r=>{if(!c)throw new Error("No store is linked to your account. See Setup to link one.");await x.cancelQueries({queryKey:["omega_daily"]});const u=`temp-${Date.now()}`,f={id:u,store_id:c,business_date:r.business_date,net_sales:r.net_sales,last_year_sales:r.last_year_sales,labor_hours:r.labor_hours,ideal_labor_hours:r.ideal_labor_hours,labor_percentage:r.labor_percentage,food_variance_cost:r.food_variance_cost,waste_amount:r.waste_amount,breakfast_sales:r.breakfast_sales,night_sales:r.night_sales},R=[],M=x.getQueriesData({queryKey:["omega_daily"]});for(const[B,ne]of M){const Z=B;if(!Z.includes(c))continue;let ss=!0;const ts=typeof Z[2]=="string"?String(Z[2]):void 0,as=typeof Z[3]=="string"?String(Z[3]):void 0;if(ts&&as&&(ss=r.business_date>=ts&&r.business_date<=as),!ss)continue;const rs=[f,...ne||[]];rs.sort((ns,is)=>ns.business_date>is.business_date?-1:ns.business_date<is.business_date?1:0),R.push({queryKey:B,previousData:ne}),x.setQueryData(B,rs)}return{optimisticId:u,touchedCaches:R}},mutationFn:async r=>{if(console.log("ð Starting insertMutation with payload:",r),console.log("ðª Store ID:",c),!c)throw console.error("â No store ID found"),new Error("No store is linked to your account. See Setup to link one.");const u={store_id:c,business_date:r.business_date,net_sales:r.net_sales,last_year_sales:r.last_year_sales,labor_hours:r.labor_hours,ideal_labor_hours:r.ideal_labor_hours,labor_percentage:r.labor_percentage,food_variance_cost:r.food_variance_cost,waste_amount:r.waste_amount,breakfast_sales:r.breakfast_sales,night_sales:r.night_sales};console.log("ð¤ Inserting data:",u);const{data:f,error:R}=await v.from("omega_daily").insert(u).select();if(console.log("ð¥ Supabase response - data:",f,"error:",R),R)throw console.error("â Supabase error:",R),R;return console.log("â Insert successful:",f),f},onError:(r,u,f)=>{if(f!=null&&f.touchedCaches)for(const{queryKey:R,previousData:M}of f.touchedCaches)x.setQueryData(R,M||[]);console.error("ð¥ Insert mutation failed (rolled back):",r),n({title:"Save failed",description:(r==null?void 0:r.message)||"Unable to save entry.",variant:"destructive"})},onSuccess:(r,u,f)=>{console.log("ð Insert mutation succeeded with data:",r),n({title:"Success!",description:"Daily metrics saved successfully."});const R=Array.isArray(r)&&r[0]?r[0]:void 0;if(R&&(f!=null&&f.touchedCaches)&&f.optimisticId)for(const{queryKey:M}of f.touchedCaches){const ne=(x.getQueryData(M)??[]).map(Z=>Z.id===f.optimisticId?R:Z);x.setQueryData(M,ne)}a(!1),i(null),o.reset()}}),T=oe({mutationFn:async({id:r,payload:u})=>{if(!c)throw new Error("No store is linked to your account. See Setup to link one.");const{error:f}=await v.from("omega_daily").update({business_date:u.business_date,net_sales:u.net_sales,last_year_sales:u.last_year_sales,labor_hours:u.labor_hours,ideal_labor_hours:u.ideal_labor_hours,labor_percentage:u.labor_percentage,food_variance_cost:u.food_variance_cost,waste_amount:u.waste_amount,breakfast_sales:u.breakfast_sales,night_sales:u.night_sales}).eq("id",r);if(f)throw f},onSuccess:()=>{n({title:"Updated!",description:"Daily metrics updated successfully."}),a(!1),i(null),o.reset(),x.invalidateQueries({queryKey:["omega_daily","last30",c]})},onError:r=>{n({title:"Update failed",description:r.message,variant:"destructive"})}}),j=r=>{console.log("ð onSubmit called with data:",r),console.log("ð Form errors:",o.formState.errors),console.log("ðª Store ID:",c),console.log("âï¸ Editing entry:",t),console.log("ð Insert mutation pending:",_.isPending),console.log("ð Update mutation pending:",T.isPending),t?(console.log("ð Calling updateMutation..."),T.mutate({id:t.id,payload:r})):(console.log("â Calling insertMutation..."),_.mutate(r))},O=r=>{console.error("â Form validation failed with errors:",r),n({title:"Validation Error",description:"Please check the form for errors and try again.",variant:"destructive"})},E=oe({mutationFn:async r=>{const{error:u}=await v.from("omega_daily").delete().eq("id",r);if(u)throw u},onSuccess:()=>{n({title:"Deleted",description:"Daily metrics entry removed."}),x.invalidateQueries({queryKey:["omega_daily","last30",c]})},onError:r=>{n({title:"Delete failed",description:r.message,variant:"destructive"})}});N.useEffect(()=>{let r=!0;return(async()=>{var ne;console.log("ð Checking user authentication...");const{data:u,error:f}=await v.auth.getUser();console.log("ð¤ Auth data:",u,"Auth error:",f);const R=(ne=u.user)==null?void 0:ne.id;if(!R){console.log("â No user ID found - user not authenticated");return}console.log("ð Looking up store for user:",R);const{data:M,error:B}=await v.from("users").select("store_id").eq("id",R).maybeSingle();if(console.log("ðª Store lookup result - data:",M,"error:",B),!!r){if(B){console.error("â Store lookup error:",B),n({title:"Connection Error",description:"Unable to connect to your store. Please check your setup.",variant:"destructive"});return}m((M==null?void 0:M.store_id)??null),console.log("â Store ID set to:",(M==null?void 0:M.store_id)??null),M!=null&&M.store_id||(console.log("â ï¸ No store linked to user account"),n({title:"Store Not Linked",description:"Your account isn't linked to a store yet. Please go to Setup to link your account.",variant:"destructive"}))}})(),()=>{r=!1}},[]);const h=p.getDateRangeFilter(),{data:D=[],isLoading:F,error:I}=Q({queryKey:["omega_daily",c,h==null?void 0:h.start,h==null?void 0:h.end],queryFn:async()=>{if(!c)return[];let r=v.from("omega_daily").select("*").eq("store_id",c);h&&(r=r.gte("business_date",h.start).lte("business_date",h.end));const{data:u,error:f}=await r.order("business_date",{ascending:!1}).limit(100);if(f)throw f;return u},enabled:!!c}),{data:q=[]}=Q({queryKey:["omega_daily_charts",c],queryFn:async()=>{if(!c)return[];const r=new Date;r.setDate(r.getDate()-30);const u=C(r,"yyyy-MM-dd"),{data:f,error:R}=await v.from("omega_daily").select("*").eq("store_id",c).gte("business_date",u).order("business_date",{ascending:!0});if(R)throw R;return f},enabled:!!c}),{data:H=[]}=Q({queryKey:["omega_daily_mtd",c],queryFn:async()=>{if(!c)return[];const{start:r,end:u}=Ge("mtd"),{data:f,error:R}=await v.from("omega_daily").select("*").eq("store_id",c).gte("business_date",r).lte("business_date",u).order("business_date",{ascending:!0});if(R)throw R;return f},enabled:!!c}),$=r=>{if(!r)return;p.handleRangeChange("custom");const u=Number(r.slice(0,4)),f=Number(r.slice(5,7)),R=Number(r.slice(8,10));p.handleDateChange(new Date(u,(f||1)-1,R||1))},Te=N.useMemo(()=>q.length?q.map(r=>({date:P.dateShort(r.business_date),dateFull:P.dateFull(r.business_date),isoDate:(typeof r.business_date=="string",r.business_date),comp_net_sales:(r.net_sales??0)-(r.last_year_sales??0)})):[],[q]),re=N.useMemo(()=>q.length?q.map(r=>({date:P.dateShort(r.business_date),dateFull:P.dateFull(r.business_date),isoDate:(typeof r.business_date=="string",r.business_date),waste_percentage:r.net_sales?r.waste_amount/r.net_sales*100:0,food_variance_percentage:r.net_sales?r.food_variance_cost/r.net_sales*100:0})):[],[q]),je=r=>{i(r);const u={business_date:r.business_date||C(new Date,"yyyy-MM-dd"),net_sales:r.net_sales!=null?Number(r.net_sales):0,last_year_sales:r.last_year_sales!=null?Number(r.last_year_sales):0,labor_hours:r.labor_hours!=null?Number(r.labor_hours):0,ideal_labor_hours:r.ideal_labor_hours!=null?Number(r.ideal_labor_hours):0,labor_percentage:r.labor_percentage!=null?Number(r.labor_percentage):0,food_variance_cost:r.food_variance_cost!=null?Number(r.food_variance_cost):0,waste_amount:r.waste_amount!=null?Number(r.waste_amount):0,breakfast_sales:r.breakfast_sales!=null?Number(r.breakfast_sales):0,night_sales:r.night_sales!=null?Number(r.night_sales):0};o.reset(u),a(!0)},l=r=>{E.mutate(r)},b=o.watch(),y=b.last_year_sales>0?(b.net_sales-b.last_year_sales)/b.last_year_sales*100:0,G=b.labor_hours-b.ideal_labor_hours,W=b.net_sales>0?b.food_variance_cost/b.net_sales*100:0,Y=b.net_sales>0?b.waste_amount/b.net_sales*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-wendys-charcoal",children:"Omega Daily"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Daily business metrics and performance tracking"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-2 md:items-center",children:[e.jsxs(S,{onClick:()=>{i(null),o.reset({business_date:C(new Date,"yyyy-MM-dd"),net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}),a(!0)},className:"wendys-button w-full md:w-auto",size:"sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Daily Entry"]}),c&&e.jsxs("div",{className:"flex space-x-2 md:space-x-0 md:flex-col md:space-y-2",children:[e.jsx(S,{onClick:g,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Sample Data"}),e.jsx(S,{onClick:d,variant:"outline",size:"sm",className:"flex-1 md:flex-none border-gray-400 text-gray-600 hover:bg-gray-100",children:"Refresh"})]})]})]}),e.jsx("div",{className:"wendys-card",children:(()=>{const r=H.reduce((M,B)=>M+(Number(B.net_sales)||0),0),u=H.length>0?H.reduce((M,B)=>M+(Number(B.labor_percentage)||0),0)/H.length:0,f=H.reduce((M,B)=>M+(Number(B.waste_amount)||0),0),R=r>0?f/r*100:0;return e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Net Sales"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:xe(r)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Labor %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:K(u)})]}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"MTD Waste %"}),e.jsx("p",{className:"mt-1 text-2xl sm:text-3xl font-bold text-wendys-charcoal",children:K(R)})]})]})})()}),e.jsx(Ze,{selectedRange:p.selectedRange,selectedDate:p.selectedDate,onRangeChange:p.handleRangeChange,onDateChange:p.handleDateChange,onClearFilters:p.clearFilters}),I&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:["Error loading data: ",I.message]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(ye,{title:"Comp Net Sales Trend",subtitle:"Last 30 days",loading:!q.length&&!I,error:I==null?void 0:I.message,children:Te.length>0?e.jsx(le,{width:"100%",height:300,children:e.jsxs(we,{data:Te,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:r=>P.currencyCompact(r)}),e.jsx(fe,{...U.tooltip,formatter:r=>[P.currencyDetailed(r),"Comp Sales"],labelFormatter:(r,u)=>{var f;return u&&u[0]&&((f=u[0].payload)==null?void 0:f.dateFull)||r}}),e.jsx(_e,{type:"monotone",dataKey:"comp_net_sales",stroke:k.sales,strokeWidth:2,dot:{fill:k.sales,strokeWidth:2,r:3},activeDot:{r:5,stroke:k.salesSecondary,strokeWidth:2},onClick:r=>{var u;return $((u=r==null?void 0:r.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ye,{title:"Waste Percentage",subtitle:"Last 30 days",loading:!q.length&&!I,error:I==null?void 0:I.message,children:re.length>0?e.jsx(le,{width:"100%",height:300,children:e.jsxs(Ps,{data:re,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:r=>P.percent(r)}),e.jsx(fe,{...U.tooltip,formatter:r=>[P.percent(r,2),"Waste %"],labelFormatter:(r,u)=>{var f;return u&&u[0]&&((f=u[0].payload)==null?void 0:f.dateFull)||r}}),e.jsx(ls,{y:.5,stroke:k.textSecondary,strokeDasharray:"4 4",label:{value:"Goal 0.5%",position:"right",fill:k.textSecondary,fontSize:12}}),e.jsx(qs,{dataKey:"waste_percentage",fill:k.waste,opacity:.7,onClick:r=>{var u;return $((u=r==null?void 0:r.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})}),e.jsx(ye,{title:"Food Variance",subtitle:"Last 30 days",loading:!q.length&&!I,error:I==null?void 0:I.message,children:re.length>0?e.jsx(le,{width:"100%",height:300,children:e.jsxs(we,{data:re,children:[e.jsx(he,{...U.cartesianGrid}),e.jsx(ge,{dataKey:"date",...U.xAxis}),e.jsx(pe,{...U.yAxis,tickFormatter:r=>P.percent(r)}),e.jsx(fe,{...U.tooltip,formatter:r=>[P.percent(r,2),"Food Variance %"],labelFormatter:(r,u)=>{var f;return u&&u[0]&&((f=u[0].payload)==null?void 0:f.dateFull)||r}}),e.jsx(ls,{y:0,stroke:k.textSecondary,strokeDasharray:"4 4",label:{value:"Target 0%",position:"right",fill:k.textSecondary,fontSize:12}}),e.jsx(_e,{type:"monotone",dataKey:"food_variance_percentage",stroke:k.foodVariance,strokeWidth:2,dot:{fill:k.foodVariance,strokeWidth:2,r:3},activeDot:{r:5,stroke:k.warning,strokeWidth:2},onClick:r=>{var u;return $((u=r==null?void 0:r.payload)==null?void 0:u.isoDate)}})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"No chart data available"}),e.jsx("p",{className:"text-sm mt-1",children:"Add some entries to see trends"})]})})})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:p.selectedRange==="last30"?"All Entries":"Filtered Entries"}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600 flex items-center",children:[F?"Loading...":`${D.length} entries`,p.selectedRange!=="last30"&&` for ${p.getSelectedLabel()}`,(p.selectedRange!=="last30"||p.selectedDate)&&e.jsx(S,{variant:"ghost",size:"sm",onClick:p.clearFilters,className:"ml-3 text-xs text-gray-600 hover:text-gray-900",children:"Show All"})]})]}),(D==null?void 0:D.length)===0&&!F?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:c?e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm mt-2",children:p.selectedRange==="last30"?"You haven't added any daily entries yet.":"No entries found for the selected filter. Try changing the filter or adding a new entry."})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Store not connected"}),e.jsx("p",{className:"text-sm mt-2",children:"Please go to Setup to link your account to a store first."})]})}),c&&e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 justify-center",children:[e.jsxs(S,{onClick:()=>a(!0),className:"wendys-button",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Your First Entry"]}),e.jsx(S,{onClick:g,variant:"outline",className:"border-wendys-red text-wendys-red hover:bg-wendys-red hover:text-white",children:"Generate Sample Data"})]})]}):e.jsx($a,{columns:[{key:"business_date",label:"Date",render:r=>X(r)},{key:"net_sales",label:"Net Sales",render:r=>xe(r)},{key:"comp_sales",label:"Comp Sales",render:(r,u)=>{const f=(u.net_sales??0)-(u.last_year_sales??0);return e.jsxs("span",{className:`flex items-center ${f>=0?"text-green-600":"text-red-600"}`,children:[f>=0?e.jsx(de,{className:"h-3 w-3 mr-1"}):e.jsx(Ne,{className:"h-3 w-3 mr-1"}),xe(Math.abs(f))]})}},{key:"labor_hours",label:"Labor Hours",render:r=>`${r}h`},{key:"labor_percentage",label:"Labor %",render:r=>K(r)},{key:"food_variance",label:"Food Variance",render:(r,u)=>{const f=u.net_sales?u.food_variance_cost/u.net_sales*100:0;return K(f)}},{key:"waste",label:"Waste",render:(r,u)=>{const f=u.net_sales?u.waste_amount/u.net_sales*100:0;return K(f)}},{key:"actions",label:"Actions",render:(r,u)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>je(u),className:"h-8 w-8 p-0",children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>{$(u.business_date),n({title:"Details",description:"Detailed view coming soon."})},className:"h-8 w-8 p-0",title:"View details",children:e.jsx(Us,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>l(u.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(He,{className:"h-4 w-4"})})]})}],data:D,mobileCardRender:r=>{const u=(r.net_sales??0)-(r.last_year_sales??0),f=r.net_sales?r.food_variance_cost/r.net_sales*100:0,R=r.net_sales?r.waste_amount/r.net_sales*100:0;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:X(r.business_date)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>je(r),className:"h-8 w-8 p-0",children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>l(r.id),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(He,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Net Sales:"}),e.jsx("div",{className:"font-medium",children:xe(r.net_sales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Comp Sales:"}),e.jsxs("div",{className:`font-medium flex items-center ${u>=0?"text-green-600":"text-red-600"}`,children:[u>=0?e.jsx(de,{className:"h-3 w-3 mr-1"}):e.jsx(Ne,{className:"h-3 w-3 mr-1"}),xe(Math.abs(u))]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Labor:"}),e.jsxs("div",{className:"font-medium",children:[r.labor_hours,"h (",K(r.labor_percentage),")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Food Variance:"}),e.jsx("div",{className:"font-medium",children:K(f)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Waste:"}),e.jsx("div",{className:"font-medium",children:K(R)})]})]})]})},emptyMessage:"No entries found",loading:F})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-wendys-charcoal",children:t?"Edit Daily Entry":"Add Daily Entry"}),e.jsx(S,{variant:"ghost",onClick:()=>{a(!1),i(null),o.reset()},className:"h-8 w-8 p-0",children:"Ã"})]}),e.jsxs("form",{onSubmit:o.handleSubmit(j,O),className:"space-y-4",children:[Object.keys(o.formState.errors).length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"Please fix the following errors:"}),e.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:Object.entries(o.formState.errors).map(([r,u])=>e.jsxs("li",{children:["â¢ ",u==null?void 0:u.message]},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Business Date"}),e.jsxs(Je,{children:[e.jsx(Xe,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),o.watch("business_date")?X(o.watch("business_date")):"Pick a date"]})}),e.jsx(ke,{className:"w-auto p-0",children:e.jsx(Ie,{mode:"single",selected:(()=>{const r=o.watch("business_date");if(!r)return;const u=Number(r.slice(0,4)),f=Number(r.slice(5,7)),R=Number(r.slice(8,10));return new Date(u,(f||1)-1,R||1)})(),onSelect:r=>{const u=r?C(r,"yyyy-MM-dd"):"";if(o.setValue("business_date",u),u){const f=D.find(R=>R.business_date===u);f?(i(f),o.reset({business_date:f.business_date,net_sales:f.net_sales!=null?Number(f.net_sales):0,last_year_sales:f.last_year_sales!=null?Number(f.last_year_sales):0,labor_hours:f.labor_hours!=null?Number(f.labor_hours):0,ideal_labor_hours:f.ideal_labor_hours!=null?Number(f.ideal_labor_hours):0,labor_percentage:f.labor_percentage!=null?Number(f.labor_percentage):0,food_variance_cost:f.food_variance_cost!=null?Number(f.food_variance_cost):0,waste_amount:f.waste_amount!=null?Number(f.waste_amount):0,breakfast_sales:f.breakfast_sales!=null?Number(f.breakfast_sales):0,night_sales:f.night_sales!=null?Number(f.night_sales):0}),n({title:"Loaded existing entry",description:`Loaded data for ${X(f.business_date)} to edit.`})):(i(null),o.reset({business_date:u,net_sales:0,last_year_sales:0,labor_hours:0,ideal_labor_hours:0,labor_percentage:0,food_variance_cost:0,waste_amount:0,breakfast_sales:0,night_sales:0}))}},initialFocus:!0})})]}),o.formState.errors.business_date&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.business_date.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"net_sales",children:"Net Sales ($)"}),e.jsx(L,{id:"net_sales",type:"number",step:"0.01",...o.register("net_sales")}),o.formState.errors.net_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.net_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"last_year_sales",children:"Last Year Sales ($)"}),e.jsx(L,{id:"last_year_sales",type:"number",step:"0.01",...o.register("last_year_sales")}),o.formState.errors.last_year_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.last_year_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"comp_net_sales",children:"Comp Net Sales (%)"}),e.jsx(L,{id:"comp_net_sales",value:K(y),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"labor_hours",children:"Labor Hours"}),e.jsx(L,{id:"labor_hours",type:"number",step:"0.1",...o.register("labor_hours")}),o.formState.errors.labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"ideal_labor_hours",children:"Ideal Labor Hours"}),e.jsx(L,{id:"ideal_labor_hours",type:"number",step:"0.1",...o.register("ideal_labor_hours")}),o.formState.errors.ideal_labor_hours&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.ideal_labor_hours.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"labor_hours_diff",children:"Labor Hours +/-"}),e.jsx(L,{id:"labor_hours_diff",value:`${G>=0?"+":""}${G.toFixed(1)}h`,disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"labor_percentage",children:"Labor Percentage (%)"}),e.jsx(L,{id:"labor_percentage",type:"number",step:"0.1",...o.register("labor_percentage")}),o.formState.errors.labor_percentage&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.labor_percentage.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"food_variance_cost",children:"Food Variance Cost ($)"}),e.jsx(L,{id:"food_variance_cost",type:"number",step:"0.01",...o.register("food_variance_cost")}),o.formState.errors.food_variance_cost&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.food_variance_cost.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"food_variance_percentage",children:"Food Variance %"}),e.jsx(L,{id:"food_variance_percentage",value:K(W),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"waste_amount",children:"Waste Amount ($)"}),e.jsx(L,{id:"waste_amount",type:"number",step:"0.01",...o.register("waste_amount")}),o.formState.errors.waste_amount&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.waste_amount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"waste_percentage",children:"Waste %"}),e.jsx(L,{id:"waste_percentage",value:K(Y),disabled:!0,className:"bg-gray-100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"breakfast_sales",children:"Breakfast Sales ($)"}),e.jsx(L,{id:"breakfast_sales",type:"number",step:"0.01",...o.register("breakfast_sales")}),o.formState.errors.breakfast_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.breakfast_sales.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"night_sales",children:"Night Sales ($)"}),e.jsx(L,{id:"night_sales",type:"number",step:"0.01",...o.register("night_sales")}),o.formState.errors.night_sales&&e.jsx("p",{className:"text-sm text-red-600",children:o.formState.errors.night_sales.message})]})]}),!c&&e.jsx("div",{className:"text-sm text-red-600",children:"Your account isnât linked to a store yet. Open Setup and link your user to a store, then try again."}),e.jsxs("div",{className:"flex flex-col-reverse space-y-2 space-y-reverse md:flex-row md:space-y-0 md:space-x-3 pt-4 md:col-span-2",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>{a(!1),i(null),o.reset()},className:"w-full md:w-auto",children:"Cancel"}),e.jsx(S,{type:"submit",className:"wendys-button w-full md:w-auto",disabled:_.isPending||T.isPending||!c,children:t?"Update Entry":"Save Entry"})]})]})]})})]})}const gs=zt,ps=Gt,$e=N.forwardRef(({className:s,children:a,...t},i)=>e.jsxs(Ws,{ref:i,className:w("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[a,e.jsx(Vt,{asChild:!0,children:e.jsx(Ke,{className:"h-4 w-4 opacity-50"})})]}));$e.displayName=Ws.displayName;const at=N.forwardRef(({className:s,...a},t)=>e.jsx(zs,{ref:t,className:w("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Vs,{className:"h-4 w-4"})}));at.displayName=zs.displayName;const rt=N.forwardRef(({className:s,...a},t)=>e.jsx(Gs,{ref:t,className:w("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Ke,{className:"h-4 w-4"})}));rt.displayName=Gs.displayName;const Ye=N.forwardRef(({className:s,children:a,position:t="popper",...i},n)=>e.jsx(Pt,{children:e.jsxs($s,{ref:n,className:w("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...i,children:[e.jsx(at,{}),e.jsx(qt,{className:w("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(rt,{})]})}));Ye.displayName=$s.displayName;const Qa=N.forwardRef(({className:s,...a},t)=>e.jsx(Ys,{ref:t,className:w("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a}));Qa.displayName=Ys.displayName;const J=N.forwardRef(({className:s,children:a,...t},i)=>e.jsxs(Bs,{ref:i,className:w("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ht,{children:e.jsx(Cs,{className:"h-4 w-4"})})}),e.jsx(Wt,{children:a})]}));J.displayName=Bs.displayName;const Ja=N.forwardRef(({className:s,...a},t)=>e.jsx(Ks,{ref:t,className:w("-mx-1 my-1 h-px bg-muted",s),...a}));Ja.displayName=Ks.displayName;const nt=N.forwardRef(({className:s,...a},t)=>e.jsx("textarea",{className:w("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a}));nt.displayName="Textarea";const Xa=me("/interviews")({component:Za});function Za(){const s=Le(),[a,t]=N.useState(null),[i,n]=N.useState(!1),[x,c]=N.useState(null),[m,p]=N.useState(null),[g,d]=N.useState(""),[o,_]=N.useState("ALL"),{toast:T}=te(),j=Ee({resolver:Se(Ta),defaultValues:{candidate_name:"",phone:"",email:"",position:"",interview_date:C(new Date,"yyyy-MM-dd"),interview_time:"10:00",status:"SCHEDULED",notes:""}});N.useEffect(()=>{let l=!0;return(async()=>{var r;console.log("ð [Interviews] Checking user authentication...");const{data:b,error:y}=await v.auth.getUser();console.log("ð¤ [Interviews] Auth data:",b,"Auth error:",y);const G=(r=b.user)==null?void 0:r.id;if(!G){console.log("â [Interviews] No user ID found - user not authenticated");return}console.log("ð [Interviews] Looking up store for user:",G);const{data:W,error:Y}=await v.from("users").select("store_id").eq("id",G).maybeSingle();if(console.log("ðª [Interviews] Store lookup result - data:",W,"error:",Y),!!l){if(Y){console.error("â [Interviews] Store lookup error:",Y);return}t((W==null?void 0:W.store_id)??null),console.log("â [Interviews] Store ID set to:",(W==null?void 0:W.store_id)??null)}})(),()=>{l=!1}},[]);const{data:O=[],isLoading:E}=Q({queryKey:["interviews",a],queryFn:async()=>{if(!a)return console.log("â ï¸ [Interviews] No store ID, skipping fetch"),[];console.log("ð [Interviews] Fetching interviews for store:",a);const{data:l,error:b}=await v.from("interviews").select("*").eq("store_id",a).order("interview_date",{ascending:!0}).order("interview_time",{ascending:!0});if(console.log("ð [Interviews] Fetch result - data:",l,"error:",b),b)throw b;return l||[]},enabled:!!a}),{data:h=[]}=Q({queryKey:["hires",a],queryFn:async()=>{if(!a)return[];const{data:l,error:b}=await v.from("hires").select("*").eq("store_id",a);if(b)throw b;return l||[]},enabled:!!a}),D=N.useMemo(()=>{const l=new Map;for(const b of h)l.set(b.interview_id,b);return l},[h]),F=oe({mutationFn:async l=>{if(!a)throw new Error("No store selected");if(console.log("ð [Interviews] Mutation payload:",l),console.log("ð [Interviews] Status value:",l.status,"Type:",typeof l.status),l.id){console.log("ð [Interviews] Updating interview with ID:",l.id);const b=[];if(l.status){const{error:y}=await v.from("interviews").update({status:l.status}).eq("id",l.id);y?(console.error("â [Interviews] Status update failed:",y),b.push(`Status: ${y.message}`)):console.log("â [Interviews] Status updated successfully")}if(l.candidate_name){const{error:y}=await v.from("interviews").update({candidate_name:l.candidate_name}).eq("id",l.id);y&&(console.error("â [Interviews] Name update failed:",y),b.push(`Name: ${y.message}`))}if(l.phone!==void 0){const{error:y}=await v.from("interviews").update({phone:l.phone||null}).eq("id",l.id);y&&(console.error("â [Interviews] Phone update failed:",y),b.push(`Phone: ${y.message}`))}if(l.email!==void 0){const{error:y}=await v.from("interviews").update({email:l.email||null}).eq("id",l.id);y&&(console.error("â [Interviews] Email update failed:",y),b.push(`Email: ${y.message}`))}if(l.position!==void 0){const{error:y}=await v.from("interviews").update({position:l.position||""}).eq("id",l.id);y&&(console.error("â [Interviews] Position update failed:",y),b.push(`Position: ${y.message}`))}if(l.interview_date){const{error:y}=await v.from("interviews").update({interview_date:l.interview_date}).eq("id",l.id);y&&(console.error("â [Interviews] Date update failed:",y),b.push(`Date: ${y.message}`))}if(l.interview_time){const{error:y}=await v.from("interviews").update({interview_time:l.interview_time}).eq("id",l.id);y&&(console.error("â [Interviews] Time update failed:",y),b.push(`Time: ${y.message}`))}if(l.notes!==void 0){const{error:y}=await v.from("interviews").update({notes:l.notes||null}).eq("id",l.id);y&&(console.error("â [Interviews] Notes update failed:",y),b.push(`Notes: ${y.message}`))}if(b.length>0)throw new Error(`Some updates failed: ${b.join(", ")}`);return}else{console.log("ð [Interviews] Inserting new interview");const b={store_id:a,candidate_name:l.candidate_name,phone:l.phone||null,email:l.email||null,position:l.position||"",interview_date:l.interview_date,interview_time:l.interview_time,status:l.status,notes:l.notes||null};console.log("ð [Interviews] Final insert payload:",JSON.stringify(b,null,2));const{error:y}=await v.from("interviews").insert([b]);if(y)throw console.error("â [Interviews] Supabase insert error:",y),console.error("â [Interviews] Error details:",{code:y.code,message:y.message,details:y.details,hint:y.hint}),y;return}},onSuccess:()=>{s.invalidateQueries({queryKey:["interviews",a]}),T({title:"Success!",description:x?"Interview updated successfully.":"Interview scheduled successfully."}),n(!1),c(null),j.reset()},onError:l=>{T({title:"Error",description:l.message||"Failed to save interview",variant:"destructive"})}}),I=oe({mutationFn:async l=>{const{error:b}=await v.from("interviews").delete().eq("id",l);if(b)throw b},onSuccess:()=>{s.invalidateQueries({queryKey:["interviews",a]}),T({title:"Deleted!",description:"Interview removed successfully."})},onError:l=>{T({title:"Error",description:l.message||"Failed to delete interview",variant:"destructive"})}}),q=l=>{console.log("ð [Interviews] Form submitted with data:",l),console.log("ð [Interviews] Status from form:",l.status,"Type:",typeof l.status),F.mutate(x?{id:x.id,...l}:l)},H=l=>{console.log("ð [Interviews] Editing interview:",l),console.log("ð [Interviews] Interview status from DB:",l.status,"Type:",typeof l.status),c(l),j.reset({candidate_name:l.candidate_name,phone:l.phone||"",email:l.email||"",position:l.position||"",interview_date:l.interview_date,interview_time:l.interview_time,status:l.status,notes:l.notes||""}),n(!0)},$=l=>{I.mutate(l)},Te=l=>{const b=D.get(l.id);p({...l,hire:b})},re=N.useMemo(()=>{const l=O||[],b=g.toLowerCase();return l.filter(y=>{const G=y.candidate_name.toLowerCase().includes(b)||(y.position||"").toLowerCase().includes(b),W=o==="ALL"||y.status===o;return G&&W})},[O,g,o]),je=N.useMemo(()=>re.reduce((l,b)=>{const y=b.interview_date;return l[y]||(l[y]=[]),l[y].push(b),l},{}),[re]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Interviews & New Hires"}),e.jsx("p",{className:"text-gray-600",children:"Manage candidate interviews and track the hiring process"})]}),e.jsxs(S,{onClick:()=>n(!0),className:"wendys-button",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Schedule Interview"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(S,{variant:"outline",onClick:async()=>{if(a)try{const l=[{store_id:a,candidate_name:"Test - DONE",phone:"555-0001",email:"test1@example.com",position:"Crew",interview_date:new Date().toISOString().split("T")[0],interview_time:"10:00:00",status:"DONE",notes:"Test DONE status"},{store_id:a,candidate_name:"Test - NO_SHOW",phone:"555-0002",email:"test2@example.com",position:"Crew",interview_date:new Date().toISOString().split("T")[0],interview_time:"11:00:00",status:"NO_SHOW",notes:"Test NO_SHOW status"},{store_id:a,candidate_name:"Test - HIRED",phone:"555-0003",email:"test3@example.com",position:"Crew",interview_date:new Date().toISOString().split("T")[0],interview_time:"12:00:00",status:"HIRED",notes:"Test HIRED status"},{store_id:a,candidate_name:"Test - REJECTED",phone:"555-0004",email:"test4@example.com",position:"Crew",interview_date:new Date().toISOString().split("T")[0],interview_time:"13:00:00",status:"REJECTED",notes:"Test REJECTED status"}];for(const b of l){const{error:y}=await v.from("interviews").insert(b);y?console.error("Error inserting:",y):console.log("â Inserted:",b.status)}window.location.reload()}catch(l){console.error("Error inserting sample data:",l)}},className:"text-xs",children:"Insert Sample Data (for testing all statuses)"}),e.jsx(S,{variant:"outline",onClick:async()=>{if(a)try{console.log("ð [Debug] Testing direct Supabase operations...");const{data:l,error:b}=await v.from("interviews").select("id, status").eq("store_id",a).limit(1);if(b){console.error("â [Debug] Failed to fetch test data:",b);return}if(l&&l.length>0){const y=l[0].id,G=l[0].status;console.log(`ð [Debug] Testing update on interview ${y}, current status: ${G}`);const{error:W}=await v.from("interviews").update({status:"DONE"}).eq("id",y);W?console.error("â [Debug] Status update failed:",W):console.log("â [Debug] Status update succeeded")}else console.log("â ï¸ [Debug] No interviews found to test with")}catch(l){console.error("â [Debug] Exception in test:",l)}},className:"text-xs ml-2",children:"Test Status Update"}),e.jsx(S,{variant:"outline",onClick:async()=>{if(a)try{console.log("ð [Debug] Testing different status values...");const{data:l,error:b}=await v.from("interviews").select("id, status").eq("store_id",a).limit(1);if(b||!l||l.length===0){console.error("â [Debug] No test interview found:",b);return}const y=l[0].id,G=l[0].status;console.log(`ð [Debug] Testing on interview ${y}, current status: ${G}`);const W=["SCHEDULED","DONE","NO_SHOW","HIRED","REJECTED","scheduled","done","no_show","hired","rejected"];for(const Y of W)try{console.log(`ð [Debug] Testing status: "${Y}"`);const{error:r}=await v.from("interviews").update({status:Y}).eq("id",y);if(r)console.log(`â [Debug] "${Y}" failed:`,r.message);else{console.log(`â [Debug] "${Y}" succeeded!`),await v.from("interviews").update({status:G}).eq("id",y);break}}catch(r){console.log(`â [Debug] "${Y}" exception:`,r)}}catch(l){console.error("â [Debug] Exception in status test:",l)}},className:"text-xs ml-2",children:"Test All Statuses"}),e.jsx(S,{variant:"outline",onClick:async()=>{if(a)try{console.log("ð [Debug] Testing database connection and schema...");const{data:l,error:b}=await v.from("interviews").select("*").limit(1);b?console.error("â [Debug] Read test failed:",b):console.log("â [Debug] Read test succeeded, data:",l);const{data:{user:y},error:G}=await v.auth.getUser();G?console.error("â [Debug] User check failed:",G):console.log("â [Debug] Current user:",y==null?void 0:y.id),console.log("ð [Debug] Checking actual database enum values...");const{data:W,error:Y}=await v.rpc("get_enum_values",{enum_name:"interview_status"});if(Y){console.log("â ï¸ [Debug] Enum check failed (trying alternative):",Y);const{data:r,error:u}=await v.from("interviews").select("status").limit(100);if(u)console.error("â [Debug] Failed to get existing statuses:",u);else{const f=[...new Set(r.map(R=>R.status))];console.log("ð [Debug] Found statuses in database:",f)}}else console.log("â [Debug] Database enum values:",W)}catch(l){console.error("â [Debug] Exception in connection test:",l)}},className:"text-xs ml-2",children:"Test Connection"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx($t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(L,{placeholder:"Search by name or position...",value:g,onChange:l=>d(l.target.value),className:"pl-10"})]})}),e.jsxs(gs,{value:o,onValueChange:_,children:[e.jsx($e,{className:"w-full sm:w-48",children:e.jsx(ps,{placeholder:"Filter by status"})}),e.jsxs(Ye,{children:[e.jsx(J,{value:"ALL",children:"All Statuses"}),e.jsx(J,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(J,{value:"DONE",children:"Completed"}),e.jsx(J,{value:"NO_SHOW",children:"No Show"}),e.jsx(J,{value:"HIRED",children:"Hired"}),e.jsx(J,{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[E&&e.jsx("div",{className:"text-center text-gray-500",children:"Loading interviews..."}),!E&&Object.keys(je).length===0&&e.jsx("div",{className:"text-center text-gray-500",children:"No interviews found."}),Object.entries(je).map(([l,b])=>e.jsxs("div",{className:"wendys-card",children:[e.jsxs("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-4 flex items-center",children:[e.jsx(be,{className:"h-5 w-5 mr-2"}),X(l)]}),e.jsx("div",{className:"space-y-3",children:b.map(y=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-wendys-charcoal",children:y.candidate_name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${We(y.status)}`,children:y.status.replace("_"," ")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Hs,{className:"h-4 w-4"}),e.jsx("span",{children:y.position})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:ds(y.interview_time)})]}),y.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{className:"h-4 w-4"}),e.jsx("span",{children:y.phone})]}),y.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:y.email})]})]}),y.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:y.notes})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>Te(y),className:"h-8 w-8 p-0",children:e.jsx(Bt,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>H(y),className:"h-8 w-8 p-0",children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>$(y.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(He,{className:"h-4 w-4"})})]})]})},y.id))})]},l))]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:x?"Edit Interview":"Schedule Interview"}),e.jsx(S,{variant:"ghost",onClick:()=>{n(!1),c(null),j.reset()},className:"h-8 w-8 p-0",children:"Ã"})]}),e.jsxs("form",{onSubmit:j.handleSubmit(q),className:"space-y-4",children:[!a&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 text-sm text-yellow-800",children:"Your account isnât linked to a store yet. Open Setup and link your user to a store before adding interviews."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"candidate_name",children:"Candidate Name *"}),e.jsx(L,{id:"candidate_name",...j.register("candidate_name"),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"position",children:"Position"}),e.jsx(L,{id:"position",...j.register("position"),placeholder:"e.g., Team Member, Shift Leader"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"phone",children:"Phone"}),e.jsx(L,{id:"phone",...j.register("phone"),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",children:"Email"}),e.jsx(L,{id:"email",type:"email",...j.register("email"),placeholder:"candidate@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"interview_date",children:"Interview Date *"}),e.jsx(L,{id:"interview_date",type:"date",...j.register("interview_date")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"interview_time",children:"Interview Time *"}),e.jsx(L,{id:"interview_time",type:"time",...j.register("interview_time")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"status",children:"Status *"}),e.jsxs(gs,{value:j.watch("status"),onValueChange:l=>j.setValue("status",l),children:[e.jsx($e,{id:"status",children:e.jsx(ps,{})}),e.jsxs(Ye,{children:[e.jsx(J,{value:"SCHEDULED",children:"Scheduled"}),e.jsx(J,{value:"DONE",children:"Completed"}),e.jsx(J,{value:"NO_SHOW",children:"No Show"}),e.jsx(J,{value:"HIRED",children:"Hired"}),e.jsx(J,{value:"REJECTED",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"notes",children:"Notes"}),e.jsx(nt,{id:"notes",...j.register("notes"),placeholder:"Additional notes about the candidate...",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>{n(!1),c(null),j.reset()},children:"Cancel"}),e.jsx(S,{type:"submit",className:"wendys-button",disabled:F.isPending||!a,children:x?"Update Interview":"Schedule Interview"})]})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-wendys-charcoal",children:["Candidate: ",m.candidate_name]}),e.jsx(S,{variant:"ghost",onClick:()=>p(null),className:"h-8 w-8 p-0",children:"Ã"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Interview Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Position:"}),e.jsx("span",{className:"font-medium",children:m.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:X(m.interview_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Time:"}),e.jsx("span",{className:"font-medium",children:ds(m.interview_time)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${We(m.status)}`,children:m.status.replace("_"," ")})]}),m.phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsx("span",{className:"font-medium",children:m.phone})]}),m.email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:m.email})]}),m.notes&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-gray-600",children:"Notes:"}),e.jsx("p",{className:"text-sm bg-gray-50 p-3 rounded",children:m.notes})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal",children:"Hiring Process"}),m.hire?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Documents Received"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Onboarding Sent"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.onboarding_sent_date),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Onboarding Completed"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.onboarding_completed_date),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Manager Reviewed"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.manager_reviewed_date),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Entered in System"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.entered_in_system_date),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"Fingerprint Scheduled"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.fingerprint_scheduled_date),")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"First Day"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",X(m.hire.first_day),")"]})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(S,{className:"wendys-button w-full",children:[e.jsx(Kt,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No hiring process started yet."}),e.jsx(S,{className:"wendys-button",children:"Start Hiring Process"})]})]})]})]})})]})}const er=ce({sales_target:z.number().min(0),labor_target_pct:z.number().min(0),waste_target_pct:z.number().min(0),food_variance_target_pct:z.number().min(0),team_notes:V().optional()});function sr(){const{toast:s}=te(),a=Le(),[t,i]=N.useState(null),n=es("goals","wtd"),x=n.getDateRangeFilter(),c=(x==null?void 0:x.start)||C(new Date,"yyyy-MM-dd"),m=(x==null?void 0:x.end)||C(new Date,"yyyy-MM-dd"),p=n.selectedRange==="mtd"?"month":n.selectedRange==="wtd"?"week":"custom",g=Ee({resolver:Se(er),defaultValues:{sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""}});N.useEffect(()=>{let E=!0;return(async()=>{var q;const{data:h}=await v.auth.getUser(),D=(q=h.user)==null?void 0:q.id;if(!D)return;const{data:F,error:I}=await v.from("users").select("store_id").eq("id",D).maybeSingle();E&&(I||i((F==null?void 0:F.store_id)??null))})(),()=>{E=!1}},[]);const{data:d}=Q({queryKey:["goals_settings",t,c,m],queryFn:async()=>{if(!t)return null;try{const{data:E,error:h}=await v.from("goals").select("*").eq("store_id",t).eq("period_start",c).eq("period_end",m).maybeSingle();if(h&&h.code!=="PGRST116"){const D=String(h.code||""),F=String(h.message||"");if(D.startsWith("42")||F.toLowerCase().includes("relation")||F.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw h}return E||null}catch(E){const h=String((E==null?void 0:E.code)||""),D=String((E==null?void 0:E.message)||"");if(h.startsWith("42")||D.toLowerCase().includes("relation")||D.toLowerCase().includes("does not exist"))return console.warn("[Goals] Goals table not available; returning null"),null;throw E}},enabled:!!t});N.useEffect(()=>{d&&g.reset({sales_target:d.sales_target,labor_target_pct:d.labor_target_pct,waste_target_pct:d.waste_target_pct,food_variance_target_pct:d.food_variance_target_pct,team_notes:d.team_notes||""})},[d]);const{data:o=[]}=Q({queryKey:["omega_daily_for_goals",t,c,m],queryFn:async()=>{if(!t)return[];const{data:E,error:h}=await v.from("omega_daily").select("*").eq("store_id",t).gte("business_date",c).lte("business_date",m).order("business_date",{ascending:!0});if(h)throw h;return E},enabled:!!t}),_=N.useMemo(()=>{const E=o.reduce((H,$)=>H+(Number($.net_sales)||0),0),h=o.length>0?o.reduce((H,$)=>H+(Number($.labor_percentage)||0),0)/o.length:0,D=o.reduce((H,$)=>H+(Number($.waste_amount)||0),0),F=o.reduce((H,$)=>H+(Number($.food_variance_cost)||0),0),I=E>0?D/E*100:0,q=E>0?F/E*100:0;return{totalSales:E,avgLaborPct:h,wastePct:I,foodVarPct:q}},[o]),T=oe({mutationFn:async E=>{if(!t)throw new Error("No store is linked to your account. See Setup to link one.");const h={store_id:t,scope:p,period_start:c,period_end:m,sales_target:E.sales_target,labor_target_pct:E.labor_target_pct,waste_target_pct:E.waste_target_pct,food_variance_target_pct:E.food_variance_target_pct,team_notes:E.team_notes||null},{error:D}=await v.from("goals").upsert(h,{onConflict:"store_id,period_start,period_end"});if(D){const F=String(D.code||""),I=String(D.message||"");throw F.startsWith("42")||I.toLowerCase().includes("relation")||I.toLowerCase().includes("does not exist")?new Error("Goals table is not installed in this Supabase project. Open Setup and run the SQL to create it, then try again."):D}},onSuccess:()=>{s({title:"Saved",description:"Goals saved for selected period."}),a.invalidateQueries({queryKey:["goals_settings",t,c,m]})},onError:E=>{s({title:"Save failed",description:E.message,variant:"destructive"})}}),j=()=>{g.reset({sales_target:0,labor_target_pct:25,waste_target_pct:.5,food_variance_target_pct:.5,team_notes:""})},O=(E,h)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${E?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:h});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-wendys-charcoal",children:"Goal Setting"}),e.jsx("p",{className:"text-gray-600",children:"Set targets and track progress against Omega Daily actuals"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",onClick:j,children:"Reset Goals"}),e.jsx(S,{className:"wendys-button",onClick:g.handleSubmit(E=>T.mutate(E)),disabled:!t||T.isPending,children:"Save Goals"})]})]}),e.jsx(Ze,{selectedRange:n.selectedRange,selectedDate:n.selectedDate,onRangeChange:n.handleRangeChange,onDateChange:n.handleDateChange,onClearFilters:n.clearFilters}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Sales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target"}),e.jsx(L,{type:"number",step:"0.01",...g.register("sales_target")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual"}),e.jsxs("p",{className:"text-xl font-semibold",children:["$",_.totalSales.toLocaleString()]})]})]}),e.jsx("div",{children:O(_.totalSales>=(g.watch("sales_target")||0),_.totalSales>=(g.watch("sales_target")||0)?"On Track":"Behind")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Labor"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Target %"}),e.jsx(L,{type:"number",step:"0.1",...g.register("labor_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[_.avgLaborPct.toFixed(1),"%"]})]})]}),e.jsx("div",{children:O(_.avgLaborPct<=(g.watch("labor_target_pct")||0),_.avgLaborPct<=(g.watch("labor_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Waste & Food"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Target %"}),e.jsx(L,{type:"number",step:"0.1",...g.register("waste_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Waste Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[_.wastePct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:O(_.wastePct<=(g.watch("waste_target_pct")||0),_.wastePct<=(g.watch("waste_target_pct")||0)?"On Track":"High")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Target %"}),e.jsx(L,{type:"number",step:"0.1",...g.register("food_variance_target_pct")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Food Var Actual %"}),e.jsxs("p",{className:"text-xl font-semibold",children:[_.foodVarPct.toFixed(2),"%"]})]})]}),e.jsx("div",{children:O(_.foodVarPct<=(g.watch("food_variance_target_pct")||0),_.foodVarPct<=(g.watch("food_variance_target_pct")||0)?"On Track":"High")})]})]}),e.jsxs("div",{className:"wendys-card md:col-span-2 xl:col-span-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-wendys-charcoal mb-3",children:"Team & Personal"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"team_notes",children:"Notes"}),e.jsx(L,{id:"team_notes",...g.register("team_notes"),placeholder:"Notes, personal goals, shout-outs..."})]})})]})]})]})}const tr=me("/goals")({component:sr}),ar=me("/")({beforeLoad:()=>{throw Qt({to:"/overview"})}}),rr=Oa.update({id:"/smg",path:"/smg",getParentRoute:()=>ae}),nr=Ua.update({id:"/setup",path:"/setup",getParentRoute:()=>ae}),ir=za.update({id:"/overview",path:"/overview",getParentRoute:()=>ae}),or=Ba.update({id:"/omega-daily",path:"/omega-daily",getParentRoute:()=>ae}),lr=Xa.update({id:"/interviews",path:"/interviews",getParentRoute:()=>ae}),dr=tr.update({id:"/goals",path:"/goals",getParentRoute:()=>ae}),cr=ar.update({id:"/",path:"/",getParentRoute:()=>ae}),mr={IndexRoute:cr,GoalsRoute:dr,InterviewsRoute:lr,OmegaDailyRoute:or,OverviewRoute:ir,SetupRoute:nr,SmgRoute:rr},ur=ae._addFileChildren(mr)._addFileTypes(),it=new Jt({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),xr=Xt({routeTree:ur,context:{queryClient:it},defaultPreload:"intent"});Zt.createRoot(document.getElementById("root")).render(e.jsx(ie.StrictMode,{children:e.jsxs(ea,{client:it,children:[e.jsx(sa,{router:xr}),e.jsx(ma,{}),e.jsx(ta,{initialIsOpen:!1})]})}));
